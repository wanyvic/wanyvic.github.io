<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/corgi_32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/corgi_16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="l0k1Y36UcsrN3dPCcAYthwLa5h11Gn8uU_6590PS-LM">
  <meta name="baidu-site-verification" content="code-XQEfkj505K">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"wanyvic.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.10.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Wanyvicの博客">
<meta property="og:url" content="https://wanyvic.github.io/page/2/index.html">
<meta property="og:site_name" content="Wanyvicの博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="wanyvic">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://wanyvic.github.io/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Wanyvicの博客</title>
  




<link rel="dns-prefetch" href="https://waline-kappa-three.vercel.app"><link rel="stylesheet" type="text/css" href="/css/injector/main.css" /><link rel="preload" as="style" href="/css/injector/light.css" /><link rel="preload" as="style" href="/css/injector/dark.css" />
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Wanyvicの博客</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">区块链攻城狮</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">49</span></a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">4</span></a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">42</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="wanyvic"
      src="/images/ProfilePhoto.PNG">
  <p class="site-author-name" itemprop="name">wanyvic</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">42</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">49</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/wanyvic" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wanyvic" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:q873040807@gmail.com" title="E-Mail → mailto:q873040807@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

  <a href="https://github.com/wanyvic" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wanyvic.github.io/posts/1b44cf2e/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ProfilePhoto.PNG">
      <meta itemprop="name" content="wanyvic">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wanyvicの博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/1b44cf2e/" class="post-title-link" itemprop="url">Star-Atlas、Fancy-Birds和DefiKingdoms 分析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-12 13:57:00" itemprop="dateCreated datePublished" datetime="2022-01-12T13:57:00+08:00">2022-01-12</time>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/posts/1b44cf2e/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/posts/1b44cf2e/" data-xid="/posts/1b44cf2e/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Star-Atlas"><a class="header-anchor" href="#Star-Atlas"> </a>Star Atlas</h1>
<p>官网：<a target="_blank" rel="noopener" href="https://staratlas.com/">https://staratlas.com/</a></p>
<p>Star Atlas是一个基于2620年的虚拟元宇宙游戏。基于虚幻5开发的3A MMORPG游戏（链游版的EVE）。故事背景设定在 2620 年，在官方设定中，宇宙分为了三大派系：由人类统治的 MUD 领地；外星种族联盟的 ONI 区域；知觉机器人控制的 Ustur 星区。三大派系为资源、领土和统治权进行着持续的战争。玩家可自由加入其中一方，为自己的派系贡献力量。而玩家的行为则将直接影响这场星际冲突的结果，通过在游戏中做出贡献，玩家可获得代币奖励。</p>
<p>特点：</p>
<ul>
<li>资产链上化（NFT）：舰船、船员、宠物、组件、土地、建筑物、服装等等</li>
<li>双代币经济体系</li>
</ul>
<h2 id="通证"><a class="header-anchor" href="#通证"> </a>通证</h2>
<p>游戏中也将实行双通证，<a target="_blank" rel="noopener" href="https://explorer.solana.com/address/ATLASXmbPQxBUYbxPsV97usA3fPQYEqzQBUHgiFCUsXx">ATLAS</a>和<a target="_blank" rel="noopener" href="https://explorer.solana.com/address/poLisWXnNRwC6oBu1vHiuKQzFjGL4XDSu4g9qjz9qVk">POLIS</a>。</p>
<p><strong>ATLAS：</strong> ATLAS将作为游戏内的主要交易媒介，用于购买游戏内的土地、装备、组件等等，总量360亿。</p>
<p><strong>POLIS：</strong> 项目的治理通证，将用于参与决策游戏内的一些玩法和机制，总量3.6亿。</p>
<h2 id="进展"><a class="header-anchor" href="#进展"> </a>进展</h2>
<ul>
<li>第一阶段：OpenSea资产售卖</li>
<li>第二阶段：网页迷你小游戏</li>
<li>第三阶段：船坞组件售卖</li>
<li>第四阶段：最终预售公测</li>
<li>第五阶段：持续售卖</li>
</ul>
<p>当前进展：阶段二，玩家可以在marketplace上自由买卖NFT。关于3A游戏本身暂未看到任何进度。按3A大作开发惯例，一般需要5-10年不等。</p>
<h2 id="github"><a class="header-anchor" href="#github"> </a>github</h2>
<p>当前github主要开源一个与token解锁相关智能合约的仓库 <a target="_blank" rel="noopener" href="https://github.com/staratlasmeta/token-vesting">token-vesting</a></p>
<h2 id="关于dex-Serum"><a class="header-anchor" href="#关于dex-Serum"> </a>关于dex-Serum</h2>
<p>solana上的所有DEX都基于Serum，也就是说只要你知道了某一交易对的Market ID，你可以在任何前端进入交易。用SA举例就是你要买飞船，不用在官网买，直接在支持Serum的任意前端导入market ID，就可以进行交易，查看订单。</p>
<h1 id="Fancy-Birds"><a class="header-anchor" href="#Fancy-Birds"> </a>Fancy Birds</h1>
<p>官网：<a target="_blank" rel="noopener" href="https://www.fancybirds.io/">https://www.fancybirds.io/</a></p>
<p>merit-circle投资。玩法类似于2013年大火的<code>flappy bird</code>。一共发行8888只创世鸟。拥有繁殖、遗传基因玩法，罕见的基因可以提升打金收入。玩法本质上类似于Axie Infinity。</p>
<h2 id="当前进度"><a class="header-anchor" href="#当前进度"> </a>当前进度</h2>
<ul>
<li>token已发行：FNC</li>
<li>2021年12月15日上线质押挖矿(Defi 挖矿玩法)</li>
<li>预计2022 Q1上线创世鸟的铸造和marketplace</li>
<li>预计2022 Q2上线游戏主体</li>
</ul>
<h2 id="github-2"><a class="header-anchor" href="#github-2"> </a>github</h2>
<p>审计报告中找到的地址，打不开。<br>
似乎未开源：<a target="_blank" rel="noopener" href="https://github.com/Fancy-Birds/">https://github.com/Fancy-Birds/</a><br>
审计报告包含Token和staking相关的合约代码审计</p>
<h2 id="defi-玩法"><a class="header-anchor" href="#defi-玩法"> </a>defi 玩法</h2>
<p>常规defi玩法，质押FNC或LP挖矿。<br>
<a target="_blank" rel="noopener" href="https://staking.fancybirds.io/">https://staking.fancybirds.io/</a></p>
<h2 id="通证-2"><a class="header-anchor" href="#通证-2"> </a>通证</h2>
<p><a target="_blank" rel="noopener" href="https://etherscan.io/token/0x7f280daC515121DcdA3EaC69eB4C13a52392CACE">Fancy Token($FNC)</a></p>
<p><a target="_blank" rel="noopener" href="https://etherscan.io/token/0x162ce5530Aba30583cCaF79dD72650CfEB050a23">Staked Fancy Games LP</a>(锁仓SLP挖矿合约)</p>
<p><a target="_blank" rel="noopener" href="https://etherscan.io/address/0x82ecdd4635766560c4e3a8efa8a7c1fff566111e">sushi FNC-WETH lp (SLP)</a></p>
<h2 id="游戏模式"><a class="header-anchor" href="#游戏模式"> </a>游戏模式</h2>
<ul>
<li>PVP、PVE打金。（flappy bird有类似的辅助软件）</li>
<li>交易、繁殖、锦标赛（玩法类似于Axie Infinity）。</li>
<li>后续sFNC用于游戏经济中的繁殖、赌注和其他游戏内活动。</li>
</ul>
<h2 id="技术手段猜测"><a class="header-anchor" href="#技术手段猜测"> </a>技术手段猜测</h2>
<p>由于代码未开源，现根据游戏玩法对技术的猜测</p>
<ol>
<li>使用<code>Immutable X</code>发行、交易、跨链NFT，和FNC（DAO）。</li>
<li>基于starknet Cairo开发繁殖、PVP、PVE奖金系统。</li>
</ol>
<h1 id="DefiKingdoms"><a class="header-anchor" href="#DefiKingdoms"> </a>DefiKingdoms</h1>
<p><a target="_blank" rel="noopener" href="https://defikingdoms.com/">https://defikingdoms.com/</a><br>
DeFi Kingdoms是基于Harmony Protocol区块链开发的一款play2earn游戏。</p>
<p>DeFi Kingdoms旨在将DeFi元素包装成一个成为一个完整的功能生态系统。<br>
本质上还是个DEX+NFT。</p>
<h2 id="通证-3"><a class="header-anchor" href="#通证-3"> </a>通证</h2>
<p>JEWEL：<a target="_blank" rel="noopener" href="https://explorer.harmony.one/address/0x72cb10c6bfa5624dd07ef608027e366bd690048f">0x72cb10c6bfa5624dd07ef608027e366bd690048f</a></p>
<p>xJEWEL：<a target="_blank" rel="noopener" href="https://explorer.harmony.one/address/0xa9ce83507d872c5e1273e745abcfda849daa654f">0xa9ce83507d872c5e1273e745abcfda849daa654f</a></p>
<h2 id="github-3"><a class="header-anchor" href="#github-3"> </a>github</h2>
<p>部分合约：<a target="_blank" rel="noopener" href="https://github.com/DefiKingdoms/contracts/">https://github.com/DefiKingdoms/contracts/</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://explorer.harmony.one/address/0xa678d193fEcC677e137a00FEFb43a9ccffA53210">AidropClaim.sol</a>： 空投相关的合约很简单，merkeproof都没有用到</li>
<li><a target="_blank" rel="noopener" href="https://explorer.harmony.one/address/0xA9cE83507D872C5e1273E745aBcfDa849DAA654F">Bank.sol</a>：质押JEWEL挖矿，使用的xsushi代码base</li>
<li><a target="_blank" rel="noopener" href="https://explorer.harmony.one/address/0x3685ec75ea531424bbe67db11e07013abeb95f1e">Banker.sol</a>：一个将合约内部的lp解除流动性并将token转换成<code>JEWEL</code>存入Bank合约中。lp来源swap的feeTo。</li>
<li><a target="_blank" rel="noopener" href="https://explorer.harmony.one/address/0xDB30643c71aC9e2122cA0341ED77d09D5f99F924">MasterGardener.sol</a>：流动性矿池类似于masterchef</li>
<li><a target="_blank" rel="noopener" href="https://explorer.harmony.one/address/0x9014B937069918bd319f80e8B3BB4A2cf6FAA5F7">UniswapV2Factory.sol</a>: uniswap的代码base，feeTo设置为Banker</li>
<li><a target="_blank" rel="noopener" href="https://explorer.harmony.one/address/0x24ad62502d1C652Cc7684081169D04896aC20f30">UniswapV2Router02.sol</a></li>
</ul>
<h2 id="NFT"><a class="header-anchor" href="#NFT"> </a>NFT</h2>
<p>玩家可以通过购买、合成、售卖等方式玩NFT获利。NFT可以影响defi的收益。</p>
<ul>
<li>Gen0：2090只创世英雄</li>
<li>稀有度：紫、橙、蓝、绿、白</li>
<li>英雄职业和专业影响defi的收益</li>
<li>特定的职业+特定的专业以及稀有度可以最大化收益产出，玩家主要就是合成此类卡片售卖或挖矿。</li>
</ul>
<h3 id="专业功能未开放"><a class="header-anchor" href="#专业功能未开放"> </a>专业功能未开放</h3>
<ul>
<li>mining：可以提前解锁JEWEL和黄金（黄金Token未上线）</li>
<li>Gardening：增加流动性挖矿利率</li>
<li>Fishing：可以获得宝物</li>
<li>Foraging：可以炼制素材</li>
</ul>
<h3 id="职业"><a class="header-anchor" href="#职业"> </a>职业</h3>
<p>职业分基础职业、进阶职业、精英职业。最上级职业。</p>
<p>两个职业可以合成上阶职业（有合成率）。</p>
<p>合成次数从职业低到高，有不同的限制，越往上合成次数越少。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wanyvic.github.io/posts/fe727175/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ProfilePhoto.PNG">
      <meta itemprop="name" content="wanyvic">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wanyvicの博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/fe727175/" class="post-title-link" itemprop="url">Cario 笔记 一</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-10 11:11:26" itemprop="dateCreated datePublished" datetime="2022-01-10T11:11:26+08:00">2022-01-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-01-17 17:31:55" itemprop="dateModified" datetime="2022-01-17T17:31:55+08:00">2022-01-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/" itemprop="url" rel="index"><span itemprop="name">区块链</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/posts/fe727175/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/posts/fe727175/" data-xid="/posts/fe727175/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>12k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>11 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="安装"><a class="header-anchor" href="#安装"> </a>安装</h1>
<p><strong>依赖：ubuntu、python3.7+</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> -y libgmp3-dev python3-dev
python3 -m venv ~/cairo_venv
<span class="token builtin class-name">source</span> ~/cairo_venv/bin/activate<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>确保 venv 已激活 - 您应该(cairo_venv)在命令行提示符中看到。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip3 <span class="token function">install</span> ecdsa fastecdsa sympy cairo-lang<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="编译和运行-Cairo-程序"><a class="header-anchor" href="#编译和运行-Cairo-程序"> </a>编译和运行 Cairo 程序</h1>
<h2 id="创建一个名为test-cairo的文件"><a class="header-anchor" href="#创建一个名为test-cairo的文件"> </a>创建一个名为<code>test.cairo</code>的文件</h2>
<p>其中包含以下几行：</p>
<pre class="line-numbers language-none"><code class="language-none">func main():
    [ap] &#x3D; 1000; ap++
    [ap] &#x3D; 2000; ap++
    [ap] &#x3D; [ap - 2] + [ap - 1]; ap++
    ret
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="编译"><a class="header-anchor" href="#编译"> </a>编译</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cairo-compile test.cairo --output test_compiled.json<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="运行"><a class="header-anchor" href="#运行"> </a>运行</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cairo-run <span class="token punctuation">\</span>
  --program<span class="token operator">=</span>test_compiled.json --print_output <span class="token punctuation">\</span>
  --print_info --relocate_prints<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="调试"><a class="header-anchor" href="#调试"> </a>调试</h2>
<p>您可以通过提供–tracer标志来打开开罗跟踪器cairo-run。然后在 <a target="_blank" rel="noopener" href="http://localhost:8100/">http://localhost:8100/</a> 打开它。</p>
<h1 id="编写第一份合约"><a class="header-anchor" href="#编写第一份合约"> </a>编写第一份合约</h1>
<p>StarkNet 是一个无需许可的去中心化 ZK-Rollup，作为以太坊上的 L2 网络运行，任何 dApp 都可以在其中实现无限规模的计算，而不会影响以太坊的可组合性和安全性。</p>
<p><strong>主网上的 StarkNet Alpha</strong><br>
StarkNet 核心合约：<a target="_blank" rel="noopener" href="https://etherscan.io/address/0xc662c410C0ECf747543f5bA90660f6ABeBD9C8c4">0xc662c410C0ECf747543f5bA90660f6ABeBD9C8c4</a></p>
<p>定序器网址：<a target="_blank" rel="noopener" href="https://alpha-mainnet.starknet.io">https://alpha-mainnet.starknet.io</a></p>
<p>代码参考：<a target="_blank" rel="noopener" href="https://github.com/xJonathanLEI/starknet-l1-contracts">https://github.com/xJonathanLEI/starknet-l1-contracts</a></p>
<p><strong>Goerli 上的 StarkNet Alpha 版本 4</strong><br>
StarkNet 核心合约：<a target="_blank" rel="noopener" href="https://etherscan.io/address/0xde29d060D45901Fb19ED6C6e959EB22d8626708e">0xde29d060D45901Fb19ED6C6e959EB22d8626708e</a></p>
<p>音序器网址：<a target="_blank" rel="noopener" href="https://alpha4.starknet.io">https://alpha4.starknet.io</a></p>
<h2 id="让我们从下面的-StarkNet-合约开始："><a class="header-anchor" href="#让我们从下面的-StarkNet-合约开始："> </a>让我们从下面的 StarkNet 合约开始：</h2>
<h3 id="创建一个名为的文件并将contract-cairo合约代码复制到其中。"><a class="header-anchor" href="#创建一个名为的文件并将contract-cairo合约代码复制到其中。"> </a>创建一个名为的文件并将<code>contract.cairo</code>合约代码复制到其中。</h3>
<pre class="line-numbers language-none"><code class="language-none"># Declare this file as a StarkNet contract and set the required
# builtins.
%lang starknet
%builtins pedersen range_check

from starkware.cairo.common.cairo_builtins import HashBuiltin

# Define a storage variable.
@storage_var
func balance() -&gt; (res : felt):
end

# Increases the balance by the given amount.
@external
func increase_balance&#123;
        syscall_ptr : felt*, pedersen_ptr : HashBuiltin*,
        range_check_ptr&#125;(amount : felt):
    let (res) &#x3D; balance.read()
    balance.write(res + amount)
    return ()
end

# Returns the current balance.
@view
func get_balance&#123;
        syscall_ptr : felt*, pedersen_ptr : HashBuiltin*,
        range_check_ptr&#125;() -&gt; (res : felt):
    let (res) &#x3D; balance.read()
    return (res)
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>%lang starknet</code>是声明使用的编译器。因此使用<code>cairo-compile</code>将编译失败。应使用<code>starknet-compile</code>代替。</p>
<h3 id="编译-2"><a class="header-anchor" href="#编译-2"> </a>编译</h3>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">starknet-compile contract.cairo <span class="token punctuation">\</span>
    --output contract_compiled.json <span class="token punctuation">\</span>
    --abi contract_abi.json<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>生成了abi和编译后的json。<br>
abi里显示有<code>increase_balance</code>和<code>get_balance</code>两个接口。</p>
<h3 id="在-StarkNet-测试网上部署合约"><a class="header-anchor" href="#在-StarkNet-测试网上部署合约"> </a>在 StarkNet 测试网上部署合约</h3>
<p>您应该<code>--network=alpha-goerli</code>在每次使用时传递，或者<code>STARKNET_NETWORK</code>按如下方式设置环境变量：(下文均使用了此环境变量)</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">STARKNET_NETWORK</span><span class="token operator">=</span>alpha-goerli<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>部署</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">starknet deploy --contract contract_compiled.json<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>得到以下结果：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Deploy transaction was sent.
Contract address: 0x03d2c69f4b89395b062da026c9fabb396b21883f7eb9c2b5cde4fcbcd8120c3f
Transaction hash: 0x7638d01c1736f6329b13cdfcf298e45e0e1cfd460d1e701a040f3cda3233275<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><code>Contract address</code>: 部署的合约地址<br>
<code>Transaction hash</code>: 交易hash</p>
<h3 id="与合约交互"><a class="header-anchor" href="#与合约交互"> </a>与合约交互</h3>
<p>运行以下命令来调用该<code>increase_balance()</code>函数。<code>--address</code>填对应上文部署的合约地址。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">starknet invoke <span class="token punctuation">\</span>
    --address 0x03d2c69f4b89395b062da026c9fabb396b21883f7eb9c2b5cde4fcbcd8120c3f <span class="token punctuation">\</span>
    --abi contract_abi.json <span class="token punctuation">\</span>
    --function increase_balance <span class="token punctuation">\</span>
    --inputs <span class="token number">1234</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果应如下所示：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Invoke transaction was sent.
Contract address: 0x03d2c69f4b89395b062da026c9fabb396b21883f7eb9c2b5cde4fcbcd8120c3f
Transaction hash: 0x159b6df5a1a375c2e08244b0276678ceb4abbb9e18546592ae7865362c85441<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="查询状态"><a class="header-anchor" href="#查询状态"> </a>查询状态</h4>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">starknet tx_status --hash 0x159b6df5a1a375c2e08244b0276678ceb4abbb9e18546592ae7865362c85441<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>状态可能会经过<code>PENDING</code>最终到达<code>ACCEPTED</code>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">&#123;</span>
    <span class="token string">"block_hash"</span><span class="token builtin class-name">:</span> <span class="token string">"0x34cb1372fa583d5d08eaeba9ba6a9b8fa791df2184b143307b07a08b952db9a"</span>,
    <span class="token string">"tx_status"</span><span class="token builtin class-name">:</span> <span class="token string">"ACCEPTED_ON_L2"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>可能的状态是：</p>
<ul>
<li><code>NOT_RECEIVED</code>：尚未收到交易（即未写入存储）。</li>
<li><code>RECEIVED</code>：事务已被定序器接收。</li>
<li><code>PENDING</code>：交易通过验证，进入待处理区块。</li>
<li><code>REJECTED</code>：交易验证失败，因此被跳过。</li>
<li><code>ACCEPTED_ON_L2</code>：交易通过验证并进入实际创建的区块。</li>
<li><code>ACCEPTED_ON_L1</code>：交易在链上被接受。</li>
</ul>
<h4 id="查询余额"><a class="header-anchor" href="#查询余额"> </a>查询余额</h4>
<p>使用以下命令查询当前余额：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">starknet call <span class="token punctuation">\</span>
    --address 0x03d2c69f4b89395b062da026c9fabb396b21883f7eb9c2b5cde4fcbcd8120c3f <span class="token punctuation">\</span>
    --abi contract_abi.json <span class="token punctuation">\</span>
    --function get_balance<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果应该是：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1234</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>请注意，要查看最新余额，您应该等到increase_balance 交易状态至少为ACCEPTED_ON_L2（即ACCEPTED_ON_L2或ACCEPTED_ON_L1）。否则，您将看到increase_balance交易执行前的余额（即 0）。</p>
<h4 id="获取交易"><a class="header-anchor" href="#获取交易"> </a>获取交易</h4>
<pre class="line-numbers language-none"><code class="language-none">starknet get_transaction --hash 0x159b6df5a1a375c2e08244b0276678ceb4abbb9e18546592ae7865362c85441<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">starknet get_transaction_receipt --hash 0x159b6df5a1a375c2e08244b0276678ceb4abbb9e18546592ae7865362c85441<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="获取代码"><a class="header-anchor" href="#获取代码"> </a>获取代码</h4>
<pre class="line-numbers language-none"><code class="language-none">starknet get_code --contract_address 0x03d2c69f4b89395b062da026c9fabb396b21883f7eb9c2b5cde4fcbcd8120c3f<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="获取块"><a class="header-anchor" href="#获取块"> </a>获取块</h4>
<pre class="line-numbers language-none"><code class="language-none">starknet get_block --number 41301<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="通过key来查询state存储的值"><a class="header-anchor" href="#通过key来查询state存储的值"> </a>通过key来查询state存储的值</h4>
<p>编写以下python代码查询key值。<br>
此处对应<code>@storage_var</code>的<code>balance</code>。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> starkware<span class="token punctuation">.</span>starknet<span class="token punctuation">.</span>public<span class="token punctuation">.</span>abi <span class="token keyword">import</span> get_storage_var_address

balance_key <span class="token operator">=</span> get_storage_var_address<span class="token punctuation">(</span><span class="token string">'balance'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Balance key: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>balance_key<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>你应该得到：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Balance key: <span class="token number">916907772491729262376534102982219947830828984996257231353398618781993312401</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>现在，您可以使用以下方法查询余额：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">starknet get_storage_at <span class="token punctuation">\</span>
    --contract_address 0x03d2c69f4b89395b062da026c9fabb396b21883f7eb9c2b5cde4fcbcd8120c3f <span class="token punctuation">\</span>
    --key <span class="token number">916907772491729262376534102982219947830828984996257231353398618781993312401</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>使用我们目前使用的同一个合约，你应该得到：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">0x4d2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>请注意，这与调用<code>get_balance</code>获得的结果相同。</p>
<p>也可以添加–block_hash指定特定块高查询的结果。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">starknet get_storage_at <span class="token punctuation">\</span>
    --contract_address 0x03d2c69f4b89395b062da026c9fabb396b21883f7eb9c2b5cde4fcbcd8120c3f <span class="token punctuation">\</span>
    --key <span class="token number">916907772491729262376534102982219947830828984996257231353398618781993312401</span> <span class="token punctuation">\</span>
    --block_hash 0x109decabe47793bead0be4ba2f06835e1b4ede7575cb60b6bd7d29762b3d34e<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">0x0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="修改合约使每个人有独立的balance"><a class="header-anchor" href="#修改合约使每个人有独立的balance"> </a>修改合约使每个人有独立的<code>balance</code></h3>
<h4 id="存储映射"><a class="header-anchor" href="#存储映射"> </a>存储映射</h4>
<p>使用kvmap存数据</p>
<pre class="line-numbers language-none"><code class="language-none"># A map from user (public key) to a balance.
@storage_var
func balance(user : felt) -&gt; (res : felt):
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="验证签名"><a class="header-anchor" href="#验证签名"> </a>验证签名</h4>
<p>我们现在必须修改<code>increase_balance</code>以执行以下操作：</p>
<ul>
<li>不同用户写入相应的balance条目。</li>
<li>验证用户是否对此次更改操作签名（ACL）。</li>
</ul>
<p>我们将需要ecdsa内置程序来验证签名，因此我们将%builtins 行更改为：</p>
<pre class="line-numbers language-none"><code class="language-none">%builtins pedersen range_check ecdsa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>并添加以下导入语句：</p>
<pre class="line-numbers language-none"><code class="language-none">from starkware.cairo.common.cairo_builtins import (
    HashBuiltin, SignatureBuiltin)
from starkware.cairo.common.hash import hash2
from starkware.cairo.common.signature import (
    verify_ecdsa_signature)
from starkware.starknet.common.syscalls import get_tx_signature<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>接下来，我们将代码更改<code>increase_balance()</code>为：</p>
<p>Increases the balance of the given user by the given amount.</p>
<pre class="line-numbers language-none"><code class="language-none">@external
func increase_balance&#123;
        syscall_ptr : felt*, pedersen_ptr : HashBuiltin*,
        range_check_ptr, ecdsa_ptr : SignatureBuiltin*&#125;(
        user : felt, amount : felt):
    # Fetch the signature.
    let (sig_len : felt, sig : felt*) &#x3D; get_tx_signature()

    # Verify the signature length.
    assert sig_len &#x3D; 2

    # Compute the hash of the message.
    # The hash of (x, 0) is equivalent to the hash of (x).
    let (amount_hash) &#x3D; hash2&#123;hash_ptr&#x3D;pedersen_ptr&#125;(amount, 0)

    # Verify the user&#39;s signature.
    verify_ecdsa_signature(
        message&#x3D;amount_hash,
        public_key&#x3D;user,
        signature_r&#x3D;sig[0],
        signature_s&#x3D;sig[1])

    let (res) &#x3D; balance.read(user&#x3D;user)
    balance.write(user, res + amount)
    return ()
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>verify_ecdsa_signature</code>行为类似于断言——如果签名无效，该函数将恢复整个交易。</p>
<p><strong>请注意，我们在这里没有设置重放保护——一旦用户签署交易，有人可能会多次调用它。防止重放攻击的一种方法是向<code>increase_balance</code>中添加一个<code>nonce</code>参数，将签名消息更改为随机数和数量的Pedersen哈希，并定义另一个从签名消息到标志（0 或 1）的存储映射，指示是否交易由系统执行。StarkNet的未来版本将处理用户身份验证并防止重放攻击。</strong></p>
<p>同样，更改<code>get_balance()</code>. 这里我们不需要验证签名（因为 StarkNet 的存储无论如何都不是私有的），所以更改更简单：</p>
<h4 id="更改get-balance"><a class="header-anchor" href="#更改get-balance"> </a>更改<code>get_balance()</code></h4>
<pre class="line-numbers language-none"><code class="language-none">@view
func get_balance&#123;
        syscall_ptr : felt*, pedersen_ptr : HashBuiltin*,
        range_check_ptr&#125;(user : felt) -&gt; (res : felt):
    let (res) &#x3D; balance.read(user&#x3D;user)
    return (res)
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="编译和部署"><a class="header-anchor" href="#编译和部署"> </a>编译和部署</h4>
<p>将新合同文件另存为<code>user_auth.cairo</code></p>
<pre class="line-numbers language-none"><code class="language-none">starknet-compile user_auth.cairo \
    --output user_auth_compiled.json \
    --abi user_auth_abi.json

starknet deploy --contract user_auth_compiled.json<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>得到：</p>
<pre class="line-numbers language-none"><code class="language-none">Deploy transaction was sent.
Contract address: 0x00a22e04b15bac3e899d500ed13ef411ac7b8ceab2711a286abcc1c332f1562a
Transaction hash: 0x6f6d8f253dfaef85398cac92bbd784f43c5f349908cd63cc24f8bcc6056b8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="与合约交互-2"><a class="header-anchor" href="#与合约交互-2"> </a>与合约交互</h4>
<p>需要一对公私钥进行签名，使用python生成：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> starkware<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>signature<span class="token punctuation">.</span>signature <span class="token keyword">import</span> <span class="token punctuation">(</span>
    pedersen_hash<span class="token punctuation">,</span> private_to_stark_key<span class="token punctuation">,</span> sign<span class="token punctuation">)</span>
private_key <span class="token operator">=</span> <span class="token number">123456</span> <span class="token comment">#实际中私钥应该尽量复杂</span>
message_hash <span class="token operator">=</span> pedersen_hash<span class="token punctuation">(</span><span class="token number">4321</span><span class="token punctuation">)</span> <span class="token comment"># 4321是调用传入的amount</span>
public_key <span class="token operator">=</span> private_to_stark_key<span class="token punctuation">(</span>private_key<span class="token punctuation">)</span>
signature <span class="token operator">=</span> sign<span class="token punctuation">(</span>
    msg_hash<span class="token operator">=</span>message_hash<span class="token punctuation">,</span> priv_key<span class="token operator">=</span>private_key<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Public key: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>public_key<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Signature: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>signature<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>得到：</p>
<pre class="line-numbers language-none"><code class="language-none">Public key: 3512654880572580671014088124487384125967296770469815068887364768195237224797
Signature: (108302296121512525602232466769839751031019513985679519327892998945991838582, 2367704193695023621669265858663986904236455946141267548614905838978060564822)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h5 id="更新余额"><a class="header-anchor" href="#更新余额"> </a>更新余额</h5>
<pre class="line-numbers language-none"><code class="language-none">starknet invoke \
    --address 0x00a22e04b15bac3e899d500ed13ef411ac7b8ceab2711a286abcc1c332f1562a \
    --abi user_auth_abi.json \
    --function increase_balance \
    --inputs \
        3512654880572580671014088124487384125967296770469815068887364768195237224797 \
        4321 \
    --signature \
        108302296121512525602232466769839751031019513985679519327892998945991838582 \
        2367704193695023621669265858663986904236455946141267548614905838978060564822<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>得到:</p>
<pre class="line-numbers language-none"><code class="language-none">Invoke transaction was sent.
Contract address: 0x00a22e04b15bac3e899d500ed13ef411ac7b8ceab2711a286abcc1c332f1562a
Transaction hash: 0x2fe59707d58ce8cd3ac10372979a80453a0ab78dbe00646738ffa55137f5ece<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h5 id="查询状态和结果"><a class="header-anchor" href="#查询状态和结果"> </a>查询状态和结果</h5>
<pre class="line-numbers language-none"><code class="language-none">starknet tx_status --hash 0x2fe59707d58ce8cd3ac10372979a80453a0ab78dbe00646738ffa55137f5ece<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">starknet call \                                                   
    --address 0x00a22e04b15bac3e899d500ed13ef411ac7b8ceab2711a286abcc1c332f1562a \
    --abi user_auth_abi.json \
    --function get_balance \
    --inputs 3512654880572580671014088124487384125967296770469815068887364768195237224797<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>最终<code>tx_status</code>改为<code>ACCEPTED</code>，<code>get_balance</code>改为4321</p>
<p>通过<code>get_storage_var_address</code>需要传入用户的pubkey</p>
<pre class="line-numbers language-none"><code class="language-none">from starkware.starknet.public.abi import get_storage_var_address

user &#x3D; 3512654880572580671014088124487384125967296770469815068887364768195237224797
user_balance_key &#x3D; get_storage_var_address(&#39;balance&#39;, user)
print(f&#39;Storage key for user &#123;user&#125;:\n&#123;user_balance_key&#125;&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="如果使用无效签名"><a class="header-anchor" href="#如果使用无效签名"> </a>如果使用无效签名</h5>
<p><code>tx_status</code>将会<code>REJECTED</code>，<br>
使用<code>--contract</code>和<code>--error_message</code>回溯错误</p>
<pre class="line-numbers language-none"><code class="language-none">starknet tx_status \
    --hash TX_HASH \
    --contract user_auth_compiled.json \
    --error_message<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="构造函数"><a class="header-anchor" href="#构造函数"> </a>构造函数</h3>
<p>使用<code>@constructor</code> 声明</p>
<pre class="line-numbers language-none"><code class="language-none">@constructor
func constructor&#123;
        syscall_ptr : felt*, pedersen_ptr : HashBuiltin*,
        range_check_ptr&#125;(owner_address : felt):
    owner.write(value&#x3D;owner_address)
    return ()
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在deploy时加<code>--inputs</code></p>
<pre class="line-numbers language-none"><code class="language-none">starknet-compile ownable.cairo \
    --output ownable_compiled.json \
    --abi ownable_abi.json
starknet deploy --contract ownable_compiled.json --inputs 123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="更多功能"><a class="header-anchor" href="#更多功能"> </a>更多功能</h3>
<ol>
<li>多个值的存储变量</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none"># A mapping from user to a pair (min, max).
@storage_var
func range(user : felt) -&gt; (res : (felt, felt)):
end

# 读取和写入
@external
func extend_range&#123;
        syscall_ptr : felt*, pedersen_ptr : HashBuiltin*,
        range_check_ptr&#125;(user : felt):
    let (min_max) &#x3D; range.read(user)
    range.write(user, (min_max[0] - 1, min_max[1] + 1))
    return ()
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li>结构参数的存储变量</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none"># 存储变量的参数也可以是结构体或元组，只要它们不包含指针
struct User:
    member first_name : felt
    member last_name : felt
end

# A mapping from a user to 1 if they voted and 0 otherwise.
@storage_var
func user_voted(user : User) -&gt; (res : felt):
end

@external
func vote&#123;
        syscall_ptr : felt*, pedersen_ptr : HashBuiltin*,
        range_check_ptr&#125;(user : User):
    user_voted.write(user, 1)
    return ()
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="3">
<li>外部函数使用数组作为参数</li>
</ol>
<p>在外部函数中使用数组参数的StarkNet合约必须内置<code>range_check</code>，用于验证数组的长度是否为非负。</p>
<pre class="line-numbers language-none"><code class="language-none">@external
func compare_arrays(
        a_len : felt, a : felt*, b_len : felt, b : felt*):
    assert a_len &#x3D; b_len
    if a_len &#x3D;&#x3D; 0:
        return ()
    end
    assert a[0] &#x3D; b[0]
    return compare_arrays(
        a_len&#x3D;a_len - 1, a&#x3D;a + 1, b_len&#x3D;b_len - 1, b&#x3D;b + 1)
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="4">
<li>传入参数包含数组长度和元素</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">starknet invoke \
    --address CONTRACT_ADDRESS \
    --abi contract_abi.json \
    --function compare_arrays \
    --inputs 4 10 20 30 40 2 50 60<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="5">
<li>在 calldata 中传递元组和结构<br>
Calldata 参数和返回值可以是不包含指针的任何类型。例如，带有毛毡成员的结构、毛毡元组和毛毡元组元组。例如：</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">struct Point:
    member x : felt
    member y : felt
end

@view
func sum_points(points : (Point, Point)) -&gt; (res : Point):
    return (
        res&#x3D;Point(
        x&#x3D;points[0].x + points[1].x,
        y&#x3D;points[0].y + points[1].y))
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>为了sum_points使用点调用，您应该将以下输入传递给：(1, 2), (10, 20)starknet call</p>
<pre class="line-numbers language-none"><code class="language-none">starknet call \
    --address CONTRACT_ADDRESS \
    --abi contract_abi.json \
    --function sum_points \
    --inputs 1 2 10 20<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="合约相互调用"><a class="header-anchor" href="#合约相互调用"> </a>合约相互调用</h3>
<p>编写合约<code>test_proxy.cario</code>调用之前部署的合约：</p>
<pre class="line-numbers language-none"><code class="language-none">%lang starknet
%builtins pedersen range_check

from starkware.cairo.common.cairo_builtins import HashBuiltin

@contract_interface
namespace IBalanceContract:
    func increase_balance(amount : felt):
    end

    func get_balance() -&gt; (res : felt):
    end
end

@external
func call_increase_balance&#123;syscall_ptr : felt*, range_check_ptr&#125;(
        contract_address : felt, amount : felt):
    IBalanceContract.increase_balance(
        contract_address&#x3D;contract_address, amount&#x3D;amount)
    return ()
end

@view
func call_get_balance&#123;syscall_ptr : felt*, range_check_ptr&#125;(
        contract_address : felt) -&gt; (res : felt):
    let (res) &#x3D; IBalanceContract.get_balance(
        contract_address&#x3D;contract_address)
    return (res&#x3D;res)
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="编译部署"><a class="header-anchor" href="#编译部署"> </a>编译部署</h4>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 编译</span>
starknet-compile test_proxy.cairo <span class="token punctuation">\</span>
    --output test_proxy_compiled.json <span class="token punctuation">\</span>
    --abi test_proxy_abi.json

<span class="token comment"># 部署</span>
starknet deploy --contract test_proxy_compiled.json 

<span class="token comment"># 合约地址及hash</span>
Deploy transaction was sent.
Contract address: 0x02a828cb2ee25629d597625df71ac41779fc9166624654ec52bcc51e77ae75a6
Transaction hash: 0x63e09a708a40d9a6c2e6f33f19d451eb0c774fc2c37db1fa8fe2245c5117c0c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="调用"><a class="header-anchor" href="#调用"> </a>调用</h4>
<pre class="line-numbers language-none"><code class="language-none">starknet invoke \
    --address 0x02a828cb2ee25629d597625df71ac41779fc9166624654ec52bcc51e77ae75a6 \
    --abi test_proxy_abi.json \     
    --function call_increase_balance \
    --inputs &quot;0x03d2c69f4b89395b062da026c9fabb396b21883f7eb9c2b5cde4fcbcd8120c3f&quot; 10000

Invoke transaction was sent.
Contract address: 0x02a828cb2ee25629d597625df71ac41779fc9166624654ec52bcc51e77ae75a6
Transaction hash: 0x6fa1501929fdf6971dd35935eb3bdfda2e64668a16d77a665d3555d9992518c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="查询值变更"><a class="header-anchor" href="#查询值变更"> </a>查询值变更</h4>
<pre class="line-numbers language-none"><code class="language-none">starknet call \                                                                            
    --address 0x03d2c69f4b89395b062da026c9fabb396b21883f7eb9c2b5cde4fcbcd8120c3f \
    --abi contract_abi.json \
    --function get_balance
11234<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="获取调用者地址"><a class="header-anchor" href="#获取调用者地址"> </a>获取调用者地址</h3>
<p>get_caller_address()您可以使用库函数检索调用您的函数的合约的地址</p>
<pre class="line-numbers language-none"><code class="language-none">from starkware.starknet.common.syscalls import get_caller_address

# ...

let (caller_address) &#x3D; get_caller_address()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>注：</strong> 如果调用者是用户则返回0，如果是合约则返回合约地址。</p>
<h3 id="获取当前合约的地址"><a class="header-anchor" href="#获取当前合约的地址"> </a>获取当前合约的地址</h3>
<p>您可以使用get_contract_address()库函数获取当前合约的地址。</p>
<pre class="line-numbers language-none"><code class="language-none">from starkware.starknet.common.syscalls import (
    get_contract_address)

# ...

let (contract_address) &#x3D; get_contract_address()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上与<code>Solidity</code>中的<code>address(this)</code>类似。</p>
<h1 id="未完，待续。。。"><a class="header-anchor" href="#未完，待续。。。"> </a>未完，待续。。。</h1>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wanyvic.github.io/posts/1fbae977/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ProfilePhoto.PNG">
      <meta itemprop="name" content="wanyvic">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wanyvicの博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/1fbae977/" class="post-title-link" itemprop="url">StarkNet 分析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-07 13:53:25" itemprop="dateCreated datePublished" datetime="2022-01-07T13:53:25+08:00">2022-01-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/" itemprop="url" rel="index"><span itemprop="name">区块链</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/posts/1fbae977/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/posts/1fbae977/" data-xid="/posts/1fbae977/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="StarkNet"><a class="header-anchor" href="#StarkNet"> </a>StarkNet</h1>
<p><a target="_blank" rel="noopener" href="https://starkware.co/starknet/">StarkNet</a>是基于STARK零知识证明方案的L2的ZK-Rollup.</p>
<h2 id="RoadMap"><a class="header-anchor" href="#RoadMap"> </a>RoadMap</h2>
<p>分四个步骤构建StarkNet：</p>
<ul>
<li>阶段0——地基（Foundations）（已完成*）</li>
<li>阶段I——行星（Planets）：单一应用汇总（Rollup）</li>
<li>阶段II——星座（Constellations）：多应用汇总</li>
<li>阶段III——宇宙（Universe）：去中心化汇总</li>
</ul>
<p><img src="/posts/1fbae977/starkware-0.webp" alt></p>
<p>StarkNet基于图灵完备的<a target="_blank" rel="noopener" href="https://www.cairo-lang.org/">Cairo语言</a>，支持以太坊上通用的计算。</p>
<p>在StarkNet上，开发者可以构建应用并部署；用户可以发起交易并在StarkNet上执行； 节点可以通过激励保证网络良好运转。</p>
<p>StarkNet的所有交易周期性地批量打包到一个proof中，在以太坊上验证。</p>
<p>所有构建StarkNet的数据在链上（on-chain）发布。</p>
<p><img src="/posts/1fbae977/starkware-1.webp" alt></p>
<h2 id="TPS"><a class="header-anchor" href="#TPS"> </a>TPS</h2>
<p>在主网上使用单个证明处理 30 万笔交易，在 Rollup 吞吐量上创下了高达 3000 tps 的世界记录。在此过程中，我们同样在 Rollup 的 gas 效率上创下每笔交易 315 gas 的世界纪录，比以太坊 L1 上的交易便宜几个数量级。</p>
<h2 id="阶段"><a class="header-anchor" href="#阶段"> </a>阶段</h2>
<h3 id="行星：只支持单一-App-的-Rollup"><a class="header-anchor" href="#行星：只支持单一-App-的-Rollup"> </a>行星：只支持单一 App 的 Rollup</h3>
<p>在该阶段，开发者可以在 StarkNet 上构建并部署他们自己的可扩展应用。</p>
<p>每个 StarkNet 实例都能运行一个应用。不同的实例可能会运行不同的应用。</p>
<p>StarkNet 架构包含以下部分：</p>
<ul>
<li>为任意 Cairo 逻辑生成 STARK 证明、然后提交证明并在以太坊上验证所需的机制</li>
<li>与 L1 以太坊交互：L1 代币的存取、链上数据的发布、保护用户免受恶意 StarkNet 运营者攻击的逃跑机制</li>
<li>L2 用户余额以及应用存储项的管理</li>
</ul>
<p>开发者只需专注于根据自己的商业逻辑构建应用，然后正式上线：在 StarkNet 上部署并大规模运行。</p>
<p>我们之所以能构建通用计算可扩展 ZK-Rollup，主要依赖于以下两点：</p>
<ul>
<li>通用型图灵完备的编程语言 Cairo</li>
<li>我们强大的 STARK 技术（证明器和验证器），可以将大量计算捆绑到一个证明中</li>
</ul>
<h3 id="星群：支持多-App-的-Rollup"><a class="header-anchor" href="#星群：支持多-App-的-Rollup"> </a>星群：支持多 App 的 Rollup</h3>
<p>该阶段将支持多个应用在同一个 StarkNet 实例上运行，并访问同一个的全局 L2 状态。这样一来，不同应用之间将具有互操作性，而且规模经济也有助于降低 gas 成本。</p>
<p>强大的 STARK 栈 Cairo 和 GPS 增强了 StarkNet 在支持多 App Rollup 方面的竞争优势。</p>
<p>在这一阶段，StarkNet 将成为一个功能完备的框架，可以在以太坊的基础上运行多个商业逻辑不同的应用，每个实例都由一个单独的运营者来运行。</p>
<p>运营者可以运行 StarkNet 节点，应用开发者可以在上面部署自己的合约。从用户的角度来说，StarkNet 感觉上跟以太坊差不多，但是在可扩展性上强于以太坊。</p>
<h3 id="宇宙：去中心化-Rollup"><a class="header-anchor" href="#宇宙：去中心化-Rollup"> </a>宇宙：去中心化 Rollup</h3>
<p>StarkNet 发展的最后一步是实现去中心化运营。</p>
<p>关于该阶段，我们现在正在解决一些有趣的研发问题，包括：（i）使用 ZK-Rollups 来改进共识机制，以及 （ii）设计密码学经济机制来激励去中心化 StarkNet 贡献者和运营者（交易排序者、证明者等）高效、公平且安全地运行。</p>
<h1 id="STARK"><a class="header-anchor" href="#STARK"> </a>STARK</h1>
<h2 id="什么是-STARK"><a class="header-anchor" href="#什么是-STARK"> </a>什么是 STARK</h2>
<p>STARK 是一个证明系统。</p>
<p><strong>复杂度：</strong></p>
<ul>
<li>证明者时空复杂度：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mrow></mrow><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n\log{}n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> 准线性</li>
<li>见证长度和验证时间：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(log_{2}n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> 亚线性</li>
</ul>
<p>在没有Cairo之前我们需要对每个问题都去创建特殊的代数中间件（arithmetic intermediate representation, AIR）。Cairo相当于建立了一个通用的AIR，类似ASIC-&gt;CPU的转换。</p>
<h2 id="生产级图灵完备-STARK"><a class="header-anchor" href="#生产级图灵完备-STARK"> </a>生产级图灵完备 STARK</h2>
<p><strong>概念：</strong> 一个链下证明者，它处理大量计算（如大批量交易），并产生指数级较小的有效性证明，然后在链上进行验证。</p>
<h2 id="什么是-Cairo"><a class="header-anchor" href="#什么是-Cairo"> </a>什么是 Cairo</h2>
<p>Cairo 是图灵完备的高级编程语言和框架，可以为通用计算生成 STARK 证明。应用开发者可以使用 Cairo 定义任何商业逻辑，在链下生成证明，并在链上进行验证，而无需自己编写复杂的“电路”或 AIR。Cairo 已在主网上线，向所有开发者开放。</p>
<p>我们将在以太坊公共测试网上发布 Cairo 的通用证明服务（Generic Proof Service ，GPS）的 alpha 版本。通过该服务，开发者可以使用 Cairo 构建自己的应用，实现他们想要的一切商业逻辑。他们会将自己的 Cairo 代码发送至 GPS 来生成证明，再在链上进行验证。</p>
<p>GPS 可以使用单个证明来证明多个独立应用的执行完整性，让这些应用可以分摊证明验证的 gas 成本。</p>
<p>Cairo 和 GPS 都是 StarkNet 的基础。我们决定将二者开放给外部开发者，让他们早些接触 StarkNet 技术。这样一来，开发者不仅可以开始在 StarkNet 的基础上进行构建，还能影响 StarkNet 的发展。</p>
<p>我们会基于开发者社区的需求和反馈继续开发 Cairo。我们会引入新的功能、语法和能够提高其可用性的内部插件来强化该语言。我们会继续开发并改进 Cairo 工具：编译器、跟踪器/调试器以及与通用 IDE（集成开发环境）的集成。</p>
<p>StarkNet 也会在底层运行 Cairo。</p>
<h2 id="Cairo-与区块链结合"><a class="header-anchor" href="#Cairo-与区块链结合"> </a>Cairo 与区块链结合</h2>
<p>今天，大多数区块链 dApp 基本上是一个实现某种逻辑的 Solidity 合约，可能是一些用于良好用户体验的前端，也可能是后端。这些 dApp 成功后，不可避免地面临可扩展性问题。</p>
<p>我们越来越多地看到 dApp 通过转向基于证明的 L2 可扩展性解决方案（如带有 StarkEx 的 DeversiFi）来解决其可扩展性问题。链下组件接管了业务逻辑的一些更复杂的部分，并与链上智能合约进行通信，而不会放弃安全性，因为系统状态的所有更改都经过证明。规模得到改善，因为验证链上证明比完全在链上执行业务逻辑要便宜得多。</p>
<p>在开罗之前，创建一个涵盖特定业务逻辑的证明系统很困难（就像通过在硅晶片上放置与非门来为该业务逻辑构建芯片一样）。在开罗，使用证明来实现可扩展性的障碍要低得多。你在开罗编写你的复杂逻辑，在链下证明它（我们将在一分钟内解释如何），一旦证明在链上得到验证，你的智能合约应用程序就可以无信任地使用结果——就好像它执行了那样链上的复杂逻辑，因为这就是证明所断言的。</p>
<h2 id="如何工作"><a class="header-anchor" href="#如何工作"> </a>如何工作</h2>
<p>以太坊上的三件事是昂贵的：计算、传输和存储。开罗解决了所有三个问题。要了解它是如何做到的，我们需要引入一个新概念——共享证明器（或 SHARP）。</p>
<p>SHARP 是您的开罗代码和 Solidity 智能合约之间的连接链接。它具有三个主要组成部分——证明者（链下）、验证者智能合约（链上）和事实登记合约（链上）。</p>
<p>证明者获取您的开罗程序的执行跟踪，证明它是有效的，并将此证明发送给验证者。检验证明后，上链验证需要一个重要的额外的步骤：将其写入一个事实，证明在事实登记证明的有效性。这个事实就像一个无需信任的批准印章，证明开罗计划的计算是正确的。现在 dApp 的智能合约剩下的就是检查这个事实是否存在，以便依赖链下执行的计算。<br>
<img src="/posts/1fbae977/starkware-2.webp" alt></p>
<p>让我们看一个玩具示例——一个基于区块链的数独游戏，提出正确解决方案的人将获得奖励。</p>
<p>今天，您需要实现验证难题的解决方案在 Solidity 中是否正确的整个业务逻辑——这是在链上执行的昂贵计算。相反，您可以在开罗编写此逻辑，然后在链外执行。Cairo 程序将检查解决方案，然后触发 SHARP 生成证明，在链上验证它并写下一个事实——一个批准该解决方案是正确解决方案的印章。数独的智能合约检查该事实是否存在，并向获胜者支付奖金。我们节省了解决方案验证的昂贵计算和链上数独游戏的解决方案的传输</p>
<p>dApp 智能合约的角色发生了变化——从负责执行昂贵的业务逻辑的组件变成了负责处理该业务逻辑的廉价后果的组件（在我们的示例中，将奖品发送给获胜者或更新一些state），同时依赖于业务逻辑被正确执行的事实。</p>
<p>我们在这篇博文中讨论了计算和传输——我们将在以后的博文中讨论开罗如何解决以太坊上的存储问题。</p>
<h2 id="STARK的性能对比"><a class="header-anchor" href="#STARK的性能对比"> </a>STARK的性能对比</h2>
<p><img src="/posts/1fbae977/starkware-3.webp" alt></p>
<h2 id="STARK生成过程"><a class="header-anchor" href="#STARK生成过程"> </a>STARK生成过程</h2>
<p><img src="/posts/1fbae977/starkware-4.webp" alt><br>
通常 zk-STARK 证明需要以下过程生成证明。验证者的证明过程分为两步：</p>
<ol>
<li>第一步为计算完整性声明经过算术后生成代数中间代码表示</li>
<li>第二步为经过测试后生成 FRI (StarkWare Co-Founder 2017年所著论文中对证明的优化方法)。</li>
</ol>
<p>之后经过加密算法后输出可拓展的公开透明知识论据 (也就是 STARK)。简而言之就是通过安全可信的环境以及优化算法生成一个可信并且高性能的证明。</p>
<h1 id="参考资料-2"><a class="header-anchor" href="#参考资料-2"> </a>参考资料</h1>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=khVPrv69Zd4&amp;t=108s">https://www.youtube.com/watch?v=khVPrv69Zd4&amp;t=108s</a><br>
<a target="_blank" rel="noopener" href="https://medium.com/nethermind-eth/solidity-on-starknet-terminal-velocity-e8df5f63e010">https://medium.com/nethermind-eth/solidity-on-starknet-terminal-velocity-e8df5f63e010</a><br>
<a target="_blank" rel="noopener" href="https://www.cairo-lang.org/cairo-for-blockchain-developers/">https://www.cairo-lang.org/cairo-for-blockchain-developers/</a><br>
<a target="_blank" rel="noopener" href="https://eprint.iacr.org/2021/1063.pdf">https://eprint.iacr.org/2021/1063.pdf</a><br>
<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/6ce113baa464">https://www.jianshu.com/p/6ce113baa464</a><br>
<a target="_blank" rel="noopener" href="https://ethfans.org/posts/on-the-road-to-starknet-a-permissionless-stark-powered-l2-zk-rollup">https://ethfans.org/posts/on-the-road-to-starknet-a-permissionless-stark-powered-l2-zk-rollup</a><br>
<a target="_blank" rel="noopener" href="https://www.ise.tu-berlin.de/fileadmin/fg308/publications/2018/Off-chaining_Models_and_Approaches_to_Off-chain_Computations.pdf">https://www.ise.tu-berlin.de/fileadmin/fg308/publications/2018/Off-chaining_Models_and_Approaches_to_Off-chain_Computations.pdf</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wanyvic.github.io/posts/bed1adf7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ProfilePhoto.PNG">
      <meta itemprop="name" content="wanyvic">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wanyvicの博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/bed1adf7/" class="post-title-link" itemprop="url">Immutable X 分析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-12-26 14:40:34" itemprop="dateCreated datePublished" datetime="2021-12-26T14:40:34+08:00">2021-12-26</time>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/posts/bed1adf7/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/posts/bed1adf7/" data-xid="/posts/bed1adf7/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="介绍-4"><a class="header-anchor" href="#介绍-4"> </a>介绍</h1>
<p>Immutable X是一个基于StarkWare的layer2网络使用Cairo编写的NFT跨链和交易应用。用户可以在此网络内进行快速低成本的交易。并且由于StarkNet底层使用了ZK-Rollup的方案，相比传统sidechain拥有更高的去中心化安全性、即时交易确认、高tps、抗DDos等优点。</p>
<h1 id="原理"><a class="header-anchor" href="#原理"> </a>原理</h1>
<p>Immutable X使用ZK-Rollup，将layer2上的一定量的交易打包，批量生成有效的证明，提交到layer1上的智能合约进行验证。通过验证后即可完成“跨链”的存取操作。</p>
<h1 id="Immutable-X的使用"><a class="header-anchor" href="#Immutable-X的使用"> </a>Immutable X的使用</h1>
<h2 id="在Immutable-X集成ERC721"><a class="header-anchor" href="#在Immutable-X集成ERC721"> </a>在Immutable X集成ERC721</h2>
<p><strong>先决条件：</strong></p>
<ol>
<li>ERC721的部署：在layer1上部署继承了Immutable X的Mintable合约的ERC721。</li>
<li>合约注册：上文所述的合约要在Immutable X登记。</li>
<li>用户注册：用户使用前也需要先登记。目的是为了将layer1私钥与layer2私钥进行绑定。</li>
</ol>
<h3 id="ERC721的部署"><a class="header-anchor" href="#ERC721的部署"> </a>ERC721的部署</h3>
<p>在layer1上部署继承了Immutable X的Mintable合约的ERC721。确保IMX拥有铸币权。</p>
<p><strong>Mintable.sol</strong><br>
此合约内部提供了一个mintFor方法确保IMX拥有铸币权。token特性相关的代码需要实现_mintFor方法。</p>
<pre class="line-numbers language-none"><code class="language-none">modifier onlyIMX() &#123;
        require(msg.sender &#x3D;&#x3D; imx, &quot;Function can only be called by IMX&quot;);
        _;
    &#125;
​
    function mintFor(
        address user,
        uint256 quantity,
        bytes calldata mintingBlob
    ) external override onlyIMX &#123;
        require(quantity &#x3D;&#x3D; 1, &quot;Mintable: invalid quantity&quot;);
        (uint256 id, bytes memory blueprint) &#x3D; Minting.split(mintingBlob);
        _mintFor(user, id, blueprint);
        blueprints[id] &#x3D; blueprint;
        emit AssetMinted(user, id, blueprint);
    &#125;
​
    function _mintFor(
        address to,
        uint256 id,
        bytes memory blueprint
    ) internal virtual;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="合约注册"><a class="header-anchor" href="#合约注册"> </a>合约注册</h3>
<p>部署合约后，需要向 Immutable X 注册。<br>
目前只支持手动验证注册，后续项目方支持自动验证注册。<br>
将以下详细信息，<a target="_blank" rel="noopener" href="https://support.immutable.com/hc/en-us/requests/new">在此处</a>提交给项目方后收到回执邮件。<br>
然后在<a target="_blank" rel="noopener" href="https://api.x.immutable.com/v1/collections">https://api.x.immutable.com/v1/collections</a>可以查询到我们的合约。</p>
<pre class="line-numbers language-none"><code class="language-none">&#123;
  &quot;name&quot;: &quot;Collection Name (usually Partner Name)&quot;,
  &quot;description&quot;: &quot;Some Description of this collection&quot;,
  &quot;owner_public_key&quot;: &quot;&lt;CHANGE-ME&gt;&quot;,
  &quot;contract_address&quot;: &quot;&lt;CHANGE-ME&gt;&quot;,
  &quot;metadata_api_url&quot;: &quot;https:&#x2F;&#x2F;&lt;CHANGE-ME&gt;&quot;,
  &quot;icon_url&quot;: &quot;https:&#x2F;&#x2F;&lt;CHANGE-ME&gt;&quot;,
  &quot;collection_image_url&quot;: &quot;https:&#x2F;&#x2F;&lt;CHANGE-ME&gt;&quot;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="用户注册"><a class="header-anchor" href="#用户注册"> </a>用户注册</h3>
<p>将按照EIP-2645对用户的layer1和layer2的私钥进行绑定。<br>
<img src="https://files.readme.io/3bc4579-THLcqN4gMFQp.png" alt></p>
<h2 id="在Immutable-X使用"><a class="header-anchor" href="#在Immutable-X使用"> </a>在Immutable X使用</h2>
<h3 id="铸币"><a class="header-anchor" href="#铸币"> </a>铸币</h3>
<p><img src="https://files.readme.io/9b5debc-THLcqN4gMFQp_1.png" alt></p>
<ol>
<li>用户在layer2用对应的私钥发起铸币请求。</li>
<li>Immutable X Engine对签名、请求、状态等验证同步提交到layer2。</li>
<li>layer2最后根据状态转移进行零知识证明生成proof。</li>
<li>将证明结果提交给layer1。</li>
</ol>
<h3 id="资产存款"><a class="header-anchor" href="#资产存款"> </a>资产存款</h3>
<p>用户在layer1上发起存款请求，layer2接收到事件后，在layer2上进行铸造。<br>
<img src="https://files.readme.io/0048928-THLcqN4gMFQp_2.png" alt></p>
<ol>
<li>用户首先向API请求存款数据。</li>
<li>用户拿到存款数据后，将token存入layer1的存款合约。</li>
<li>存款合约发出事件后，Immutable X engine收到事件后在layer2上处理存款请求。</li>
<li>layer2生成proof提交到layer1。</li>
</ol>
<h3 id="资产提取"><a class="header-anchor" href="#资产提取"> </a>资产提取</h3>
<p>用户在layer2上发起提取请求。当确认后，用户可以在layer1上发起请求进行提款。<br>
<img src="https://files.readme.io/f18d111-THLcqN4gMFQp_3.png" alt></p>
<ol>
<li>用户首先向API请求提款数据。</li>
<li>用户拿到提款数据后发起提款。</li>
<li>当layer2协商一致后并且proof成功上链后，layer1用户会收到提款事件。</li>
<li>用户layer1发起提款，并收到资产。</li>
</ol>
<h3 id="资产交易"><a class="header-anchor" href="#资产交易"> </a>资产交易</h3>
<p>用户交易本身发生在layer2，无须与layer1交互。<br>
<img src="https://files.readme.io/6e913c7-THLcqN4gMFQp_4.png" alt></p>
<ol>
<li>用户首先向API请求卖单数据。</li>
<li>用户根据数据提交卖单。（此部分没有进行实质上的状态数据变化，所有无须与其他节点同步）</li>
<li>某用户确认认购后，Immutable Engine将卖单买单数据同步给其他节点。</li>
<li>生成proof提交到layer1。</li>
</ol>
<h1 id="参考资料"><a class="header-anchor" href="#参考资料"> </a>参考资料</h1>
<blockquote>
<p>Cairo合约开发文档 <a target="_blank" rel="noopener" href="https://www.cairo-lang.org/">https://www.cairo-lang.org/</a><br>
immutable x 文档 <a target="_blank" rel="noopener" href="https://docs.x.immutable.com/docs/">https://docs.x.immutable.com/docs/</a><br>
starknet <a target="_blank" rel="noopener" href="https://starkware.co/starknet/">https://starkware.co/starknet/</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wanyvic.github.io/posts/1baceed3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ProfilePhoto.PNG">
      <meta itemprop="name" content="wanyvic">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wanyvicの博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/1baceed3/" class="post-title-link" itemprop="url">Axie Infinity 分析 （一）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-12-17 12:08:26" itemprop="dateCreated datePublished" datetime="2021-12-17T12:08:26+08:00">2021-12-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/" itemprop="url" rel="index"><span itemprop="name">区块链</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/posts/1baceed3/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/posts/1baceed3/" data-xid="/posts/1baceed3/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="介绍"><a class="header-anchor" href="#介绍"> </a>介绍</h1>
<p>Axie Infinity是一个卡片对战类型的gamefi游戏玩家可以通过PVE、PVP对战、获取SLP、购买NFT精灵、繁殖、升级等养成类游戏。<br>
部分代码开源：<br>
<a target="_blank" rel="noopener" href="https://github.com/axieinfinity/public-smart-contracts">public-smart-contracts</a><br>
<a target="_blank" rel="noopener" href="https://github.com/axieinfinity/ronin-smart-contracts">ronin-smart-contracts</a></p>
<h1 id="玩法分析"><a class="header-anchor" href="#玩法分析"> </a>玩法分析</h1>
<ol>
<li>用户通过跨链将资产转移到ronin chain。需购买或其他方式得到3个NFT小精灵，进行游戏对战。</li>
<li>用私钥对邮箱地址签名进行账号绑定。</li>
<li>玩家进入游戏可以进行PVE、PVP获得SLP。用户等待锁定期后通过链上claim获取SLP。SLP的释放速率受控于项目方。</li>
<li>NFT可以有性繁殖，中间消耗SLP和AXS。</li>
<li>NFT交易市场可以自由买卖、拍卖NFT。</li>
<li>玩家获取的SLP和AXS可以进行Defi挖矿（Lp挖矿和单币挖矿）。</li>
<li>对于PVP Rank topN，赛季后会释放奖金激励。</li>
</ol>
<h1 id="涉及的合约"><a class="header-anchor" href="#涉及的合约"> </a>涉及的合约</h1>
<h2 id="ronin侧"><a class="header-anchor" href="#ronin侧"> </a>ronin侧</h2>
<h3 id="Ronin-Gateway-Contract"><a class="header-anchor" href="#Ronin-Gateway-Contract"> </a>Ronin Gateway Contract</h3>
<p>Ronin和Ethereum的跨链桥</p>
<h4 id="合约地址"><a class="header-anchor" href="#合约地址"> </a>合约地址</h4>
<p><a target="_blank" rel="noopener" href="https://explorer.roninchain.com/address/ronin:e35d62ebe18413d96ca2a2f7cf215bb21a406b4b">ronin:e35d62ebe18413d96ca2a2f7cf215bb21a406b4b</a></p>
<h4 id="作用"><a class="header-anchor" href="#作用"> </a>作用</h4>
<p>Ronin和Ethereum的跨链桥</p>
<h4 id="核心方法"><a class="header-anchor" href="#核心方法"> </a>核心方法</h4>
<table>
<thead>
<tr>
<th>functionId</th>
<th>调用权限</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>acknowledWithdrawalOnMainchain(uint256 _withdrawalId)</td>
<td>onlyValidator</td>
<td>需要多个validator对取款到ethereum的确认,如果阈值达到设置，则从pending中移除。</td>
</tr>
<tr>
<td>submitWithdrawalSignatures(uint256 _withdrawalId,bool _shouldReplace,bytes memory _sig)</td>
<td>onlyValidator</td>
<td>validator提供取款操作签名给ethereum，当ethereum收集足够的签名时可以被批准取出token</td>
</tr>
<tr>
<td>withdrawERC20(address _token, uint256 _amount)</td>
<td>user</td>
<td>用户调用取token到ethereum，创建withdrawEntry到pending</td>
</tr>
<tr>
<td>depositERCTokenFor(uint256 _depositId, address _owner, address _token, uint32 _standard, uint256 _tokenNumber)</td>
<td>onlyValidator</td>
<td>validator调用，当满足阈值时可以在ronin取出token</td>
</tr>
</tbody>
</table>
<h4 id="提款到MainChain"><a class="header-anchor" href="#提款到MainChain"> </a>提款到MainChain</h4>
<pre class="mermaid">
sequenceDiagram
participant Validitor
participant User
participant SideChain as SideChain Gateway
participant MainChain as MainChain Gateway

User-&gt;&gt;+SideChain:withdrawERC20 (transferFrom token)
Validitor-&gt;&gt;SideChain:N x acknowledWithdrawalOnMainchain
Validitor-&gt;&gt;SideChain:N x submitWithdrawalSignatures
SideChain--&gt;&gt;-User: N x Signatures
User-&gt;&gt;+MainChain:withdrawERC20 (with Signatures)
MainChain--&gt;&gt;-User:token transfer

</pre>
<h4 id="存款到SideChain"><a class="header-anchor" href="#存款到SideChain"> </a>存款到SideChain</h4>
<pre class="mermaid">
sequenceDiagram
participant Validitor
participant User
participant SideChain as SideChain Gateway
participant MainChain as MainChain Gateway

User-&gt;&gt;+MainChain:depositERC20
MainChain--&gt;&gt;-Validitor:emit TokenDeposited
Validitor-&gt;&gt;+SideChain:N x depositERCTokenFor
SideChain--&gt;&gt;-User:token transfer

</pre>
<p><strong>注：涉及weth取出存入与token操作相同此处不再赘述</strong><br>
<strong>注：涉及batch操作与原子操作类似此处不再赘述</strong></p>
<h3 id="Ronin-Registry-Contract"><a class="header-anchor" href="#Ronin-Registry-Contract"> </a>Ronin Registry Contract</h3>
<h4 id="合约地址-2"><a class="header-anchor" href="#合约地址-2"> </a>合约地址</h4>
<p><a target="_blank" rel="noopener" href="https://explorer.roninchain.com/address/ronin:3a860626b0467809d50c58bef89b8ac6247fd62a">ronin:3a860626b0467809d50c58bef89b8ac6247fd62a</a></p>
<h4 id="作用-2"><a class="header-anchor" href="#作用-2"> </a>作用</h4>
<p>维护例如GATEWAY、WETH_TOKEN、VALIDATOR、ACKNOWLEDGEMENT合约名称到地址的注册合约。</p>
<h3 id="Ronin-Validator-Contract"><a class="header-anchor" href="#Ronin-Validator-Contract"> </a>Ronin Validator Contract</h3>
<h4 id="合约地址-3"><a class="header-anchor" href="#合约地址-3"> </a>合约地址</h4>
<p><a target="_blank" rel="noopener" href="https://explorer.roninchain.com/address/ronin:0000000000000000000000000000000000000011">ronin:0000000000000000000000000000000000000011</a></p>
<h4 id="作用-3"><a class="header-anchor" href="#作用-3"> </a>作用</h4>
<p>validator白名单合约，用于添加、删除validator和更改阈值投票。维护Ronin的POA共识。</p>
<h3 id="Smooth-Love-Potion-Contract"><a class="header-anchor" href="#Smooth-Love-Potion-Contract"> </a>Smooth Love Potion Contract</h3>
<h4 id="合约地址-4"><a class="header-anchor" href="#合约地址-4"> </a>合约地址</h4>
<p><a target="_blank" rel="noopener" href="https://explorer.roninchain.com/address/ronin:a8754b9fa15fc18bb59458815510e40a12cd2014">ronin:a8754b9fa15fc18bb59458815510e40a12cd2014</a></p>
<h4 id="作用-4"><a class="header-anchor" href="#作用-4"> </a>作用</h4>
<p>游戏内的ERC20：SLP，用户进行游戏后服务器发放给玩家的“经验”，用于其他玩法消耗。</p>
<h4 id="核心方法-2"><a class="header-anchor" href="#核心方法-2"> </a>核心方法</h4>
<p>除常规IERC20外，多了一个checkpoint方法用于“claim”。</p>
<table>
<thead>
<tr>
<th>function</th>
<th>调用权限</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>checkpoint(address _owner,uint256 _amount,uint256 _createdAt,bytes _signature)</td>
<td>user</td>
<td>用户取出slp时需要服务器给出相对应的签名</td>
</tr>
</tbody>
</table>
<h3 id="Axie-Infinity-Shard-Contract"><a class="header-anchor" href="#Axie-Infinity-Shard-Contract"> </a>Axie Infinity Shard Contract</h3>
<h4 id="合约地址-5"><a class="header-anchor" href="#合约地址-5"> </a>合约地址</h4>
<p><a target="_blank" rel="noopener" href="https://explorer.roninchain.com/address/ronin:97a9107c1793bc407d6f527b77e7fff4d812bece">ronin:97a9107c1793bc407d6f527b77e7fff4d812bece</a></p>
<h4 id="作用-5"><a class="header-anchor" href="#作用-5"> </a>作用</h4>
<p>ERC20合约：axs</p>
<h3 id="Axie-Contract"><a class="header-anchor" href="#Axie-Contract"> </a>Axie Contract</h3>
<h4 id="合约地址-6"><a class="header-anchor" href="#合约地址-6"> </a>合约地址</h4>
<p><a target="_blank" rel="noopener" href="https://explorer.roninchain.com/address/ronin:32950db2a7164ae833121501c797d79e7b79d74c">ronin:32950db2a7164ae833121501c797d79e7b79d74c</a></p>
<h4 id="作用-6"><a class="header-anchor" href="#作用-6"> </a>作用</h4>
<p>ERC721合约：axie。除了正常的IERC721以外，里面包含了一些管理员操作例如：growAxieggToAdult、batchMintAxieggs、mintAxie、和一些改变genes的设置。此部分代码未开源。</p>
<h3 id="Katana-Router-Contract"><a class="header-anchor" href="#Katana-Router-Contract"> </a>Katana Router Contract</h3>
<h4 id="合约地址-7"><a class="header-anchor" href="#合约地址-7"> </a>合约地址</h4>
<p><a target="_blank" rel="noopener" href="https://explorer.roninchain.com/address/ronin:7d0556d55ca1a92708681e2e231733ebd922597d">ronin:7d0556d55ca1a92708681e2e231733ebd922597d</a></p>
<h4 id="Lp对"><a class="header-anchor" href="#Lp对"> </a>Lp对</h4>
<p>slp-weth lp <a target="_blank" rel="noopener" href="https://explorer.roninchain.com/address/ronin:306a28279d04a47468ed83d55088d0dcd1369294">ronin:306a28279d04a47468ed83d55088d0dcd1369294</a><br>
axs-weth lp <a target="_blank" rel="noopener" href="https://explorer.roninchain.com/address/ronin:c6344bc1604fcab1a5aad712d766796e2b7a70b9">ronin:c6344bc1604fcab1a5aad712d766796e2b7a70b9</a><br>
usdc-weth lp <a target="_blank" rel="noopener" href="https://explorer.roninchain.com/address/ronin:a7964991f339668107e2b6a6f6b8e8b74aa9d017">ronin:a7964991f339668107e2b6a6f6b8e8b74aa9d017</a></p>
<h3 id="AXS-Staking-Pool-Contract"><a class="header-anchor" href="#AXS-Staking-Pool-Contract"> </a>AXS Staking Pool Contract</h3>
<h4 id="合约地址-8"><a class="header-anchor" href="#合约地址-8"> </a>合约地址</h4>
<p><a target="_blank" rel="noopener" href="https://explorer.roninchain.com/address/ronin:05b0bb3c1c320b280501b86706c3551995bc8571">ronin:05b0bb3c1c320b280501b86706c3551995bc8571</a></p>
<h4 id="作用-7"><a class="header-anchor" href="#作用-7"> </a>作用</h4>
<p>质押axs挖矿（单币挖矿）</p>
<h4 id="核心方法-3"><a class="header-anchor" href="#核心方法-3"> </a>核心方法</h4>
<table>
<thead>
<tr>
<th>function</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>stake(uint256)</td>
<td>质押axs</td>
</tr>
<tr>
<td>restakeRewards()</td>
<td>复投</td>
</tr>
<tr>
<td>claimPendingRewards()</td>
<td>获取收益</td>
</tr>
<tr>
<td>unstake(uint256)</td>
<td>取出质押</td>
</tr>
</tbody>
</table>
<h3 id="Staking-Pool-Contracts"><a class="header-anchor" href="#Staking-Pool-Contracts"> </a>Staking Pool Contracts</h3>
<h4 id="合约地址-9"><a class="header-anchor" href="#合约地址-9"> </a>合约地址</h4>
<p>SLP-WETH LP Staking Pool <a target="_blank" rel="noopener" href="https://explorer.roninchain.com/address/ronin:d4640c26c1a31cd632d8ae1a96fe5ac135d1eb52">ronin:d4640c26c1a31cd632d8ae1a96fe5ac135d1eb52</a><br>
AXS-WETH LP Staking Pool <a target="_blank" rel="noopener" href="https://explorer.roninchain.com/address/ronin:487671acdea3745b6dac3ae8d1757b44a04bfe8a">ronin:487671acdea3745b6dac3ae8d1757b44a04bfe8a</a></p>
<h4 id="作用-8"><a class="header-anchor" href="#作用-8"> </a>作用</h4>
<p>质押LP挖矿。</p>
<h3 id="Marketplace-Contract"><a class="header-anchor" href="#Marketplace-Contract"> </a>Marketplace Contract</h3>
<p>NFT交易二级市场</p>
<h4 id="合约地址-10"><a class="header-anchor" href="#合约地址-10"> </a>合约地址</h4>
<p><a target="_blank" rel="noopener" href="https://explorer.roninchain.com/address/ronin:213073989821f738a7ba3520c3d31a1f9ad31bbd">ronin:213073989821f738a7ba3520c3d31a1f9ad31bbd</a></p>
<h4 id="核心方法-4"><a class="header-anchor" href="#核心方法-4"> </a>核心方法</h4>
<table>
<thead>
<tr>
<th>function</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>settleAuction(address,address,uint256,uint256,uint256)</td>
<td>买NFT</td>
</tr>
<tr>
<td>createAuction(uint8[],address[],uint256[],uint256[],uint256[],address[],uint256[])</td>
<td>创建卖单</td>
</tr>
<tr>
<td>cancelAuction(uint256)</td>
<td>撤销卖单</td>
</tr>
<tr>
<td>revalidateRelatedAuctions(uint256)</td>
<td>未知，似乎是管理员的操作</td>
</tr>
</tbody>
</table>
<pre class="mermaid">
sequenceDiagram
participant Consumer
participant Seller
participant Marketplace

Seller-&gt;&gt;+Marketplace:createAuction 创建卖单
alt
    Seller-&gt;&gt;Marketplace:cancelAuction 撤单
else
    Consumer-&gt;&gt;Marketplace:settleAuction 购买
    Marketplace--&gt;&gt;-Consumer:transfer NFT
end
</pre>
<h2 id="Ethereum侧"><a class="header-anchor" href="#Ethereum侧"> </a>Ethereum侧</h2>
<p>Ethereum侧包含gateway、ERC20、ERC721合约与ronin侧大致相同。不同点在于Ethereum上的gateway使用了EIP712方式取款减少交互节约gas。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wanyvic.github.io/posts/ce18c401/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ProfilePhoto.PNG">
      <meta itemprop="name" content="wanyvic">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wanyvicの博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/ce18c401/" class="post-title-link" itemprop="url">MetaProofs</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-11-29 13:32:56" itemprop="dateCreated datePublished" datetime="2021-11-29T13:32:56+08:00">2021-11-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/" itemprop="url" rel="index"><span itemprop="name">区块链</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/posts/ce18c401/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/posts/ce18c401/" data-xid="/posts/ce18c401/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>854</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="引言"><a class="header-anchor" href="#引言"> </a>引言</h1>
<p>现如今的智能合约虚拟机是一种对称式的虚拟机。即：<code>Ф(s)-&gt;s'</code>。其中<code>s</code>是原状态，<code>Ф</code>是状态转移函数，<code>s'</code>是经过计算后的新状态。由上公式可以得出，全节点验证状态转移的合法性过程需要执行一次相同的计算<code>Ф(s)-&gt;s'</code>验证<code>s'</code>是否与链上结果一致。<code>Ф</code>相当于合约代码。如果<code>Ф</code>逻辑较为复杂，这无疑增加的了全节点的性能负担，导致出块时间不平衡的等系统性风险。以太坊通过<code>gas limit</code>和<code>block gas limits</code>限制计算量保证全节点都可以在规定的时间范围内计算出数据结果。但这样同时也限制了<code>Ф</code>的复杂度，合约不能执行复杂的逻辑代码。</p>
<h1 id="MetaProofs"><a class="header-anchor" href="#MetaProofs"> </a>MetaProofs</h1>
<p>为此根据论文<a target="_blank" rel="noopener" href="https://eprint.iacr.org/2012/495.pdf">“METAPROOFS”</a>。一种新的理论证明方式引起广泛的讨论。</p>
<p><code>MetaProofs</code>基于零知识证明，大致原理会生成一个证明<code>(Prover)</code>结果<code>µP</code>证明<code>s</code>通过<code>Ф</code>函数计算出<code>s'</code>。验证<code>(Verifier)</code>的时候只需要将这四个参数传入验证函数中，得到结果为<code>true</code>则可以表示状态转移是合法的。详细步骤如下图所示。<br>
<img src="/posts/ce18c401/metaproofs.png" alt></p>
<p><code>MetaProofs</code>是一个证明<code>Prover</code>复杂度高，但<code>Verifier</code>快的函数。并且验证与<code>Ф</code>函数本身的复杂度无关。<br>
因此将<code>MetaProofs</code>引入区块链，链下<code>Prover</code>生成，链上<code>Verifier</code>。既可以使智能合约处理更复杂的逻辑代码，又可以降低全节点的计算负载。不仅如此<code>MetaProofs</code>也可以生成单个链的证明，从而对分片和layer2有更好性能提升。</p>
<p><strong>注：</strong> 此处因作者水平有限，如有理解偏差。欢迎讨论告知。</p>
<h1 id="相关的语言"><a class="header-anchor" href="#相关的语言"> </a>相关的语言</h1>
<h2 id="Lurk"><a class="header-anchor" href="#Lurk"> </a>Lurk</h2>
<p>Lurk 是一种用于图灵完备递归 SNARK 的开发中的编程语言：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/lurk-lang/root">https://github.com/lurk-lang/root</a></li>
</ul>
<h2 id="yatima"><a class="header-anchor" href="#yatima"> </a>yatima</h2>
<p>yatima 是一个去中心化网络的编程语言</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/yatima-inc/yatima">https://github.com/yatima-inc/yatima</a></li>
</ul>
<h1 id="参考文献-3"><a class="header-anchor" href="#参考文献-3"> </a>参考文献</h1>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://eprint.iacr.org/2012/495.pdf">https://eprint.iacr.org/2012/495.pdf</a><br>
<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=iQkedSqQH34">https://www.youtube.com/watch?v=iQkedSqQH34</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wanyvic.github.io/posts/5671ab14/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ProfilePhoto.PNG">
      <meta itemprop="name" content="wanyvic">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wanyvicの博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/5671ab14/" class="post-title-link" itemprop="url">CosmWasm 三 入口函数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-11-23 16:50:41" itemprop="dateCreated datePublished" datetime="2021-11-23T16:50:41+08:00">2021-11-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/" itemprop="url" rel="index"><span itemprop="name">区块链</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/posts/5671ab14/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/posts/5671ab14/" data-xid="/posts/5671ab14/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="cosmwasm-特点"><a class="header-anchor" href="#cosmwasm-特点"> </a>cosmwasm 特点</h1>
<ul>
<li>合约在<code>cosmwasm</code>被称之为<code>actor</code></li>
<li>异步栈式调用，将每个调用压栈，触发调用弹栈。避免重入攻击风险，并且有跨链优势</li>
</ul>
<h1 id="actor-调用接口"><a class="header-anchor" href="#actor-调用接口"> </a>actor 调用接口</h1>
<p>交互<code>actor</code>的接口封装在<code>WasmMsg</code>结构中，共有5种类型</p>
<table>
<thead>
<tr>
<th>调用接口</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Instantiate</td>
<td>初始化合约入口</td>
</tr>
<tr>
<td>Execute</td>
<td>执行合约交易</td>
</tr>
<tr>
<td>Migrate</td>
<td>迁移合约至新的代码</td>
</tr>
<tr>
<td>UpdateAdmin</td>
<td>升级管理员</td>
</tr>
<tr>
<td>ClearAdmin</td>
<td>清除管理员</td>
</tr>
</tbody>
</table>
<p><strong>说明:</strong></p>
<ol>
<li>每个<code>actor</code>有个内置的<code>Admin</code>充当管理员的角色。</li>
<li>只有<code>Admin</code>拥有<code>UpdateAdmin</code>、<code>ClearAdmin</code>和<code>Migrate</code>调用权限。</li>
<li>当<code>Admin</code>成功调用<code>ClearAdmin</code>后，<code>actor</code>将失去管理员角色。</li>
<li>成功调用<code>Migrate</code>后，只会改变<code>actor</code>的<code>code</code>，地址和状态数据不会改变。</li>
<li><code>Instantiate</code>、<code>Execute</code>和<code>Migrate</code>接口，wasm有对应的事件处理函数。</li>
</ol>
<h2 id="wasm-调用事件入口"><a class="header-anchor" href="#wasm-调用事件入口"> </a>wasm 调用事件入口</h2>
<h3 id="instantiate"><a class="header-anchor" href="#instantiate"> </a>instantiate</h3>
<p>处理初始化事件代码逻辑入口</p>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token attribute attr-name">#[entry_point]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">instantiate</span><span class="token punctuation">(</span>
  deps<span class="token punctuation">:</span> <span class="token class-name">DepsMut</span><span class="token punctuation">,</span>
  env<span class="token punctuation">:</span> <span class="token class-name">Env</span><span class="token punctuation">,</span>
  info<span class="token punctuation">:</span> <span class="token class-name">MessageInfo</span><span class="token punctuation">,</span>
  msg<span class="token punctuation">:</span> <span class="token class-name">InstantiateMsg</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Response</span><span class="token punctuation">,</span> <span class="token class-name">ContractError</span><span class="token operator">></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="execute"><a class="header-anchor" href="#execute"> </a>execute</h3>
<p>处理交互合约事件代码逻辑入口</p>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token attribute attr-name">#[entry_point]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">execute</span><span class="token punctuation">(</span>
  deps<span class="token punctuation">:</span> <span class="token class-name">DepsMut</span><span class="token punctuation">,</span>
  env<span class="token punctuation">:</span> <span class="token class-name">Env</span><span class="token punctuation">,</span>
  info<span class="token punctuation">:</span> <span class="token class-name">MessageInfo</span><span class="token punctuation">,</span>
  msg<span class="token punctuation">:</span> <span class="token class-name">ExecuteMsg</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Response</span><span class="token punctuation">,</span> <span class="token class-name">ContractError</span><span class="token operator">></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="migrate"><a class="header-anchor" href="#migrate"> </a>migrate</h3>
<p>处理迁移事件代码逻辑入口。<br>
此部分调用逻辑是在更新的代码中触发。</p>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token attribute attr-name">#[entry_point]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">migrate</span><span class="token punctuation">(</span>deps<span class="token punctuation">:</span> <span class="token class-name">DepsMut</span><span class="token punctuation">,</span> env<span class="token punctuation">:</span> <span class="token class-name">Env</span><span class="token punctuation">,</span> msg<span class="token punctuation">:</span> <span class="token class-name">MigrateMsg</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Response</span><span class="token punctuation">,</span> <span class="token class-name">ContractError</span><span class="token operator">></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h1 id="actor-查询接口"><a class="header-anchor" href="#actor-查询接口"> </a>actor 查询接口</h1>
<table>
<thead>
<tr>
<th>查询接口</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Smart</td>
<td>查询公共API的接口</td>
</tr>
<tr>
<td>Raw</td>
<td>查询kv-store类型的接口</td>
</tr>
</tbody>
</table>
<h2 id="wasm-查询事件入口"><a class="header-anchor" href="#wasm-查询事件入口"> </a>wasm 查询事件入口</h2>
<p>对于<code>Smart</code>查询wasm的<code>query</code>接口</p>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token attribute attr-name">#[entry_point]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">query</span><span class="token punctuation">(</span>deps<span class="token punctuation">:</span> <span class="token class-name">Deps</span><span class="token punctuation">,</span> env<span class="token punctuation">:</span> <span class="token class-name">Env</span><span class="token punctuation">,</span> msg<span class="token punctuation">:</span> <span class="token class-name">QueryMsg</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Binary</span><span class="token punctuation">,</span> <span class="token class-name">ContractError</span><span class="token operator">></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wanyvic.github.io/posts/b2bb0ade/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ProfilePhoto.PNG">
      <meta itemprop="name" content="wanyvic">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wanyvicの博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/b2bb0ade/" class="post-title-link" itemprop="url">CosmWasm 二 项目创建</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-11-05 17:09:52" itemprop="dateCreated datePublished" datetime="2021-11-05T17:09:52+08:00">2021-11-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/" itemprop="url" rel="index"><span itemprop="name">区块链</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/posts/b2bb0ade/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/posts/b2bb0ade/" data-xid="/posts/b2bb0ade/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>426</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="使用cw-template模板初始化"><a class="header-anchor" href="#使用cw-template模板初始化"> </a>使用<a target="_blank" rel="noopener" href="https://github.com/CosmWasm/cw-template">cw-template</a>模板初始化</h1>
<h2 id="环境要求"><a class="header-anchor" href="#环境要求"> </a>环境要求</h2>
<ul>
<li>Rust 1.55+</li>
</ul>
<h2 id="安装cargo-generate"><a class="header-anchor" href="#安装cargo-generate"> </a>安装cargo-generate</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cargo <span class="token function">install</span> cargo-generate --features vendored-openssl
cargo <span class="token function">install</span> cargo-run-script<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="创建新的合约"><a class="header-anchor" href="#创建新的合约"> </a>创建新的合约</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cargo generate --git https://github.com/CosmWasm/cw-template.git --name PROJECT_NAME<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>使用旧版本需要加上版本号作为参数</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cargo generate --git https://github.com/CosmWasm/cw-template.git --branch <span class="token operator">&lt;</span>version<span class="token operator">></span> --name PROJECT_NAME<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Example:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cargo generate --git https://github.com/CosmWasm/cw-template.git --branch <span class="token number">0.16</span> --name PROJECT_NAME<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wanyvic.github.io/posts/4b1fd5af/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ProfilePhoto.PNG">
      <meta itemprop="name" content="wanyvic">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wanyvicの博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/4b1fd5af/" class="post-title-link" itemprop="url">BXH被盗分析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-11-03 11:09:50" itemprop="dateCreated datePublished" datetime="2021-11-03T11:09:50+08:00">2021-11-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/" itemprop="url" rel="index"><span itemprop="name">区块链</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/posts/4b1fd5af/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/posts/4b1fd5af/" data-xid="/posts/4b1fd5af/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="观前提示"><a class="header-anchor" href="#观前提示"> </a>观前提示</h1>
<p>以下时间均为北京时间</p>
<h1 id="参与者"><a class="header-anchor" href="#参与者"> </a>参与者</h1>
<table>
<thead>
<tr>
<th>角色</th>
<th>地址</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>攻击者 Exploiter</td>
<td><a target="_blank" rel="noopener" href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">0x48c94305bddfd80c6f4076963866d968cac27d79</a></td>
<td>BXH攻击者外部账户</td>
</tr>
<tr>
<td>攻击合约 Attacker</td>
<td><a target="_blank" rel="noopener" href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">0x887716168FC8c1A2933F97ea3858a94c9E229201</a></td>
<td>BXH攻击者创建的攻击合约（通过此合约攻击BXH策略）创建于 <a target="_blank" rel="noopener" href="https://bscscan.com/tx/0xf0a833371d843130601dca50553a203e2a07940ec531592cbd3c48003ace34bd">2021-10-27 21:47:34</a></td>
</tr>
<tr>
<td>攻击者收款合约</td>
<td><a target="_blank" rel="noopener" href="https://bscscan.com/address/0x13b81fa9c0873a74c49a85bd8149c1c20bf9d18c">0x13b81fa9c0873a74c49a85bd8149c1c20bf9d18c</a></td>
<td>创建于 <a target="_blank" rel="noopener" href="https://bscscan.com/tx/0x6119e86085440083b8e8b6f5435cbc6480df7fde541c8028d013dce7245720a5">2021-10-30 11:15:45</a></td>
</tr>
<tr>
<td>BXH策略地址</td>
<td><a target="_blank" rel="noopener" href="https://bscscan.com/address/0x6AcECA12de5a15f11ca51b654433259533B0B802">0x6AcECA12de5a15f11ca51b654433259533B0B802</a></td>
<td>BXH策略资金地址</td>
</tr>
<tr>
<td>BXH管理员</td>
<td><a target="_blank" rel="noopener" href="https://bscscan.com/address/0x56146b129017940d06d8e235c02285a3d05d6b7c">0x56146b129017940d06d8e235c02285a3d05d6b7c</a></td>
<td>总管理员</td>
</tr>
<tr>
<td>BXH访问权限控制合约</td>
<td><a target="_blank" rel="noopener" href="https://bscscan.com/address/0x83dae57c46985c3a2346e8a3c6991ca908f8b06b">0x83dae57c46985c3a2346e8a3c6991ca908f8b06b</a></td>
<td>用于控制各个合约访问权限</td>
</tr>
</tbody>
</table>
<h1 id="攻击时序图"><a class="header-anchor" href="#攻击时序图"> </a>攻击时序图</h1>
<pre class="mermaid">
sequenceDiagram
participant Exploiter as 攻击者 Exploiter
participant Attacker as 攻击合约 Attacker
participant AttackContract as 攻击者收款合约 AttackContract
participant ACL as BXH访问权限控制合约 ACL
participant BXH as BXH策略合约
participant master as BXH管理员
rect rgba(0, 0, 255, .1)
Exploiter-&gt;&gt;Attacker: 2021-10-27 21:47:34 创建攻击合约
master-&gt;&gt;+ACL: 2021-10-29 16:19:00 给攻击合约提权
ACL--&gt;&gt;-Attacker: 攻击合约获得权限
%% Note over Exploiter,master: 省略:期间尝试七次攻击,均失败
end
Exploiter-&gt;&gt;AttackContract: 2021-10-30 11:15:45 创建攻击者收款合约
Exploiter-&gt;&gt;+Attacker: 2021-10-30 11:27:47 给攻击者收款合约提权
Attacker--&gt;&gt;+ACL: 访问权限控制合约0xf047601d函数，给攻击者收款合约尝试提权
ACL--&gt;&gt;-AttackContract: ACL内部调用收款合约的0x1f1fcd51。最后给攻击者收款合约添加INTERFACE_ROLE角色
deactivate Attacker
Exploiter-&gt;&gt;+Attacker:2021-10-30 11:32:53 第八次发起攻击
Attacker--&gt;&gt;+ACL: 调用ACL的0x8b6b802函数，此函数反编译失败。但猜测内部将资产从策略合约转移给攻击者
ACL--&gt;&gt;+BXH:请求资产转移
BXH--&gt;&gt;-AttackContract:资产转移至攻击者收款合约
deactivate ACL
AttackContract--&gt;&gt;Exploiter:ETH转移至攻击者
deactivate Attacker
</pre>
<p><strong>注:</strong> 攻击者在最后一次成功攻击前，有7次尝试更改逻辑代码的失败攻击。</p>
<h1 id="从攻击者角度去分析"><a class="header-anchor" href="#从攻击者角度去分析"> </a>从攻击者角度去分析</h1>
<ol>
<li>
<p><strong>2021-10-29 16:19:00</strong> 未知原因拥有BXH最高权限的管理员给Attacker开启<code>GOVERNANCE_ROLE</code>权限。</p>
<ul>
<li>此角色可能是添加删除策略的权限。</li>
<li>txid: <a target="_blank" rel="noopener" href="https://bscscan.com/tx/0x992c4b9e5cb5c42fbe35403e1e85034fa42beb5bebb3bfa930d1e6dca37742cf">0x992c4b9e5cb5c42fbe35403e1e85034fa42beb5bebb3bfa930d1e6dca37742cf</a></li>
</ul>
</li>
<li>
<p><strong>2021-10-30 11:27:47</strong> Exploiter给AttackContract添加<code>INTERFACE_ROLE</code>权限。</p>
<ul>
<li>猜测0x13b81fa9c0873a74c49a85bd8149c1c20bf9d18c伪装成策略合约并获得权限。</li>
<li>txid: <a target="_blank" rel="noopener" href="https://bscscan.com/tx/0x94c3dac0df93d13205f78509dc79363c3c79e4d50f4a5a2a3614ba11e457fa1d">0x94c3dac0df93d13205f78509dc79363c3c79e4d50f4a5a2a3614ba11e457fa1d</a></li>
</ul>
</li>
<li>
<p><strong>2021-10-30 11:32:53</strong> Exploiter通过<code>GOVERNANCE_ROLE</code>权限对ACL合约发起攻击成功获取资产。</p>
<ul>
<li>此处可能是调用了类似于策略调仓的逻辑，将BXH策略内的资产转移给AttackContract。</li>
<li>txid: <a target="_blank" rel="noopener" href="https://bscscan.com/tx/0x6466cad9ad300054f0d560db5619a299f67883ad51b6aeafad3061d09674ac84">0x6466cad9ad300054f0d560db5619a299f67883ad51b6aeafad3061d09674ac84</a></li>
</ul>
</li>
</ol>
<h1 id="ACL内部角色对应的bytes32的值"><a class="header-anchor" href="#ACL内部角色对应的bytes32的值"> </a>ACL内部角色对应的bytes32的值</h1>
<table>
<thead>
<tr>
<th>ACL内角色</th>
<th>bytes32</th>
</tr>
</thead>
<tbody>
<tr>
<td>keccak256(‘INTERFACE_ROLE’)</td>
<td>0x886f5b5d23a7f8b3645010a8eb98414557d4607145067846682ff187e4950fe3</td>
</tr>
<tr>
<td>keccak256(‘WITHDRAW_ROLE’)</td>
<td>0x5d8e12c39142ff96d79d04d15d1ba1269e4fe57bb9d26f43523628b34ba108ec</td>
</tr>
<tr>
<td>keccak256(‘GOVERNANCE_ROLE’)</td>
<td>0x71840dc4906352362b0cdaf79870196c8e42acafade72d5d5a6d59291253ceb1</td>
</tr>
</tbody>
</table>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/posts/4b1fd5af/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wanyvic.github.io/posts/a537129b/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ProfilePhoto.PNG">
      <meta itemprop="name" content="wanyvic">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wanyvicの博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/a537129b/" class="post-title-link" itemprop="url">filecoin的元数据证明和lurk</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-11-03 01:27:56" itemprop="dateCreated datePublished" datetime="2021-11-03T01:27:56+08:00">2021-11-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/" itemprop="url" rel="index"><span itemprop="name">区块链</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/posts/a537129b/#waline-comments" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" id="/posts/a537129b/" data-xid="/posts/a537129b/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>118</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Lurk-2"><a class="header-anchor" href="#Lurk-2"> </a>Lurk</h1>
<p>Lurk 是一种用于图灵完备递归 SNARK 的开发中的编程语言：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/lurk-lang/root">https://github.com/lurk-lang/root</a></li>
</ul>
<h1 id="资料"><a class="header-anchor" href="#资料"> </a>资料</h1>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=iQkedSqQH34">https://www.youtube.com/watch?v=iQkedSqQH34</a></p>
<h1 id="留坑待补充…"><a class="header-anchor" href="#留坑待补充…"> </a>留坑待补充…</h1>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2021 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wanyvic</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">113k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">1:43</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdn.jsdelivr.net/npm/pdfobject@2.2.7/pdfobject.min.js","integrity":"sha256-ph3Dk89VmuTVXG6x/RDzk53SU9LPdAh1tpv0UvnDZ2I="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@8.13.10/dist/mermaid.min.js","integrity":"sha256-CmZCFVnvol9YL23PfjDflGY5nJwE+Mf/JN+8v+tD/34="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>


  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha256-94CNZ/bJtwrBYZrXhCOBvpB4rZUzBnvAsirFv31TMGo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/copy-tex.min.css" integrity="sha256-+oItviPaTmqjDhk4y4fLLUIMgRQYDV/ZyrRNvQiebWM=" crossorigin="anonymous">
  <script class="next-config" data-name="katex" type="application/json">{"copy_tex_js":{"url":"https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/copy-tex.min.js","integrity":"sha256-etSqbSVF4+Lwe8MGk/Vanc1sR+mWv+qOG73fxWw9p94="}}</script>
  <script src="/js/third-party/math/katex.js"></script>


  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.2.0/dist/quicklink.umd.js" integrity="sha256-4kQf9z5ntdQrzsBC3YSHnEz02Z9C1UeW/E9OgnvlzSY=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://wanyvic.github.io/page/2/"}</script>
  <script src="/js/third-party/quicklink.js"></script>
<script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://waline-kappa-three.vercel.app","placeholder":"发表评论~","avatar":"wavatar","pageSize":10,"visitor":false,"comment_count":true,"requiredFields":["nick"],"meta":["nick","mail","link"],"libUrl":"https://cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js","emoji":["https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/weibo","https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/bilibili","https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/tw-emoji","https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/qq"],"el":"#waline-comments","path":"/page/2/"}</script>
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() => 
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => {
    new Waline(CONFIG.waline);
  });
});
</script><div class="moon-menu">
  <div class="moon-menu-items">
    
    <div id="moon-menu-item-back2bottom" class="moon-menu-item" onclick="back2bottom()">
      <i class='fa fa-chevron-down'></i>    </div>
    
    <div id="moon-menu-item-back2top" class="moon-menu-item" onclick="back2top()">
      <i class='fa fa-chevron-up'></i>    </div>
    
  </div>
  <div class="moon-menu-button">
    <svg class="moon-menu-bg">
      <circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle>
      <circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle>
    </svg>
    <div class="moon-menu-content">
      <div class="moon-menu-icon"><i class='fas fa-ellipsis-v'></i></div>
      <div class="moon-menu-text"></div>
    </div>
  </div>
</div><script src="/js/injector.js"></script>
</body>
</html>
