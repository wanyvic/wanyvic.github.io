<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Axie Infinity 分析 （一）</title>
    <url>/posts/1baceed3/</url>
    <content><![CDATA[<h1 id="介绍"><a class="header-anchor" href="#介绍"> </a>介绍</h1>
<p>Axie Infinity是一个卡片对战类型的gamefi游戏玩家可以通过PVE、PVP对战、获取SLP、购买NFT精灵、繁殖、升级等养成类游戏。<br>
部分代码开源：<br>
<a href="https://github.com/axieinfinity/public-smart-contracts">public-smart-contracts</a><br>
<a href="https://github.com/axieinfinity/ronin-smart-contracts">ronin-smart-contracts</a></p>
<h1 id="玩法分析"><a class="header-anchor" href="#玩法分析"> </a>玩法分析</h1>
<ol>
<li>用户通过跨链将资产转移到ronin chain。需购买或其他方式得到3个NFT小精灵，进行游戏对战。</li>
<li>用私钥对邮箱地址签名进行账号绑定。</li>
<li>玩家进入游戏可以进行PVE、PVP获得SLP。用户等待锁定期后通过链上claim获取SLP。SLP的释放速率受控于项目方。</li>
<li>NFT可以有性繁殖，中间消耗SLP和AXS。</li>
<li>NFT交易市场可以自由买卖、拍卖NFT。</li>
<li>玩家获取的SLP和AXS可以进行Defi挖矿（Lp挖矿和单币挖矿）。</li>
<li>对于PVP Rank topN，赛季后会释放奖金激励。</li>
</ol>
<h1 id="涉及的合约"><a class="header-anchor" href="#涉及的合约"> </a>涉及的合约</h1>
<h2 id="ronin侧"><a class="header-anchor" href="#ronin侧"> </a>ronin侧</h2>
<h3 id="Ronin-Gateway-Contract"><a class="header-anchor" href="#Ronin-Gateway-Contract"> </a>Ronin Gateway Contract</h3>
<p>Ronin和Ethereum的跨链桥</p>
<h4 id="合约地址"><a class="header-anchor" href="#合约地址"> </a>合约地址</h4>
<p><a href="https://explorer.roninchain.com/address/ronin:e35d62ebe18413d96ca2a2f7cf215bb21a406b4b">ronin:e35d62ebe18413d96ca2a2f7cf215bb21a406b4b</a></p>
<h4 id="作用"><a class="header-anchor" href="#作用"> </a>作用</h4>
<p>Ronin和Ethereum的跨链桥</p>
<h4 id="核心方法"><a class="header-anchor" href="#核心方法"> </a>核心方法</h4>
<table>
<thead>
<tr>
<th>functionId</th>
<th>调用权限</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>acknowledWithdrawalOnMainchain(uint256 _withdrawalId)</td>
<td>onlyValidator</td>
<td>需要多个validator对取款到ethereum的确认,如果阈值达到设置，则从pending中移除。</td>
</tr>
<tr>
<td>submitWithdrawalSignatures(uint256 _withdrawalId,bool _shouldReplace,bytes memory _sig)</td>
<td>onlyValidator</td>
<td>validator提供取款操作签名给ethereum，当ethereum收集足够的签名时可以被批准取出token</td>
</tr>
<tr>
<td>withdrawERC20(address _token, uint256 _amount)</td>
<td>user</td>
<td>用户调用取token到ethereum，创建withdrawEntry到pending</td>
</tr>
<tr>
<td>depositERCTokenFor(uint256 _depositId, address _owner, address _token, uint32 _standard, uint256 _tokenNumber)</td>
<td>onlyValidator</td>
<td>validator调用，当满足阈值时可以在ronin取出token</td>
</tr>
</tbody>
</table>
<h4 id="提款到MainChain"><a class="header-anchor" href="#提款到MainChain"> </a>提款到MainChain</h4>
<pre class="mermaid">
sequenceDiagram
participant Validitor
participant User
participant SideChain as SideChain Gateway
participant MainChain as MainChain Gateway

User-&gt;&gt;+SideChain:withdrawERC20 (transferFrom token)
Validitor-&gt;&gt;SideChain:N x acknowledWithdrawalOnMainchain
Validitor-&gt;&gt;SideChain:N x submitWithdrawalSignatures
SideChain--&gt;&gt;-User: N x Signatures
User-&gt;&gt;+MainChain:withdrawERC20 (with Signatures)
MainChain--&gt;&gt;-User:token transfer

</pre>
<h4 id="存款到SideChain"><a class="header-anchor" href="#存款到SideChain"> </a>存款到SideChain</h4>
<pre class="mermaid">
sequenceDiagram
participant Validitor
participant User
participant SideChain as SideChain Gateway
participant MainChain as MainChain Gateway

User-&gt;&gt;+MainChain:depositERC20
MainChain--&gt;&gt;-Validitor:emit TokenDeposited
Validitor-&gt;&gt;+SideChain:N x depositERCTokenFor
SideChain--&gt;&gt;-User:token transfer

</pre>
<p><strong>注：涉及weth取出存入与token操作相同此处不再赘述</strong><br>
<strong>注：涉及batch操作与原子操作类似此处不再赘述</strong></p>
<h3 id="Ronin-Registry-Contract"><a class="header-anchor" href="#Ronin-Registry-Contract"> </a>Ronin Registry Contract</h3>
<h4 id="合约地址-2"><a class="header-anchor" href="#合约地址-2"> </a>合约地址</h4>
<p><a href="https://explorer.roninchain.com/address/ronin:3a860626b0467809d50c58bef89b8ac6247fd62a">ronin:3a860626b0467809d50c58bef89b8ac6247fd62a</a></p>
<h4 id="作用-2"><a class="header-anchor" href="#作用-2"> </a>作用</h4>
<p>维护例如GATEWAY、WETH_TOKEN、VALIDATOR、ACKNOWLEDGEMENT合约名称到地址的注册合约。</p>
<h3 id="Ronin-Validator-Contract"><a class="header-anchor" href="#Ronin-Validator-Contract"> </a>Ronin Validator Contract</h3>
<h4 id="合约地址-3"><a class="header-anchor" href="#合约地址-3"> </a>合约地址</h4>
<p><a href="https://explorer.roninchain.com/address/ronin:0000000000000000000000000000000000000011">ronin:0000000000000000000000000000000000000011</a></p>
<h4 id="作用-3"><a class="header-anchor" href="#作用-3"> </a>作用</h4>
<p>validator白名单合约，用于添加、删除validator和更改阈值投票。维护Ronin的POA共识。</p>
<h3 id="Smooth-Love-Potion-Contract"><a class="header-anchor" href="#Smooth-Love-Potion-Contract"> </a>Smooth Love Potion Contract</h3>
<h4 id="合约地址-4"><a class="header-anchor" href="#合约地址-4"> </a>合约地址</h4>
<p><a href="https://explorer.roninchain.com/address/ronin:a8754b9fa15fc18bb59458815510e40a12cd2014">ronin:a8754b9fa15fc18bb59458815510e40a12cd2014</a></p>
<h4 id="作用-4"><a class="header-anchor" href="#作用-4"> </a>作用</h4>
<p>游戏内的ERC20：SLP，用户进行游戏后服务器发放给玩家的“经验”，用于其他玩法消耗。</p>
<h4 id="核心方法-2"><a class="header-anchor" href="#核心方法-2"> </a>核心方法</h4>
<p>除常规IERC20外，多了一个checkpoint方法用于“claim”。</p>
<table>
<thead>
<tr>
<th>function</th>
<th>调用权限</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>checkpoint(address _owner,uint256 _amount,uint256 _createdAt,bytes _signature)</td>
<td>user</td>
<td>用户取出slp时需要服务器给出相对应的签名</td>
</tr>
</tbody>
</table>
<h3 id="Axie-Infinity-Shard-Contract"><a class="header-anchor" href="#Axie-Infinity-Shard-Contract"> </a>Axie Infinity Shard Contract</h3>
<h4 id="合约地址-5"><a class="header-anchor" href="#合约地址-5"> </a>合约地址</h4>
<p><a href="https://explorer.roninchain.com/address/ronin:97a9107c1793bc407d6f527b77e7fff4d812bece">ronin:97a9107c1793bc407d6f527b77e7fff4d812bece</a></p>
<h4 id="作用-5"><a class="header-anchor" href="#作用-5"> </a>作用</h4>
<p>ERC20合约：axs</p>
<h3 id="Axie-Contract"><a class="header-anchor" href="#Axie-Contract"> </a>Axie Contract</h3>
<h4 id="合约地址-6"><a class="header-anchor" href="#合约地址-6"> </a>合约地址</h4>
<p><a href="https://explorer.roninchain.com/address/ronin:32950db2a7164ae833121501c797d79e7b79d74c">ronin:32950db2a7164ae833121501c797d79e7b79d74c</a></p>
<h4 id="作用-6"><a class="header-anchor" href="#作用-6"> </a>作用</h4>
<p>ERC721合约：axie。除了正常的IERC721以外，里面包含了一些管理员操作例如：growAxieggToAdult、batchMintAxieggs、mintAxie、和一些改变genes的设置。此部分代码未开源。</p>
<h3 id="Katana-Router-Contract"><a class="header-anchor" href="#Katana-Router-Contract"> </a>Katana Router Contract</h3>
<h4 id="合约地址-7"><a class="header-anchor" href="#合约地址-7"> </a>合约地址</h4>
<p><a href="https://explorer.roninchain.com/address/ronin:7d0556d55ca1a92708681e2e231733ebd922597d">ronin:7d0556d55ca1a92708681e2e231733ebd922597d</a></p>
<h4 id="Lp对"><a class="header-anchor" href="#Lp对"> </a>Lp对</h4>
<p>slp-weth lp <a href="https://explorer.roninchain.com/address/ronin:306a28279d04a47468ed83d55088d0dcd1369294">ronin:306a28279d04a47468ed83d55088d0dcd1369294</a><br>
axs-weth lp <a href="https://explorer.roninchain.com/address/ronin:c6344bc1604fcab1a5aad712d766796e2b7a70b9">ronin:c6344bc1604fcab1a5aad712d766796e2b7a70b9</a><br>
usdc-weth lp <a href="https://explorer.roninchain.com/address/ronin:a7964991f339668107e2b6a6f6b8e8b74aa9d017">ronin:a7964991f339668107e2b6a6f6b8e8b74aa9d017</a></p>
<h3 id="AXS-Staking-Pool-Contract"><a class="header-anchor" href="#AXS-Staking-Pool-Contract"> </a>AXS Staking Pool Contract</h3>
<h4 id="合约地址-8"><a class="header-anchor" href="#合约地址-8"> </a>合约地址</h4>
<p><a href="https://explorer.roninchain.com/address/ronin:05b0bb3c1c320b280501b86706c3551995bc8571">ronin:05b0bb3c1c320b280501b86706c3551995bc8571</a></p>
<h4 id="作用-7"><a class="header-anchor" href="#作用-7"> </a>作用</h4>
<p>质押axs挖矿（单币挖矿）</p>
<h4 id="核心方法-3"><a class="header-anchor" href="#核心方法-3"> </a>核心方法</h4>
<table>
<thead>
<tr>
<th>function</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>stake(uint256)</td>
<td>质押axs</td>
</tr>
<tr>
<td>restakeRewards()</td>
<td>复投</td>
</tr>
<tr>
<td>claimPendingRewards()</td>
<td>获取收益</td>
</tr>
<tr>
<td>unstake(uint256)</td>
<td>取出质押</td>
</tr>
</tbody>
</table>
<h3 id="Staking-Pool-Contracts"><a class="header-anchor" href="#Staking-Pool-Contracts"> </a>Staking Pool Contracts</h3>
<h4 id="合约地址-9"><a class="header-anchor" href="#合约地址-9"> </a>合约地址</h4>
<p>SLP-WETH LP Staking Pool <a href="https://explorer.roninchain.com/address/ronin:d4640c26c1a31cd632d8ae1a96fe5ac135d1eb52">ronin:d4640c26c1a31cd632d8ae1a96fe5ac135d1eb52</a><br>
AXS-WETH LP Staking Pool <a href="https://explorer.roninchain.com/address/ronin:487671acdea3745b6dac3ae8d1757b44a04bfe8a">ronin:487671acdea3745b6dac3ae8d1757b44a04bfe8a</a></p>
<h4 id="作用-8"><a class="header-anchor" href="#作用-8"> </a>作用</h4>
<p>质押LP挖矿。</p>
<h3 id="Marketplace-Contract"><a class="header-anchor" href="#Marketplace-Contract"> </a>Marketplace Contract</h3>
<p>NFT交易二级市场</p>
<h4 id="合约地址-10"><a class="header-anchor" href="#合约地址-10"> </a>合约地址</h4>
<p><a href="https://explorer.roninchain.com/address/ronin:213073989821f738a7ba3520c3d31a1f9ad31bbd">ronin:213073989821f738a7ba3520c3d31a1f9ad31bbd</a></p>
<h4 id="核心方法-4"><a class="header-anchor" href="#核心方法-4"> </a>核心方法</h4>
<table>
<thead>
<tr>
<th>function</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>settleAuction(address,address,uint256,uint256,uint256)</td>
<td>买NFT</td>
</tr>
<tr>
<td>createAuction(uint8[],address[],uint256[],uint256[],uint256[],address[],uint256[])</td>
<td>创建卖单</td>
</tr>
<tr>
<td>cancelAuction(uint256)</td>
<td>撤销卖单</td>
</tr>
<tr>
<td>revalidateRelatedAuctions(uint256)</td>
<td>未知，似乎是管理员的操作</td>
</tr>
</tbody>
</table>
<pre class="mermaid">
sequenceDiagram
participant Consumer
participant Seller
participant Marketplace

Seller-&gt;&gt;+Marketplace:createAuction 创建卖单
alt
    Seller-&gt;&gt;Marketplace:cancelAuction 撤单
else
    Consumer-&gt;&gt;Marketplace:settleAuction 购买
    Marketplace--&gt;&gt;-Consumer:transfer NFT
end
</pre>
<h2 id="Ethereum侧"><a class="header-anchor" href="#Ethereum侧"> </a>Ethereum侧</h2>
<p>Ethereum侧包含gateway、ERC20、ERC721合约与ronin侧大致相同。不同点在于Ethereum上的gateway使用了EIP712方式取款减少交互节约gas。</p>
]]></content>
      <categories>
        <category>区块链</category>
      </categories>
      <tags>
        <tag>eth</tag>
        <tag>区块链</tag>
        <tag>axie</tag>
        <tag>ronin</tag>
      </tags>
  </entry>
  <entry>
    <title>BXH被盗分析</title>
    <url>/posts/4b1fd5af/</url>
    <content><![CDATA[<h1 id="观前提示"><a class="header-anchor" href="#观前提示"> </a>观前提示</h1>
<p>以下时间均为北京时间</p>
<h1 id="参与者"><a class="header-anchor" href="#参与者"> </a>参与者</h1>
<table>
<thead>
<tr>
<th>角色</th>
<th>地址</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>攻击者 Exploiter</td>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">0x48c94305bddfd80c6f4076963866d968cac27d79</a></td>
<td>BXH攻击者外部账户</td>
</tr>
<tr>
<td>攻击合约 Attacker</td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">0x887716168FC8c1A2933F97ea3858a94c9E229201</a></td>
<td>BXH攻击者创建的攻击合约（通过此合约攻击BXH策略）创建于 <a href="https://bscscan.com/tx/0xf0a833371d843130601dca50553a203e2a07940ec531592cbd3c48003ace34bd">2021-10-27 21:47:34</a></td>
</tr>
<tr>
<td>攻击者收款合约</td>
<td><a href="https://bscscan.com/address/0x13b81fa9c0873a74c49a85bd8149c1c20bf9d18c">0x13b81fa9c0873a74c49a85bd8149c1c20bf9d18c</a></td>
<td>创建于 <a href="https://bscscan.com/tx/0x6119e86085440083b8e8b6f5435cbc6480df7fde541c8028d013dce7245720a5">2021-10-30 11:15:45</a></td>
</tr>
<tr>
<td>BXH策略地址</td>
<td><a href="https://bscscan.com/address/0x6AcECA12de5a15f11ca51b654433259533B0B802">0x6AcECA12de5a15f11ca51b654433259533B0B802</a></td>
<td>BXH策略资金地址</td>
</tr>
<tr>
<td>BXH管理员</td>
<td><a href="https://bscscan.com/address/0x56146b129017940d06d8e235c02285a3d05d6b7c">0x56146b129017940d06d8e235c02285a3d05d6b7c</a></td>
<td>总管理员</td>
</tr>
<tr>
<td>BXH访问权限控制合约</td>
<td><a href="https://bscscan.com/address/0x83dae57c46985c3a2346e8a3c6991ca908f8b06b">0x83dae57c46985c3a2346e8a3c6991ca908f8b06b</a></td>
<td>用于控制各个合约访问权限</td>
</tr>
</tbody>
</table>
<h1 id="攻击时序图"><a class="header-anchor" href="#攻击时序图"> </a>攻击时序图</h1>
<pre class="mermaid">
sequenceDiagram
participant Exploiter as 攻击者 Exploiter
participant Attacker as 攻击合约 Attacker
participant AttackContract as 攻击者收款合约 AttackContract
participant ACL as BXH访问权限控制合约 ACL
participant BXH as BXH策略合约
participant master as BXH管理员
rect rgba(0, 0, 255, .1)
Exploiter-&gt;&gt;Attacker: 2021-10-27 21:47:34 创建攻击合约
master-&gt;&gt;+ACL: 2021-10-29 16:19:00 给攻击合约提权
ACL--&gt;&gt;-Attacker: 攻击合约获得权限
%% Note over Exploiter,master: 省略:期间尝试七次攻击,均失败
end
Exploiter-&gt;&gt;AttackContract: 2021-10-30 11:15:45 创建攻击者收款合约
Exploiter-&gt;&gt;+Attacker: 2021-10-30 11:27:47 给攻击者收款合约提权
Attacker--&gt;&gt;+ACL: 访问权限控制合约0xf047601d函数，给攻击者收款合约尝试提权
ACL--&gt;&gt;-AttackContract: ACL内部调用收款合约的0x1f1fcd51。最后给攻击者收款合约添加INTERFACE_ROLE角色
deactivate Attacker
Exploiter-&gt;&gt;+Attacker:2021-10-30 11:32:53 第八次发起攻击
Attacker--&gt;&gt;+ACL: 调用ACL的0x8b6b802函数，此函数反编译失败。但猜测内部将资产从策略合约转移给攻击者
ACL--&gt;&gt;+BXH:请求资产转移
BXH--&gt;&gt;-AttackContract:资产转移至攻击者收款合约
deactivate ACL
AttackContract--&gt;&gt;Exploiter:ETH转移至攻击者
deactivate Attacker
</pre>
<p><strong>注:</strong> 攻击者在最后一次成功攻击前，有7次尝试更改逻辑代码的失败攻击。</p>
<h1 id="从攻击者角度去分析"><a class="header-anchor" href="#从攻击者角度去分析"> </a>从攻击者角度去分析</h1>
<ol>
<li>
<p><strong>2021-10-29 16:19:00</strong> 未知原因拥有BXH最高权限的管理员给Attacker开启<code>GOVERNANCE_ROLE</code>权限。</p>
<ul>
<li>此角色可能是添加删除策略的权限。</li>
<li>txid: <a href="https://bscscan.com/tx/0x992c4b9e5cb5c42fbe35403e1e85034fa42beb5bebb3bfa930d1e6dca37742cf">0x992c4b9e5cb5c42fbe35403e1e85034fa42beb5bebb3bfa930d1e6dca37742cf</a></li>
</ul>
</li>
<li>
<p><strong>2021-10-30 11:27:47</strong> Exploiter给AttackContract添加<code>INTERFACE_ROLE</code>权限。</p>
<ul>
<li>猜测0x13b81fa9c0873a74c49a85bd8149c1c20bf9d18c伪装成策略合约并获得权限。</li>
<li>txid: <a href="https://bscscan.com/tx/0x94c3dac0df93d13205f78509dc79363c3c79e4d50f4a5a2a3614ba11e457fa1d">0x94c3dac0df93d13205f78509dc79363c3c79e4d50f4a5a2a3614ba11e457fa1d</a></li>
</ul>
</li>
<li>
<p><strong>2021-10-30 11:32:53</strong> Exploiter通过<code>GOVERNANCE_ROLE</code>权限对ACL合约发起攻击成功获取资产。</p>
<ul>
<li>此处可能是调用了类似于策略调仓的逻辑，将BXH策略内的资产转移给AttackContract。</li>
<li>txid: <a href="https://bscscan.com/tx/0x6466cad9ad300054f0d560db5619a299f67883ad51b6aeafad3061d09674ac84">0x6466cad9ad300054f0d560db5619a299f67883ad51b6aeafad3061d09674ac84</a></li>
</ul>
</li>
</ol>
<h1 id="ACL内部角色对应的bytes32的值"><a class="header-anchor" href="#ACL内部角色对应的bytes32的值"> </a>ACL内部角色对应的bytes32的值</h1>
<table>
<thead>
<tr>
<th>ACL内角色</th>
<th>bytes32</th>
</tr>
</thead>
<tbody>
<tr>
<td>keccak256(‘INTERFACE_ROLE’)</td>
<td>0x886f5b5d23a7f8b3645010a8eb98414557d4607145067846682ff187e4950fe3</td>
</tr>
<tr>
<td>keccak256(‘WITHDRAW_ROLE’)</td>
<td>0x5d8e12c39142ff96d79d04d15d1ba1269e4fe57bb9d26f43523628b34ba108ec</td>
</tr>
<tr>
<td>keccak256(‘GOVERNANCE_ROLE’)</td>
<td>0x71840dc4906352362b0cdaf79870196c8e42acafade72d5d5a6d59291253ceb1</td>
</tr>
</tbody>
</table>
<span id="more"></span>
<h1 id="攻击者尝试的8次攻击"><a class="header-anchor" href="#攻击者尝试的8次攻击"> </a>攻击者尝试的8次攻击</h1>
<h2 id="第一次升级逻辑代码"><a class="header-anchor" href="#第一次升级逻辑代码"> </a>第一次升级逻辑代码</h2>
<table>
<thead>
<tr>
<th>调用者</th>
<th>触发者</th>
<th>时间</th>
<th>备注</th>
<th>参数</th>
<th>txid</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-27 21:47:34</td>
<td>攻击者创建攻击合约</td>
<td></td>
<td><a href="https://bscscan.com/tx/0x6119e86085440083b8e8b6f5435cbc6480df7fde541c8028d013dce7245720a5">查看</a></td>
</tr>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-29 15:58:53</td>
<td>给攻击合约第一次升级逻辑合约<a href="https://bscscan.com/address/0x2d4d4b79249e6f03cf0e8d672bfc32bdb07981df">0x2d4d4b79249e6f03cf0e8d672bfc32bdb07981df</a></td>
<td></td>
<td><a href="https://bscscan.com/tx/0x7e8c28a0af1e70a39b493f32da191d56836f6ce46b7f6fe83af1d066971fa459">查看</a></td>
</tr>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-29 22:26:36</td>
<td>尝试取款失败，参数填的是ETH合约地址</td>
<td>withdraw(<code>2170ed0880ac9a755fd29b2688956bd959f933f8</code>)</td>
<td><a href="https://bscscan.com/tx/0x831f1e2915305abd32eaa7399c17623f3f34fac956d71bedba41cb3469d95241">查看</a></td>
</tr>
</tbody>
</table>
<h2 id="第二次升级逻辑代码"><a class="header-anchor" href="#第二次升级逻辑代码"> </a>第二次升级逻辑代码</h2>
<table>
<thead>
<tr>
<th>调用者</th>
<th>触发者</th>
<th>时间</th>
<th>备注</th>
<th>参数</th>
<th>txid</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-30 03:45:16</td>
<td>给攻击合约第二次升级逻辑合约<a href="https://bscscan.com/address/0x9e47d35f352d322670e5c6def2174d1ae739b3ca">0x9e47d35f352d322670e5c6def2174d1ae739b3ca</a></td>
<td></td>
<td><a href="https://bscscan.com/tx/0x7467e536acae21b407bc2e0ca4e4522208dce94830eadd5a1a349517dc3632ae">查看</a></td>
</tr>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-30 03:51:19</td>
<td>尝试取款失败</td>
<td>withdraw()</td>
<td><a href="https://bscscan.com/tx/0x4c4c55bca50687487b12c1b2b2e5d9ec8900514d09639cd1a35174f4cb154404">查看</a></td>
</tr>
</tbody>
</table>
<h2 id="第三次升级逻辑代码"><a class="header-anchor" href="#第三次升级逻辑代码"> </a>第三次升级逻辑代码</h2>
<table>
<thead>
<tr>
<th>调用者</th>
<th>触发者</th>
<th>时间</th>
<th>备注</th>
<th>参数</th>
<th>txid</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-30 04:01:10</td>
<td>给攻击合约第三次升级逻辑合约<a href="https://bscscan.com/address/0x977171a577cf954663457af5a2bdc7b1a9951e3b">0x977171a577cf954663457af5a2bdc7b1a9951e3b</a></td>
<td></td>
<td><a href="https://bscscan.com/tx/0x332ccad03edf5dd679101595e7b6f1cd3afba6f9f225ed57fda832081448aca7e">查看</a></td>
</tr>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-30 04:04:35</td>
<td>尝试取款失败</td>
<td>withdraw()</td>
<td><a href="https://bscscan.com/tx/0x30f837e901e72af2541dd42b029f438ca0845dbc69f81c7e179665b0686be4e0">查看</a></td>
</tr>
</tbody>
</table>
<h2 id="第四次升级逻辑代码"><a class="header-anchor" href="#第四次升级逻辑代码"> </a>第四次升级逻辑代码</h2>
<table>
<thead>
<tr>
<th>调用者</th>
<th>触发者</th>
<th>时间</th>
<th>备注</th>
<th>参数</th>
<th>txid</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-30 04:23:39</td>
<td>给攻击合约第四次升级逻辑合约<a href="https://bscscan.com/address/0x477c53ac688f27b1d2460d85aa681eda9edefde3">0x477c53ac688f27b1d2460d85aa681eda9edefde3</a></td>
<td></td>
<td><a href="https://bscscan.com/tx/0x5d8df759d18226781ef1e139e3d1c59862ac9298e4c7a467412325025af6bc25">查看</a></td>
</tr>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-30 04:24:54</td>
<td>尝试取款失败</td>
<td>withdraw()</td>
<td><a href="https://bscscan.com/tx/0x4402968870e1e08d83eba0f79e7822720a8aa3e6fd36fbc5fe0120c6f3fa701c">查看</a></td>
</tr>
</tbody>
</table>
<h2 id="第五次升级逻辑代码"><a class="header-anchor" href="#第五次升级逻辑代码"> </a>第五次升级逻辑代码</h2>
<table>
<thead>
<tr>
<th>调用者</th>
<th>触发者</th>
<th>时间</th>
<th>备注</th>
<th>参数</th>
<th>txid</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-30 04:34:03</td>
<td>给攻击合约第五次升级逻辑合约<a href="https://bscscan.com/address/0xe18e97ea16b86f37e335ff1e6d6e96cf74b5f842">0xe18e97ea16b86f37e335ff1e6d6e96cf74b5f842</a></td>
<td></td>
<td><a href="https://bscscan.com/tx/0xa268fa121d91eeabc59c4935d0f835f22c7123e6b43c06a0789190658821e5dd">查看</a></td>
</tr>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-30 04:34:51</td>
<td>尝试取款失败</td>
<td>withdraw()</td>
<td><a href="https://bscscan.com/tx/0x33ba0953f98cc98dc0ef71113fa8f1512946db7df497877566669d86463b27c5">查看</a></td>
</tr>
</tbody>
</table>
<h2 id="第六次升级逻辑代码"><a class="header-anchor" href="#第六次升级逻辑代码"> </a>第六次升级逻辑代码</h2>
<table>
<thead>
<tr>
<th>调用者</th>
<th>触发者</th>
<th>时间</th>
<th>备注</th>
<th>参数</th>
<th>txid</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-30 05:14:09</td>
<td>给攻击合约第六次升级逻辑合约<a href="https://bscscan.com/address/0x114587850bbdd67f69517143106a9c3af7a9d61c">0x114587850bbdd67f69517143106a9c3af7a9d61c</a></td>
<td></td>
<td><a href="https://bscscan.com/tx/0x760ed9d86ec2846430cb2965c17a37c1908caac6848244f6b0f1233bbc585cf0">查看</a></td>
</tr>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-30 05:16:24</td>
<td>第一次尝试取款至<code>0x61e365f6031e3cc859911a75c467d3cf2d037e01</code>失败</td>
<td>withdraw1()</td>
<td><a href="https://bscscan.com/tx/0xbd0ee9292a47285f723f05d4b40f4f778d5a21e8c5a796719ab90c894173b486">查看</a></td>
</tr>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-30 09:19:00</td>
<td>第二次尝试取款至<code>0x61e365f6031e3cc859911a75c467d3cf2d037e01</code>失败</td>
<td>withdraw1()</td>
<td><a href="https://bscscan.com/tx/0x57ed3b940d236fd52a1031148fe7ad83c7d676de3466ce8847222678b93b219e">查看</a></td>
</tr>
</tbody>
</table>
<h2 id="第七次升级逻辑代码"><a class="header-anchor" href="#第七次升级逻辑代码"> </a>第七次升级逻辑代码</h2>
<table>
<thead>
<tr>
<th>调用者</th>
<th>触发者</th>
<th>时间</th>
<th>备注</th>
<th>参数</th>
<th>txid</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-30 09:36:12</td>
<td>给攻击合约第七次升级逻辑合约<a href="https://bscscan.com/address/0x22952a0eb4ebd12a1f2d6c318704420f22a2c3db">0x22952a0eb4ebd12a1f2d6c318704420f22a2c3db</a></td>
<td></td>
<td><a href="https://bscscan.com/tx/0x065447e1fe4a8d69e660af3570bf59340fdfd51eb1ecbed971472256dcc07cdb">查看</a></td>
</tr>
</tbody>
</table>
<h2 id="第八次升级逻辑代码"><a class="header-anchor" href="#第八次升级逻辑代码"> </a>第八次升级逻辑代码</h2>
<table>
<thead>
<tr>
<th>调用者</th>
<th>触发者</th>
<th>时间</th>
<th>备注</th>
<th>参数</th>
<th>txid</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-30 09:39:21</td>
<td>给攻击合约第八次升级逻辑合约<a href="https://bscscan.com/address/0x114587850bbdd67f69517143106a9c3af7a9d61c">0x114587850bbdd67f69517143106a9c3af7a9d61c</a></td>
<td></td>
<td><a href="https://bscscan.com/tx/0x38327b97955cd7f7151b6b4309888a38eb20cd27aada8d23364d6fa3fa350def">查看</a></td>
</tr>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-30 09:41:09</td>
<td>第一次取款至<code>0x22952a0eb4ebd12a1f2d6c318704420f22a2c3db</code>失败</td>
<td>withdraw1()</td>
<td><a href="https://bscscan.com/tx/0x39559c0e38dd4230e330ed585cb5761bf84bedfc76de575db04f40ff7355d564">查看</a></td>
</tr>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-30 09:54:53</td>
<td>第二次取款至<code>0x22952a0eb4ebd12a1f2d6c318704420f22a2c3db</code>失败</td>
<td>withdraw1()</td>
<td><a href="https://bscscan.com/tx/0xf0434705664ae4a55b29a3666ae2673bc9a8852f43070c502ebcca7521d3d043">查看</a></td>
</tr>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-30 10:56:37</td>
<td>第三次取款至<code>0x91ecadeab1a43ed918309175bcc877ea456378c0</code>失败</td>
<td>withdraw2()</td>
<td><a href="https://bscscan.com/tx/0xa4ce16f4ddcbb7eab09d8b9e4d943edcf3f714579174c739aab94a33a54e0fed">查看</a></td>
</tr>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-30 11:07:00</td>
<td>第四次尝试，此次操作成功给<code>0x22</code>地址提权，但未能成功取出存款</td>
<td>withdraw1(<code>0x22952a0eb4ebd12a1f2d6c318704420f22a2c3db</code>)</td>
<td><a href="https://bscscan.com/tx/0xa50946e61a76a91ba0c4a9147c31a63f3285bebe5e935141833c04df27834085">查看</a></td>
</tr>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-30 11:18:21</td>
<td>第五次取款至<code>0x13b81fa9c0873a74c49a85bd8149c1c20bf9d18c</code>未能成功</td>
<td>withdraw1()</td>
<td><a href="https://bscscan.com/tx/0x3bd6823d3304dd046aadc26c70f5c42f8c0ce84e1991346d1a5a0521848e118a">查看</a></td>
</tr>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-30 11:19:45</td>
<td>第六次取款至<code>0x13b81fa9c0873a74c49a85bd8149c1c20bf9d18c</code>未能成功</td>
<td>withdraw2()</td>
<td><a href="https://bscscan.com/tx/0x843121bb60581a4f50143a34e752ce8acfbc4304a67f26b3e9bc895ffdea842f">查看</a></td>
</tr>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-30 11:27:47</td>
<td>第七次尝试，此次操作成功给<code>0x13b81</code>地址提权，但未能成功取出存款</td>
<td>withdraw1(<code>0x13b81fa9c0873a74c49a85bd8149c1c20bf9d18c</code>)</td>
<td><a href="https://bscscan.com/tx/0x94c3dac0df93d13205f78509dc79363c3c79e4d50f4a5a2a3614ba11e457fa1d">查看</a></td>
</tr>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-30 11:29:17</td>
<td>第八次取款至<code>0x13b81fa9c0873a74c49a85bd8149c1c20bf9d18c</code>未能成功</td>
<td>withdraw2(<code>0x13b81fa9c0873a74c49a85bd8149c1c20bf9d18c</code>)</td>
<td><a href="https://bscscan.com/tx/0x6696cfbe7bf491f24abeae5a9d5fc2e20d65a1bfb2cd072404c554a3e18879a8">查看</a></td>
</tr>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-30 11:32:53</td>
<td>第九次取款至<code>0x13b81fa9c0873a74c49a85bd8149c1c20bf9d18c</code>成功，大量资产被转移</td>
<td>withdraw2(<code>0x13b81fa9c0873a74c49a85bd8149c1c20bf9d18c</code>)</td>
<td><a href="https://bscscan.com/tx/0x6466cad9ad300054f0d560db5619a299f67883ad51b6aeafad3061d09674ac84">查看</a></td>
</tr>
<tr>
<td><a href="https://bscscan.com/address/0x48c94305bddfd80c6f4076963866d968cac27d79">Exploiter</a></td>
<td><a href="https://bscscan.com/address/0x887716168FC8c1A2933F97ea3858a94c9E229201">Attacker</a></td>
<td>2021-10-30 11:36:11</td>
<td>第十次取款至<code>0x13b81fa9c0873a74c49a85bd8149c1c20bf9d18c</code>成功，但是已无剩余资产</td>
<td>withdraw2(<code>0x13b81fa9c0873a74c49a85bd8149c1c20bf9d18c</code>)</td>
<td><a href="https://bscscan.com/tx/0xf27301bf6c824c5dc11eb751e0992a7dfeadf01dcc5350ae86a713d4cf9590f3">查看</a></td>
</tr>
</tbody>
</table>
]]></content>
      <categories>
        <category>区块链</category>
      </categories>
      <tags>
        <tag>区块链</tag>
        <tag>智能合约</tag>
        <tag>BXH</tag>
      </tags>
  </entry>
  <entry>
    <title>Cario 笔记 一</title>
    <url>/posts/fe727175/</url>
    <content><![CDATA[<h1 id="安装"><a class="header-anchor" href="#安装"> </a>安装</h1>
<p><strong>依赖：ubuntu、python3.7+</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> -y libgmp3-dev python3-dev
python3 -m venv ~/cairo_venv
<span class="token builtin class-name">source</span> ~/cairo_venv/bin/activate<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>确保 venv 已激活 - 您应该(cairo_venv)在命令行提示符中看到。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip3 <span class="token function">install</span> ecdsa fastecdsa sympy cairo-lang<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="编译和运行-Cairo-程序"><a class="header-anchor" href="#编译和运行-Cairo-程序"> </a>编译和运行 Cairo 程序</h1>
<h2 id="创建一个名为test-cairo的文件"><a class="header-anchor" href="#创建一个名为test-cairo的文件"> </a>创建一个名为<code>test.cairo</code>的文件</h2>
<p>其中包含以下几行：</p>
<pre class="line-numbers language-none"><code class="language-none">func main():
    [ap] &#x3D; 1000; ap++
    [ap] &#x3D; 2000; ap++
    [ap] &#x3D; [ap - 2] + [ap - 1]; ap++
    ret
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="编译"><a class="header-anchor" href="#编译"> </a>编译</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cairo-compile test.cairo --output test_compiled.json<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="运行"><a class="header-anchor" href="#运行"> </a>运行</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cairo-run <span class="token punctuation">\</span>
  --program<span class="token operator">=</span>test_compiled.json --print_output <span class="token punctuation">\</span>
  --print_info --relocate_prints<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="调试"><a class="header-anchor" href="#调试"> </a>调试</h2>
<p>您可以通过提供–tracer标志来打开开罗跟踪器cairo-run。然后在 <a href="http://localhost:8100/">http://localhost:8100/</a> 打开它。</p>
<h1 id="编写第一份合约"><a class="header-anchor" href="#编写第一份合约"> </a>编写第一份合约</h1>
<p>StarkNet 是一个无需许可的去中心化 ZK-Rollup，作为以太坊上的 L2 网络运行，任何 dApp 都可以在其中实现无限规模的计算，而不会影响以太坊的可组合性和安全性。</p>
<p><strong>主网上的 StarkNet Alpha</strong><br>
StarkNet 核心合约：<a href="https://etherscan.io/address/0xc662c410C0ECf747543f5bA90660f6ABeBD9C8c4">0xc662c410C0ECf747543f5bA90660f6ABeBD9C8c4</a></p>
<p>定序器网址：<a href="https://alpha-mainnet.starknet.io">https://alpha-mainnet.starknet.io</a></p>
<p>代码参考：<a href="https://github.com/xJonathanLEI/starknet-l1-contracts">https://github.com/xJonathanLEI/starknet-l1-contracts</a></p>
<p><strong>Goerli 上的 StarkNet Alpha 版本 4</strong><br>
StarkNet 核心合约：<a href="https://etherscan.io/address/0xde29d060D45901Fb19ED6C6e959EB22d8626708e">0xde29d060D45901Fb19ED6C6e959EB22d8626708e</a></p>
<p>音序器网址：<a href="https://alpha4.starknet.io">https://alpha4.starknet.io</a></p>
<h2 id="让我们从下面的-StarkNet-合约开始："><a class="header-anchor" href="#让我们从下面的-StarkNet-合约开始："> </a>让我们从下面的 StarkNet 合约开始：</h2>
<h3 id="创建一个名为的文件并将contract-cairo合约代码复制到其中。"><a class="header-anchor" href="#创建一个名为的文件并将contract-cairo合约代码复制到其中。"> </a>创建一个名为的文件并将<code>contract.cairo</code>合约代码复制到其中。</h3>
<pre class="line-numbers language-none"><code class="language-none"># Declare this file as a StarkNet contract and set the required
# builtins.
%lang starknet
%builtins pedersen range_check

from starkware.cairo.common.cairo_builtins import HashBuiltin

# Define a storage variable.
@storage_var
func balance() -&gt; (res : felt):
end

# Increases the balance by the given amount.
@external
func increase_balance&#123;
        syscall_ptr : felt*, pedersen_ptr : HashBuiltin*,
        range_check_ptr&#125;(amount : felt):
    let (res) &#x3D; balance.read()
    balance.write(res + amount)
    return ()
end

# Returns the current balance.
@view
func get_balance&#123;
        syscall_ptr : felt*, pedersen_ptr : HashBuiltin*,
        range_check_ptr&#125;() -&gt; (res : felt):
    let (res) &#x3D; balance.read()
    return (res)
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>%lang starknet</code>是声明使用的编译器。因此使用<code>cairo-compile</code>将编译失败。应使用<code>starknet-compile</code>代替。</p>
<h3 id="编译-2"><a class="header-anchor" href="#编译-2"> </a>编译</h3>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">starknet-compile contract.cairo <span class="token punctuation">\</span>
    --output contract_compiled.json <span class="token punctuation">\</span>
    --abi contract_abi.json<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>生成了abi和编译后的json。<br>
abi里显示有<code>increase_balance</code>和<code>get_balance</code>两个接口。</p>
<h3 id="在-StarkNet-测试网上部署合约"><a class="header-anchor" href="#在-StarkNet-测试网上部署合约"> </a>在 StarkNet 测试网上部署合约</h3>
<p>您应该<code>--network=alpha-goerli</code>在每次使用时传递，或者<code>STARKNET_NETWORK</code>按如下方式设置环境变量：(下文均使用了此环境变量)</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">STARKNET_NETWORK</span><span class="token operator">=</span>alpha-goerli<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>部署</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">starknet deploy --contract contract_compiled.json<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>得到以下结果：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Deploy transaction was sent.
Contract address: 0x03d2c69f4b89395b062da026c9fabb396b21883f7eb9c2b5cde4fcbcd8120c3f
Transaction hash: 0x7638d01c1736f6329b13cdfcf298e45e0e1cfd460d1e701a040f3cda3233275<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><code>Contract address</code>: 部署的合约地址<br>
<code>Transaction hash</code>: 交易hash</p>
<h3 id="与合约交互"><a class="header-anchor" href="#与合约交互"> </a>与合约交互</h3>
<p>运行以下命令来调用该<code>increase_balance()</code>函数。<code>--address</code>填对应上文部署的合约地址。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">starknet invoke <span class="token punctuation">\</span>
    --address 0x03d2c69f4b89395b062da026c9fabb396b21883f7eb9c2b5cde4fcbcd8120c3f <span class="token punctuation">\</span>
    --abi contract_abi.json <span class="token punctuation">\</span>
    --function increase_balance <span class="token punctuation">\</span>
    --inputs <span class="token number">1234</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果应如下所示：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Invoke transaction was sent.
Contract address: 0x03d2c69f4b89395b062da026c9fabb396b21883f7eb9c2b5cde4fcbcd8120c3f
Transaction hash: 0x159b6df5a1a375c2e08244b0276678ceb4abbb9e18546592ae7865362c85441<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="查询状态"><a class="header-anchor" href="#查询状态"> </a>查询状态</h4>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">starknet tx_status --hash 0x159b6df5a1a375c2e08244b0276678ceb4abbb9e18546592ae7865362c85441<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>状态可能会经过<code>PENDING</code>最终到达<code>ACCEPTED</code>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">&#123;</span>
    <span class="token string">"block_hash"</span><span class="token builtin class-name">:</span> <span class="token string">"0x34cb1372fa583d5d08eaeba9ba6a9b8fa791df2184b143307b07a08b952db9a"</span>,
    <span class="token string">"tx_status"</span><span class="token builtin class-name">:</span> <span class="token string">"ACCEPTED_ON_L2"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>可能的状态是：</p>
<ul>
<li><code>NOT_RECEIVED</code>：尚未收到交易（即未写入存储）。</li>
<li><code>RECEIVED</code>：事务已被定序器接收。</li>
<li><code>PENDING</code>：交易通过验证，进入待处理区块。</li>
<li><code>REJECTED</code>：交易验证失败，因此被跳过。</li>
<li><code>ACCEPTED_ON_L2</code>：交易通过验证并进入实际创建的区块。</li>
<li><code>ACCEPTED_ON_L1</code>：交易在链上被接受。</li>
</ul>
<h4 id="查询余额"><a class="header-anchor" href="#查询余额"> </a>查询余额</h4>
<p>使用以下命令查询当前余额：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">starknet call <span class="token punctuation">\</span>
    --address 0x03d2c69f4b89395b062da026c9fabb396b21883f7eb9c2b5cde4fcbcd8120c3f <span class="token punctuation">\</span>
    --abi contract_abi.json <span class="token punctuation">\</span>
    --function get_balance<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果应该是：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1234</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>请注意，要查看最新余额，您应该等到increase_balance 交易状态至少为ACCEPTED_ON_L2（即ACCEPTED_ON_L2或ACCEPTED_ON_L1）。否则，您将看到increase_balance交易执行前的余额（即 0）。</p>
<h4 id="获取交易"><a class="header-anchor" href="#获取交易"> </a>获取交易</h4>
<pre class="line-numbers language-none"><code class="language-none">starknet get_transaction --hash 0x159b6df5a1a375c2e08244b0276678ceb4abbb9e18546592ae7865362c85441<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">starknet get_transaction_receipt --hash 0x159b6df5a1a375c2e08244b0276678ceb4abbb9e18546592ae7865362c85441<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="获取代码"><a class="header-anchor" href="#获取代码"> </a>获取代码</h4>
<pre class="line-numbers language-none"><code class="language-none">starknet get_code --contract_address 0x03d2c69f4b89395b062da026c9fabb396b21883f7eb9c2b5cde4fcbcd8120c3f<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="获取块"><a class="header-anchor" href="#获取块"> </a>获取块</h4>
<pre class="line-numbers language-none"><code class="language-none">starknet get_block --number 41301<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="通过key来查询state存储的值"><a class="header-anchor" href="#通过key来查询state存储的值"> </a>通过key来查询state存储的值</h4>
<p>编写以下python代码查询key值。<br>
此处对应<code>@storage_var</code>的<code>balance</code>。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> starkware<span class="token punctuation">.</span>starknet<span class="token punctuation">.</span>public<span class="token punctuation">.</span>abi <span class="token keyword">import</span> get_storage_var_address

balance_key <span class="token operator">=</span> get_storage_var_address<span class="token punctuation">(</span><span class="token string">'balance'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Balance key: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>balance_key<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>你应该得到：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Balance key: <span class="token number">916907772491729262376534102982219947830828984996257231353398618781993312401</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>现在，您可以使用以下方法查询余额：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">starknet get_storage_at <span class="token punctuation">\</span>
    --contract_address 0x03d2c69f4b89395b062da026c9fabb396b21883f7eb9c2b5cde4fcbcd8120c3f <span class="token punctuation">\</span>
    --key <span class="token number">916907772491729262376534102982219947830828984996257231353398618781993312401</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>使用我们目前使用的同一个合约，你应该得到：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">0x4d2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>请注意，这与调用<code>get_balance</code>获得的结果相同。</p>
<p>也可以添加–block_hash指定特定块高查询的结果。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">starknet get_storage_at <span class="token punctuation">\</span>
    --contract_address 0x03d2c69f4b89395b062da026c9fabb396b21883f7eb9c2b5cde4fcbcd8120c3f <span class="token punctuation">\</span>
    --key <span class="token number">916907772491729262376534102982219947830828984996257231353398618781993312401</span> <span class="token punctuation">\</span>
    --block_hash 0x109decabe47793bead0be4ba2f06835e1b4ede7575cb60b6bd7d29762b3d34e<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">0x0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="修改合约使每个人有独立的balance"><a class="header-anchor" href="#修改合约使每个人有独立的balance"> </a>修改合约使每个人有独立的<code>balance</code></h3>
<h4 id="存储映射"><a class="header-anchor" href="#存储映射"> </a>存储映射</h4>
<p>使用kvmap存数据</p>
<pre class="line-numbers language-none"><code class="language-none"># A map from user (public key) to a balance.
@storage_var
func balance(user : felt) -&gt; (res : felt):
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="验证签名"><a class="header-anchor" href="#验证签名"> </a>验证签名</h4>
<p>我们现在必须修改<code>increase_balance</code>以执行以下操作：</p>
<ul>
<li>不同用户写入相应的balance条目。</li>
<li>验证用户是否对此次更改操作签名（ACL）。</li>
</ul>
<p>我们将需要ecdsa内置程序来验证签名，因此我们将%builtins 行更改为：</p>
<pre class="line-numbers language-none"><code class="language-none">%builtins pedersen range_check ecdsa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>并添加以下导入语句：</p>
<pre class="line-numbers language-none"><code class="language-none">from starkware.cairo.common.cairo_builtins import (
    HashBuiltin, SignatureBuiltin)
from starkware.cairo.common.hash import hash2
from starkware.cairo.common.signature import (
    verify_ecdsa_signature)
from starkware.starknet.common.syscalls import get_tx_signature<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>接下来，我们将代码更改<code>increase_balance()</code>为：</p>
<p>Increases the balance of the given user by the given amount.</p>
<pre class="line-numbers language-none"><code class="language-none">@external
func increase_balance&#123;
        syscall_ptr : felt*, pedersen_ptr : HashBuiltin*,
        range_check_ptr, ecdsa_ptr : SignatureBuiltin*&#125;(
        user : felt, amount : felt):
    # Fetch the signature.
    let (sig_len : felt, sig : felt*) &#x3D; get_tx_signature()

    # Verify the signature length.
    assert sig_len &#x3D; 2

    # Compute the hash of the message.
    # The hash of (x, 0) is equivalent to the hash of (x).
    let (amount_hash) &#x3D; hash2&#123;hash_ptr&#x3D;pedersen_ptr&#125;(amount, 0)

    # Verify the user&#39;s signature.
    verify_ecdsa_signature(
        message&#x3D;amount_hash,
        public_key&#x3D;user,
        signature_r&#x3D;sig[0],
        signature_s&#x3D;sig[1])

    let (res) &#x3D; balance.read(user&#x3D;user)
    balance.write(user, res + amount)
    return ()
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>verify_ecdsa_signature</code>行为类似于断言——如果签名无效，该函数将恢复整个交易。</p>
<p><strong>请注意，我们在这里没有设置重放保护——一旦用户签署交易，有人可能会多次调用它。防止重放攻击的一种方法是向<code>increase_balance</code>中添加一个<code>nonce</code>参数，将签名消息更改为随机数和数量的Pedersen哈希，并定义另一个从签名消息到标志（0 或 1）的存储映射，指示是否交易由系统执行。StarkNet的未来版本将处理用户身份验证并防止重放攻击。</strong></p>
<p>同样，更改<code>get_balance()</code>. 这里我们不需要验证签名（因为 StarkNet 的存储无论如何都不是私有的），所以更改更简单：</p>
<h4 id="更改get-balance"><a class="header-anchor" href="#更改get-balance"> </a>更改<code>get_balance()</code></h4>
<pre class="line-numbers language-none"><code class="language-none">@view
func get_balance&#123;
        syscall_ptr : felt*, pedersen_ptr : HashBuiltin*,
        range_check_ptr&#125;(user : felt) -&gt; (res : felt):
    let (res) &#x3D; balance.read(user&#x3D;user)
    return (res)
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="编译和部署"><a class="header-anchor" href="#编译和部署"> </a>编译和部署</h4>
<p>将新合同文件另存为<code>user_auth.cairo</code></p>
<pre class="line-numbers language-none"><code class="language-none">starknet-compile user_auth.cairo \
    --output user_auth_compiled.json \
    --abi user_auth_abi.json

starknet deploy --contract user_auth_compiled.json<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>得到：</p>
<pre class="line-numbers language-none"><code class="language-none">Deploy transaction was sent.
Contract address: 0x00a22e04b15bac3e899d500ed13ef411ac7b8ceab2711a286abcc1c332f1562a
Transaction hash: 0x6f6d8f253dfaef85398cac92bbd784f43c5f349908cd63cc24f8bcc6056b8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="与合约交互-2"><a class="header-anchor" href="#与合约交互-2"> </a>与合约交互</h4>
<p>需要一对公私钥进行签名，使用python生成：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> starkware<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>signature<span class="token punctuation">.</span>signature <span class="token keyword">import</span> <span class="token punctuation">(</span>
    pedersen_hash<span class="token punctuation">,</span> private_to_stark_key<span class="token punctuation">,</span> sign<span class="token punctuation">)</span>
private_key <span class="token operator">=</span> <span class="token number">123456</span> <span class="token comment">#实际中私钥应该尽量复杂</span>
message_hash <span class="token operator">=</span> pedersen_hash<span class="token punctuation">(</span><span class="token number">4321</span><span class="token punctuation">)</span> <span class="token comment"># 4321是调用传入的amount</span>
public_key <span class="token operator">=</span> private_to_stark_key<span class="token punctuation">(</span>private_key<span class="token punctuation">)</span>
signature <span class="token operator">=</span> sign<span class="token punctuation">(</span>
    msg_hash<span class="token operator">=</span>message_hash<span class="token punctuation">,</span> priv_key<span class="token operator">=</span>private_key<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Public key: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>public_key<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Signature: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>signature<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>得到：</p>
<pre class="line-numbers language-none"><code class="language-none">Public key: 3512654880572580671014088124487384125967296770469815068887364768195237224797
Signature: (108302296121512525602232466769839751031019513985679519327892998945991838582, 2367704193695023621669265858663986904236455946141267548614905838978060564822)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h5 id="更新余额"><a class="header-anchor" href="#更新余额"> </a>更新余额</h5>
<pre class="line-numbers language-none"><code class="language-none">starknet invoke \
    --address 0x00a22e04b15bac3e899d500ed13ef411ac7b8ceab2711a286abcc1c332f1562a \
    --abi user_auth_abi.json \
    --function increase_balance \
    --inputs \
        3512654880572580671014088124487384125967296770469815068887364768195237224797 \
        4321 \
    --signature \
        108302296121512525602232466769839751031019513985679519327892998945991838582 \
        2367704193695023621669265858663986904236455946141267548614905838978060564822<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>得到:</p>
<pre class="line-numbers language-none"><code class="language-none">Invoke transaction was sent.
Contract address: 0x00a22e04b15bac3e899d500ed13ef411ac7b8ceab2711a286abcc1c332f1562a
Transaction hash: 0x2fe59707d58ce8cd3ac10372979a80453a0ab78dbe00646738ffa55137f5ece<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h5 id="查询状态和结果"><a class="header-anchor" href="#查询状态和结果"> </a>查询状态和结果</h5>
<pre class="line-numbers language-none"><code class="language-none">starknet tx_status --hash 0x2fe59707d58ce8cd3ac10372979a80453a0ab78dbe00646738ffa55137f5ece<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">starknet call \                                                   
    --address 0x00a22e04b15bac3e899d500ed13ef411ac7b8ceab2711a286abcc1c332f1562a \
    --abi user_auth_abi.json \
    --function get_balance \
    --inputs 3512654880572580671014088124487384125967296770469815068887364768195237224797<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>最终<code>tx_status</code>改为<code>ACCEPTED</code>，<code>get_balance</code>改为4321</p>
<p>通过<code>get_storage_var_address</code>需要传入用户的pubkey</p>
<pre class="line-numbers language-none"><code class="language-none">from starkware.starknet.public.abi import get_storage_var_address

user &#x3D; 3512654880572580671014088124487384125967296770469815068887364768195237224797
user_balance_key &#x3D; get_storage_var_address(&#39;balance&#39;, user)
print(f&#39;Storage key for user &#123;user&#125;:\n&#123;user_balance_key&#125;&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="如果使用无效签名"><a class="header-anchor" href="#如果使用无效签名"> </a>如果使用无效签名</h5>
<p><code>tx_status</code>将会<code>REJECTED</code>，<br>
使用<code>--contract</code>和<code>--error_message</code>回溯错误</p>
<pre class="line-numbers language-none"><code class="language-none">starknet tx_status \
    --hash TX_HASH \
    --contract user_auth_compiled.json \
    --error_message<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="构造函数"><a class="header-anchor" href="#构造函数"> </a>构造函数</h3>
<p>使用<code>@constructor</code> 声明</p>
<pre class="line-numbers language-none"><code class="language-none">@constructor
func constructor&#123;
        syscall_ptr : felt*, pedersen_ptr : HashBuiltin*,
        range_check_ptr&#125;(owner_address : felt):
    owner.write(value&#x3D;owner_address)
    return ()
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在deploy时加<code>--inputs</code></p>
<pre class="line-numbers language-none"><code class="language-none">starknet-compile ownable.cairo \
    --output ownable_compiled.json \
    --abi ownable_abi.json
starknet deploy --contract ownable_compiled.json --inputs 123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="更多功能"><a class="header-anchor" href="#更多功能"> </a>更多功能</h3>
<ol>
<li>多个值的存储变量</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none"># A mapping from user to a pair (min, max).
@storage_var
func range(user : felt) -&gt; (res : (felt, felt)):
end

# 读取和写入
@external
func extend_range&#123;
        syscall_ptr : felt*, pedersen_ptr : HashBuiltin*,
        range_check_ptr&#125;(user : felt):
    let (min_max) &#x3D; range.read(user)
    range.write(user, (min_max[0] - 1, min_max[1] + 1))
    return ()
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li>结构参数的存储变量</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none"># 存储变量的参数也可以是结构体或元组，只要它们不包含指针
struct User:
    member first_name : felt
    member last_name : felt
end

# A mapping from a user to 1 if they voted and 0 otherwise.
@storage_var
func user_voted(user : User) -&gt; (res : felt):
end

@external
func vote&#123;
        syscall_ptr : felt*, pedersen_ptr : HashBuiltin*,
        range_check_ptr&#125;(user : User):
    user_voted.write(user, 1)
    return ()
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="3">
<li>外部函数使用数组作为参数</li>
</ol>
<p>在外部函数中使用数组参数的StarkNet合约必须内置<code>range_check</code>，用于验证数组的长度是否为非负。</p>
<pre class="line-numbers language-none"><code class="language-none">@external
func compare_arrays(
        a_len : felt, a : felt*, b_len : felt, b : felt*):
    assert a_len &#x3D; b_len
    if a_len &#x3D;&#x3D; 0:
        return ()
    end
    assert a[0] &#x3D; b[0]
    return compare_arrays(
        a_len&#x3D;a_len - 1, a&#x3D;a + 1, b_len&#x3D;b_len - 1, b&#x3D;b + 1)
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="4">
<li>传入参数包含数组长度和元素</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">starknet invoke \
    --address CONTRACT_ADDRESS \
    --abi contract_abi.json \
    --function compare_arrays \
    --inputs 4 10 20 30 40 2 50 60<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="5">
<li>在 calldata 中传递元组和结构<br>
Calldata 参数和返回值可以是不包含指针的任何类型。例如，带有毛毡成员的结构、毛毡元组和毛毡元组元组。例如：</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">struct Point:
    member x : felt
    member y : felt
end

@view
func sum_points(points : (Point, Point)) -&gt; (res : Point):
    return (
        res&#x3D;Point(
        x&#x3D;points[0].x + points[1].x,
        y&#x3D;points[0].y + points[1].y))
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>为了sum_points使用点调用，您应该将以下输入传递给：(1, 2), (10, 20)starknet call</p>
<pre class="line-numbers language-none"><code class="language-none">starknet call \
    --address CONTRACT_ADDRESS \
    --abi contract_abi.json \
    --function sum_points \
    --inputs 1 2 10 20<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="合约相互调用"><a class="header-anchor" href="#合约相互调用"> </a>合约相互调用</h3>
<p>编写合约<code>test_proxy.cario</code>调用之前部署的合约：</p>
<pre class="line-numbers language-none"><code class="language-none">%lang starknet
%builtins pedersen range_check

from starkware.cairo.common.cairo_builtins import HashBuiltin

@contract_interface
namespace IBalanceContract:
    func increase_balance(amount : felt):
    end

    func get_balance() -&gt; (res : felt):
    end
end

@external
func call_increase_balance&#123;syscall_ptr : felt*, range_check_ptr&#125;(
        contract_address : felt, amount : felt):
    IBalanceContract.increase_balance(
        contract_address&#x3D;contract_address, amount&#x3D;amount)
    return ()
end

@view
func call_get_balance&#123;syscall_ptr : felt*, range_check_ptr&#125;(
        contract_address : felt) -&gt; (res : felt):
    let (res) &#x3D; IBalanceContract.get_balance(
        contract_address&#x3D;contract_address)
    return (res&#x3D;res)
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="编译部署"><a class="header-anchor" href="#编译部署"> </a>编译部署</h4>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 编译</span>
starknet-compile test_proxy.cairo <span class="token punctuation">\</span>
    --output test_proxy_compiled.json <span class="token punctuation">\</span>
    --abi test_proxy_abi.json

<span class="token comment"># 部署</span>
starknet deploy --contract test_proxy_compiled.json 

<span class="token comment"># 合约地址及hash</span>
Deploy transaction was sent.
Contract address: 0x02a828cb2ee25629d597625df71ac41779fc9166624654ec52bcc51e77ae75a6
Transaction hash: 0x63e09a708a40d9a6c2e6f33f19d451eb0c774fc2c37db1fa8fe2245c5117c0c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="调用"><a class="header-anchor" href="#调用"> </a>调用</h4>
<pre class="line-numbers language-none"><code class="language-none">starknet invoke \
    --address 0x02a828cb2ee25629d597625df71ac41779fc9166624654ec52bcc51e77ae75a6 \
    --abi test_proxy_abi.json \     
    --function call_increase_balance \
    --inputs &quot;0x03d2c69f4b89395b062da026c9fabb396b21883f7eb9c2b5cde4fcbcd8120c3f&quot; 10000

Invoke transaction was sent.
Contract address: 0x02a828cb2ee25629d597625df71ac41779fc9166624654ec52bcc51e77ae75a6
Transaction hash: 0x6fa1501929fdf6971dd35935eb3bdfda2e64668a16d77a665d3555d9992518c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="查询值变更"><a class="header-anchor" href="#查询值变更"> </a>查询值变更</h4>
<pre class="line-numbers language-none"><code class="language-none">starknet call \                                                                            
    --address 0x03d2c69f4b89395b062da026c9fabb396b21883f7eb9c2b5cde4fcbcd8120c3f \
    --abi contract_abi.json \
    --function get_balance
11234<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="获取调用者地址"><a class="header-anchor" href="#获取调用者地址"> </a>获取调用者地址</h3>
<p>get_caller_address()您可以使用库函数检索调用您的函数的合约的地址</p>
<pre class="line-numbers language-none"><code class="language-none">from starkware.starknet.common.syscalls import get_caller_address

# ...

let (caller_address) &#x3D; get_caller_address()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>注：</strong> 如果调用者是用户则返回0，如果是合约则返回合约地址。</p>
<h3 id="获取当前合约的地址"><a class="header-anchor" href="#获取当前合约的地址"> </a>获取当前合约的地址</h3>
<p>您可以使用get_contract_address()库函数获取当前合约的地址。</p>
<pre class="line-numbers language-none"><code class="language-none">from starkware.starknet.common.syscalls import (
    get_contract_address)

# ...

let (contract_address) &#x3D; get_contract_address()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上与<code>Solidity</code>中的<code>address(this)</code>类似。</p>
<h1 id="未完，待续。。。"><a class="header-anchor" href="#未完，待续。。。"> </a>未完，待续。。。</h1>
]]></content>
      <categories>
        <category>区块链</category>
      </categories>
      <tags>
        <tag>区块链</tag>
        <tag>cario</tag>
        <tag>startnet</tag>
      </tags>
  </entry>
  <entry>
    <title>Casper FFG paper总结</title>
    <url>/posts/3830d322/</url>
    <content><![CDATA[<h1 id="介绍-2"><a class="header-anchor" href="#介绍-2"> </a>介绍</h1>
<p>权益证明设计有两个主要的思想流派：</p>
<ul>
<li>基于链的权益证明<em>chain-based proof of stake</em>，模仿PoW机制，并以一系列区块为特征，并通过伪随机赋予利益相关者创建新区块的权利来模拟挖掘。以Peercoin，Blackcoin，和Iddo Bentov为代表。</li>
<li>基于拜占庭容错(BFT)的权益证明<em>Byzantine fault tolerant based proof of stake</em>。对拜占庭容错有了三十多年的研究。例如：实用拜占庭容错(PBFT)。 BFT算法通常具有经过验证的数学特性。例如，通常可以在数学上证明只要2/3个协议参与者诚实地遵循协议，那么，无论网络延迟如何，算法都能保证无法出现冲突区块。</li>
</ul>
<h1 id="我们的工作"><a class="header-anchor" href="#我们的工作"> </a>我们的工作</h1>
<p>Casper the Friendly Finality Gadget(Caper FFG)是一个顶层的提议机制用来解决谁提议区块的问题。Casper负责最终确定这些块，主要是选择一个代表分类帐规范交易的唯一链。 Casper提供安全性，但是活力取决于所选择的提议机制。 也就是说，如果攻击者完全控制提议机制，Casper可以防止最终确定两个冲突的检查点，但是攻击者可以阻止Casper完成任何未来的检查点。</p>
<p>Casper引入了BFT算法不必要支持的几个新功能：</p>
<ul>
<li><strong>问责制</strong>：如果<em><strong>validator</strong></em>（验证者）违反规则，我们可以检测到违规并知道哪个<em>validator</em>违反了规则。问责制允许我们惩罚恶意<em>validator</em>，解决困扰基于链的PoS的“无利害关系”(<em>Nothing at Stake</em>)问题。违反规则的处罚是验证人的全部存款。这种最大惩罚是防止违反协议。因为权益证明的安全性是基于罚款的大小，其可以设定为大大超过挖矿报酬的收益，所以股权证明提供了比工作证明更严格的安全激励。</li>
<li><strong>动态验证者</strong>：我们引入了一种安全的方法使<em><strong>validator set</strong></em>（验证者集合）随时间进行变化。</li>
<li><strong>防御性</strong>：我们引入了针对长程攻击的防御以及超过1/3的<em>validator</em>掉线的攻击，代价是非常弱的权衡同步性假设。</li>
<li><strong>模块化叠加</strong>：Casper的设计成叠加层的模式使其更容易实现对现有PoW链的升级。</li>
</ul>
<h2 id="对此理解"><a class="header-anchor" href="#对此理解"> </a>对此理解</h2>
<ul>
<li>问责制：质押32BETH，成为验证节点。验证节点通过下注提议来获取奖励。对于作恶节点进行罚款。</li>
<li>动态验证者机制：信标链每个epoch重新选举委员会。</li>
</ul>
<h3 id="长程攻击-long-range-attack"><a class="header-anchor" href="#长程攻击-long-range-attack"> </a>长程攻击 <em>long range attack</em></h3>
<h4 id="工作量证明的弱主观性"><a class="header-anchor" href="#工作量证明的弱主观性"> </a>工作量证明的弱主观性</h4>
<ul>
<li>在工作量证明区块链中我们基于这样一个假设，除非遭遇了 51% 攻击，不可能有其它从创世区块开始并与当前主链存在潜在竞争关系的分支链。而对于一个企图篡位的分支链，要达到当前主链那样的长度，<strong>必然耗费巨量的算力</strong>。所以对采取工作量证明协议的区块链，最长链原则已经足够解决弱主观性问题了。</li>
</ul>
<h4 id="无利害关系-nothing-at-stake"><a class="header-anchor" href="#无利害关系-nothing-at-stake"> </a>无利害关系 <em>nothing at stake</em></h4>
<ul>
<li>“无利害关系”问题指的是，权益证明机制中的矿工最佳的策略是在所有的分叉链上进行挖矿，因为签名的制造非常的便宜。<em>validator</em>仅仅是从交易池中取交易，打包到区块中，然后广播出去，仅此而已。所以说，几乎不消耗算力资源来创建一条从创世区块开始的长分支链的能力。而在工作量证明机制上需要付出算力成本，所以不存在此问题。所以Casper需要引入保证金机制来解决经典权益证明协议中做坏事的代价很低的问题。</li>
</ul>
<p>任何加入到权益证明区块链的新节点都会接收到多条分支链，其中很大一部分长度也相同。由于无利害关系和弱主观性 ，仅仅依凭最长链原则不足以判断哪一条是主链。长程攻击恰恰利用了权益证明协议区块链的这两个特点。</p>
<h1 id="Casper协议"><a class="header-anchor" href="#Casper协议"> </a>Casper协议</h1>
<p>在以太坊中，最初的提议机制是现有的PoW，使Casper的第一个版本成为混合PoW / PoS系统。 在未来版本中，PoW提议机制将被更有效的方式替代。 例如，我们可以想象将区块提议转换为某种PoS循环区块签名方案。</p>
<p>在Casper的这个简单版本中，我们假设有一组固定的<em>validator</em>和一个提议机制（例如，我们熟悉的PoW机制），它产生现有块的子块，形成一个不断增长的区块树。 根据<em>比特币白皮书</em>，树的根通常被称为“创世区块”。</p>
<p>在正常情况下，我们期望提议机制通常在链表中一个接一个地提出区块（即，每个“父”块恰好有一个“子”块）。 但是在网络延迟或故意攻击的情况下，提议机制将不可避免地偶尔产生同一父块的多个子块。 Casper的工作是从每个父块中选择一个子块，从而从区块树中选择一条规范链。</p>
<p>为了提高效率，Casper只考虑<em><strong>checkpoint tree</strong></em>（检查点子树）（图1a），而不是处理完整的区块树。 创世区块是一个检查点，区块树中高度（或块号）为100的倍数的每个区块也是一个检查点。 区块高度为100 * k的区块的“检查点高度”仅为k; 等价地，检查点c的高度h©是检查点链中区块的数量，从c沿着父链一直延伸到根（图1b）。</p>
<p>每个验证人都有押金; 当验证人加入时，其存款是存入的货币数量。 加入后，每个验证人的存款都会随着奖励和罚款而上升和下降。 权益证明的安全性来自存款的大小，而不是验证人的数量，因此对于本文的其余部分，当我们说“2/3的<em>validator</em>”时，我们指的是存款加权分数; 也就是说，一组验证人，其总存款大小占整个<em>validator set</em>的总存款大小的2/3。</p>
<p><img src="/posts/3830d322/figure1-1.webp" alt><br>
<img src="/posts/3830d322/figure1-2.webp" alt="图1"></p>
<p><em>validator</em>广播信息需要包含（表1）中四条数据的投票消息数据以及一条签名数据：两个检查点s和t以及它们的高度h(s)和h(t)。 我们要求s是检查点树中t的祖先，否则投票被视为无效。 如果<em>validator</em> : ν的公钥不在<em>validator set</em>中，则该投票被视为无效。以及连同<em>validator</em>的签名信息，我们将以<code>⟨ν, s, t, h(s), h(t)⟩</code>的形式投票。</p>
<p>**理解：**Casper FFG的这种投票消息，很巧妙地把二步融合到一个步骤里了，本质上它还是跟pBFT, Tendermint里的二阶段投票等价，pre-prepare-&gt;prepare, pre-vote -&gt; pre-commit。<br>
<img src="/posts/3830d322/table1.webp" alt="表1"></p>
<h2 id="我们定义以下术语："><a class="header-anchor" href="#我们定义以下术语："> </a>我们定义以下术语：</h2>
<ul>
<li><em><strong>supermajority link</strong></em> 是一对有序的<em>checkpoint</em>（a，b），也写成<code>a→b</code>。至少有2/3的<em>validator</em>（存款额度的2/3）发布了对源a和目标b的投票。 <em>supermajority link</em>可以跳过<em>checkpoint</em>，即<code>h(b) &gt; h(a) + 1</code>也是允许的。图1c显示了红色的三个不同的绝对多数链路：<code>r→b1</code>，<code>b1→b2</code>和<code>b2→b3</code>。</li>
<li>当且仅当两个<em>checkpoint</em> a和b是不同分支中的节点时，它们被称为<em><strong>conflicting</strong></em>，即，它们都不是另一个的祖先或后代。</li>
<li>如果<em>checkpoint</em> c是根，或者存在<em>supermajority link</em> c’→c，其中c’是<em>justified checkpoint</em>，则<em>checkpoint</em> c被称为<em><strong>justified checkpoint</strong></em>。 图1c显示了<em>justified checkpoint</em>。</li>
<li>如果<em>checkpoint</em> c被证明是合理化的并且存在<em>supermajority link</em>c→c’，其中c’是c的直接子项，则称其为<em><strong>finalized checkpoint</strong></em>。 等价地，<em>checkpoint</em>c是最终确定的<em>checkpoint</em>当且仅当：<em>checkpoint</em>c是合理化的，z存在<em>supermajority link</em>c→c’，<em>checkpoint</em>c和c’<em>no conflicting</em>，并且<code>h(c') = h(c) + 1</code>。</li>
</ul>
<h2 id="惩罚"><a class="header-anchor" href="#惩罚"> </a>惩罚</h2>
<p>为了防止<em>validator</em>在运行的过程中作恶，Casper制定了一套惩罚机制如下：对于相同的<em>validator</em>，发布了两个不同的投票vote=&lt;v , s1 , t1 , h(s1) , h(t1)&gt; 和vote=&lt;v , s2 , t2 , h(s2) , h(t2)&gt; ，如果存在以下两种情况之一则罚抵押的stake。</p>
<ol>
<li>
<p>h(t1) = h(t2)：对于同一个目标高度，不能发起两个不同的投票。</p>
</li>
<li>
<p>h(s1)&lt; h(s2) &lt; h(t2) &lt; h(t1)：两个投票的投票范围不能存在一个包含另一个。</p>
</li>
</ol>
<p><img src="/posts/3830d322/figure2-1.webp" alt="图2-1：两个Casper惩罚条件。任何validator只要违反以上任何一个条件就会被罚没他的存款"></p>
<p>我们来看一下在合法的交易的情况下，<em>justified</em> 和 <em>finalized</em> 是如何保证 <em>checkpoint</em> 的安全性的。当一个 <em>checkpoint</em> : c 成为了 <em>justified</em>，说明有超过2/3的 <em>validator</em> 支持 c 之前所有的 <em>checkpoint</em>，配合着第一个惩罚条件，在h©有超过2/3的<em>validator</em>唯一支持 <em>checkpoint</em> c。对于 <em>finalized</em> 的<em>checkpoint</em> : f，他会有一个从f出发，连接到f的子节点的 <em>supermajority link</em>。配合第二个惩罚条件，当一个 <em>checkpoint</em> f 成为了 <em>finalized</em>，说明全网超过2/3的 <em>validator</em> 不能发出跨越f的投票，这2/3的 <em>validator</em> 只能对f之后的 <em>checkpoint</em> 进行投票。如图2-2所示：对于任意一个 <em>validator</em>，在投出了 vote1之后就无法投 vote2，因此 f 之前的 <em>checkpoint</em> 将不会被改变，因为任意对于f之前 <em>checkpoint</em> 的投票都无法获得超过2/3的投票。<br>
<img src="/posts/3830d322/figure2-2.png" alt="图2-2"></p>
<p>Casper最值得注意的特性是，如果没有≥1/ 3的 <em>validator</em> 违反两个Casper戒律或惩罚条件之一，就不可能最终确定两个相互冲突的检查点（图2-1）。</p>
<p>如果 <em>validator</em> 违反了任何惩罚条件，则违规的证据可以作为交易包含在区块链中，此时 <em>validator</em> 的全部存款将被拿走作为给证据交易提交者的小“发现者费用”。 在目前的以太坊中，停止执行惩罚条件需要对以太坊的工作量证明区块提议者进行成功的51％攻击。</p>
<h1 id="证明安全和合理的活性"><a class="header-anchor" href="#证明安全和合理的活性"> </a>证明安全和合理的活性</h1>
<p>下面我们证明Casper的两个基本属性：可问责的安全性和合理的活性。可说明的安全性意味着两个相互冲突的检查点不能同时最终确定，除非≥1/ 3的 <em>validator</em> 违反惩罚条件（意味着至少有三分之一的存款丢失）。 合理的活性意味着，无论以前发生过什么事件（例如，惩罚事件，延迟区块，审查攻击等），如果≥2/ 3的 <em>validator</em> 遵循协议，那么总是可以在没有任何 <em>validator</em> 违反惩罚条件的情况下完成新的检查点。</p>
<p>假设按权重计2/3的 <em>validator</em> 没有违反惩罚条件，我们有以下属性：</p>
<ol>
<li>如果s1→t1和s2→t2是不同的绝对多数链路，那么h(t1) != h(t2)。</li>
<li>如果s1→t1和s2→t2是不同的绝对多数链接，则不等式h(s1) &lt; h(s2) &lt; h(t2) &lt; h(t1)不能成立。</li>
</ol>
<p>从这两个属性中，我们可以立即发现，对于任何高度n：</p>
<ol start="3">
<li>最多存在一个绝对多数链接: s→t，其中h（t）= n。</li>
<li>最多存在一个高度为n的合理检查点。<br>
有了这四个属性，我们转向主要定理。</li>
</ol>
<blockquote>
<p><strong>定理1(问责安全)(Accountable Safety)：</strong> 两个冲突的检查点a[m]和b[n]不能同时被最终确定。<br>
证明：设a[m]（有正当直接孩子a[m + 1]）和b[n]（有正当直接孩子b [n + 1]）是不同的最终检查点，如图3所示。现在假设a[m]和 b[n]冲突，并且不失一般性h(a[m]) &lt; h(b[n])（如果h(a[m]) = h(b[n])，则很明显1/3 验证者违反了条件I）。 设r→b [1]→b [2]→···→b [n]为检查点链，使得存在绝对多数链路r→b [1] ,.。 。，b [i]→b [i + 1] ,.。。 ，b [n]→b [n + 1]。 我们知道没有h(b[i])等于h(a [m])或h(a[m + 1])，因为这违反了属性（iv）。 令j为最小整数，使得h(b[j]) &gt; h(a [m + 1]); 然后h(b[j -1]) &lt; h(a[m])。 然而，这意味着存在从具有小于h(a[m])的纪元数的检查点到具有大于h(a[m + 1])的纪元数的检查点的超大多数链接，这与从a[m]到a[m + 1]的绝对多数链不兼容。</p>
</blockquote>
<blockquote>
<p><strong>定理2(合理的活性)(Plausible Liveness)：</strong> 如果存在扩展最终链的子项，则可以始终添加绝对多数链接以生成新的最终检查点。</p>
</blockquote>
<p><img src="/posts/3830d322/figure3.webp" alt="图3"></p>
<h1 id="Casper的分叉选择规则"><a class="header-anchor" href="#Casper的分叉选择规则"> </a>Casper的分叉选择规则</h1>
<p>Casper比标准PoW设计更复杂。因此，必须调整分叉选择。我们修改后的分叉选择规则应该被所有用户，验证器，甚至底层块提议机制所遵循。如果用户，验证者或块提议者改为遵循“始终在最长链上建立”的标准PoW分叉选择规则，则存在Casper被“卡住”的病态场景，并且在最长链上建立的任何区块都不能最终确定（甚至是合理的），除非有一些验证者无私地牺牲他们的存款。为了避免这种情况，我们引入一种新颖的，正确实施的(correct by construction)分叉选择规则：<strong>遵循包含最高高度的合理检查点的链</strong>。这个分叉选择规则是正确的，因为它遵循合理的活动证明（定理2），它精确地说明总是可以在具有最大高度的合理检查点顶部完成新的检查点。此分叉选择规则将在第3节和第4节中进行调整。</p>
<h1 id="启用动态验证人集合"><a class="header-anchor" href="#启用动态验证人集合"> </a>启用动态验证人集合</h1>
<p>验证器集需要能够更改。新的验证器必须能够加入，现有的验证器必须能够离开。为了实现这一点，我们定义了一个块的朝代。区块b的朝代是从根到区块b的父节点链中的最终检查点的数量。当一个可能的验证者的存款消息被包含在具有朝代d的块中时，验证者ν将加入朝代d + 2的验证者集合。我们称d + 2这个验证者的起始朝代DS(ν)。</p>
<p>要离开验证者集合，验证者必须发送“提款”消息。如果验证者ν的提款消息包含在具有朝代d的块中，则类似地将验证者将离开具有王朝d + 2的区块的验证者集合;我们称d + 2为验证者的结束朝代，DE(ν)。如果尚未包括提款消息，则DE(ν)=∞。一旦验证者ν离开验证者集合，验证者的公钥将被禁止重新加入验证者集合。这消除了处理单个身份的多个开始/结束朝代的需要。</p>
<p>在结束朝代开始时，验证人的存款被锁定很长一段时间，称为退出延迟（认为是“四个月的区块”），然后才能取消存款。如果在撤回延迟期间，验证人违反任何戒条，则押金将被没收处罚。</p>
<p>我们定义了两个函数，为任何给定的朝代d生成两个验证器子集，前向验证者集合和后向验证者集合。它们被定义为，</p>
<p><img src="/posts/3830d322/figure3-2.webp" alt></p>
<p>注意这意味着朝代d的前向验证者集合是朝代d + 1的后验证者集合</p>
<p>请注意，为了使链能够“知道”它自己当前的朝代，我们需要稍微限制我们对“最终确定”的定义：之前，如果检查点c是合理的并且从c到任何其直接子检查点存在绝大多数的链，则检查点c是最终确定的。现在，最终确定还有一个附加条件 – 只有当绝大多数链接c→c’的投票以及递归证明c的所有绝对多数链接都被包含在c’的子代之前的区块链中时，才能最终确定，（在区块号h(c’)* 100之前）。为了支持动态验证者集合，我们重新定义了绝对多数的链接和最终确定，如下所示：</p>
<ul>
<li>一对有序的检查点（s，t），其中t在朝代d中，如果朝代d中至少有2/3的前向验证者已经公布了投票s→t，并且朝代d中至少有2/3的后向验证者已经公布了投票s→t，则表示具有绝对多数的链。</li>
<li>原先，如果c是合理的，并且c→c’中存在绝对多数链接，其中c’是c的子节点，则检查点c被认为最终确定的。我们添加了这样的条件：只有当绝大多数链接c→c’的投票以及证明c合理的绝对多数链被包含在c’的区块链中，并且在c’的子块之前-在区块号h(c’)* 100之前。</li>
</ul>
<p>前后验证器组通常会大部分重叠;但是如果两个验证者结合基本上不同，这种“缝合”机制可防止在最终检查点的两个孙子具有不同朝代的情况下的安全失败，因为证据包含在一个链中但不包括在另一个链中。有关此示例，请参见图4。</p>
<p><img src="/posts/3830d322/figure4.webp" alt></p>
<h1 id="阻止攻击"><a class="header-anchor" href="#阻止攻击"> </a>阻止攻击</h1>
<p>有两种众所周知的针对权益证明系统的攻击：长程攻击和灾难性崩溃。 我们依次讨论每个问题。</p>
<h2 id="长程攻击"><a class="header-anchor" href="#长程攻击"> </a>长程攻击</h2>
<p>验证者结束朝代之后的退出延迟引入了验证者与客户之间的同步性假设。 一旦验证者联盟撤回了他们的存款，如果该联盟过去很久以前有超过2/3的存款，他们可以利用他们的历史绝对多数来完成相互冲突的检查点的最终确定，而不必担心被没收处罚（因为他们已经撤回了他们的钱）。 这称为长程攻击，见图5。</p>
<p><img src="/posts/3830d322/figure5.webp" alt></p>
<p>简单来说，分叉选择规则阻止长程攻击永远不会恢复最终确定的块，并期望每个客户端能以某个常规频率“登录”并获得链的完整最新视图（例如，每1-2个月一次）。 一个最终确定更老区块的“长程修订版”的分叉将被忽略，因为所有客户端都已经看到在该高度的最终块，并拒绝反转它。</p>
<p>(忽略了证明部分的翻译)</p>
<h2 id="灾难性崩溃"><a class="header-anchor" href="#灾难性崩溃"> </a>灾难性崩溃</h2>
<p>假设大于1/3的验证者同时崩溃 - 即，由于网络分区，计算机故障或验证者本身是恶意的，它们不再连接到网络。 直观地说，从这一点来看，不能创建绝对多数的链接，因此无法最终确定未来的检查点。</p>
<p>我们可以通过建立“不活动泄漏”来从这种情况进行恢复，这种泄漏会慢慢消耗任何不给检查点投票的验证人的存款，直到最终其存款规模减少到足以使投票的验证人为绝对多数。 最简单的公式就像“在每个时代，存款大小为D的验证人未能投票，它失去D * p（0 &lt; p &lt; 1）”，但对长时间未完成最终确定的区块使用增加泄漏率的公式以更快地解决灾难性崩溃，可能是最佳的。</p>
<p>这种泄漏的ether可以被销毁或在ω天后返回验证者。 泄漏资产是否应该被烧毁或返还以及不活动泄漏的确切公式超出了本文的范围，因为这些是经济激励的问题，而不是拜占庭式的容错。</p>
<p>不活动泄漏引入了两个冲突的检查点被最终确定而没有任何验证者被削减的可能性（如图6所示），验证者只在两个检查点中的一个上损失金钱。 假设验证者被分成两个子集，子集V[A]对链A投票和子集V[B]对链B投票。在链A上，V[B]的存款将泄漏，反之亦然，导致每个子集在其各自的链上具有绝对多数， 允许最终确定两个冲突的检查点，而不会明确地削减任何验证者（但由于泄漏，每个子集将在两个链中的一个链上丢失大部分存款）。 如果发生这种情况，那么每个验证者应该只是支持它首先看到的最终检查点。</p>
<p>从这些各种攻击中恢复的确切算法仍然是一个悬而未决的问题。 目前，我们假设验证者可以检测到明显的不良行为（例如，不包括证据）并手动创建“少数软分叉”。 这种少数派分支本身可以被视为区块链，与市场中的多数链竞争，如果多数链真正通过串联恶意攻击者来操作，那么我们可以假设市场将偏向少数派。</p>
<h1 id="结论"><a class="header-anchor" href="#结论"> </a>结论</h1>
<p>我们介绍了Casper，这是一种来自拜占庭容错文献的新颖的权益证明系统。 Casper包括：两个削减条件，一个受[11]启发的正确构造的分叉选择规则，以及动态验证者结合。 最后，我们介绍了Casper的扩展（不反转最终检查点和不活动泄漏）来防御两种常见的攻击。</p>
<p>Casper仍然不完美。 例如，完全受损的区块提议机制将阻止Casper完成确认新块。 Casper是对几乎所有PoW链的基于PoS的严格安全性改进。 Casper没有完全解决的问题，特别是与51％攻击相关的问题，仍然可以使用用户激活的软叉进行纠正。 未来的发展无疑将提高Casper的安全性并减少对用户激活的软叉的需求。</p>
<p><strong>未来的工作</strong>。 当前的Casper系统建立在PoW区块提案机制之上。 我们希望将区块提案机制转换为权益证明(PoS)。 即使验证者集合的权重随奖励和处罚而变化，我们也希望证明其可靠的安全性和合理的活力。 未来工作的另一个问题是对分叉选择规则的正式规范，考虑到对权益证明的常见攻击。 未来的工作报告将解释和分析Casper的经济激励及其后果。 与阻止攻击者的这种自动化策略相关的特定经济问题证明了不同客户端之间的不一致程度与攻击者所产生的成本之间的比率的上限。</p>
<h2 id><a class="header-anchor" href="#"> </a></h2>
<h1 id="引用和参考文献"><a class="header-anchor" href="#引用和参考文献"> </a>引用和参考文献</h1>
<blockquote>
<p><a href="https://github.com/ethereum/research/blob/master/papers/casper-basics/casper_basics.pdf">Casper the Friendly Finality Gadget [Latest commit 61ae146 on 29 Oct 2017]</a><br>
<a href="https://www.jianshu.com/p/6fd6d4f97ddd">【文章翻译】Casper FFG基础</a></p>
</blockquote>
]]></content>
      <categories>
        <category>区块链</category>
      </categories>
      <tags>
        <tag>区块链</tag>
        <tag>PoS</tag>
        <tag>capser</tag>
      </tags>
  </entry>
  <entry>
    <title>CosmWasm 一 安装</title>
    <url>/posts/e627dad1/</url>
    <content><![CDATA[<h1 id="rust安装省略"><a class="header-anchor" href="#rust安装省略"> </a>rust安装省略</h1>
<h1 id="升级rust并安装wasm32-target"><a class="header-anchor" href="#升级rust并安装wasm32-target"> </a>升级rust并安装wasm32 target</h1>
<p>rust版本要求1.51.0+</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">rustup default stable
cargo version
<span class="token comment"># If this is lower than 1.51.0+, update</span>
rustup update stable

rustup target list --installed
rustup target <span class="token function">add</span> wasm32-unknown-unknown <span class="token comment"># 安装wasm32的target</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="安装wasmd"><a class="header-anchor" href="#安装wasmd"> </a>安装wasmd</h1>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/CosmWasm/wasmd.git
<span class="token builtin class-name">cd</span> wasmd
<span class="token comment"># replace the v0.20.0 with the most stable version on https://github.com/CosmWasm/wasmd/releases</span>
<span class="token function">git</span> checkout v0.20.0
<span class="token function">make</span> <span class="token function">install</span>

<span class="token comment"># verify the installation</span>
wasmd version<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="建立环境"><a class="header-anchor" href="#建立环境"> </a>建立环境</h1>
<h2 id="pebblenet-测试网"><a class="header-anchor" href="#pebblenet-测试网"> </a>pebblenet 测试网</h2>
<p>Block Explorer: <a href="https://block-explorer.pebblenet.cosmwasm.com">https://block-explorer.pebblenet.cosmwasm.com</a></p>
<h3 id="设置pebblenet的参数到本地临时环境变量"><a class="header-anchor" href="#设置pebblenet的参数到本地临时环境变量"> </a>设置pebblenet的参数到本地临时环境变量</h3>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">source</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token function">curl</span> -sSL https://raw.githubusercontent.com/CosmWasm/testnets/master/pebblenet-1/defaults.env<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="添加wallet"><a class="header-anchor" href="#添加wallet"> </a>添加wallet</h3>
<p>注意备份助记词</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># add wallets for testing</span>
wasmd keys <span class="token function">add</span> wallet
<span class="token comment"># output</span>
<span class="token operator">></span>
<span class="token punctuation">&#123;</span>
  <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"wallet"</span>,
  <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>,
  <span class="token string">"address"</span><span class="token builtin class-name">:</span> <span class="token string">"wasm13nt9rxj7v2ly096hm8qsyfjzg5pr7vn5saqd50"</span>,
  <span class="token string">"pubkey"</span><span class="token builtin class-name">:</span> <span class="token string">"wasmpub1addwnpepqf4n9afaefugnfztg7udk50duwr4n8p7pwcjlm9tuumtlux5vud6qvfgp9g"</span>,
  <span class="token string">"mnemonic"</span><span class="token builtin class-name">:</span> <span class="token string">"hobby bunker rotate piano satoshi planet network verify else market spring toward pledge turkey tip slim word jaguar congress thumb flag project chalk inspire"</span>
<span class="token punctuation">&#125;</span>

wasmd keys <span class="token function">add</span> wallet2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>Error: No such interface “org.freedesktop.DBus.Properties” on object at path /</strong><br>
<strong>注</strong>：如果你使用的是<code>headless mode</code>的linux这里可能会报错。可以使用以下命令代替：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">wasmd keys <span class="token function">add</span> wallet --keyring-backend <span class="token function">file</span>
<span class="token comment"># 此命令会在--keyring-dir中写入文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="查看wallet"><a class="header-anchor" href="#查看wallet"> </a>查看wallet</h3>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">wasmd keys list <span class="token comment">#or</span>
wasmd keys list --keyring-backend <span class="token function">file</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="水龙头申请代币"><a class="header-anchor" href="#水龙头申请代币"> </a>水龙头申请代币</h3>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">JSON</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>jq -n --arg addr <span class="token punctuation">$(</span>wasmd keys show -a wallet<span class="token punctuation">)</span> <span class="token string">'&#123;"denom":"upebble","address":$addr&#125;'</span><span class="token variable">)</span></span> <span class="token operator">&amp;&amp;</span> <span class="token function">curl</span> -X POST --header <span class="token string">"Content-Type: application/json"</span> --data <span class="token string">"<span class="token variable">$JSON</span>"</span> https://faucet.pebblenet.cosmwasm.com/credit
<span class="token comment"># 如果使用file的keyring-backend，则使用下列命令</span>
<span class="token assign-left variable">JSON</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>jq -n --arg addr <span class="token punctuation">$(</span>wasmd keys show -a wallet --keyring-backend <span class="token function">file</span><span class="token punctuation">)</span> <span class="token string">'&#123;"denom":"upebble","address":$addr&#125;'</span><span class="token variable">)</span></span> <span class="token operator">&amp;&amp;</span> <span class="token function">curl</span> -X POST --header <span class="token string">"Content-Type: application/json"</span> --data <span class="token string">"<span class="token variable">$JSON</span>"</span> https://faucet.pebblenet.cosmwasm.com/credit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="查询余额-2"><a class="header-anchor" href="#查询余额-2"> </a>查询余额</h3>
<p>区块浏览器查询钱包地址: <a href="https://block-explorer.pebblenet.cosmwasm.com/">https://block-explorer.pebblenet.cosmwasm.com/</a></p>
<h3 id="有用的环境变量"><a class="header-anchor" href="#有用的环境变量"> </a>有用的环境变量</h3>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># bash</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">NODE</span><span class="token operator">=</span><span class="token string">"--node <span class="token variable">$RPC</span>"</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">TXFLAG</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$&#123;NODE&#125;</span> --chain-id <span class="token variable">$&#123;CHAIN_ID&#125;</span> --gas-prices 0.001upebble --gas auto --gas-adjustment 1.3"</span>

<span class="token comment"># 如果你用的是zsh则添加以下环境变量</span>
<span class="token comment"># zsh</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">NODE</span><span class="token operator">=</span><span class="token punctuation">(</span>--node <span class="token variable">$RPC</span><span class="token punctuation">)</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">TXFLAG</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">$NODE</span> --chain-id <span class="token variable">$CHAIN_ID</span> --gas-prices <span class="token number">0</span>.001upebble --gas auto --gas-adjustment <span class="token number">1.3</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="下载合约示例代码和编译"><a class="header-anchor" href="#下载合约示例代码和编译"> </a>下载合约示例代码和编译</h1>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/InterWasm/cw-contracts
<span class="token builtin class-name">cd</span> cw-contracts
<span class="token function">git</span> fetch --tags
<span class="token function">git</span> checkout nameservice-0.11.0
<span class="token builtin class-name">cd</span> contracts/nameservice

cargo wasm <span class="token comment"># 此处若依赖下载报错,Cargo则需要换源</span>
<span class="token assign-left variable">RUSTFLAGS</span><span class="token operator">=</span><span class="token string">'-C link-arg=-s'</span> cargo wasm <span class="token comment">#以此命令生成最下wasm</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="上传和交互"><a class="header-anchor" href="#上传和交互"> </a>上传和交互</h1>
<h2 id="上传"><a class="header-anchor" href="#上传"> </a>上传</h2>
<p>将代码上传到链上</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">RES</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>wasmd tx wasm store target/wasm32-unknown-unknown/release/cw_nameservice.wasm --from wallet $TXFLAG -y --keyring-backend <span class="token function">file</span><span class="token variable">)</span></span>
<span class="token assign-left variable">CODE_ID</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $RES <span class="token operator">|</span> jq -r <span class="token string">'.logs[0].events[-1].attributes[0].value'</span><span class="token variable">)</span></span>

<span class="token comment"># 查找当前codeId生成的contract，如果不存在则返回空</span>
wasmd query wasm list-contract-by-code <span class="token variable">$CODE_ID</span> <span class="token variable">$NODE</span> --output json

<span class="token comment"># 你也可以从链上下载这个wasm并且和本地检查一下是否一致</span>
<span class="token comment"># you can also download the wasm from the chain and check that the diff between them is empty</span>
wasmd query wasm code <span class="token variable">$CODE_ID</span> <span class="token variable">$NODE</span> download.wasm
<span class="token function">diff</span> artifacts/cw_nameservice.wasm download.wasm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="实例化"><a class="header-anchor" href="#实例化"> </a>实例化</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># instantiate contract and verify</span>
<span class="token comment"># 构造函数的参数</span>
<span class="token assign-left variable">INIT</span><span class="token operator">=</span><span class="token string">'&#123;"purchase_price":&#123;"amount":"100","denom":"upebble"&#125;,"transfer_price":&#123;"amount":"999","denom":"upebble"&#125;&#125;'</span>
<span class="token comment"># 实例化</span>
wasmd tx wasm instantiate <span class="token variable">$CODE_ID</span> <span class="token string">"<span class="token variable">$INIT</span>"</span> <span class="token punctuation">\</span>
    --from wallet --label <span class="token string">"awesome name service"</span> <span class="token variable">$TXFLAG</span> -y --keyring-backend <span class="token function">file</span>

<span class="token comment"># check the contract state (and account balance)</span>
<span class="token comment"># 再次查询是否有实例化的合约</span>
wasmd query wasm list-contract-by-code <span class="token variable">$CODE_ID</span> <span class="token variable">$NODE</span> --output json
<span class="token assign-left variable">CONTRACT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>wasmd query wasm list-contract-by-code $CODE_ID $NODE --output json <span class="token operator">|</span> jq -r <span class="token string">'.contracts[-1]'</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token variable">$CONTRACT</span>

wasmd query wasm contract <span class="token variable">$CONTRACT</span> <span class="token variable">$NODE</span>

<span class="token comment"># you can dump entire contract state</span>
wasmd query wasm contract-state all <span class="token variable">$CONTRACT</span> <span class="token variable">$NODE</span>

<span class="token comment"># Note that keys are hex encoded, and val is base64 encoded.</span>
<span class="token comment"># To view the returned data (assuming it is ascii), try something like:</span>
<span class="token comment"># (Note that in many cases the binary data returned is non in ascii format, thus the encoding)</span>
wasmd query wasm contract-state all <span class="token variable">$CONTRACT</span> <span class="token variable">$NODE</span> --output <span class="token string">"json"</span> <span class="token operator">|</span> jq -r <span class="token string">'.models[0].key'</span> <span class="token operator">|</span> xxd -r -ps
wasmd query wasm contract-state all <span class="token variable">$CONTRACT</span> <span class="token variable">$NODE</span> --output <span class="token string">"json"</span> <span class="token operator">|</span> jq -r <span class="token string">'.models[0].value'</span> <span class="token operator">|</span> base64 -d

<span class="token comment"># or try a "smart query", executing against the contract</span>
wasmd query wasm contract-state smart <span class="token variable">$CONTRACT</span> <span class="token string">'&#123;&#125;'</span> <span class="token variable">$NODE</span>
<span class="token comment"># (since we didn't implement any valid QueryMsg, we just get a parse error back)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="注册和转移name"><a class="header-anchor" href="#注册和转移name"> </a>注册和转移name</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># execute fails if wrong person</span>
<span class="token assign-left variable">REGISTER</span><span class="token operator">=</span><span class="token string">'&#123;"register":&#123;"name":"fred"&#125;&#125;'</span>
wasmd tx wasm execute <span class="token variable">$CONTRACT</span> <span class="token string">"<span class="token variable">$REGISTER</span>"</span> <span class="token punctuation">\</span>
    --amount 100upebble <span class="token punctuation">\</span>
    --from wallet <span class="token variable">$TXFLAG</span> -y --keyring-backend <span class="token function">file</span>

<span class="token comment"># query name record</span>
<span class="token assign-left variable">NAME_QUERY</span><span class="token operator">=</span><span class="token string">'&#123;"resolve_record": &#123;"name": "fred"&#125;&#125;'</span>
wasmd query wasm contract-state smart <span class="token variable">$CONTRACT</span> <span class="token string">"<span class="token variable">$NAME_QUERY</span>"</span> <span class="token variable">$NODE</span> --output json
<span class="token comment"># &#123;"data":&#123;"address":"wasm1av9uhya7ltnusvunyqay3xcv9x0nyc872cheu5"&#125;&#125;</span>

<span class="token comment"># 转移</span>
<span class="token comment"># buy and transfer name record to wallet2</span>
<span class="token assign-left variable">TRANSFER</span><span class="token operator">=</span><span class="token string">'&#123;"transfer":&#123;"name":"fred","to":"wasm1um2e88neq8sxzuuem5ztt9d0em033rpr5ps9tv"&#125;&#125;'</span>
wasmd tx wasm execute <span class="token variable">$CONTRACT</span> <span class="token string">"<span class="token variable">$TRANSFER</span>"</span> <span class="token punctuation">\</span>
    --amount 999upebble <span class="token punctuation">\</span>
    --from wallet <span class="token variable">$TXFLAG</span> -y --keyring-backend <span class="token function">file</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>区块链</category>
      </categories>
      <tags>
        <tag>区块链</tag>
        <tag>wasm</tag>
        <tag>cosmos</tag>
      </tags>
  </entry>
  <entry>
    <title>CosmWasm 三 入口函数</title>
    <url>/posts/5671ab14/</url>
    <content><![CDATA[<h1 id="cosmwasm-特点"><a class="header-anchor" href="#cosmwasm-特点"> </a>cosmwasm 特点</h1>
<ul>
<li>合约在<code>cosmwasm</code>被称之为<code>actor</code></li>
<li>异步栈式调用，将每个调用压栈，触发调用弹栈。避免重入攻击风险，并且有跨链优势</li>
</ul>
<h1 id="actor-调用接口"><a class="header-anchor" href="#actor-调用接口"> </a>actor 调用接口</h1>
<p>交互<code>actor</code>的接口封装在<code>WasmMsg</code>结构中，共有5种类型</p>
<table>
<thead>
<tr>
<th>调用接口</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Instantiate</td>
<td>初始化合约入口</td>
</tr>
<tr>
<td>Execute</td>
<td>执行合约交易</td>
</tr>
<tr>
<td>Migrate</td>
<td>迁移合约至新的代码</td>
</tr>
<tr>
<td>UpdateAdmin</td>
<td>升级管理员</td>
</tr>
<tr>
<td>ClearAdmin</td>
<td>清除管理员</td>
</tr>
</tbody>
</table>
<p><strong>说明:</strong></p>
<ol>
<li>每个<code>actor</code>有个内置的<code>Admin</code>充当管理员的角色。</li>
<li>只有<code>Admin</code>拥有<code>UpdateAdmin</code>、<code>ClearAdmin</code>和<code>Migrate</code>调用权限。</li>
<li>当<code>Admin</code>成功调用<code>ClearAdmin</code>后，<code>actor</code>将失去管理员角色。</li>
<li>成功调用<code>Migrate</code>后，只会改变<code>actor</code>的<code>code</code>，地址和状态数据不会改变。</li>
<li><code>Instantiate</code>、<code>Execute</code>和<code>Migrate</code>接口，wasm有对应的事件处理函数。</li>
</ol>
<h2 id="wasm-调用事件入口"><a class="header-anchor" href="#wasm-调用事件入口"> </a>wasm 调用事件入口</h2>
<h3 id="instantiate"><a class="header-anchor" href="#instantiate"> </a>instantiate</h3>
<p>处理初始化事件代码逻辑入口</p>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token attribute attr-name">#[entry_point]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">instantiate</span><span class="token punctuation">(</span>
  deps<span class="token punctuation">:</span> <span class="token class-name">DepsMut</span><span class="token punctuation">,</span>
  env<span class="token punctuation">:</span> <span class="token class-name">Env</span><span class="token punctuation">,</span>
  info<span class="token punctuation">:</span> <span class="token class-name">MessageInfo</span><span class="token punctuation">,</span>
  msg<span class="token punctuation">:</span> <span class="token class-name">InstantiateMsg</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Response</span><span class="token punctuation">,</span> <span class="token class-name">ContractError</span><span class="token operator">></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="execute"><a class="header-anchor" href="#execute"> </a>execute</h3>
<p>处理交互合约事件代码逻辑入口</p>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token attribute attr-name">#[entry_point]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">execute</span><span class="token punctuation">(</span>
  deps<span class="token punctuation">:</span> <span class="token class-name">DepsMut</span><span class="token punctuation">,</span>
  env<span class="token punctuation">:</span> <span class="token class-name">Env</span><span class="token punctuation">,</span>
  info<span class="token punctuation">:</span> <span class="token class-name">MessageInfo</span><span class="token punctuation">,</span>
  msg<span class="token punctuation">:</span> <span class="token class-name">ExecuteMsg</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Response</span><span class="token punctuation">,</span> <span class="token class-name">ContractError</span><span class="token operator">></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="migrate"><a class="header-anchor" href="#migrate"> </a>migrate</h3>
<p>处理迁移事件代码逻辑入口。<br>
此部分调用逻辑是在更新的代码中触发。</p>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token attribute attr-name">#[entry_point]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">migrate</span><span class="token punctuation">(</span>deps<span class="token punctuation">:</span> <span class="token class-name">DepsMut</span><span class="token punctuation">,</span> env<span class="token punctuation">:</span> <span class="token class-name">Env</span><span class="token punctuation">,</span> msg<span class="token punctuation">:</span> <span class="token class-name">MigrateMsg</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Response</span><span class="token punctuation">,</span> <span class="token class-name">ContractError</span><span class="token operator">></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h1 id="actor-查询接口"><a class="header-anchor" href="#actor-查询接口"> </a>actor 查询接口</h1>
<table>
<thead>
<tr>
<th>查询接口</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Smart</td>
<td>查询公共API的接口</td>
</tr>
<tr>
<td>Raw</td>
<td>查询kv-store类型的接口</td>
</tr>
</tbody>
</table>
<h2 id="wasm-查询事件入口"><a class="header-anchor" href="#wasm-查询事件入口"> </a>wasm 查询事件入口</h2>
<p>对于<code>Smart</code>查询wasm的<code>query</code>接口</p>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token attribute attr-name">#[entry_point]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">query</span><span class="token punctuation">(</span>deps<span class="token punctuation">:</span> <span class="token class-name">Deps</span><span class="token punctuation">,</span> env<span class="token punctuation">:</span> <span class="token class-name">Env</span><span class="token punctuation">,</span> msg<span class="token punctuation">:</span> <span class="token class-name">QueryMsg</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Binary</span><span class="token punctuation">,</span> <span class="token class-name">ContractError</span><span class="token operator">></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>区块链</category>
      </categories>
      <tags>
        <tag>区块链</tag>
        <tag>wasm</tag>
        <tag>cosmos</tag>
      </tags>
  </entry>
  <entry>
    <title>CosmWasm 二 项目创建</title>
    <url>/posts/b2bb0ade/</url>
    <content><![CDATA[<h1 id="使用cw-template模板初始化"><a class="header-anchor" href="#使用cw-template模板初始化"> </a>使用<a href="https://github.com/CosmWasm/cw-template">cw-template</a>模板初始化</h1>
<h2 id="环境要求"><a class="header-anchor" href="#环境要求"> </a>环境要求</h2>
<ul>
<li>Rust 1.55+</li>
</ul>
<h2 id="安装cargo-generate"><a class="header-anchor" href="#安装cargo-generate"> </a>安装cargo-generate</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cargo <span class="token function">install</span> cargo-generate --features vendored-openssl
cargo <span class="token function">install</span> cargo-run-script<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="创建新的合约"><a class="header-anchor" href="#创建新的合约"> </a>创建新的合约</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cargo generate --git https://github.com/CosmWasm/cw-template.git --name PROJECT_NAME<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>使用旧版本需要加上版本号作为参数</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cargo generate --git https://github.com/CosmWasm/cw-template.git --branch <span class="token operator">&lt;</span>version<span class="token operator">></span> --name PROJECT_NAME<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Example:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cargo generate --git https://github.com/CosmWasm/cw-template.git --branch <span class="token number">0.16</span> --name PROJECT_NAME<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
]]></content>
      <categories>
        <category>区块链</category>
      </categories>
      <tags>
        <tag>区块链</tag>
        <tag>wasm</tag>
        <tag>cosmos</tag>
      </tags>
  </entry>
  <entry>
    <title>DefiKingdoms 分析</title>
    <url>/posts/eec96fd2/</url>
    <content><![CDATA[<h1 id="介绍-3"><a class="header-anchor" href="#介绍-3"> </a>介绍</h1>
<p>本次以拆解DefiKingdoms项目的NFT方面为主。</p>
<h1 id="关于审计"><a class="header-anchor" href="#关于审计"> </a>关于审计</h1>
<p>目前在官方文档中找到关于defi的<a href="https://solidity.finance/audits/DefiKingdoms/">审计</a>，关于gamefi的审计未找到。</p>
<h1 id="关于源码"><a class="header-anchor" href="#关于源码"> </a>关于源码</h1>
<p>目前找到关于defi<a href="https://github.com/DefiKingdoms/contracts">源码</a>，NFT源码未公开、未验证。</p>
<h1 id="ERC20"><a class="header-anchor" href="#ERC20"> </a>ERC20</h1>
<table>
<thead>
<tr>
<th>name</th>
<th>symbol</th>
<th>Decimals</th>
<th>address</th>
</tr>
</thead>
<tbody>
<tr>
<td>Gaia’s Tears</td>
<td>DFKTEARS</td>
<td>0</td>
<td><a href="https://explorer.harmony.one/address/one1yn4q6smd8snq97l7l0n2z6auxpxfv0gyvfd7gr">one1yn4q6smd8snq97l7l0n2z6auxpxfv0gyvfd7gr</a></td>
</tr>
<tr>
<td>Jewels</td>
<td>JEWEL</td>
<td>18</td>
<td><a href="https://explorer.harmony.one/address/one1wt93p34l543ym5r77cyqyl3kd0tfqpy0eyd6n0">one1wt93p34l543ym5r77cyqyl3kd0tfqpy0eyd6n0</a></td>
</tr>
<tr>
<td>Gold</td>
<td>DFKGOLD</td>
<td>3</td>
<td><a href="https://explorer.harmony.one/address/one18f8deue39azw7qn6elvvyyuz55jejdh8xdfdw2">one18f8deue39azw7qn6elvvyyuz55jejdh8xdfdw2</a></td>
</tr>
</tbody>
</table>
<h1 id="ERC721"><a class="header-anchor" href="#ERC721"> </a>ERC721</h1>
<p>NFT：<a href="https://explorer.harmony.one/address/one1ta6nmn0ekxke427px3npf505w3hadnjuhlh7vv">one1ta6nmn0ekxke427px3npf505w3hadnjuhlh7vv</a></p>
<h1 id="玩法"><a class="header-anchor" href="#玩法"> </a>玩法</h1>
<h2 id="Marketplace"><a class="header-anchor" href="#Marketplace"> </a>Marketplace</h2>
<p>交易市场可以交易Token、流动性和买卖部分游戏物品。</p>
<h3 id="Druid"><a class="header-anchor" href="#Druid"> </a>Druid</h3>
<p>流动性相关，DEX常规玩法（uniswap）：</p>
<ol>
<li>创建流动性</li>
<li>添加流动性</li>
</ol>
<p>合约地址：<a href="https://explorer.harmony.one/address/one1yjkky5pdr3jje3mggzq3d8gy394vyresl69pgt">one1yjkky5pdr3jje3mggzq3d8gy394vyresl69pgt</a></p>
<h3 id="Trader"><a class="header-anchor" href="#Trader"> </a>Trader</h3>
<p>DEX的swap交易功能相关</p>
<h3 id="Vendor"><a class="header-anchor" href="#Vendor"> </a>Vendor</h3>
<p>使用<code>DFKGOLD</code>买卖专业任务获得的部分物品。</p>
<p>合约地址：<a href="https://explorer.harmony.one/address/one1u5al0rutnxmdx4he8aq6lwv4z95vegkxj3wh82">one1u5al0rutnxmdx4he8aq6lwv4z95vegkxj3wh82</a><br>
合约交互：</p>
<ul>
<li>buyItem 买物品</li>
<li>096c5e1a 卖物品</li>
</ul>
<h2 id="Gardens"><a class="header-anchor" href="#Gardens"> </a>Gardens</h2>
<p>DEX的存入lp挖<code>JEWEL</code></p>
<ol>
<li>每个Epoch是302400个区块。每个Epoch执行相对应的系数减产。</li>
<li>并且获得的JEWEL按Epoch给的系数部分锁定。</li>
</ol>
<p><a href="https://docs.defikingdoms.com/how-defi-kingdoms-works/the-gardens">详细参数</a></p>
<h2 id="Bank"><a class="header-anchor" href="#Bank"> </a>Bank</h2>
<p>存<code>JEWEL</code>得到<code>xJEWEL</code>类似xsushi。收入来源dex手续费、流动性撤出手续费和游戏手续费。</p>
<p>合约地址：<a href="https://explorer.harmony.one/address/one1488gx5rasuk9uynnuaz6hn76sjw65e206pmljg">one1488gx5rasuk9uynnuaz6hn76sjw65e206pmljg</a></p>
<p>合约交互：</p>
<ul>
<li>enter 存入</li>
<li>leave 取出</li>
</ul>
<h2 id="Tevern"><a class="header-anchor" href="#Tevern"> </a>Tevern</h2>
<p>查看、买卖和出租英雄。本质上是个NFTMarketPlace。购买时抽手续费给dev、bank。</p>
<p>NFTMarketPlace：</p>
<ul>
<li><a href="https://explorer.harmony.one/address/one1zwn9h8uq883vqv4uqgshrhq9kvxr72yjjjz9la">one1zwn9h8uq883vqv4uqgshrhq9kvxr72yjjjz9la</a></li>
</ul>
<p>合约交互：</p>
<ul>
<li>createAction：设置卖单</li>
<li>cancelAction：撤销卖单</li>
<li>bid：购买英雄</li>
</ul>
<h2 id="Portal"><a class="header-anchor" href="#Portal"> </a>Portal</h2>
<ul>
<li>召唤需要两个英雄和消耗<code>DFKTEARS</code>和<code>JEWEL</code>合成召唤水晶，然后调用Open开启水晶得到新的召唤英雄。</li>
<li>召唤次数是有固定的限制。并且召唤消耗的<code>DFKTEARS</code>随着英雄等级而提高。</li>
<li>召唤英雄基因会继承和随机突变上代。</li>
</ul>
<p>召唤相关合约：<br>
<a href="https://explorer.harmony.one/address/one17nf6ugpvntj3daltrk66luvm76v6tc648l0sva">one17nf6ugpvntj3daltrk66luvm76v6tc648l0sva</a></p>
<p>合约交互：</p>
<ul>
<li>租用召唤：c2b40631</li>
<li>合成召唤水晶：summonCrystal</li>
<li>打开水晶：open</li>
</ul>
<h2 id="Professions"><a class="header-anchor" href="#Professions"> </a>Professions</h2>
<p>任务系统，不同的职业通过任务获得不同的产出：</p>
<ul>
<li>消耗耐力，有几率得到产出。</li>
<li>参与职业任务获得<code>JEWEL</code>和游戏内资源，以及提升职业技能和经验。</li>
<li>当前只有<code>fisher</code>和<code>forager</code>职业开放，其他职业暂未推出。</li>
<li>英雄的基因会影响获得奖励的几率和减少耐力消耗。</li>
<li>不同的职业获取的游戏物品不一。</li>
<li>游戏物品可以去Vendor交易，也可以用于炼金合成。</li>
</ul>
<p>Fishing：</p>
<ul>
<li>消耗耐力得到经验和钓鱼的技能提升。有几率得到与钓鱼相关的物品，相关物品可以在Vendor售卖或在Alchemist合成药水。</li>
</ul>
<p>Foraging：</p>
<ul>
<li>消耗耐力得到经验和觅食的技能提升。有几率得到与植物相关的物品，相关物品可以在Vendor售卖或在Alchemist合成药水。</li>
</ul>
<p><a href="https://explorer.harmony.one/address/one12yqt6vdcygm3zz9q7c7uldjefwv3n6h5trltq4">one12yqt6vdcygm3zz9q7c7uldjefwv3n6h5trltq4</a></p>
<p>合约交互：</p>
<ul>
<li>startQuest 开始任务</li>
<li>completeQuest 完成任务获得奖励</li>
</ul>
<h2 id="Docks"><a class="header-anchor" href="#Docks"> </a>Docks</h2>
<p>跳转到跨链桥功能。</p>
<h2 id="Meditation-Circle"><a class="header-anchor" href="#Meditation-Circle"> </a>Meditation Circle</h2>
<p>英雄升级：</p>
<p>当在任务系统中累积足够的经验即可在此升级，需要消耗<code>JEWEL</code>和专业符文(专业任务中产出)。也可以消耗水晶提升某属性的成功率。</p>
<p>合约地址：<a href="https://explorer.harmony.one/address/one1qk2ds6efyvrk5gckat4yu89zsmd2zskpwyytuq">one1qk2ds6efyvrk5gckat4yu89zsmd2zskpwyytuq</a></p>
<p>合约交互：</p>
<ul>
<li>startMeditation 开始升级</li>
<li>completeMeditation 完成升级</li>
</ul>
<h2 id="Alchemist"><a class="header-anchor" href="#Alchemist"> </a>Alchemist</h2>
<p>炼金术师使用多个专业物品合成药水。</p>
<h1 id="总结"><a class="header-anchor" href="#总结"> </a>总结</h1>
<p>DefiKingdoms与传统的NFT开盲盒、合成、消耗、抽奖的机制基本无差。相较于同类型游戏玩法稍复杂、可玩性较强。</p>
<p>游戏本质是通过一系列的游戏玩法，设置产出和消耗与门槛使参与游戏的部分玩家获得获利，从而达到财富再分配。</p>
]]></content>
  </entry>
  <entry>
    <title>ETH2.0 Specs</title>
    <url>/posts/8a7d387/</url>
    <content><![CDATA[<h1 id="Casper共识机制"><a class="header-anchor" href="#Casper共识机制"> </a>Casper共识机制</h1>
<p>Casper 实现有助于改变以太坊生态系统。其中两个项目的实现分别是 Friendly Finality Gadget (Casper FFG) 和 Correct-by-Construction(Casper CBC)。</p>
<p>Casper FFG 是由以太坊创始人 Vitalik Buterin创立的。Casper FFG 是 Casper 的最初版本，是 PoW/PoS的混合版。然而，由 Vlad Zamfir 创立的 Casper CBC 已经制定了被广泛认为是一种卓越的协议。</p>
<p>ETH2.0 最终采用Vitalik 的 Casper FFG共识协议。</p>
<p>ETH2.0信标链(Beacon chain) 采用Casper共识机制，Casper属于权益证明制（PoS）范畴，除了继承PoS机制低能耗、防51%攻击更安全的优势外，还在现有PoS机制上增加经济惩罚机制，解决PoS机制本身存在的“无利害攻击”问题。</p>
<p>“无利害攻击”是PoS系统的一个经典攻击问题。PoS系统节点持有权益证明（即按币的数量）就可以参与挖矿，权益占比越大负责出块的概率也越大，由于PoS不需要额外付出挖矿的算力成本，挖矿边际成本为0，区块链网络产生分叉的可能性更高。PoS验证者可以选择同时在两条链上进行“投票”，不论最后哪条链成为“最长链”胜出，验证节点都可以获得区块奖励。这和PoW链不同，如图4所示，PoW链不会发生这种现象，因为算力只有一份，而Token同时存在在两条链上。随着时间推移，这种无成本为多条链出块的投票行为会助长更多的网络安全攻击行为，损伤区块链网络本身的安全性。</p>
<p>Casper通过设置惩罚经济模型来解决PoS的无成本攻击问题，确保网络可以正常运转。它的主要机制包括：</p>
<ol>
<li>
<p>验证节点需要预先在链上抵押锁定一定数量的以太坊（BETH）作为保证金。</p>
</li>
<li>
<p>验证节点每一轮需要对区块进行“下注”，验证节点需要评估其他节点会“下注”哪个块胜出，同时也“下注”这个块。如果支持正确的链就可以拿回保证金外加区块奖励及区块内的交易Gas费；如果下注没有迅速达成一致，就只能拿回保证金。如果验证节点明显地改变下注，进行“投机下注”，比如先投某个块有很高概率胜出，再投另外一个块，将被信标链严惩, 最坏结果就是没收全部保证金，并从验证节点委员会中剔除，同时验证节点也可以监督其他节点的投注并举报此类投机行为。由于可能造成的经济损失，验证节点会选择对自己最有利的结果进行投注，当全网验证节点数量足够多时，投注机制确保最后的结果分布趋向于收敛，即大多数验证节点都选择的某个高概率胜出的区块作为最终一致性结果。</p>
</li>
<li>
<p>Casper验证节点委员会随机选举验证节点，每隔一个周期进行一次轮换选举，随机指派验证节点负责指定分片内的校验区块出块，确保分片内的验证节点不形成“合谋”，降低网络安全性。</p>
</li>
</ol>
<p>Casper PoS的基本思路是正向奖励诚信、负向惩罚作恶，所以对于验证节点设置非常多的惩罚规则来防止分叉，对于不尽责的验证节点，也存在惩罚保证金的风险。成为Casper 验证节点需要在ETH PoW主链上注册的验证管理器合约上至少质押32个BETH才能运行信标链节点客户端软件。</p>
<p>考虑前期ETH矿工从PoW节点转为PoS验证节点参与度可能低于预期，Vitalik主导了Casper FFG这个PoW/PoS混合挖矿方案，在现有以太坊PoW协议上叠加一层PoS协议，在PoS协议正式稳定前维持PoW挖矿不变，但每通过PoW挖矿产生50个区块触发一次PoS节点区块验证，这样做方便让社区一部分用户可以先参与新PoS链的测试，直到社区顺利过渡到纯PoS主网。</p>
<p>Casper 还有一个纯PoS的竞争版本实现Casper CBC, 由Vlad Zamfir主导，和FFG采用的混合共识不同，CBC从一开始就完全定义成PoS链，理论创新较多，实际部署难度高于FFG，可能ETH2.0不会直接采用。CBC和FFG的目标是一致的，即提高整个区块链系统共识的安全性。技术思想方面，CBC更倾向通过新的共识改进BFT(拜占庭容错协议)不超过三分之一作恶节点数量的限制，容错率降到1/4。Vitalik Butterin主导的FFG更倾向如何将现有的BFT1/3容错协议更好地运用在信标链上。目前来看，Vitalik主导的FFG路线获得了胜出。</p>
<p><strong>总结:</strong> merge阶段,ETH1.0 POW出块模式不变，在此基础上包装一层casper进行区块的二次确认，然后通过crosslink提交摘要信息至信标链。</p>
<h1 id="分片技术"><a class="header-anchor" href="#分片技术"> </a>分片技术</h1>
<p>分片技术（sharding）其实来源于一种传统概念扩容技术，它指将数据库分成若干片段，以增加处理效率。在区块链中，它指将区块链网络分成多个碎片，每个碎片中包含一定的节点，由这些节点分别处理每个碎片中的事务，以提高区块链整体的性能。</p>
<p>因此，在ETH2.0升级中，以太坊将通过分片技术提高系统并发交易处理吞吐量水平。它将网络划分为64个分片（旧方案中曾预计采用1024个分片），每个分片处理网络中不同的交易，并处于独立的账户空间。</p>
<p>每个分片内的交易结果将由信标链网络上的验证节点委员会指定的验证节点负责验证，验证节点不需要验证分片外的交易，分片每隔一段时间（即时隙Slot，12s）由验证节点产生一个校对区块, 校对区块包含分片内的状态和交易内容，提供可验证信息（如Merkle根）。这也意味着，每过12秒整个网络中就产生64个分片链区块，再加1个信标链区块。</p>
<p>随后，通过交联（crosslink）过程，信标链可以引用不同分片链的内容和状态，获得该分片网络的真实性证明，而不需要去验证分片内每一笔交易，最终信标链验证委员会通过Casper机制对信标链内所有分片链进行校对，随后区块结果获得最终确定性，分片也将通过交联获得信标链对引用的分片区块完成最终确认的状态结果。</p>
<p>ETH2.0将网络分成两部分，左边L1代表信标链网络，右边L2代表分片网络，分片之间空间各自独立，不同的分片由验证节点组成的验证委员会维护，相当于也是多条独立的区块链。信标链通过交联（crosslink）收集分片内的交易真实性证明摘要（Merkle根），ETH2.0分片技术第一阶段就是建立信标链-分片的锚定模型，分片内交易结果的确认要等待信标链的区块结果确认，分片内不支持状态存储。</p>
<p>总结一下，ETH2.0分片技术的阶段1属于链上数据分片范畴，即只是将验证节点随机划分到不同的网络，处理不同的交易数据，分片未涉及处理状态的问题，ETH通过信标链这个核心中枢来负责最终交易状态的共识验证并在区块确认后在各个分片进行同步，信标链同时协调跨分片的状态通信，信标链基于Casper 共识来实现区块的更新, 通过交联技术实现信标链和分片的状态通信。</p>
<h1 id="EVM-2-0虚拟机eWASM"><a class="header-anchor" href="#EVM-2-0虚拟机eWASM"> </a>EVM 2.0虚拟机eWASM</h1>
<p>ETH2.0的阶段1“分片链”仍不支持智能合约，但是随着ETH2.0新虚拟机eWASM的推出，这一情况将被改变。新虚拟机推出后，分片链将可以执行智能合约，每个分片链管理一个eWASM，包括账户、合约代码、状态、收据、其他抽象等等，这些ETH1.0拥有的概念将迁移至分片链。这将发生在信标链和分片网络稳定运行之后，分片内增加对智能合约的支持会增加状态存储的开销，以及分片之间跨分片（状态）通信的复杂性。eWASM将应对分片内运行智能合约的挑战，这是可预见的趋势，分片内支持状态操作才能明显提高ETH扩容后的交易性能。</p>
<p>eWASM是针对以太坊EVM推出的WebAssembly子集，EVM最初设计过程强调简单和安全，以保证智能合约运行结果的无歧义和正确性，所以EVM不支持数据类型方面精确度不确定的浮点计算。同时EVM只支持处理通用区块32位8字节数据，不支持64位。EVM本身支持的操作码也较少，只能支持有限的几种编程语言进行智能合约开发比如Solidity/Vyper，并不支持C/C++/Rust硬件及系统级别语言开发，Solidity本身语言在内存泄露、执行速度方面存在很多改进的地方。</p>
<p>WebAssembly(简称WASM)的设计目标是性能和效率，是为Web开发构建的一个高效计算引擎（Web虚拟机），体系架构设计接近传统计算机，支持接近硬件水平的指令，性能非常好，其支持计算机CPU RSIC指令集使得Web应用程序能利用本地计算机的硬件功能提高代码的执行速度，所以兼容多种编程语言，软件代码更加易于阅读和调试，包括Google、Microsoft等传统互联网公司以及Polkadot、EOS、Cardano等知名区块链项目都在陆续采用WASM。</p>
<p>eWASM是以太坊上的WASM, 向后兼容目前的EVM，不支持浮点数操作，其相比EVM最明显的优势是代码执行的速度和效率上的大幅提升，执行速度提升意味着区块每秒可以处理的交易数量TPS（吞吐量）提升，eWASM也支持更多的编程语言种类进行智能合约开发，这些编程语言相比Solidity具有更广泛的社区开发支持资源，包括编译工具、开发人员。</p>
<p>eWASM还有一个“优化”的地方是用eWASM智能合约替代预编译，预编译是EVM字节码的特殊位，通常代表某些通用的特定操作比如签名和哈希计算，EVM评估预编码字节代替评估合约地址内的整段代码，可以减少执行代码的Gas费用，如果不通过预编译，EVM将评估智能合约地址整段代码，效率非常低，同时很多复杂的密码计算将导致很高的Gas成本，有可能超过区块的限制而导致交易无法处理。</p>
<p>但是预编译存在一个缺点就是要如果加入新的操作字节码进行预编译，通常需要网络发生硬分叉，硬分叉因为有争议而较难实现。eWASM可以消除大多数当前的预编译，并用eWASM合约替换，这些智能合约可以通过重写和重新部署，而无需使用硬分叉，来增加更多新的通用操作，这使得eWASM比EVM更具优势。</p>
<h1 id="智能合约如何跨分片调用"><a class="header-anchor" href="#智能合约如何跨分片调用"> </a>智能合约如何跨分片调用</h1>
<p>分片链A智能合约内抛出链B的调用消息，经过信标链传播在链B完成调用。<br>
此部分调用是异步的过程。</p>
<h1 id="参考链接"><a class="header-anchor" href="#参考链接"> </a>参考链接</h1>
<p><a href="https://www.lianyi.cc/zixun/3197403">一文概述以太坊2.0的意义、时间表与未来生态演变</a></p>
]]></content>
      <categories>
        <category>区块链</category>
      </categories>
      <tags>
        <tag>区块链</tag>
        <tag>ETH2.0</tag>
        <tag>Casper</tag>
      </tags>
  </entry>
  <entry>
    <title>EarnDefi被盗分析</title>
    <url>/posts/28567f46/</url>
    <content><![CDATA[<h1 id="Earn-Defi-单币挖矿合约架构"><a class="header-anchor" href="#Earn-Defi-单币挖矿合约架构"> </a>Earn Defi 单币挖矿合约架构</h1>
<h2 id="入口合约"><a class="header-anchor" href="#入口合约"> </a>入口合约</h2>
<p>负责单笔挖矿用户接入的账户系统</p>
<p>地址：<a href="https://hecoinfo.com/address/0x80b0eafa5aaec24c3971d55a4919e8d6a6b71c78">0x80b0eafa5aaec24c3971d55a4919e8d6a6b71c78</a><br>
管理员：<a href="https://hecoinfo.com/address/0x61f942b6eedd9b400aa9780637c84d2770af85b6">0x61f942b6eedd9b400aa9780637c84d2770af85b6</a></p>
<p>当前账户内剩余USDT数量：</p>
<pre class="line-numbers language-none"><code class="language-none">282,095.648425891624129973 USDTHECO  
248,056,556.021327376723397534 HPT  
3,001.664842435153282252 HLTC  
3,027.460637161641773855 HFIL  
2.528440468150094002 HBTC  
22.021496524943978192 ETH  
3,030.812388128947611371 WHT  
3,041.24777095 HUSD<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>合约内部用map维护了pool列表，其中USDT的pid为2</p>
<p><strong>交互方法</strong></p>
<table>
<thead>
<tr>
<th>方法</th>
<th>MethodID</th>
<th>备注</th>
<th>示例txId</th>
</tr>
</thead>
<tbody>
<tr>
<td>deposit(uint256 _pid, uint256 _amount)</td>
<td>0xe2bbb158</td>
<td>用户存入指定数量的某种token</td>
<td><a href="https://hecoinfo.com/tx/0xe314a2bc03a274f06bfe25f76c0f3ad1c8beadda5a899846c8a4ef905c64b709">0xe314a2bc03a274f06bfe25f76c0f3ad1c8beadda5a899846c8a4ef905c64b709</a></td>
</tr>
<tr>
<td>depositAll(uint256 _pid)</td>
<td>0xc6f678bd</td>
<td>用户存入所有的某种token</td>
<td><a href="https://hecoinfo.com/tx/0xbd9973852e45cda3839080e8d3c6daff2e9c9db4d5f67eca2b2056719388f7fc">0xbd9973852e45cda3839080e8d3c6daff2e9c9db4d5f67eca2b2056719388f7fc</a></td>
</tr>
<tr>
<td>withdraw(uint256 _bid, uint256 _refId)</td>
<td>0x441a3e70</td>
<td>用户提出指定数量的某种token</td>
<td><a href="https://hecoinfo.com/tx/0xb4aa7ee92d21a3b40d5ef3f96ec8646f45c1d47a15a1d183cacf2cfc8e43cddb">0xb4aa7ee92d21a3b40d5ef3f96ec8646f45c1d47a15a1d183cacf2cfc8e43cddb</a></td>
</tr>
<tr>
<td>withdrawAll(uint256 _pid)</td>
<td>0x958e2d31</td>
<td>用户提出所有的某种token</td>
<td><a href="https://hecoinfo.com/tx/0x94e889b92424a9b879bd01ff3d762ba3580b0993e8bf1089566b79639f8aadcf">0x94e889b92424a9b879bd01ff3d762ba3580b0993e8bf1089566b79639f8aadcf</a></td>
</tr>
<tr>
<td>pause?(bool)</td>
<td>0xe83ddd87</td>
<td>管理员可以设置参数暂停存提,true为暂停，false为开放。函数名未确定</td>
<td><a href="https://hecoinfo.com/tx/0x2a9c37e9df8998e4c51f1b7446dee1baeddbb5c087c4687d4db4bc992f4470d2">0x2a9c37e9df8998e4c51f1b7446dee1baeddbb5c087c4687d4db4bc992f4470d2</a></td>
</tr>
<tr>
<td>addStrategy(address addr)</td>
<td>0x223e5479</td>
<td>添加币种</td>
<td><a href="https://hecoinfo.com/tx/0x7e957b90142617ead7d349456590c1a262ad2eba2727aa4c503ffd2fe3e1ff83">0x7e957b90142617ead7d349456590c1a262ad2eba2727aa4c503ffd2fe3e1ff83</a></td>
</tr>
<tr>
<td>harvestAll()</td>
<td>0x8ed955b9</td>
<td></td>
<td><a href="https://hecoinfo.com/tx/0x7a5dc22804e51ff0a692b6f3ee0e52069d5fc07c0b1ed4b8f138383ac68065ac">0x7a5dc22804e51ff0a692b6f3ee0e52069d5fc07c0b1ed4b8f138383ac68065ac</a></td>
</tr>
<tr>
<td>unknowed(address)</td>
<td>0x776d59e4</td>
<td>貌似是设置对下层合约进行重新投资的函数</td>
<td><a href="https://hecoinfo.com/tx/0x2efeea460127f3f598f3836a08dacafe55c21d8ba1e99bacff5425f38710a54b">0x2efeea460127f3f598f3836a08dacafe55c21d8ba1e99bacff5425f38710a54b</a></td>
</tr>
</tbody>
</table>
<h3 id="storage-状态变量"><a class="header-anchor" href="#storage-状态变量"> </a>storage 状态变量</h3>
<p><strong>unknown1526fe27 is array of struct at storage 4</strong></p>
<p>struct poolInfo[]:</p>
<ul>
<li>erc20Address address</li>
<li>pid?</li>
<li>blockNumber</li>
<li>?</li>
<li>已投额度</li>
<li>总计额度</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">例如：pid为2的USDT
[
  &#39;0xa71edc38d189767582c38a3145b5873052c3e47a&#39;,
  &#39;125&#39;,
  &#39;9567307&#39;,
  &#39;10918534050&#39;,
  &#39;8999854826604473921412569&#39;,
  &#39;30000000000000000000000000&#39;
]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>unknowna267526b is array of addr at storage 5</strong><br>
策略列表</p>
<pre class="line-numbers language-none"><code class="language-none">address[] strategys;
sid: 0, addr: 0x447e8a7f84368a762294be9a8a34f606206bde0e    &#x2F;&#x2F;boo 涉及wht的投资策略
sid: 1, addr: 0x40b910d008cebfd433154e52ce343ded3d248378    &#x2F;&#x2F;Depth 涉及 USDT 11 0
sid: 2, addr: 0xbb8f5d4e826c32085baabb3623cffb1887dd5917    &#x2F;&#x2F;Depth 涉及 HUSD   pid 9 510853.05530818
sid: 3, addr: 0x1843f672f6d60db32b374d0eb3acd0bdd12cd3c1    &#x2F;&#x2F;boo 涉及HFIL  &#x2F;&#x2F; 空
sid: 4, addr: 0xc19c9adc5fe02a1d91b2721c2e232e1c37527392    &#x2F;&#x2F;coinwind 涉及HFIL &#x2F;&#x2F; 空
sid: 5, addr: 0x996b6e9635f862c834cf50403cd33aacbfa4b207    &#x2F;&#x2F;coinwind 涉及USDT &#x2F;&#x2F; 空
sid: 6, addr: 0xadc0a8b9e7149d7c6a5bbecf6a4016576e942247    &#x2F;&#x2F;coinwind 涉及HUSD &#x2F;&#x2F;空
sid: 7, addr: 0x4f676ec7a3d75f7be2fcbda74df5a31708822aa5    &#x2F;&#x2F;bxh 的HDOT    &#x2F;&#x2F;空
sid: 8, addr: 0x9aaa9ed5eed70494df66e0540d0bc5512c3938c6    &#x2F;&#x2F;gHLTC         &#x2F;&#x2F;空
sid: 9, addr: 0x36768a55a260e561291b2fc14f67ddee86fc6fa1    &#x2F;&#x2F;mdx HT-HUSD   &#x2F;&#x2F;空
sid: 10, addr: 0xf207e6d9f1e59cfaa8358e849cd6b7c8d323e025   &#x2F;&#x2F;mdx HT-BTC    &#x2F;&#x2F;空
sid: 11, addr: 0xa8a8881edc4660b834c2b9e5add3cb46db1d65fb   &#x2F;&#x2F;mdx ETH-HUSD  &#x2F;&#x2F;空
sid: 12, addr: 0xb3cd38e467139721b319401e5bc06e3930b2216c   &#x2F;&#x2F;分配dev收益mdx
sid: 13, addr: 0xf1c11b4ac327d3e2da24114c183ec8a977ebcfe9   &#x2F;&#x2F;coinwind HBTC &#x2F;&#x2F;空
sid: 14, addr: 0xe0d179935161af517fbd5c57e993cce9e65c6137   &#x2F;&#x2F;分配dev收益mdx &#x2F;&#x2F;空
sid: 15, addr: 0x55297d6f8fb33beafe5880c3b59ba6cce7c8b13c   &#x2F;&#x2F;coinwind WHT  
sid: 16, addr: 0x954e4a0eb2aabdc5a8140a162f6cab649f9fc0c6   &#x2F;&#x2F;BOO HUSD
sid: 17, addr: 0xe4fdb79bae96a082a9d716b09f0fa8eedfa5ee32   &#x2F;&#x2F; MDX HBTC-USDT 8 1.827616583664665540个LP&#x2F;233065.623498707777205998池内总计
sid: 18, addr: 0x96164d9398408b5dc2cd6705ac7b98b231c26c22   &#x2F;&#x2F;BOO HBTC  &#x2F;&#x2F;空
sid: 19, addr: 0x8a2fc39d821916149f4d7b722fec2be5d2abe825   &#x2F;&#x2F;BOO ETH  &#x2F;&#x2F;空
sid: 20, addr: 0xc461dd52d605ab22d762d1a019da4342c9d8ad12   &#x2F;&#x2F;back平台 ETH   &#x2F;&#x2F;空
sid: 21, addr: 0x54556e1aa1092bc614ad39f519fabce66e74b588   &#x2F;&#x2F;back平台 HBTC  &#x2F;&#x2F;空
sid: 22, addr: 0x5948ad44812e02868aa5c9f018943d35670eaf8f   &#x2F;&#x2F;BOO USDT  &#x2F;&#x2F;空 
sid: 23, addr: 0xdccf2926ee39de136ee31b805a5bd7f3d8c58119   &#x2F;&#x2F;BACK WHT &#x2F;&#x2F;空 
sid: 24, addr: 0x22a411ff3ad2d25fe53ee0143cc36b13f8a9a6cc   &#x2F;&#x2F;分配dev收益mdx     &#x2F;&#x2F;空 
sid: 25, addr: 0x8e5dc937013f67e4e506fe2e3d0774b66147404a   &#x2F;&#x2F;Belt.fi ETH
sid: 26, addr: 0x1fb01f73e3bdfd805bf8c8f39e4885d08369906d   &#x2F;&#x2F;Belt.fi HBTC
sid: 27, addr: 0xd16a55ba2b84419c83a671d8992db92d2910acd6   &#x2F;&#x2F;gHLTC
sid: 28, addr: 0xf49a3ea13728e46204900c87390a45365c465ab6   &#x2F;&#x2F;mdx HBTC-ETH
sid: 29, addr: 0xd3fcca8a912cd975ae85c57c903f1856a147b2b3   &#x2F;&#x2F;mdx HETH-USDT 9 0
sid: 30, addr: 0xc1bd204bc1d0c1bf239aaf103b9a407f60056fbf   &#x2F;&#x2F;Belt.fi WHT 有
sid: 31, addr: 0xe2992d7d4f905294639ebe3fd916a2ed4de28a24   &#x2F;&#x2F;MDX 过度
sid: 32, addr: 0x0ebfe4706f08aea1130e7e7239e06edd45b491d3   &#x2F;&#x2F;MDX 过度
sid: 33, addr: 0xf02bd1bb3958de33818490f81f3f95a0157dc2cb
sid: 34, addr: 0xecf8b5fd8c1b82f8de88fb061641ad9c291fb885   &#x2F;&#x2F;FILDA MDX
sid: 35, addr: 0xb4680dbb6a283065d4f45f4c5ab54138182da0ca   &#x2F;&#x2F;DEMETER HDOT (8185 dmHDOT 304dmt)
sid: 36, addr: 0x4d1fc3664298dc1f0ceae114f16a92ddcb659181   &#x2F;&#x2F; 管理员调用的dmt
sid: 37, addr: 0x8f89467cdfdd96ce9e35aac6825c1ffadd4a684a   &#x2F;&#x2F;借贷平台 20,774.53639379 dmUSDT
sid: 38, addr: 0xd77adc07294df8b0d1a95571889a649c12c744b0   &#x2F;&#x2F;dmMDX 1,051,236.85964317 dmMDX 11,707.917522113808967497 DMT
sid: 39, addr: 0x0298c2b32eae4da002a15f36fdf7615bea3da047   &#x2F;&#x2F;HUSD                       <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="关于审计-2"><a class="header-anchor" href="#关于审计-2"> </a>关于审计</h1>
<table>
<thead>
<tr>
<th>审计方</th>
<th>结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>成都链安</td>
<td>只审计了EDC代币的合约</td>
</tr>
<tr>
<td>CERTIK</td>
<td>只了LP池内相关的2个合约</td>
</tr>
<tr>
<td>慢雾科技</td>
<td>审计打不开</td>
</tr>
</tbody>
</table>
<p>另外：审计报告内的github链接打不开<br>
<a href="https://github.com/Wendy-Earndefi/vault">https://github.com/Wendy-Earndefi/vault</a></p>
]]></content>
      <categories>
        <category>区块链</category>
      </categories>
      <tags>
        <tag>区块链</tag>
        <tag>earndefi</tag>
      </tags>
  </entry>
  <entry>
    <title>Immutable X 分析</title>
    <url>/posts/bed1adf7/</url>
    <content><![CDATA[<h1 id="介绍-4"><a class="header-anchor" href="#介绍-4"> </a>介绍</h1>
<p>Immutable X是一个基于StarkWare的layer2网络使用Cairo编写的NFT跨链和交易应用。用户可以在此网络内进行快速低成本的交易。并且由于StarkNet底层使用了ZK-Rollup的方案，相比传统sidechain拥有更高的去中心化安全性、即时交易确认、高tps、抗DDos等优点。</p>
<h1 id="原理"><a class="header-anchor" href="#原理"> </a>原理</h1>
<p>Immutable X使用ZK-Rollup，将layer2上的一定量的交易打包，批量生成有效的证明，提交到layer1上的智能合约进行验证。通过验证后即可完成“跨链”的存取操作。</p>
<h1 id="Immutable-X的使用"><a class="header-anchor" href="#Immutable-X的使用"> </a>Immutable X的使用</h1>
<h2 id="在Immutable-X集成ERC721"><a class="header-anchor" href="#在Immutable-X集成ERC721"> </a>在Immutable X集成ERC721</h2>
<p><strong>先决条件：</strong></p>
<ol>
<li>ERC721的部署：在layer1上部署继承了Immutable X的Mintable合约的ERC721。</li>
<li>合约注册：上文所述的合约要在Immutable X登记。</li>
<li>用户注册：用户使用前也需要先登记。目的是为了将layer1私钥与layer2私钥进行绑定。</li>
</ol>
<h3 id="ERC721的部署"><a class="header-anchor" href="#ERC721的部署"> </a>ERC721的部署</h3>
<p>在layer1上部署继承了Immutable X的Mintable合约的ERC721。确保IMX拥有铸币权。</p>
<p><strong>Mintable.sol</strong><br>
此合约内部提供了一个mintFor方法确保IMX拥有铸币权。token特性相关的代码需要实现_mintFor方法。</p>
<pre class="line-numbers language-none"><code class="language-none">modifier onlyIMX() &#123;
        require(msg.sender &#x3D;&#x3D; imx, &quot;Function can only be called by IMX&quot;);
        _;
    &#125;
​
    function mintFor(
        address user,
        uint256 quantity,
        bytes calldata mintingBlob
    ) external override onlyIMX &#123;
        require(quantity &#x3D;&#x3D; 1, &quot;Mintable: invalid quantity&quot;);
        (uint256 id, bytes memory blueprint) &#x3D; Minting.split(mintingBlob);
        _mintFor(user, id, blueprint);
        blueprints[id] &#x3D; blueprint;
        emit AssetMinted(user, id, blueprint);
    &#125;
​
    function _mintFor(
        address to,
        uint256 id,
        bytes memory blueprint
    ) internal virtual;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="合约注册"><a class="header-anchor" href="#合约注册"> </a>合约注册</h3>
<p>部署合约后，需要向 Immutable X 注册。<br>
目前只支持手动验证注册，后续项目方支持自动验证注册。<br>
将以下详细信息，<a href="https://support.immutable.com/hc/en-us/requests/new">在此处</a>提交给项目方后收到回执邮件。<br>
然后在<a href="https://api.x.immutable.com/v1/collections">https://api.x.immutable.com/v1/collections</a>可以查询到我们的合约。</p>
<pre class="line-numbers language-none"><code class="language-none">&#123;
  &quot;name&quot;: &quot;Collection Name (usually Partner Name)&quot;,
  &quot;description&quot;: &quot;Some Description of this collection&quot;,
  &quot;owner_public_key&quot;: &quot;&lt;CHANGE-ME&gt;&quot;,
  &quot;contract_address&quot;: &quot;&lt;CHANGE-ME&gt;&quot;,
  &quot;metadata_api_url&quot;: &quot;https:&#x2F;&#x2F;&lt;CHANGE-ME&gt;&quot;,
  &quot;icon_url&quot;: &quot;https:&#x2F;&#x2F;&lt;CHANGE-ME&gt;&quot;,
  &quot;collection_image_url&quot;: &quot;https:&#x2F;&#x2F;&lt;CHANGE-ME&gt;&quot;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="用户注册"><a class="header-anchor" href="#用户注册"> </a>用户注册</h3>
<p>将按照EIP-2645对用户的layer1和layer2的私钥进行绑定。<br>
<img src="https://files.readme.io/3bc4579-THLcqN4gMFQp.png" alt></p>
<h2 id="在Immutable-X使用"><a class="header-anchor" href="#在Immutable-X使用"> </a>在Immutable X使用</h2>
<h3 id="铸币"><a class="header-anchor" href="#铸币"> </a>铸币</h3>
<p><img src="https://files.readme.io/9b5debc-THLcqN4gMFQp_1.png" alt></p>
<ol>
<li>用户在layer2用对应的私钥发起铸币请求。</li>
<li>Immutable X Engine对签名、请求、状态等验证同步提交到layer2。</li>
<li>layer2最后根据状态转移进行零知识证明生成proof。</li>
<li>将证明结果提交给layer1。</li>
</ol>
<h3 id="资产存款"><a class="header-anchor" href="#资产存款"> </a>资产存款</h3>
<p>用户在layer1上发起存款请求，layer2接收到事件后，在layer2上进行铸造。<br>
<img src="https://files.readme.io/0048928-THLcqN4gMFQp_2.png" alt></p>
<ol>
<li>用户首先向API请求存款数据。</li>
<li>用户拿到存款数据后，将token存入layer1的存款合约。</li>
<li>存款合约发出事件后，Immutable X engine收到事件后在layer2上处理存款请求。</li>
<li>layer2生成proof提交到layer1。</li>
</ol>
<h3 id="资产提取"><a class="header-anchor" href="#资产提取"> </a>资产提取</h3>
<p>用户在layer2上发起提取请求。当确认后，用户可以在layer1上发起请求进行提款。<br>
<img src="https://files.readme.io/f18d111-THLcqN4gMFQp_3.png" alt></p>
<ol>
<li>用户首先向API请求提款数据。</li>
<li>用户拿到提款数据后发起提款。</li>
<li>当layer2协商一致后并且proof成功上链后，layer1用户会收到提款事件。</li>
<li>用户layer1发起提款，并收到资产。</li>
</ol>
<h3 id="资产交易"><a class="header-anchor" href="#资产交易"> </a>资产交易</h3>
<p>用户交易本身发生在layer2，无须与layer1交互。<br>
<img src="https://files.readme.io/6e913c7-THLcqN4gMFQp_4.png" alt></p>
<ol>
<li>用户首先向API请求卖单数据。</li>
<li>用户根据数据提交卖单。（此部分没有进行实质上的状态数据变化，所有无须与其他节点同步）</li>
<li>某用户确认认购后，Immutable Engine将卖单买单数据同步给其他节点。</li>
<li>生成proof提交到layer1。</li>
</ol>
<h1 id="参考资料"><a class="header-anchor" href="#参考资料"> </a>参考资料</h1>
<blockquote>
<p>Cairo合约开发文档 <a href="https://www.cairo-lang.org/">https://www.cairo-lang.org/</a><br>
immutable x 文档 <a href="https://docs.x.immutable.com/docs/">https://docs.x.immutable.com/docs/</a><br>
starknet <a href="https://starkware.co/starknet/">https://starkware.co/starknet/</a></p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>MEV 套利 flashbots</title>
    <url>/posts/c0c0fef6/</url>
    <content><![CDATA[<h1 id="三明治攻击案例分析"><a class="header-anchor" href="#三明治攻击案例分析"> </a>三明治攻击案例分析</h1>
<p><img src="/posts/c0c0fef6/mev-0.jpg" alt></p>
<h2 id="抢跑阶段"><a class="header-anchor" href="#抢跑阶段"> </a>抢跑阶段</h2>
<ol>
<li>Mev bot在uniswap-v2上卖出ETH买入NCR。</li>
<li>再将买入的NCR在uniswap-v3上卖出，买入USDC。引起USDC在uniswap-v3的NCR-USDC LP池中升值抬高了接下来受害者交易的成本。（其他池不受影响）</li>
</ol>
<p><img src="/posts/c0c0fef6/mev-1.png" alt><br>
<a href="https://etherscan.io/tx/0xc6d53c38434effa63fdf3b763759b1fa9699219af99c9e5efca53a8bbb44804a">https://etherscan.io/tx/0xc6d53c38434effa63fdf3b763759b1fa9699219af99c9e5efca53a8bbb44804a</a></p>
<h2 id="受害者行为"><a class="header-anchor" href="#受害者行为"> </a>受害者行为</h2>
<p>受害者在uniswap-v3用较高的成本上卖出大量NCR，买入USDC。</p>
<p><img src="/posts/c0c0fef6/mev-2.png" alt><br>
<a href="https://etherscan.io/tx/0x88d125526b4a1549108a508663104c643160a349876a576be64a3109dc082576">https://etherscan.io/tx/0x88d125526b4a1549108a508663104c643160a349876a576be64a3109dc082576</a></p>
<h2 id="尾随阶段"><a class="header-anchor" href="#尾随阶段"> </a>尾随阶段</h2>
<ol>
<li>Mev bot在uniswap-v3上卖出USDC买入NCR成功换出更多的NCR。</li>
<li>再将换出的NCR在uniswap-v2上卖出，换回WETH。</li>
</ol>
<p><img src="/posts/c0c0fef6/mev-3.png" alt><br>
<a href="https://etherscan.io/tx/0x0f66853c690105c5f3a080ce75d75a04a35bd4eb8618f7878ee7e0e3dd53ab82">https://etherscan.io/tx/0x0f66853c690105c5f3a080ce75d75a04a35bd4eb8618f7878ee7e0e3dd53ab82</a></p>
<h2 id="利益分析"><a class="header-anchor" href="#利益分析"> </a>利益分析</h2>
<p>用户损失\Mev Bot毛利润：0.099336744926763451 ether（$303.53）</p>
<p>Mev Bot净利润（去除矿工费）：0.001781203268032581 ether（$5.44）</p>
<p>矿工净利润（去除basefee）：0.08727896012374656 ether（$266.69）</p>
<p>燃烧费用：0.00978678484422912 ether（$29.9）</p>
<p>在此利益分配中，矿工通过套利交易手续费获取套利总额的97.46%</p>
<h2 id="uniswap公式"><a class="header-anchor" href="#uniswap公式"> </a>uniswap公式</h2>
<p><img src="/posts/c0c0fef6/mev-4.png" alt><br>
<img src="/posts/c0c0fef6/mev-5.png" alt></p>
<p>最后把<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mo>=</mo><mn>1</mn><mo>−</mo><mi>ρ</mi></mrow><annotation encoding="application/x-tex">\theta=1-\rho</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ρ</span></span></span></span>（对于uniswap是0.3%）代入公式:</p>
<p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">Δ</mi><mi>y</mi><mo>=</mo><mo stretchy="false">(</mo><mn>997</mn><mo separator="true">⋅</mo><mi mathvariant="normal">Δ</mi><mi>x</mi><mo separator="true">⋅</mo><mi>y</mi><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mo stretchy="false">(</mo><mn>997</mn><mo separator="true">⋅</mo><mi mathvariant="normal">Δ</mi><mi>x</mi><mo>+</mo><mn>1000</mn><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Delta{y}=(997·\Delta{x}·y)/(997·\Delta{x}+1000x)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">997</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal">x</span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mord">/</span><span class="mopen">(</span><span class="mord">997</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal">x</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1000</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span></p>
<p>公式符合UniswapV2Library的getAmountOut函数。</p>
<p><img src="/posts/c0c0fef6/mev-6.png" alt></p>
<h1 id="Flashbots-Auction"><a class="header-anchor" href="#Flashbots-Auction"> </a>Flashbots Auction</h1>
<p>Flashbots Auction提供私人交易池 + 密封投标区块空间拍卖机制，允许区块生产者无需信任地外包寻找最佳区块构建的工作。<br>
在常规的以太坊交易池中，用户将交易广播到公共点对点网络并指定一个燃料价格，该价格表明他们愿意为以太坊链上的每个计算单元支付多少。矿工收到这些交易，按gas价格排序，并使用贪心算法生成一个区块，试图通过交易费用获得最大价值。<br>
以下是该机制的关键问题：</p>
<ul>
<li>用户为了抢占套利机会，纷纷通过提高gas price，以便抢占第一个套利机会（只有第一笔套利能够成功），在短时间内使gas price巨幅提升，影响网络稳定。</li>
<li>只有一笔套利交易可以成功，其他的交易均失败，消耗区块链空间。</li>
<li>恶意用户为了抢占套利机会，这导致了诸如垃圾邮件之类的替代策略来增加获胜的可能性，从而进一步增加无谓损失。<br>
相反，Flashbots Auction基础设施使用第一价格密封投标拍卖，允许用户私下交流他们的投标和细化交易订单偏好，而无需为失败的投标付费。这种机制最大限度地提高了矿工的收益，同时为给定 MEV机会价值的价格发现提供了一个有效的场所。至关重要的是，这种机制消除了抢先漏洞。</li>
</ul>
<h2 id="技术架构"><a class="header-anchor" href="#技术架构"> </a>技术架构</h2>
<p><img src="/posts/c0c0fef6/mev-7.png" alt><br>
Flashbots Auction引入了一种新的eth_sendBundleRPC请求，它标准化了通信通道中的消息格式。此消息称为“Flashbots Bundle”。目的是将多笔交易顺序捆绑，竞拍后交由矿工出块。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">&#123;</span>
  <span class="token string-property property">"jsonrpc"</span><span class="token operator">:</span> <span class="token string">"2.0"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token string-property property">"method"</span><span class="token operator">:</span> <span class="token string">"eth_sendBundle"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"params"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
      txs<span class="token punctuation">,</span>               <span class="token comment">// Array[String], A list of signed transactions to execute in an atomic bundle</span>
      blockNumber<span class="token punctuation">,</span>       <span class="token comment">// String, a hex encoded block number for which this bundle is valid on</span>
      minTimestamp<span class="token punctuation">,</span>      <span class="token comment">// (Optional) Number, the minimum timestamp for which this bundle is valid, in seconds since the unix epoch</span>
      maxTimestamp<span class="token punctuation">,</span>      <span class="token comment">// (Optional) Number, the maximum timestamp for which this bundle is valid, in seconds since the unix epoch</span>
      revertingTxHashes<span class="token punctuation">,</span> <span class="token comment">// (Optional) Array[String], A list of tx hashes that are allowed to revert</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="搬砖套利"><a class="header-anchor" href="#搬砖套利"> </a>搬砖套利</h1>
<p>因为DEX各池子的价差，Mev Bot分析后在DEX之间搬砖套利。</p>
<h2 id="案例具体过程"><a class="header-anchor" href="#案例具体过程"> </a>案例具体过程</h2>
<ol>
<li>Mev Bot在sushiswap卖出7.38WETH，买入2698.66 RUNE。</li>
<li>随后再将买入的2698.66 RUNE在uniswap-v3卖出换成7.70个WETH完成套利。</li>
</ol>
<p><img src="/posts/c0c0fef6/mev-8.png" alt><br>
<a href="https://etherscan.io/tx/0xa8930ae6a17a679ea5abd4b7274dc27416be5d62379c848ade8779e876986f7b">https://etherscan.io/tx/0xa8930ae6a17a679ea5abd4b7274dc27416be5d62379c848ade8779e876986f7b</a></p>
<h2 id="利益分析-2"><a class="header-anchor" href="#利益分析-2"> </a>利益分析</h2>
<p>Mev Bot毛利润：0.329689032623411672 ether（$1021.11）</p>
<p>Mev Bot净利润：0.314207274249977546 ether（$973.16）</p>
<p>矿工利润：0.011232792714802698 ether（$34.79）</p>
<h1 id="简单的搬砖套利程序"><a class="header-anchor" href="#简单的搬砖套利程序"> </a>简单的搬砖套利程序</h1>
<p>Flashbot提供一个简单的套利工具，用于从两个DEX中相同的LP池套利。<br>
<a href="https://github.com/flashbots/simple-arbitrage">https://github.com/flashbots/simple-arbitrage</a></p>
<h2 id="具体流程"><a class="header-anchor" href="#具体流程"> </a>具体流程</h2>
<ol>
<li>获取两个DEX所有LP池的reserves数据。</li>
<li>计算两个DEX相同的LP池reserves的可套利空间。</li>
<li>构造交易调用链上部署好的FlashBotsMultiCall合约。</li>
<li>将交易构建完成，模拟交易，如果成功则构建simulate。</li>
<li>将simulate发送给flashbots。</li>
</ol>
<p><img src="/posts/c0c0fef6/mev-9.png" alt></p>
<h2 id="项目不足的地方"><a class="header-anchor" href="#项目不足的地方"> </a>项目不足的地方</h2>
<p>计算最佳收益使用二分搜索的方式，时间复杂度高，并且代码不完善、不精确。</p>
<p><img src="/posts/c0c0fef6/mev-10.png" alt></p>
<h2 id="改进"><a class="header-anchor" href="#改进"> </a>改进</h2>
<p>理论上交叉套利是存在一个最值的，我们可以通过uniswap的公式统一成一个交叉套利的公式，求出最值。此公式论文：<a href="https://arxiv.org/pdf/1911.03380.pdf">https://arxiv.org/pdf/1911.03380.pdf</a><br>
github上也有大神通过此论文改进了getBestCrossdMarket函数：<a href="https://github.com/jacksonConrad/better-simple-arbitrage">https://github.com/jacksonConrad/better-simple-arbitrage</a></p>
<p><img src="/posts/c0c0fef6/mev-11.png" alt></p>
<h3 id="输出结果"><a class="header-anchor" href="#输出结果"> </a>输出结果</h3>
<p><img src="/posts/c0c0fef6/mev-12.png" alt></p>
<h1 id="参考文献"><a class="header-anchor" href="#参考文献"> </a>参考文献</h1>
<blockquote>
<p><a href="https://www.cxyzjd.com/article/sanqima/109667469">https://www.cxyzjd.com/article/sanqima/109667469</a><br>
<a href="https://arxiv.org/pdf/1911.03380.pdf">https://arxiv.org/pdf/1911.03380.pdf</a><br>
<a href="https://docs.flashbots.net/flashbots-auction/overview">https://docs.flashbots.net/flashbots-auction/overview</a></p>
</blockquote>
]]></content>
      <categories>
        <category>区块链</category>
      </categories>
      <tags>
        <tag>MEV</tag>
        <tag>flashbots</tag>
        <tag>矿工可提取价值</tag>
      </tags>
  </entry>
  <entry>
    <title>MEV 矿工可提取价值分析</title>
    <url>/posts/60c92d46/</url>
    <content><![CDATA[<h1 id="什么是MEV"><a class="header-anchor" href="#什么是MEV"> </a>什么是MEV</h1>
<p><code>MEV</code>是矿工可提取价值（<code>Miner Extractable Value</code>）的缩写。由于区块链并没有要求矿工对交易打包顺序做出强制要求，矿工是可以自主选择对内存池中的待处理交易进行重新排序，由此矿工从用户那里获得了额外的利润，这部分利润价值就被称为<code>MEV</code>。</p>
<p><code>DeFi</code>的兴起。<code>MEV</code>价值呈指数增长。</p>
<p><img src="/posts/60c92d46/MEV%E4%BB%B7%E5%80%BC%E5%9B%BE2.png" alt><br>
浏览器链接：<a href="https://explore.flashbots.net/">https://explore.flashbots.net/</a></p>
<h1 id="存在的角色"><a class="header-anchor" href="#存在的角色"> </a>存在的角色</h1>
<h2 id="矿工"><a class="header-anchor" href="#矿工"> </a>矿工</h2>
<p>矿工是工作量证明机制的核心。矿工的工作任务是将用户发来的交易进行打包，并通过工作量证明提交到区块链上。</p>
<p>矿工可以在不影响交易原子正确的前提下对多笔交易进行排序、包含、剔除等操作。</p>
<p>通常来说，矿工为了寻求利润最大化会将<strong>待打包的交易</strong>交易按照<code>gas price</code>进行排序。然后将最前面的<code>N</code>笔交易进行打包入块。</p>
<p>当然出于某些场景需求，矿工也可以按照他们想要的交易顺序进行打包。比如矿池定制化交易加速功能、对异常地址进行风险控制等等。例如：<br>
<a href="https://pushtx.btc.com/">比特大陆交易加速服务</a></p>
<p><img src="/posts/60c92d46/memorypool2.png" alt></p>
<h2 id="套利机器人"><a class="header-anchor" href="#套利机器人"> </a>套利机器人</h2>
<p>虽然现在常用的说法是“矿工可提取价值”，但实际上大多数<code>MEV</code>行为是由第三方机器人，而非矿工，发起的。这些机器人通过提高支付给矿工的交易费来操纵区块中的交易排序。这意味着就算矿工仅按照<code>gas price</code>高低排序交易，也会出现<code>MEV</code>问题。然而，<code>MEV</code>还可以被视作是矿工可以提取的最大价值上限，因为矿工是最终决定区块中交易顺序的一方。</p>
<h1 id="如何套利"><a class="header-anchor" href="#如何套利"> </a>如何套利</h1>
<h2 id="有利的套利"><a class="header-anchor" href="#有利的套利"> </a>有利的套利</h2>
<p>如果套利发生在「世界状态」发生之后，套利机器人对市场变化作出的合理的反馈。那么这种套利即是合理的套利。</p>
<h3 id="搬砖套利-2"><a class="header-anchor" href="#搬砖套利-2"> </a>搬砖套利</h3>
<p>用户在交易平台进行了一笔大额交易导致价格下滑，产生了较大的套利空间。套利机器人进行套利交易，将市场价格套利至真实价格水平。此类型的提取<code>MEV</code>大多是发生在链上事务发生后，套利机器人对市场进行反应，不会损害原始交易者的利益。<br>
txid:<a href="https://etherscan.io/tx/0xb72689042f313adbffbe4d192b0febc4c8a8346b75a549d5b4d4795b37180488">0xb72689042f313adbffbe4d192b0febc4c8a8346b75a549d5b4d4795b37180488</a></p>
<h3 id="清算机器人套利"><a class="header-anchor" href="#清算机器人套利"> </a>清算机器人套利</h3>
<p>有些协议的运转需要依赖于<code>MEV</code>，比如对<code>Aave Protocol</code>、<code>MakerDAO</code>、<code>Compound</code>的清算。在<code>DeFi</code>抵押借贷协议中，当抵押物价值下降时，如果没有补足或者出售抵押资产，就会触发清算程序。清算人可以以低于市场价格3%-5%的折扣，获得如<code>ETH</code>这样的抵押资产，而这3%-5%的折扣价值，就是<code>MEV</code>。</p>
<h2 id="有害的套利"><a class="header-anchor" href="#有害的套利"> </a>有害的套利</h2>
<p>如果套利发生在「世界状态」改变之前，即机器人有预知「世界状态」改变的能力，那么这种操作会危害于区块链上的正常参与者。</p>
<h3 id="三明治攻击"><a class="header-anchor" href="#三明治攻击"> </a>三明治攻击</h3>
<p>试想下，如果我们有能力在大资金买卖交易前后各插入一笔交易（买在低点，卖在高点）岂不是是一个稳赚不赔的策略？</p>
<p>如图所示，套利机器人过程主要分以下4个阶段。</p>
<p><img src="/posts/60c92d46/DEX%E5%A5%97%E5%88%A9%E7%A4%BA%E6%84%8F%E5%9B%BE2.png" alt></p>
<ul>
<li>阶段一：用户创建大额买单交易并进行广播，此时交易在内存池中未打包入块。</li>
<li>阶段二：套利机器人从交易内存池中捕获到用户交易，计算交易可套利价值空间，构造两笔交易进行广播。一笔以高于用户<code>gas price</code>创建买单进行广播，另一笔以低于用户<code>gas price</code>创建一笔卖单。</li>
<li>阶段三：交易机器人买单先成交，随后用户交易成功打包入块，价格拉升。</li>
<li>阶段四：价格拉升后，交易机器人卖单成功打包入块，完成套利。</li>
</ul>
<p>矿工与套利机器人的收益来源是用户损失的部分。</p>
<h1 id="MEV对网络的危害"><a class="header-anchor" href="#MEV对网络的危害"> </a>MEV对网络的危害</h1>
<ul>
<li>
<p>拉高手续费：当<code>DeFi</code>各类资产价格发生波动，可套利的机会与利润空间也越来越多。机器人纷纷抬高<code>gas price</code>来争抢这笔利润，短时间使手续费价格巨增。</p>
</li>
<li>
<p>增加无效交易数量：<code>MEV</code>最终只会有一笔交易可以成功套利，其他的都会以失败告终。这些无效的交易也会像垃圾一样占用区块链的空间。</p>
</li>
<li>
<p>损害用户利益：套利机器人为了争抢套利机会，往往会抬高交易费，支付的交易费往往占套利所得收益的很大比例，而这些交易费最终直接落入了矿工的口袋。也就是说，虽然矿工没有亲自开展套利交易，但仍是这类<code>MEV</code>行为的最大受益者。</p>
</li>
<li>
<p>区块链频繁重组风险：对于矿工来说，如果<code>MEV</code>的价值远大于重组区块带来的损失。那么众多矿工都会尝试对不利于自己的区块进行重组。这导致的后果包括：交易确认时间变长，用户在平台的体验下降；增加了51%算力攻击的可能性。</p>
</li>
</ul>
<p><strong>MEV本质上是个零和游戏，损失的是链上用户，受益的是矿工和套利者。</strong></p>
<h1 id="缓解MEV重组风险"><a class="header-anchor" href="#缓解MEV重组风险"> </a>缓解MEV重组风险</h1>
<ul>
<li>额外的安全性激励：除了区块奖励之外(如<code>EIP-1559</code>提议销毁的<code>BaseFee</code>，或状态租金)，稳定的矿工收入来源是对协议安全的补充，并可以帮助缓解<code>MEV</code>问题。</li>
<li>最终确定性 (<code>Finality</code>)：工作量证明 (<code>PoW</code>) 只有概率上的最终确定性。而基于拜占庭容错的算法（<code>BFT</code>）更能保证最终确定性，并且仅仅重组单个被敲定的区块就需要程度更深的合谋，该算法使得时间盗贼攻击更加困难。然而，如果<code>MEV</code>的激励足够高，那么即使合谋的难度较高也值得尝试了。再者，参与者对于其提议的区块，仍然有权任意排序交易，因此仅凭最终确定性无法解决“一般”的抢跑交易问题。</li>
<li>权益证明 (<code>Proof-of-Stake</code>)：基于新一代<code>PoS</code>的区块链（<code>Casper FFG</code>、<code>Tendermint</code>）中，尝试重组的验证者会遭受罚没惩罚，因此使得时间盗贼攻击成本更高，尤其是与最终确定性结合时。然而，只要<code>MEV</code>的激励足够高，即使在罚没惩罚的警示下也可能会捕获<code>MEV</code>。</li>
</ul>
<p>以上方案在一定程度上缓解了矿工为了利益频繁重组区块带来的风险，但是对于套利机器人并无作用。</p>
<h2 id="项目与服务"><a class="header-anchor" href="#项目与服务"> </a>项目与服务</h2>
<ul>
<li><code>Flashbots</code>：是一家旨在降低由矿工可提取价值 (<code>MEV</code>) 对智能合约公链构成负外部性影响和存在风险的研发机构，该机构希望为智能合约公链打造一个无需许可、透明、公平的生态系统。（<code>mev-geth</code>和<code>mev-relay</code>）。他们的密封投标拍卖模型允许任何人通过贿赂提交交易，从而减轻以太坊网络的压力并减少矿工为最大化<code>MEV</code>所需的串通数量。对于同一笔套利只有一笔交易能够通过<code>mev-relay</code>下发给矿工，从而缓解了网络的拥堵以及手续费的水涨船高。但是并没有解决普通用户的三明治攻击问题。<br>
<img src="/posts/60c92d46/flashbots.png" alt></li>
<li><code>Taichi Network</code>：由目前以太坊算力第二大矿池星火矿池创立，用户可以通过太极网络提供的接口直接发送交易到星火矿池的隐私池。由于星火矿池并不对这笔交易进行网络公开发布，这笔被发送出去的交易在未被正式确认前，在<code>Etherscan</code>上无法看到该笔交易的状态。</li>
<li><code>bloXroute</code>：提供隐私通信功能，允许交易在不被暴露的情况下直接到达矿工手中。<code>bloXroute</code>的<code>BDN</code>（区块链分发网络）通过自己的网关软件将区块链节点与<code>BDN</code>链接，网关软件和区块链节点首先翻译从区块链进入<code>BDN</code>的信息。然后，在第二层，它会进行区块压缩。通过极大缩小区块大小，使其随后更高效地在区块链分发网络（<code>BDN</code>）中发送/传输。</li>
</ul>
<p>以上方案都在一定程度上解决了套利机器窥视内存池交易所带来的「抢跑」，但无法解决矿工本身套利的问题。</p>
<h1 id="如何使用技术手段来避免MEV"><a class="header-anchor" href="#如何使用技术手段来避免MEV"> </a>如何使用技术手段来避免MEV</h1>
<p>思路是：交易可以在<code>memory pool</code>存储池中加密，并在排序完成后解密。这样任何人在交易定序前都不知道交易的内部细节。</p>
<h2 id="可信式硬件（Trusted-Hardware）"><a class="header-anchor" href="#可信式硬件（Trusted-Hardware）"> </a>可信式硬件（Trusted Hardware）</h2>
<p><code>SGX</code>代表<code>Software Guard eXtensions</code>，这是一个提供硬件内存加密的指令集，其中特定的代码和数据被隔离在「飞地」中，它们可以在不暴露于外部代码的情况下运行。</p>
<p>它以如下流程运行:</p>
<ul>
<li>每个矿工都有一个<code>SGX</code>，他们有一个协议，用于共享只有在<code>SGX</code>中才能访问的加密密钥。</li>
<li>所有<code>p2p</code>内的交易都需要通过<code>SGX</code>内给定的公钥进行加密。</li>
<li><code>SGX</code>内部可以解密并验证交易的合法性，并构造一个<code>pending block</code>，并将<code>block hash</code>发送给外部用于<code>PoW</code>计算。</li>
<li>外部计算出<code>PoW</code>值后提交给<code>SGX</code>，<code>SGX</code>验证合法后将完整区块返还给外部进行广播。</li>
</ul>
<p>优点：可以不用修改现有协议，<code>SGX</code>可以作为一个选项，添加到现有协议中。<br>
缺点：虽然解决了交易内存池的可见性，抵挡了外部机器人对<code>memory pool</code>的窥视，但是对于矿工来说。如果<code>MEV</code>的价值远远大于报块可获得的奖励，矿工将在解密交易后重新<code>rehash</code>（非确定性共识下，例如<code>PoW</code>)。并且<code>SGX</code>依赖<code>intel</code>的指令集，并不能保证绝度安全。如果当利益足够大的情况下，某人通过<code>SGX</code>的漏洞找到私钥这个系统就不能运行了。</p>
<h2 id="基于时间锁加密（TimeLock-Encryption）"><a class="header-anchor" href="#基于时间锁加密（TimeLock-Encryption）"> </a>基于时间锁加密（TimeLock Encryption）</h2>
<p>代表：<code>STARKware’s Veedo</code><br>
将交易进行加密后到内存池中，由矿工将加密后的交易打包到区块链上（事务为执行），同时将私钥通过例如<code>VDF</code>（<a href="https://blog.priewienv.me/post/verifiable-delay-function-1/">可验证延迟函数</a>)等方式，交由矿工进行延迟解密。<code>N</code>个块后矿工成功解密，将解密后的交易和<code>Proof</code>提交到区块链上进行验证，此时事务将真正执行。</p>
<ul>
<li>所有的交易都需要加密，任何人都可以在<code>X</code>个计算周期后完成解密。</li>
<li>矿工将在加密交易上链后<code>N</code>区块开始解密，并在<code>N+X</code>区块后完成解密并提交到区块链上。</li>
<li>矿工必须在<code>N+Y（Y&gt;X）</code>个区块之前完成解密交易的上链，否则交易将失效。</li>
</ul>
<p>流程如下：</p>
<ul>
<li>
<p>用户将经过同态隐藏的信息（可能是<code>hash</code>）交给矿工进行打包。<br>
<img src="/posts/60c92d46/TimeLock1.png" alt></p>
</li>
<li>
<p>矿工成功将数据写入区块。<br>
<img src="/posts/60c92d46/TimeLock2.png" alt></p>
</li>
<li>
<p>矿工对<code>VDF</code>进行解密（<code>VDF</code>保证在<code>N</code>个块之后才能解开），同时产生新的区块。<br>
<img src="/posts/60c92d46/TimeLock3.png" alt></p>
</li>
<li>
<p><code>N</code>个块后，矿工解开交易生成解密后的交易和一个<code>Proof</code>，合约验证<code>Proof</code>的合法性再将解密后的数据写入区块链。<br>
<img src="/posts/60c92d46/TimeLock4.png" alt></p>
</li>
</ul>
<p><strong>缺点：</strong> 所有的交易都得过这套系统，不能作为一个选项。并且交易有延迟对用户体验不好。有一个风险是当加密的交易不能及时上链，交易被解密。<br>
<strong>优点：</strong> 对共识时间影响较小。矿工不需要花费额外的精力去处理交易解密本身。</p>
<h2 id="门限密码系统-Threshshold-Encryption"><a class="header-anchor" href="#门限密码系统-Threshshold-Encryption"> </a>门限密码系统 Threshshold Encryption</h2>
<p>代表：<code>ChainLink FSS</code><br>
一种门限密码系统，该领域的基础门限密码学，是密码系统通过对信息进行加密并将其分发到容错计算机群集中来保护信息。该消息使用公钥，并且对应的私钥是共享参与方之间。使用阈值密码系统时，为了解密加密的消息或对消息进行签名，必须有多个参与方（超过某个阈值编号）进行解密或签名协议。</p>
<p>在<code>Tendermint</code>中，事务的执行在链上包含区块之后在块中进行。<br>
每个验证器都有一份<code>BLS</code>门限解密密钥。任何2/3验证器可以使用这个密钥去解密一部分交易数据。<br>
通过验证程序对<code>Tendermint</code>投票的时候必须包含对应部分解密数据的份额，交易的解密与共识最终状态的生成是同步进行的，即在没有最终确定块的情况下无法解密交易；如果交易不可解密，则无法最终确定块。</p>
<p><strong>缺点：</strong> 在<code>mempool</code>中，为了支付解密手续费，有些数据无法加密。这里需要知道哪个帐户发送的交易，从而泄漏可以用作<code>MEV</code>边缘的信息。通过使用零知识证明使数据链上隐私，隐藏手续费的资金来源。必须使用泛拜占庭容错作为共识算法。</p>
<h1 id="探索"><a class="header-anchor" href="#探索"> </a>探索</h1>
<h2 id="同态加密"><a class="header-anchor" href="#同态加密"> </a>同态加密</h2>
<p>同态加密体系大致上被分为四类：部分同态、近似同态加密、有限级数全同态与完全同态。</p>
<ul>
<li>加法同态：<code>E(X)+E(Y) = E(X+Y)</code></li>
<li>乘法同态：<code>E(X)E(Y) = E(XY)</code></li>
</ul>
<p>满足上述两个公式的特性是全同态，满足期中之一就是半同态。</p>
<p>通俗来说，<strong>对原文的逻辑运算等于对密文的逻辑运算的解密</strong>。理论上所有的算术运算都可以归纳为加法和乘法。</p>
<h2 id="零知识证明"><a class="header-anchor" href="#零知识证明"> </a>零知识证明</h2>
<p>定义：</p>
<ul>
<li><code>Succinct</code>：简洁，证明的数据量比较小。</li>
<li><code>Non-interactive</code>：非交互，没有或者只有很少交互。</li>
<li><code>ARguments</code>：论证，讨论这些证明的一种形式主义，因为有一些花哨的密码学和非确定性并不能完全构成传统意义上的这些“形式证明”。</li>
<li><code>Knowledge</code>：知识，对于证明者来说在不知道证据（<code>witness</code>，比如一个哈希函数的输入或者一个确定<code>Merkle-tree</code>节点的路径）的情况下，构造出一组参数和证明是不可能的。<br>
零知识证明的目标是让验证者相信证明者拥有某个秘密(<code>withness</code>)，满足某种关系，而无需向验证者或其他任何人透露秘密本身。</li>
</ul>
<h2 id="零知识证明与dApp"><a class="header-anchor" href="#零知识证明与dApp"> </a>零知识证明与dApp</h2>
<p>在现有的基于零知识证明的区块链系统，一般有如下角色：证明者（<code>Prover</code>）和验证者（<code>Verifier</code>）<br>
运用零知识证明系统我们可以轻松的用算术电路构建<code>dApp</code>（例如在：<code>starkware</code>、<code>aleo</code>上开发<code>dApp</code>），用户执行<code>dApp</code>，会生成<code>Output</code>和<code>Proof</code>。验证者不需要对交易本身进行<code>re-execution</code>（重放式验证），取而代之的是通过验证生成的<code>Proof</code>的正确性（<code>Proof</code>非常简洁，验证十分快速），即可保证<code>Output</code>的正确性（一定是按照<code>dApp</code>逻辑运行的）又可使验证复杂度与代码复杂度解藕。随后将<code>Output</code>提交到链上，逻辑代码处理链下化，链上只需要做状态数据通过<code>Verifier</code>检验后进行更改。极大的提升了链上处理数据的能力。</p>
<p>至此在理想情况下，我们可以使用零知识证明构建的<code>dApp</code>部署在服务器上。使用同态加密将私密数据进行加密，并在<code>dApp</code>中进行同态加密运算。将结果数据存储在区块链或链下的<code>DHT</code>中。<br>
注：当不使用第三方<code>Prover</code>甚至不需要同态加密来做计算。<code>Proof</code>本身已经相当于隐私过了。<br>
<img src="/posts/60c92d46/aexe.png" alt></p>
<h1 id="参考文献-2"><a class="header-anchor" href="#参考文献-2"> </a>参考文献</h1>
<blockquote>
<p><a href="https://www.zvstus.com/article/news/1/75d87ffffe84382c25d6d2d1c0f50000.html">https://www.zvstus.com/article/news/1/75d87ffffe84382c25d6d2d1c0f50000.html</a><br>
<a href="https://www.youtube.com/watch?v=Hnw_tMGNx3A">https://www.youtube.com/watch?v=Hnw_tMGNx3A</a><br>
<a href="https://docs.google.com/presentation/d/1tQEUpZjy_U9J-VQAx1Wf5W9oOX5rrCY3AwjAb7ZgA68/edit#slide=id.p">https://docs.google.com/presentation/d/1tQEUpZjy_U9J-VQAx1Wf5W9oOX5rrCY3AwjAb7ZgA68/edit#slide=id.p</a><br>
<a href="https://www.bilibili.com/video/BV1Ti4y1L7Ur">https://www.bilibili.com/video/BV1Ti4y1L7Ur</a><br>
<a href="https://medium.com/starkware/presenting-veedo-e4bbff77c7ae">https://medium.com/starkware/presenting-veedo-e4bbff77c7ae</a><br>
<a href="https://wanyvic.cn/posts/a5f2eb4">https://wanyvic.cn/posts/a5f2eb4</a><br>
<a href="https://github.com/flashbots/pm">https://github.com/flashbots/pm</a><br>
<a href="https://reading.supply/@whyrusleeping/a-vdf-explainer-5S6Ect">https://reading.supply/@whyrusleeping/a-vdf-explainer-5S6Ect</a><br>
<a href="https://www.onlyalt.com/blog/mev-miner-extractable-value">https://www.onlyalt.com/blog/mev-miner-extractable-value</a><br>
<a href="https://www.youtube.com/watch?v=o08E4gx9TqA">https://www.youtube.com/watch?v=o08E4gx9TqA</a></p>
</blockquote>
]]></content>
      <categories>
        <category>区块链</category>
      </categories>
      <tags>
        <tag>MEV</tag>
        <tag>矿工可提取价值</tag>
        <tag>零知识证明</tag>
      </tags>
  </entry>
  <entry>
    <title>MacOS M1 编译 Qv2ray + Trojan-go + QT6</title>
    <url>/posts/aa6d79f4/</url>
    <content><![CDATA[<p>本文撰写时间为2023/01/19 参考wicast C的文章（链接：<a href="https://wicast.medium.com/-531cd9ed9ea">https://wicast.medium.com/-531cd9ed9ea</a>）在此基础上使用macdeployqt进行打包</p>
<h1 id="不使用brew-安装qt6"><a class="header-anchor" href="#不使用brew-安装qt6"> </a>不使用brew 安装qt6</h1>
<p>brew 安装的qt6 在使用macdeployqt会有类似如下错误导致，qv2ray无法正常打包framework</p>
<pre class="line-numbers language-none"><code class="language-none">ERROR: Cannot resolve rpath &quot;@rpath&#x2F;QtGui.framework&#x2F;Versions&#x2F;A&#x2F;QtGui&quot;
ERROR:  using QList(&quot;&#x2F;Users&#x2F;wany&#x2F;Qv2ray&#x2F;build3&#x2F;lib&quot;)
ERROR: Cannot resolve rpath &quot;@rpath&#x2F;QtCore.framework&#x2F;Versions&#x2F;A&#x2F;QtCore&quot;
ERROR:  using QList(&quot;&#x2F;Users&#x2F;wany&#x2F;Qv2ray&#x2F;build3&#x2F;lib&quot;)
ERROR: Cannot resolve rpath &quot;@rpath&#x2F;QtWidgets.framework&#x2F;Versions&#x2F;A&#x2F;QtWidgets&quot;
ERROR:  using QList(&quot;&#x2F;Users&#x2F;wany&#x2F;Qv2ray&#x2F;build3&#x2F;lib&quot;)
ERROR: Cannot resolve rpath &quot;@rpath&#x2F;QtGui.framework&#x2F;Versions&#x2F;A&#x2F;QtGui&quot;
ERROR:  using QList(&quot;&#x2F;Users&#x2F;wany&#x2F;Qv2ray&#x2F;build3&#x2F;lib&quot;)
ERROR: Cannot resolve rpath &quot;@rpath&#x2F;QtCore.framework&#x2F;Versions&#x2F;A&#x2F;QtCore&quot;
ERROR:  using QList(&quot;&#x2F;Users&#x2F;wany&#x2F;Qv2ray&#x2F;build3&#x2F;lib&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="卸载qt6"><a class="header-anchor" href="#卸载qt6"> </a>卸载qt6</h2>
<pre class="line-numbers language-none"><code class="language-none">brew remove qt@6<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="使用qt-io官方安装器安装"><a class="header-anchor" href="#使用qt-io官方安装器安装"> </a>使用qt.io官方安装器安装</h2>
<p><a href="https://www.qt.io/download-qt-installer">https://www.qt.io/download-qt-installer</a></p>
<p>可能需要注册账号</p>
<p>参考：<a href="https://blog.csdn.net/ilovejujube/article/details/128035916">https://blog.csdn.net/ilovejujube/article/details/128035916</a></p>
<h1 id="安装依赖"><a class="header-anchor" href="#安装依赖"> </a>安装依赖</h1>
<pre class="line-numbers language-none"><code class="language-none">brew install go grpc cmake v2ray openssl<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="编译-Qv2ray"><a class="header-anchor" href="#编译-Qv2ray"> </a>编译 Qv2ray</h1>
<h1 id="编译-3"><a class="header-anchor" href="#编译-3"> </a>编译</h1>
<p>注意替换<code>CMAKE_PREFIX_PATH</code>为自己的Qt路径</p>
<pre class="line-numbers language-none"><code class="language-none">git clone https:&#x2F;&#x2F;github.com&#x2F;Qv2ray&#x2F;Qv2ray -b dev
cd Qv2ray
mkdir build
cd build
cmake -DQV2RAY_QT6&#x3D;ON -DQV2RAY_USE_V5_CORE&#x3D;OFF -DCMAKE_BUILD_TYPE&#x3D;Release -DQV2RAY_AUTO_DEPLOY&#x3D;ON -DCMAKE_PREFIX_PATH&#x3D;&#x2F;Users&#x2F;wany&#x2F;Qt&#x2F;6.4.2&#x2F;macos -DOPENSSL_ROOT_DIR&#x3D;&#x2F;opt&#x2F;homebrew&#x2F;Cellar&#x2F;openssl@3&#x2F;3.0.7 ..
make -j16<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="运行-2"><a class="header-anchor" href="#运行-2"> </a>运行</h2>
<pre class="line-numbers language-none"><code class="language-none">open qv2ray.app<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="编译-QvPlugin-Trojan-Go"><a class="header-anchor" href="#编译-QvPlugin-Trojan-Go"> </a>编译 QvPlugin-Trojan-Go</h1>
<p>注意替换<code>CMAKE_PREFIX_PATH</code>为自己的Qt路径</p>
<pre class="line-numbers language-none"><code class="language-none">git clone https:&#x2F;&#x2F;github.com&#x2F;Qv2ray&#x2F;QvPlugin-Trojan-Go -b dev
cd QvPlugin-Trojan-Go
mkdir build
cd build
# 要让插件用 QT6
cmake -DQVPLUGIN_USE_QT6&#x3D;ON -DCMAKE_PREFIX_PATH&#x3D;&#x2F;Users&#x2F;wany&#x2F;Qt&#x2F;6.4.2&#x2F;macos -DCMAKE_BUILD_TYPE&#x3D;Release ..
make -j16<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
  </entry>
  <entry>
    <title>MetaProofs</title>
    <url>/posts/ce18c401/</url>
    <content><![CDATA[<h1 id="引言"><a class="header-anchor" href="#引言"> </a>引言</h1>
<p>现如今的智能合约虚拟机是一种对称式的虚拟机。即：<code>Ф(s)-&gt;s'</code>。其中<code>s</code>是原状态，<code>Ф</code>是状态转移函数，<code>s'</code>是经过计算后的新状态。由上公式可以得出，全节点验证状态转移的合法性过程需要执行一次相同的计算<code>Ф(s)-&gt;s'</code>验证<code>s'</code>是否与链上结果一致。<code>Ф</code>相当于合约代码。如果<code>Ф</code>逻辑较为复杂，这无疑增加的了全节点的性能负担，导致出块时间不平衡的等系统性风险。以太坊通过<code>gas limit</code>和<code>block gas limits</code>限制计算量保证全节点都可以在规定的时间范围内计算出数据结果。但这样同时也限制了<code>Ф</code>的复杂度，合约不能执行复杂的逻辑代码。</p>
<h1 id="MetaProofs"><a class="header-anchor" href="#MetaProofs"> </a>MetaProofs</h1>
<p>为此根据论文<a href="https://eprint.iacr.org/2012/495.pdf">“METAPROOFS”</a>。一种新的理论证明方式引起广泛的讨论。</p>
<p><code>MetaProofs</code>基于零知识证明，大致原理会生成一个证明<code>(Prover)</code>结果<code>µP</code>证明<code>s</code>通过<code>Ф</code>函数计算出<code>s'</code>。验证<code>(Verifier)</code>的时候只需要将这四个参数传入验证函数中，得到结果为<code>true</code>则可以表示状态转移是合法的。详细步骤如下图所示。<br>
<img src="/posts/ce18c401/metaproofs.png" alt></p>
<p><code>MetaProofs</code>是一个证明<code>Prover</code>复杂度高，但<code>Verifier</code>快的函数。并且验证与<code>Ф</code>函数本身的复杂度无关。<br>
因此将<code>MetaProofs</code>引入区块链，链下<code>Prover</code>生成，链上<code>Verifier</code>。既可以使智能合约处理更复杂的逻辑代码，又可以降低全节点的计算负载。不仅如此<code>MetaProofs</code>也可以生成单个链的证明，从而对分片和layer2有更好性能提升。</p>
<p><strong>注：</strong> 此处因作者水平有限，如有理解偏差。欢迎讨论告知。</p>
<h1 id="相关的语言"><a class="header-anchor" href="#相关的语言"> </a>相关的语言</h1>
<h2 id="Lurk"><a class="header-anchor" href="#Lurk"> </a>Lurk</h2>
<p>Lurk 是一种用于图灵完备递归 SNARK 的开发中的编程语言：</p>
<ul>
<li><a href="https://github.com/lurk-lang/root">https://github.com/lurk-lang/root</a></li>
</ul>
<h2 id="yatima"><a class="header-anchor" href="#yatima"> </a>yatima</h2>
<p>yatima 是一个去中心化网络的编程语言</p>
<ul>
<li><a href="https://github.com/yatima-inc/yatima">https://github.com/yatima-inc/yatima</a></li>
</ul>
<h1 id="参考文献-3"><a class="header-anchor" href="#参考文献-3"> </a>参考文献</h1>
<blockquote>
<p><a href="https://eprint.iacr.org/2012/495.pdf">https://eprint.iacr.org/2012/495.pdf</a><br>
<a href="https://www.youtube.com/watch?v=iQkedSqQH34">https://www.youtube.com/watch?v=iQkedSqQH34</a></p>
</blockquote>
]]></content>
      <categories>
        <category>区块链</category>
      </categories>
      <tags>
        <tag>filecoin</tag>
        <tag>Lurk</tag>
        <tag>MetaProofs</tag>
      </tags>
  </entry>
  <entry>
    <title>Rust笔记(一) 安装</title>
    <url>/posts/6af9b2cc/</url>
    <content><![CDATA[<h1 id="安装-2"><a class="header-anchor" href="#安装-2"> </a>安装</h1>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> --proto <span class="token string">'=https'</span> --tlsv1.2 -sSf https://sh.rustup.rs <span class="token operator">|</span> <span class="token function">sh</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="更新"><a class="header-anchor" href="#更新"> </a>更新</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">rustup update<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="卸载"><a class="header-anchor" href="#卸载"> </a>卸载</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">rustup self uninstall<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="编译-4"><a class="header-anchor" href="#编译-4"> </a>编译</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">rustc xxx.rs<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="命名规范"><a class="header-anchor" href="#命名规范"> </a>命名规范</h2>
<p><code>snake_case</code>: 文件名<br>
<code>CamelCase</code>:</p>
<h1 id="Cargo"><a class="header-anchor" href="#Cargo"> </a>Cargo</h1>
<p>cargo 是rust的构建系统和包管理工具。</p>
<h2 id="创建项目"><a class="header-anchor" href="#创建项目"> </a>创建项目</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cargo new xxx <span class="token comment"># 创建二进制项目</span>
cargo new xxx --lib <span class="token comment"># 创建库项目</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="安装依赖-2"><a class="header-anchor" href="#安装依赖-2"> </a>安装依赖</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cargo <span class="token function">install</span> xxxx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="编译-5"><a class="header-anchor" href="#编译-5"> </a>编译</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cargo build
cargo build --release<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="运行-3"><a class="header-anchor" href="#运行-3"> </a>运行</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cargo run<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="tests"><a class="header-anchor" href="#tests"> </a>tests</h2>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cargo <span class="token builtin class-name">test</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="检查"><a class="header-anchor" href="#检查"> </a>检查</h2>
<p>检查代码，<code>cargo check</code>比<code>cargo build</code>运行时间快的多</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cargo check<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="panic-中断"><a class="header-anchor" href="#panic-中断"> </a>panic 中断</h3>
<p><code>Cargo.toml</code></p>
<pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">profile.release</span><span class="token punctuation">]</span>
<span class="token key property">panic</span> <span class="token punctuation">=</span> <span class="token string">'abort'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="使用外部package"><a class="header-anchor" href="#使用外部package"> </a>使用外部package</h2>
<p>在 Cargo.toml的<br>
<code>[dependencies]</code> 添加package</p>
<h2 id="cargo-换源"><a class="header-anchor" href="#cargo-换源"> </a>cargo 换源</h2>
<p><code>.cargo/config</code></p>
<pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">source.crates-io</span><span class="token punctuation">]</span>
<span class="token key property">registry</span> <span class="token punctuation">=</span> <span class="token string">"https://github.com/rust-lang/crates.io-index"</span>

<span class="token key property">replace-with</span> <span class="token punctuation">=</span> <span class="token string">'tuna'</span>
<span class="token punctuation">[</span><span class="token table class-name">source.tuna</span><span class="token punctuation">]</span>
<span class="token key property">registry</span> <span class="token punctuation">=</span> <span class="token string">"https://mirrors.tuna.tsinghua.edu.cn/git/crates.io-index.git"</span>

<span class="token punctuation">[</span><span class="token table class-name">net</span><span class="token punctuation">]</span>
<span class="token key property">git-fetch-with-cli</span> <span class="token punctuation">=</span> <span class="token boolean">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>rust</category>
      </categories>
      <tags>
        <tag>rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rust笔记(七) 枚举</title>
    <url>/posts/274a678a/</url>
    <content><![CDATA[<h1 id="枚举定义和使用"><a class="header-anchor" href="#枚举定义和使用"> </a>枚举定义和使用</h1>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">enum</span> <span class="token type-definition class-name">IpAddrKind</span> <span class="token punctuation">&#123;</span>
    <span class="token constant">V4</span><span class="token punctuation">,</span>
    <span class="token constant">V6</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> four <span class="token operator">=</span> <span class="token class-name">IpAddrKind</span><span class="token punctuation">::</span><span class="token constant">V4</span><span class="token punctuation">;</span> <span class="token comment">// 枚举值</span>
<span class="token keyword">let</span> six <span class="token operator">=</span> <span class="token class-name">IpAddrKind</span><span class="token punctuation">::</span><span class="token constant">V6</span><span class="token punctuation">;</span> <span class="token comment">// 枚举值</span>

<span class="token comment">// enum 附带数据</span>
<span class="token keyword">enum</span> <span class="token type-definition class-name">IpAddr</span> <span class="token punctuation">&#123;</span>
    <span class="token constant">V4</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token constant">V6</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> four <span class="token operator">=</span> <span class="token class-name">IpAddrKind</span><span class="token punctuation">::</span><span class="token constant">V4</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> six <span class="token operator">=</span> <span class="token class-name">IpAddrKind</span><span class="token punctuation">::</span><span class="token constant">V6</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"::1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 实现枚举方法（与struct 类似）</span>
<span class="token keyword">impl</span> <span class="token class-name">IpAddr</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="Opthion枚举"><a class="header-anchor" href="#Opthion枚举"> </a>Opthion枚举</h1>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// 预导入库中定义了结构</span>
<span class="token keyword">enum</span> <span class="token type-definition class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">None</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="模式匹配"><a class="header-anchor" href="#模式匹配"> </a>模式匹配</h1>
<ul>
<li>refutable 可反驳模式</li>
<li>irrefutable 不可反驳模式</li>
</ul>
<h2 id="match-匹配"><a class="header-anchor" href="#match-匹配"> </a>match 匹配</h2>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> some_number <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> some_string <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">"string"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> undefined_number<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token class-name">None</span><span class="token punctuation">;</span>
<span class="token comment">// 必须穷举所有可能</span>
<span class="token keyword">match</span> some_number <span class="token punctuation">&#123;</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> s <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Some</span><span class="token punctuation">(</span>s <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token class-name">None</span> <span class="token operator">=></span> <span class="token class-name">None</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">// - => () 通配符</span>
<span class="token keyword">match</span> some_number <span class="token punctuation">&#123;</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"3 or 5"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>
    _ <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"None"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="if-let-匹配"><a class="header-anchor" href="#if-let-匹配"> </a>if let 匹配</h2>
<p>if let [类型] = [变量] { }</p>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> some_number <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> some_number <span class="token punctuation">&#123;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=</span> some_number <span class="token punctuation">&#123;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"None"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>rust</category>
      </categories>
      <tags>
        <tag>rust</tag>
        <tag>enum</tag>
        <tag>枚举</tag>
      </tags>
  </entry>
  <entry>
    <title>Rust笔记(三) 函数</title>
    <url>/posts/a0f35e48/</url>
    <content><![CDATA[<h1 id="函数"><a class="header-anchor" href="#函数"> </a>函数</h1>
<p>函数名使用蛇形命名法<code>snake case</code></p>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">add_four</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"result:&#123;&#125;"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// parameter 形参 argument 实参</span>
<span class="token comment">// add_four 蛇形命名法</span>
<span class="token keyword">fn</span> <span class="token function-definition function">add_four</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        x <span class="token operator">+</span> <span class="token number">3</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    y <span class="token comment">// return y; 可以使用return y; 也可以直接使用表达式返回</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="表达式与语句区别"><a class="header-anchor" href="#表达式与语句区别"> </a>表达式与语句区别</h1>
<ul>
<li>语句（statement）执行操作但不返回值的命令。</li>
<li>表达式（expression）会进行计算并返回一个结果的指令。</li>
</ul>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// 语句:</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token comment">// 表达式:</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        x <span class="token operator">+</span> <span class="token number">3</span>    <span class="token comment">// 无分号。返回最后一个表达式的结果</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>rust</category>
      </categories>
      <tags>
        <tag>rust</tag>
        <tag>function</tag>
        <tag>函数</tag>
      </tags>
  </entry>
  <entry>
    <title>Rust笔记(九) 错误处理</title>
    <url>/posts/b9e41b5c/</url>
    <content><![CDATA[<h1 id="不可恢复错误-panic"><a class="header-anchor" href="#不可恢复错误-panic"> </a>不可恢复错误: panic</h1>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">"str"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="可恢复错误-Result-T-E"><a class="header-anchor" href="#可恢复错误-Result-T-E"> </a>可恢复错误: Result&lt;T,E&gt;</h1>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// 定义在标准库</span>
<span class="token comment">// enum Result&lt;T,E> &#123;</span>
<span class="token comment">//     Ok(T),</span>
<span class="token comment">//     Err(E),</span>
<span class="token comment">// &#125;</span>
<span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token keyword">match</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"a.txt"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token operator">=></span> file<span class="token punctuation">,</span>
    <span class="token class-name">Err</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">match</span> error<span class="token punctuation">.</span><span class="token function">kind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">ErrorKind</span><span class="token punctuation">::</span><span class="token class-name">NotFound</span> <span class="token operator">=></span> <span class="token keyword">match</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"a.txt"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Ok</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token operator">=></span> file<span class="token punctuation">,</span>
            <span class="token class-name">Err</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        s <span class="token operator">=></span> <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">// 闭包简写</span>
<span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"a.txt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap_or_else</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>error<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> error<span class="token punctuation">.</span><span class="token function">kind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">ErrorKind</span><span class="token punctuation">::</span><span class="token class-name">NotFound</span> <span class="token punctuation">&#123;</span>
        <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"a.txt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap_or_else</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>error<span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// unwrap()</span>
<span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"a.txt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 如果能打开则返回Ok(x)内的值,如果出错则调用panic</span>

<span class="token comment">// expect() 与unwrap() 一样但可以附加错误信息</span>
<span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"a.txt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"无法打开"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="传播错误"><a class="header-anchor" href="#传播错误"> </a>传播错误</h1>
<p>返回值使用<code>Result&lt;T,E&gt;</code>来传播错误</p>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// ? 只能用返回值类型Result的函数</span>
<span class="token comment">// ? 如果执行失败则return Error</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Read</span><span class="token punctuation">;</span>
<span class="token keyword">fn</span> <span class="token function-definition function">read_string_from_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"a.txt"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>rust</category>
      </categories>
      <tags>
        <tag>rust</tag>
        <tag>错误处理</tag>
      </tags>
  </entry>
  <entry>
    <title>Rust笔记(二) 数据类型</title>
    <url>/posts/1637e2fc/</url>
    <content><![CDATA[<h1 id="变量的可变性"><a class="header-anchor" href="#变量的可变性"> </a>变量的可变性</h1>
<p>可变变量需要加上<code>mut</code>关键字</p>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// cannot assign twice to immutable variable `a`</span>

<span class="token keyword">let</span> <span class="token keyword">mut</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// ok!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="常量"><a class="header-anchor" href="#常量"> </a>常量</h1>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">const</span> <span class="token constant">MAX</span><span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="隐藏"><a class="header-anchor" href="#隐藏"> </a>隐藏</h1>
<p>隐藏（shadow）</p>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h1 id="标量类型-scalar-type"><a class="header-anchor" href="#标量类型-scalar-type"> </a>标量类型(scalar type)</h1>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> u1<span class="token punctuation">:</span> <span class="token keyword">u8</span> <span class="token operator">=</span> <span class="token char">b'A'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> u2<span class="token punctuation">:</span> <span class="token keyword">u16</span> <span class="token operator">=</span> <span class="token number">0xff</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> u3<span class="token punctuation">:</span> <span class="token keyword">u32</span> <span class="token operator">=</span> <span class="token number">0o77</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> u4<span class="token punctuation">:</span> <span class="token keyword">u64</span> <span class="token operator">=</span> <span class="token number">232_212</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> u5<span class="token punctuation">:</span> <span class="token keyword">u128</span> <span class="token operator">=</span> <span class="token number">232_212</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> i1<span class="token punctuation">:</span> <span class="token keyword">i8</span> <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> i2<span class="token punctuation">:</span> <span class="token keyword">i16</span> <span class="token operator">=</span> <span class="token number">254</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> i3<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">254</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> i4<span class="token punctuation">:</span> <span class="token keyword">i64</span> <span class="token operator">=</span> <span class="token number">254</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> i5<span class="token punctuation">:</span> <span class="token keyword">i128</span> <span class="token operator">=</span> <span class="token number">254</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> f1<span class="token punctuation">:</span> <span class="token keyword">f32</span> <span class="token operator">=</span> <span class="token number">254.0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> f2<span class="token punctuation">:</span> <span class="token keyword">f64</span> <span class="token operator">=</span> <span class="token number">254.0</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> b<span class="token punctuation">:</span> <span class="token keyword">bool</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> c1<span class="token punctuation">:</span> <span class="token keyword">char</span> <span class="token operator">=</span> <span class="token char">'我'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> c2<span class="token punctuation">:</span> <span class="token keyword">char</span> <span class="token operator">=</span> '😂'<span class="token punctuation">;</span>

<span class="token comment">// 默认值为i32和f64</span>
<span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">254</span><span class="token punctuation">;</span> <span class="token comment">// let i: i32 = 254;</span>
<span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token number">254.0</span><span class="token punctuation">;</span> <span class="token comment">// let f: f64 = 254.0;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>debug模式下会检测溢出，代码触发panic，release模式下不会检测溢出，会执行二进制补码“环绕”。</p>
<h1 id="复合类型-compound-type"><a class="header-anchor" href="#复合类型-compound-type"> </a>复合类型(compound type)</h1>
<h2 id="元组-tuple"><a class="header-anchor" href="#元组-tuple"> </a>元组(tuple)</h2>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">u8</span><span class="token punctuation">,</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">240</span><span class="token punctuation">,</span> <span class="token number">3.2</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> t2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">240</span><span class="token punctuation">,</span> <span class="token number">3.2</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;,&#123;&#125;,&#123;&#125;"</span><span class="token punctuation">,</span> t<span class="token number">.0</span><span class="token punctuation">,</span> t<span class="token number">.1</span><span class="token punctuation">,</span> t<span class="token number">.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="数组-array"><a class="header-anchor" href="#数组-array"> </a>数组(array)</h2>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [elem, len] 表示: 5个7</span>
<span class="token keyword">let</span> arr1<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;,&#123;&#125;"</span><span class="token punctuation">,</span> arr<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> arr2<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> arr2<span class="token punctuation">[</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 访问越界 thread 'main' panicked at 'index out of bounds: the len is 4 but the index is 7', src/main.rs:21:20</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>rust</category>
      </categories>
      <tags>
        <tag>rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rust笔记(五) 所有权</title>
    <url>/posts/b1e3a0f/</url>
    <content><![CDATA[<h1 id="所有权规则"><a class="header-anchor" href="#所有权规则"> </a>所有权规则</h1>
<ul>
<li>Rust中每一个值都有一个对应的变量作为它的所有者</li>
<li>在同一时间内，值有且仅有一个所有者</li>
<li>当所有者离开自己的作用域时，它持有的值就会被释放掉</li>
</ul>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">" world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> s2 <span class="token operator">=</span> s<span class="token punctuation">;</span> <span class="token comment">// 所有权转移</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//error: borrow of moved value: `s`</span>

<span class="token keyword">let</span> s2 <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// clone()对stack和Heap数据进行深拷贝</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ok</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="Copy-trait-vs-Drop-trait"><a class="header-anchor" href="#Copy-trait-vs-Drop-trait"> </a>Copy trait vs Drop trait</h1>
<ol>
<li>实现了 Copy trait 旧变量赋值后仍然可以使用</li>
<li>实现了Drop trait 就不允许实现Copy trait</li>
<li>简单标量类型都实现了Copy</li>
<li>需要Heap分配的类型都没实现Copy</li>
<li>tuple 内所有字段都是实现Copy就可以Copy</li>
</ol>
<h1 id="引用和借用"><a class="header-anchor" href="#引用和借用"> </a>引用和借用</h1>
<ul>
<li><code>&amp;</code>与c++类似，引用某值不获取所有权</li>
<li>将引用作为函数参数的行为称之为借用</li>
</ul>
<h2 id="数据竞争三条规则"><a class="header-anchor" href="#数据竞争三条规则"> </a>数据竞争三条规则</h2>
<ul>
<li>两个或多个指针同时访问同一个数据</li>
<li>至少有一个指针用于写入数据</li>
<li>没有使用任何机制来同步对数据的访问</li>
</ul>
<p>如果都满足，就有可能出现数据竞争、报错。</p>
<p>Rust的引用规则：</p>
<ul>
<li>一个可变的引用</li>
<li>任意数量不可变引用<br>
只能满足其一</li>
</ul>
<h2 id="悬垂引用-dangling-refrences"><a class="header-anchor" href="#悬垂引用-dangling-refrences"> </a>悬垂引用 dangling refrences</h2>
<ul>
<li>类似与cpp的野指针</li>
<li>rust内 编译器可保证引用永远都不是悬垂引用</li>
</ul>
<h1 id="切片"><a class="header-anchor" href="#切片"> </a>切片</h1>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>rust</category>
      </categories>
      <tags>
        <tag>rust</tag>
        <tag>所有权</tag>
      </tags>
  </entry>
  <entry>
    <title>Rust笔记(八) 通用集合</title>
    <url>/posts/ab025fe7/</url>
    <content><![CDATA[<h1 id="Vector"><a class="header-anchor" href="#Vector"> </a>Vector</h1>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> v<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 用vec! 宏带值初始化</span>
<span class="token keyword">let</span> <span class="token keyword">mut</span> v1 <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 添加</span>
v1<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 读取</span>
<span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token operator">&amp;</span>v1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 下标越界即panic</span>

<span class="token comment">// get方法返回Option&lt;T></span>
<span class="token keyword">match</span> v1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">None</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"None"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// enum + vector 存储多个类型的值</span>
<span class="token keyword">enum</span> <span class="token type-definition class-name">Cell</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Int</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">Float</span><span class="token punctuation">(</span><span class="token keyword">f64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> row <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span>
    <span class="token class-name">Cell</span><span class="token punctuation">::</span><span class="token class-name">Int</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">Cell</span><span class="token punctuation">::</span><span class="token class-name">Float</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">Cell</span><span class="token punctuation">::</span><span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"str"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="String"><a class="header-anchor" href="#String"> </a>String</h1>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"ssss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token string">"ssss"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> s3 <span class="token operator">=</span> <span class="token operator">&amp;</span>s1<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// push_str</span>
s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s3<span class="token punctuation">)</span><span class="token punctuation">;</span>
s<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token char">'l'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> s4 <span class="token operator">=</span> s <span class="token operator">+</span> <span class="token operator">&amp;</span>s1<span class="token punctuation">;</span> <span class="token comment">// 使用s的所有权</span>
<span class="token comment">// println!("&#123;&#125;", s); //error</span>

<span class="token comment">// format</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;-&#123;&#125;-&#123;&#125;"</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> s4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// string index</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> s4<span class="token punctuation">.</span><span class="token function">bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> s4<span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="HashMap"><a class="header-anchor" href="#HashMap"> </a>HashMap</h1>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// 引入Package</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token keyword">mut</span> table<span class="token punctuation">:</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">f32</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// insert</span>
table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// collect</span>
<span class="token keyword">let</span> key <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token keyword">mut</span> table2<span class="token punctuation">:</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span>_<span class="token punctuation">,</span> _<span class="token operator">></span> <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">zip</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 所有权</span>
<span class="token comment">// 实现了Copy 就赋值，没实现则移交所有权</span>

<span class="token comment">// 访问</span>
<span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=</span> table2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"v:&#123;&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"none"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 遍历</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token operator">&amp;</span>table2 <span class="token punctuation">&#123;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;:&#123;&#125;"</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//  not exist insert</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> table2<span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or_insert</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">3.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> table2<span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// OccupiedEntry</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> table2<span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// VacantEntry</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>rust</category>
      </categories>
      <tags>
        <tag>rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rust笔记(六) 结构体</title>
    <url>/posts/ba2042f3/</url>
    <content><![CDATA[<h1 id="定义结构体"><a class="header-anchor" href="#定义结构体"> </a>定义结构体</h1>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">User</span> <span class="token punctuation">&#123;</span>
    username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    email<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    sign_in_count<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    active<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 没有结构体继承</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">User2</span> <span class="token punctuation">&#123;</span>
    a<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    <span class="token punctuation">..</span><span class="token class-name">User</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span> <span class="token comment">// error</span>

<span class="token comment">// unit-like struct 空结构体</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Empty</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="初始化结构体变量"><a class="header-anchor" href="#初始化结构体变量"> </a>初始化结构体变量</h1>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> user1 <span class="token operator">=</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>
    username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"aaa"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    email<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"abc@abc.com"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    sign_in_count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    active<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">// 同名简写</span>
<span class="token keyword">let</span> username <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"bbb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user2 <span class="token operator">=</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>
    username<span class="token punctuation">,</span>
    email<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"abc@abc.com"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    sign_in_count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    active<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">// 更新简写</span>
<span class="token keyword">let</span> user3 <span class="token operator">=</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>
    username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"ccc"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">..</span>user2
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="定义方法"><a class="header-anchor" href="#定义方法"> </a>定义方法</h1>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Rectangle</span> <span class="token punctuation">&#123;</span>
    width<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
    length<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">impl</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">area</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">u32</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token keyword">self</span><span class="token punctuation">.</span>length
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 关联函数 associate function(静态方法) 第一个参数不是self</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">square</span><span class="token punctuation">(</span>size<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Rectangle</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Rectangle</span> <span class="token punctuation">&#123;</span>
            width<span class="token punctuation">:</span> size<span class="token punctuation">,</span>
            length<span class="token punctuation">:</span> size<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="tuple-struct"><a class="header-anchor" href="#tuple-struct"> </a>tuple struct</h1>
<p>想给类型相同的tuple做区分，但是里面的元素没名</p>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Color</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h1 id="结构体打印调试信息"><a class="header-anchor" href="#结构体打印调试信息"> </a>结构体打印调试信息</h1>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// struct 上面加 #[derive(Debug)]</span>
<span class="token attribute attr-name">#[derive(Debug)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">User</span> <span class="token punctuation">&#123;</span>
    username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    email<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    sign_in_count<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    active<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>
    username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"sss"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    email<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"abc@abc.com"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    sign_in_count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    active<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:#?&#125;"</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 带换行</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="struct-数据所有权"><a class="header-anchor" href="#struct-数据所有权"> </a>struct 数据所有权</h1>
<ul>
<li>struct 拥有其所有数据所有权</li>
<li>如果 struct 存引用，则需要使用生命周期。（生命周期保证struct实例有效，里面的引用就有效）</li>
</ul>
]]></content>
      <categories>
        <category>rust</category>
      </categories>
      <tags>
        <tag>rust</tag>
        <tag>struct</tag>
        <tag>结构体</tag>
      </tags>
  </entry>
  <entry>
    <title>Rust笔记(十) 泛型、trait与生命周期</title>
    <url>/posts/7c516f81/</url>
    <content><![CDATA[<h1 id="泛型"><a class="header-anchor" href="#泛型"> </a>泛型</h1>
<h2 id="泛型函数"><a class="header-anchor" href="#泛型函数"> </a>泛型函数</h2>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// 只展示语法形式，add函数编译会报错</span>
<span class="token keyword">fn</span> <span class="token function-definition function">add</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">T</span>
<span class="token punctuation">&#123;</span>
    a <span class="token operator">+</span> b
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="结构体泛型"><a class="header-anchor" href="#结构体泛型"> </a>结构体泛型</h2>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    a<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span>
    b<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span>
    c<span class="token punctuation">:</span> <span class="token class-name">U</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token operator">></span> <span class="token class-name">Point</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span> c<span class="token punctuation">:</span> <span class="token class-name">U</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Point</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 泛型偏特化 只有在具体类型才有new2方法</span>
<span class="token keyword">impl</span> <span class="token class-name">Point</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i64</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">new2</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> c<span class="token punctuation">:</span> <span class="token keyword">i64</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Point</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i64</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="枚举泛型"><a class="header-anchor" href="#枚举泛型"> </a>枚举泛型</h2>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">enum</span> <span class="token type-definition class-name">Some</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">None</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="trait"><a class="header-anchor" href="#trait"> </a>trait</h1>
<h2 id="定义"><a class="header-anchor" href="#定义"> </a>定义</h2>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">A</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"impl"</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="实现"><a class="header-anchor" href="#实现"> </a>实现</h2>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// 无法为外部类型来实现外部的trait</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">ImplA</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">ImplB</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token keyword">impl</span> <span class="token class-name">A</span> <span class="token keyword">for</span> <span class="token class-name">ImplA</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token keyword">impl</span> <span class="token class-name">A</span> <span class="token keyword">for</span> <span class="token class-name">ImplB</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//重写</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"implB"</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="trait-约束"><a class="header-anchor" href="#trait-约束"> </a>trait 约束</h2>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// Trait 约束</span>
<span class="token keyword">fn</span> <span class="token function-definition function">s0</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token keyword">impl</span> <span class="token class-name">A</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token keyword">impl</span> <span class="token class-name">A</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token comment">// 要求参数同时实现A和Display的trait</span>
<span class="token keyword">fn</span> <span class="token function-definition function">s1</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token keyword">impl</span> <span class="token class-name">A</span> <span class="token operator">+</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Display</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token comment">// trait bound（trait 与泛型绑定）</span>
<span class="token keyword">fn</span> <span class="token function-definition function">s2</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">A</span> <span class="token operator">+</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Display</span><span class="token operator">></span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token comment">// where 子句 trait 约束</span>
<span class="token keyword">fn</span> <span class="token function-definition function">s3</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token operator">></span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token class-name">U</span><span class="token punctuation">)</span>
<span class="token keyword">where</span>
    <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">A</span> <span class="token operator">+</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Display</span><span class="token punctuation">,</span>
    <span class="token class-name">U</span><span class="token punctuation">:</span> <span class="token class-name">A</span> <span class="token operator">+</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Display</span><span class="token punctuation">,</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">// sss</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="返回值为-trait"><a class="header-anchor" href="#返回值为-trait"> </a>返回值为 trait</h2>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// 返回只能为同一种类型 trait</span>
<span class="token keyword">fn</span> <span class="token function-definition function">s4</span><span class="token punctuation">(</span>flag<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">impl</span> <span class="token class-name">A</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// if flag &#123;</span>
    <span class="token class-name">ImplB</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token comment">// &#125; else &#123;</span>
    <span class="token comment">// ImplA &#123;&#125;    // error</span>
    <span class="token comment">// &#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="泛型-trait"><a class="header-anchor" href="#泛型-trait"> </a>泛型 + trait</h1>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// where 子句对T进行trait约束</span>
<span class="token comment">// 两个相同类型相加，要求T实现了`std::ops::Add`的trait</span>
<span class="token keyword">fn</span> <span class="token function-definition function">add</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">T</span>
<span class="token keyword">where</span>
    <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token namespace">std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span></span><span class="token class-name">Add</span> <span class="token operator">+</span> <span class="token namespace">std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span></span><span class="token class-name">Add</span><span class="token operator">&lt;</span><span class="token class-name">Output</span> <span class="token operator">=</span> <span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">,</span>
<span class="token punctuation">&#123;</span>
    a <span class="token operator">+</span> b
<span class="token punctuation">&#125;</span>

<span class="token comment">// 两个不同的类型相加，前提可转换，即实现了std::convert::From&lt;U>或std::convert::Into&lt;T>的trait</span>
<span class="token comment">// 例如: add2(1, 2.0)</span>
<span class="token keyword">fn</span> <span class="token function-definition function">add2</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token operator">></span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token class-name">U</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">T</span>
<span class="token keyword">where</span>
    <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token namespace">std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span></span><span class="token class-name">Add</span> <span class="token operator">+</span> <span class="token namespace">std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span></span><span class="token class-name">Add</span><span class="token operator">&lt;</span><span class="token class-name">Output</span> <span class="token operator">=</span> <span class="token class-name">T</span><span class="token operator">></span> <span class="token operator">+</span> <span class="token namespace">std<span class="token punctuation">::</span>convert<span class="token punctuation">::</span></span><span class="token class-name">From</span><span class="token operator">&lt;</span><span class="token class-name">U</span><span class="token operator">></span><span class="token punctuation">,</span>
<span class="token punctuation">&#123;</span>
    a <span class="token operator">+</span> <span class="token class-name">T</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">add3</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token operator">></span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token class-name">U</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">T</span>
<span class="token keyword">where</span>
    <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token namespace">std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span></span><span class="token class-name">Add</span> <span class="token operator">+</span> <span class="token namespace">std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span></span><span class="token class-name">Add</span><span class="token operator">&lt;</span><span class="token class-name">Output</span> <span class="token operator">=</span> <span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token class-name">U</span><span class="token punctuation">:</span> <span class="token namespace">std<span class="token punctuation">::</span>convert<span class="token punctuation">::</span></span><span class="token class-name">Into</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">,</span>
<span class="token punctuation">&#123;</span>
    a <span class="token operator">+</span> <span class="token class-name">U</span><span class="token punctuation">::</span><span class="token function">into</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>rust</category>
      </categories>
      <tags>
        <tag>rust</tag>
        <tag>泛型</tag>
        <tag>trait</tag>
        <tag>生命周期</tag>
      </tags>
  </entry>
  <entry>
    <title>Rust笔记(四) 控制流</title>
    <url>/posts/825dbcee/</url>
    <content><![CDATA[<h1 id="if-表达式"><a class="header-anchor" href="#if-表达式"> </a>if 表达式</h1>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> number <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> number <span class="token operator">&lt;</span> <span class="token number">5</span> <span class="token punctuation">&#123;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"less five"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> number <span class="token operator">></span> <span class="token number">5</span> <span class="token operator">&amp;&amp;</span> number <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token punctuation">&#123;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"more five, less ten"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"more ten"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 因为是表达式可以赋值</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token boolean">true</span> <span class="token punctuation">&#123;</span>
    <span class="token number">3</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token number">5</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="loop-表达式"><a class="header-anchor" href="#loop-表达式"> </a>loop 表达式</h1>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token keyword">mut</span> count <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">loop</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> count <span class="token operator">==</span> <span class="token number">5</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">break</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="while-循环"><a class="header-anchor" href="#while-循环"> </a>while 循环</h1>
<p>while 循环内不能使用<code>break</code>关键字</p>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token keyword">mut</span> number <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> number <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
    number <span class="token operator">-=</span> <span class="token number">1</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="for-循环"><a class="header-anchor" href="#for-循环"> </a>for 循环</h1>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// for in</span>
<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> element <span class="token keyword">in</span> arr<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"t1 the value is: &#123;&#125;"</span><span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// for range</span>
<span class="token comment">// (0...arr.len()) 只能正着，反转需要rev()</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">..</span>arr<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"t2 the value is: &#123;&#125;"</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//(0..a.len()).rev() 反转</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">..</span>arr<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"t3 the value is: &#123;&#125;"</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>rust</category>
      </categories>
      <tags>
        <tag>rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Star-Atlas、Fancy-Birds和DefiKingdoms 分析</title>
    <url>/posts/1b44cf2e/</url>
    <content><![CDATA[<h1 id="Star-Atlas"><a class="header-anchor" href="#Star-Atlas"> </a>Star Atlas</h1>
<p>官网：<a href="https://staratlas.com/">https://staratlas.com/</a></p>
<p>Star Atlas是一个基于2620年的虚拟元宇宙游戏。基于虚幻5开发的3A MMORPG游戏（链游版的EVE）。故事背景设定在 2620 年，在官方设定中，宇宙分为了三大派系：由人类统治的 MUD 领地；外星种族联盟的 ONI 区域；知觉机器人控制的 Ustur 星区。三大派系为资源、领土和统治权进行着持续的战争。玩家可自由加入其中一方，为自己的派系贡献力量。而玩家的行为则将直接影响这场星际冲突的结果，通过在游戏中做出贡献，玩家可获得代币奖励。</p>
<p>特点：</p>
<ul>
<li>资产链上化（NFT）：舰船、船员、宠物、组件、土地、建筑物、服装等等</li>
<li>双代币经济体系</li>
</ul>
<h2 id="通证"><a class="header-anchor" href="#通证"> </a>通证</h2>
<p>游戏中也将实行双通证，<a href="https://explorer.solana.com/address/ATLASXmbPQxBUYbxPsV97usA3fPQYEqzQBUHgiFCUsXx">ATLAS</a>和<a href="https://explorer.solana.com/address/poLisWXnNRwC6oBu1vHiuKQzFjGL4XDSu4g9qjz9qVk">POLIS</a>。</p>
<p><strong>ATLAS：</strong> ATLAS将作为游戏内的主要交易媒介，用于购买游戏内的土地、装备、组件等等，总量360亿。</p>
<p><strong>POLIS：</strong> 项目的治理通证，将用于参与决策游戏内的一些玩法和机制，总量3.6亿。</p>
<h2 id="进展"><a class="header-anchor" href="#进展"> </a>进展</h2>
<ul>
<li>第一阶段：OpenSea资产售卖</li>
<li>第二阶段：网页迷你小游戏</li>
<li>第三阶段：船坞组件售卖</li>
<li>第四阶段：最终预售公测</li>
<li>第五阶段：持续售卖</li>
</ul>
<p>当前进展：阶段二，玩家可以在marketplace上自由买卖NFT。关于3A游戏本身暂未看到任何进度。按3A大作开发惯例，一般需要5-10年不等。</p>
<h2 id="github"><a class="header-anchor" href="#github"> </a>github</h2>
<p>当前github主要开源一个与token解锁相关智能合约的仓库 <a href="https://github.com/staratlasmeta/token-vesting">token-vesting</a></p>
<h2 id="关于dex-Serum"><a class="header-anchor" href="#关于dex-Serum"> </a>关于dex-Serum</h2>
<p>solana上的所有DEX都基于Serum，也就是说只要你知道了某一交易对的Market ID，你可以在任何前端进入交易。用SA举例就是你要买飞船，不用在官网买，直接在支持Serum的任意前端导入market ID，就可以进行交易，查看订单。</p>
<h1 id="Fancy-Birds"><a class="header-anchor" href="#Fancy-Birds"> </a>Fancy Birds</h1>
<p>官网：<a href="https://www.fancybirds.io/">https://www.fancybirds.io/</a></p>
<p>merit-circle投资。玩法类似于2013年大火的<code>flappy bird</code>。一共发行8888只创世鸟。拥有繁殖、遗传基因玩法，罕见的基因可以提升打金收入。玩法本质上类似于Axie Infinity。</p>
<h2 id="当前进度"><a class="header-anchor" href="#当前进度"> </a>当前进度</h2>
<ul>
<li>token已发行：FNC</li>
<li>2021年12月15日上线质押挖矿(Defi 挖矿玩法)</li>
<li>预计2022 Q1上线创世鸟的铸造和marketplace</li>
<li>预计2022 Q2上线游戏主体</li>
</ul>
<h2 id="github-2"><a class="header-anchor" href="#github-2"> </a>github</h2>
<p>审计报告中找到的地址，打不开。<br>
似乎未开源：<a href="https://github.com/Fancy-Birds/">https://github.com/Fancy-Birds/</a><br>
审计报告包含Token和staking相关的合约代码审计</p>
<h2 id="defi-玩法"><a class="header-anchor" href="#defi-玩法"> </a>defi 玩法</h2>
<p>常规defi玩法，质押FNC或LP挖矿。<br>
<a href="https://staking.fancybirds.io/">https://staking.fancybirds.io/</a></p>
<h2 id="通证-2"><a class="header-anchor" href="#通证-2"> </a>通证</h2>
<p><a href="https://etherscan.io/token/0x7f280daC515121DcdA3EaC69eB4C13a52392CACE">Fancy Token($FNC)</a></p>
<p><a href="https://etherscan.io/token/0x162ce5530Aba30583cCaF79dD72650CfEB050a23">Staked Fancy Games LP</a>(锁仓SLP挖矿合约)</p>
<p><a href="https://etherscan.io/address/0x82ecdd4635766560c4e3a8efa8a7c1fff566111e">sushi FNC-WETH lp (SLP)</a></p>
<h2 id="游戏模式"><a class="header-anchor" href="#游戏模式"> </a>游戏模式</h2>
<ul>
<li>PVP、PVE打金。（flappy bird有类似的辅助软件）</li>
<li>交易、繁殖、锦标赛（玩法类似于Axie Infinity）。</li>
<li>后续sFNC用于游戏经济中的繁殖、赌注和其他游戏内活动。</li>
</ul>
<h2 id="技术手段猜测"><a class="header-anchor" href="#技术手段猜测"> </a>技术手段猜测</h2>
<p>由于代码未开源，现根据游戏玩法对技术的猜测</p>
<ol>
<li>使用<code>Immutable X</code>发行、交易、跨链NFT，和FNC（DAO）。</li>
<li>基于starknet Cairo开发繁殖、PVP、PVE奖金系统。</li>
</ol>
<h1 id="DefiKingdoms"><a class="header-anchor" href="#DefiKingdoms"> </a>DefiKingdoms</h1>
<p><a href="https://defikingdoms.com/">https://defikingdoms.com/</a><br>
DeFi Kingdoms是基于Harmony Protocol区块链开发的一款play2earn游戏。</p>
<p>DeFi Kingdoms旨在将DeFi元素包装成一个成为一个完整的功能生态系统。<br>
本质上还是个DEX+NFT。</p>
<h2 id="通证-3"><a class="header-anchor" href="#通证-3"> </a>通证</h2>
<p>JEWEL：<a href="https://explorer.harmony.one/address/0x72cb10c6bfa5624dd07ef608027e366bd690048f">0x72cb10c6bfa5624dd07ef608027e366bd690048f</a></p>
<p>xJEWEL：<a href="https://explorer.harmony.one/address/0xa9ce83507d872c5e1273e745abcfda849daa654f">0xa9ce83507d872c5e1273e745abcfda849daa654f</a></p>
<h2 id="github-3"><a class="header-anchor" href="#github-3"> </a>github</h2>
<p>部分合约：<a href="https://github.com/DefiKingdoms/contracts/">https://github.com/DefiKingdoms/contracts/</a></p>
<ul>
<li><a href="https://explorer.harmony.one/address/0xa678d193fEcC677e137a00FEFb43a9ccffA53210">AidropClaim.sol</a>： 空投相关的合约很简单，merkeproof都没有用到</li>
<li><a href="https://explorer.harmony.one/address/0xA9cE83507D872C5e1273E745aBcfDa849DAA654F">Bank.sol</a>：质押JEWEL挖矿，使用的xsushi代码base</li>
<li><a href="https://explorer.harmony.one/address/0x3685ec75ea531424bbe67db11e07013abeb95f1e">Banker.sol</a>：一个将合约内部的lp解除流动性并将token转换成<code>JEWEL</code>存入Bank合约中。lp来源swap的feeTo。</li>
<li><a href="https://explorer.harmony.one/address/0xDB30643c71aC9e2122cA0341ED77d09D5f99F924">MasterGardener.sol</a>：流动性矿池类似于masterchef</li>
<li><a href="https://explorer.harmony.one/address/0x9014B937069918bd319f80e8B3BB4A2cf6FAA5F7">UniswapV2Factory.sol</a>: uniswap的代码base，feeTo设置为Banker</li>
<li><a href="https://explorer.harmony.one/address/0x24ad62502d1C652Cc7684081169D04896aC20f30">UniswapV2Router02.sol</a></li>
</ul>
<h2 id="NFT"><a class="header-anchor" href="#NFT"> </a>NFT</h2>
<p>玩家可以通过购买、合成、售卖等方式玩NFT获利。NFT可以影响defi的收益。</p>
<ul>
<li>Gen0：2090只创世英雄</li>
<li>稀有度：紫、橙、蓝、绿、白</li>
<li>英雄职业和专业影响defi的收益</li>
<li>特定的职业+特定的专业以及稀有度可以最大化收益产出，玩家主要就是合成此类卡片售卖或挖矿。</li>
</ul>
<h3 id="专业功能未开放"><a class="header-anchor" href="#专业功能未开放"> </a>专业功能未开放</h3>
<ul>
<li>mining：可以提前解锁JEWEL和黄金（黄金Token未上线）</li>
<li>Gardening：增加流动性挖矿利率</li>
<li>Fishing：可以获得宝物</li>
<li>Foraging：可以炼制素材</li>
</ul>
<h3 id="职业"><a class="header-anchor" href="#职业"> </a>职业</h3>
<p>职业分基础职业、进阶职业、精英职业。最上级职业。</p>
<p>两个职业可以合成上阶职业（有合成率）。</p>
<p>合成次数从职业低到高，有不同的限制，越往上合成次数越少。</p>
]]></content>
  </entry>
  <entry>
    <title>StarkNet 分析</title>
    <url>/posts/1fbae977/</url>
    <content><![CDATA[<h1 id="StarkNet"><a class="header-anchor" href="#StarkNet"> </a>StarkNet</h1>
<p><a href="https://starkware.co/starknet/">StarkNet</a>是基于STARK零知识证明方案的L2的ZK-Rollup.</p>
<h2 id="RoadMap"><a class="header-anchor" href="#RoadMap"> </a>RoadMap</h2>
<p>分四个步骤构建StarkNet：</p>
<ul>
<li>阶段0——地基（Foundations）（已完成*）</li>
<li>阶段I——行星（Planets）：单一应用汇总（Rollup）</li>
<li>阶段II——星座（Constellations）：多应用汇总</li>
<li>阶段III——宇宙（Universe）：去中心化汇总</li>
</ul>
<p><img src="/posts/1fbae977/starkware-0.webp" alt></p>
<p>StarkNet基于图灵完备的<a href="https://www.cairo-lang.org/">Cairo语言</a>，支持以太坊上通用的计算。</p>
<p>在StarkNet上，开发者可以构建应用并部署；用户可以发起交易并在StarkNet上执行； 节点可以通过激励保证网络良好运转。</p>
<p>StarkNet的所有交易周期性地批量打包到一个proof中，在以太坊上验证。</p>
<p>所有构建StarkNet的数据在链上（on-chain）发布。</p>
<p><img src="/posts/1fbae977/starkware-1.webp" alt></p>
<h2 id="TPS"><a class="header-anchor" href="#TPS"> </a>TPS</h2>
<p>在主网上使用单个证明处理 30 万笔交易，在 Rollup 吞吐量上创下了高达 3000 tps 的世界记录。在此过程中，我们同样在 Rollup 的 gas 效率上创下每笔交易 315 gas 的世界纪录，比以太坊 L1 上的交易便宜几个数量级。</p>
<h2 id="阶段"><a class="header-anchor" href="#阶段"> </a>阶段</h2>
<h3 id="行星：只支持单一-App-的-Rollup"><a class="header-anchor" href="#行星：只支持单一-App-的-Rollup"> </a>行星：只支持单一 App 的 Rollup</h3>
<p>在该阶段，开发者可以在 StarkNet 上构建并部署他们自己的可扩展应用。</p>
<p>每个 StarkNet 实例都能运行一个应用。不同的实例可能会运行不同的应用。</p>
<p>StarkNet 架构包含以下部分：</p>
<ul>
<li>为任意 Cairo 逻辑生成 STARK 证明、然后提交证明并在以太坊上验证所需的机制</li>
<li>与 L1 以太坊交互：L1 代币的存取、链上数据的发布、保护用户免受恶意 StarkNet 运营者攻击的逃跑机制</li>
<li>L2 用户余额以及应用存储项的管理</li>
</ul>
<p>开发者只需专注于根据自己的商业逻辑构建应用，然后正式上线：在 StarkNet 上部署并大规模运行。</p>
<p>我们之所以能构建通用计算可扩展 ZK-Rollup，主要依赖于以下两点：</p>
<ul>
<li>通用型图灵完备的编程语言 Cairo</li>
<li>我们强大的 STARK 技术（证明器和验证器），可以将大量计算捆绑到一个证明中</li>
</ul>
<h3 id="星群：支持多-App-的-Rollup"><a class="header-anchor" href="#星群：支持多-App-的-Rollup"> </a>星群：支持多 App 的 Rollup</h3>
<p>该阶段将支持多个应用在同一个 StarkNet 实例上运行，并访问同一个的全局 L2 状态。这样一来，不同应用之间将具有互操作性，而且规模经济也有助于降低 gas 成本。</p>
<p>强大的 STARK 栈 Cairo 和 GPS 增强了 StarkNet 在支持多 App Rollup 方面的竞争优势。</p>
<p>在这一阶段，StarkNet 将成为一个功能完备的框架，可以在以太坊的基础上运行多个商业逻辑不同的应用，每个实例都由一个单独的运营者来运行。</p>
<p>运营者可以运行 StarkNet 节点，应用开发者可以在上面部署自己的合约。从用户的角度来说，StarkNet 感觉上跟以太坊差不多，但是在可扩展性上强于以太坊。</p>
<h3 id="宇宙：去中心化-Rollup"><a class="header-anchor" href="#宇宙：去中心化-Rollup"> </a>宇宙：去中心化 Rollup</h3>
<p>StarkNet 发展的最后一步是实现去中心化运营。</p>
<p>关于该阶段，我们现在正在解决一些有趣的研发问题，包括：（i）使用 ZK-Rollups 来改进共识机制，以及 （ii）设计密码学经济机制来激励去中心化 StarkNet 贡献者和运营者（交易排序者、证明者等）高效、公平且安全地运行。</p>
<h1 id="STARK"><a class="header-anchor" href="#STARK"> </a>STARK</h1>
<h2 id="什么是-STARK"><a class="header-anchor" href="#什么是-STARK"> </a>什么是 STARK</h2>
<p>STARK 是一个证明系统。</p>
<p><strong>复杂度：</strong></p>
<ul>
<li>证明者时空复杂度：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mrow></mrow><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n\log{}n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> 准线性</li>
<li>见证长度和验证时间：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(log_{2}n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> 亚线性</li>
</ul>
<p>在没有Cairo之前我们需要对每个问题都去创建特殊的代数中间件（arithmetic intermediate representation, AIR）。Cairo相当于建立了一个通用的AIR，类似ASIC-&gt;CPU的转换。</p>
<h2 id="生产级图灵完备-STARK"><a class="header-anchor" href="#生产级图灵完备-STARK"> </a>生产级图灵完备 STARK</h2>
<p><strong>概念：</strong> 一个链下证明者，它处理大量计算（如大批量交易），并产生指数级较小的有效性证明，然后在链上进行验证。</p>
<h2 id="什么是-Cairo"><a class="header-anchor" href="#什么是-Cairo"> </a>什么是 Cairo</h2>
<p>Cairo 是图灵完备的高级编程语言和框架，可以为通用计算生成 STARK 证明。应用开发者可以使用 Cairo 定义任何商业逻辑，在链下生成证明，并在链上进行验证，而无需自己编写复杂的“电路”或 AIR。Cairo 已在主网上线，向所有开发者开放。</p>
<p>我们将在以太坊公共测试网上发布 Cairo 的通用证明服务（Generic Proof Service ，GPS）的 alpha 版本。通过该服务，开发者可以使用 Cairo 构建自己的应用，实现他们想要的一切商业逻辑。他们会将自己的 Cairo 代码发送至 GPS 来生成证明，再在链上进行验证。</p>
<p>GPS 可以使用单个证明来证明多个独立应用的执行完整性，让这些应用可以分摊证明验证的 gas 成本。</p>
<p>Cairo 和 GPS 都是 StarkNet 的基础。我们决定将二者开放给外部开发者，让他们早些接触 StarkNet 技术。这样一来，开发者不仅可以开始在 StarkNet 的基础上进行构建，还能影响 StarkNet 的发展。</p>
<p>我们会基于开发者社区的需求和反馈继续开发 Cairo。我们会引入新的功能、语法和能够提高其可用性的内部插件来强化该语言。我们会继续开发并改进 Cairo 工具：编译器、跟踪器/调试器以及与通用 IDE（集成开发环境）的集成。</p>
<p>StarkNet 也会在底层运行 Cairo。</p>
<h2 id="Cairo-与区块链结合"><a class="header-anchor" href="#Cairo-与区块链结合"> </a>Cairo 与区块链结合</h2>
<p>今天，大多数区块链 dApp 基本上是一个实现某种逻辑的 Solidity 合约，可能是一些用于良好用户体验的前端，也可能是后端。这些 dApp 成功后，不可避免地面临可扩展性问题。</p>
<p>我们越来越多地看到 dApp 通过转向基于证明的 L2 可扩展性解决方案（如带有 StarkEx 的 DeversiFi）来解决其可扩展性问题。链下组件接管了业务逻辑的一些更复杂的部分，并与链上智能合约进行通信，而不会放弃安全性，因为系统状态的所有更改都经过证明。规模得到改善，因为验证链上证明比完全在链上执行业务逻辑要便宜得多。</p>
<p>在开罗之前，创建一个涵盖特定业务逻辑的证明系统很困难（就像通过在硅晶片上放置与非门来为该业务逻辑构建芯片一样）。在开罗，使用证明来实现可扩展性的障碍要低得多。你在开罗编写你的复杂逻辑，在链下证明它（我们将在一分钟内解释如何），一旦证明在链上得到验证，你的智能合约应用程序就可以无信任地使用结果——就好像它执行了那样链上的复杂逻辑，因为这就是证明所断言的。</p>
<h2 id="如何工作"><a class="header-anchor" href="#如何工作"> </a>如何工作</h2>
<p>以太坊上的三件事是昂贵的：计算、传输和存储。开罗解决了所有三个问题。要了解它是如何做到的，我们需要引入一个新概念——共享证明器（或 SHARP）。</p>
<p>SHARP 是您的开罗代码和 Solidity 智能合约之间的连接链接。它具有三个主要组成部分——证明者（链下）、验证者智能合约（链上）和事实登记合约（链上）。</p>
<p>证明者获取您的开罗程序的执行跟踪，证明它是有效的，并将此证明发送给验证者。检验证明后，上链验证需要一个重要的额外的步骤：将其写入一个事实，证明在事实登记证明的有效性。这个事实就像一个无需信任的批准印章，证明开罗计划的计算是正确的。现在 dApp 的智能合约剩下的就是检查这个事实是否存在，以便依赖链下执行的计算。<br>
<img src="/posts/1fbae977/starkware-2.webp" alt></p>
<p>让我们看一个玩具示例——一个基于区块链的数独游戏，提出正确解决方案的人将获得奖励。</p>
<p>今天，您需要实现验证难题的解决方案在 Solidity 中是否正确的整个业务逻辑——这是在链上执行的昂贵计算。相反，您可以在开罗编写此逻辑，然后在链外执行。Cairo 程序将检查解决方案，然后触发 SHARP 生成证明，在链上验证它并写下一个事实——一个批准该解决方案是正确解决方案的印章。数独的智能合约检查该事实是否存在，并向获胜者支付奖金。我们节省了解决方案验证的昂贵计算和链上数独游戏的解决方案的传输</p>
<p>dApp 智能合约的角色发生了变化——从负责执行昂贵的业务逻辑的组件变成了负责处理该业务逻辑的廉价后果的组件（在我们的示例中，将奖品发送给获胜者或更新一些state），同时依赖于业务逻辑被正确执行的事实。</p>
<p>我们在这篇博文中讨论了计算和传输——我们将在以后的博文中讨论开罗如何解决以太坊上的存储问题。</p>
<h2 id="STARK的性能对比"><a class="header-anchor" href="#STARK的性能对比"> </a>STARK的性能对比</h2>
<p><img src="/posts/1fbae977/starkware-3.webp" alt></p>
<h2 id="STARK生成过程"><a class="header-anchor" href="#STARK生成过程"> </a>STARK生成过程</h2>
<p><img src="/posts/1fbae977/starkware-4.webp" alt><br>
通常 zk-STARK 证明需要以下过程生成证明。验证者的证明过程分为两步：</p>
<ol>
<li>第一步为计算完整性声明经过算术后生成代数中间代码表示</li>
<li>第二步为经过测试后生成 FRI (StarkWare Co-Founder 2017年所著论文中对证明的优化方法)。</li>
</ol>
<p>之后经过加密算法后输出可拓展的公开透明知识论据 (也就是 STARK)。简而言之就是通过安全可信的环境以及优化算法生成一个可信并且高性能的证明。</p>
<h1 id="参考资料-2"><a class="header-anchor" href="#参考资料-2"> </a>参考资料</h1>
<blockquote>
<p><a href="https://www.youtube.com/watch?v=khVPrv69Zd4&amp;t=108s">https://www.youtube.com/watch?v=khVPrv69Zd4&amp;t=108s</a><br>
<a href="https://medium.com/nethermind-eth/solidity-on-starknet-terminal-velocity-e8df5f63e010">https://medium.com/nethermind-eth/solidity-on-starknet-terminal-velocity-e8df5f63e010</a><br>
<a href="https://www.cairo-lang.org/cairo-for-blockchain-developers/">https://www.cairo-lang.org/cairo-for-blockchain-developers/</a><br>
<a href="https://eprint.iacr.org/2021/1063.pdf">https://eprint.iacr.org/2021/1063.pdf</a><br>
<a href="https://www.jianshu.com/p/6ce113baa464">https://www.jianshu.com/p/6ce113baa464</a><br>
<a href="https://ethfans.org/posts/on-the-road-to-starknet-a-permissionless-stark-powered-l2-zk-rollup">https://ethfans.org/posts/on-the-road-to-starknet-a-permissionless-stark-powered-l2-zk-rollup</a><br>
<a href="https://www.ise.tu-berlin.de/fileadmin/fg308/publications/2018/Off-chaining_Models_and_Approaches_to_Off-chain_Computations.pdf">https://www.ise.tu-berlin.de/fileadmin/fg308/publications/2018/Off-chaining_Models_and_Approaches_to_Off-chain_Computations.pdf</a></p>
</blockquote>
]]></content>
      <categories>
        <category>区块链</category>
      </categories>
      <tags>
        <tag>StarkNet</tag>
        <tag>Cairo</tag>
        <tag>STARK</tag>
      </tags>
  </entry>
  <entry>
    <title>StarkWare 分析</title>
    <url>/posts/487c3c24/</url>
    <content><![CDATA[<h1 id="Starkware"><a class="header-anchor" href="#Starkware"> </a>Starkware</h1>
<p><code>StarkWare</code>是一个为了解决区块链的可扩展性和隐私的组织。 <code>StarkWare</code>开发了一个完整的解决方案，使用透明零知识证明（<code>zk-STARK</code>）技术，<code>zk-Rollup</code>和<code>Validium</code>模式组成<code>Volition</code>来生成和验证计算完整性的证明。<code>StarkWare</code>的密码证明可以做到零知识、简洁、透明和后量子安全的特点。 <code>StarkWare</code>所研发的产品主要有：<code>StarkNet</code>、<code>StarkEx</code>、<code>Cairo</code>。</p>
<h2 id="扩展解决方案"><a class="header-anchor" href="#扩展解决方案"> </a>扩展解决方案</h2>
<p><img src="/posts/487c3c24/f-1.png" alt></p>
<h1 id="StarkEx"><a class="header-anchor" href="#StarkEx"> </a>StarkEx</h1>
<p><code>StarkEx</code>是基于有效性证明的以太坊可扩展性解决方案。 它可以在<code>zk-Rollup</code>或<code>Validium</code>数据可用性模式下运行。<br>
基于<code>StarkEx</code>之上架构使用<code>Cairo</code>编写的应用程序（<code>dydx</code>、<code>Imutable X</code>…）都会定义自己的业务运行逻辑，并在<code>StarkEx</code>服务上运行。 该系统具有链上组件和链下组件。 链下组件持有状态，命令执行系统中的交易，并将状态更新发送到链上组件。 链上组件持有状态承诺，持有系统资产，并负责执行状态转换的有效性。</p>
<h2 id="系统元件"><a class="header-anchor" href="#系统元件"> </a>系统元件</h2>
<p><code>StarkEx</code>系统包含以下组件：</p>
<ul>
<li>应用程序：接收用户交易的链下组件，定义业务运行逻辑和执行的顺序。最终，它将交易发送到<code>StarkEx</code>服务。</li>
<li><code>StarkEx</code>服务：链下组件，负责批处理一组操作，根据这些操作更新系统状态。针对每一批，<code>StarkEx</code>服务将发送此批的操作(作为<code>Cairo</code>执行痕迹)到<code>SHARP</code>进行有效性证明，一旦证明被验证，它将新状态发布在链上。 状态由<code>Merkle</code> <code>tree</code>呈现，其叶子是保险库。每个保险库的结构和内容根据所实施的特定业务逻辑而有所不同。<code>Merkle tree root</code>代表要在链上提交的状态承诺。</li>
<li><code>SHARP</code>(<code>Prover</code>)：<code>Cairo</code>程序的共享证明服务。 它接收来自不同应用程序的证明请求，并输出证明以证明<code>Cairo</code>程序执行的有效性。输出的证明可以在多个证明请求之间共享。</li>
<li><code>STARK</code>验证器(<code>Verifier</code>)：这是一个链上组件，用于接收状态更新有效性证明并验证该证明是否有效。</li>
<li><code>StarkEx</code>合约：该合约有两个主要功能。 第一个是在确认有效性条件得以满足后更新系统状态。第二个功能是以自主托管方式管理在<code>StarkEx</code>中的进出资金，这意味着在任何情况下，用户都可以提取其资金。</li>
</ul>
<p><img src="/posts/487c3c24/f-2.png" alt><br>
系统中的所有交易都通过应用程序执行，并将撮合好的交易发送到<code>StarkEx</code>服务。 <code>StarkEx</code>服务对交易进行批处理更新状态，并将批处理后将<code>SHARP</code>需要的参数发送到<code>SHARP</code>（共享证明服务）生成一份证明来表明批处理的有效性。<code>SHARP</code>将<code>STARK</code>证明发送给<code>STARK</code>验证器进行验证。服务随后发送一份链上状态更新交易到<code>StarkEx</code>合约，仅在证明被验证器验证有效时，交易才会被接受。</p>
<p>用户以两种方式与系统交互：</p>
<ul>
<li>通过发送链上交易到<code>StarkEx</code>合约。<br>
‌‌当用户想要使用该系统时，他们首先将<code>StarkKey</code>注册到<code>StarkEx</code>合约中的以太坊地址。<code>StarkKey</code>用于验证用户的链下交易。 然后，用户将其资金存入<code>StarkEx</code>合约。 在应用程序接受存款后，用户可以在链下使用其资金。</li>
<li>发送链下交易到应用程序。<br>
用户将由<code>StarkKey</code>签名的转账或限价单直接提交给应用程序。限价单经由链下程序定序匹配，并作为结算发送给<code>StarkEx</code>服务。转账行为照原样发送。不同类型的转账交易可以由额外的逻辑来执行。<br>
‌为提取资金，用户应向应用程序提交链下提款请求。此请求被发送到<code>StarkEx</code>服务，一旦包含提款的状态更新被接受，用户就可以在链上获取其资金。</li>
</ul>
<p>‌为了防止审查，如果用户的提款请求没有得到实现，他们可以使用<a href="https://docs.starkware.co/starkex-docs-v2-chinese/cheng-xu-liu-miao-shu/qiang-zhi-cao-zuo">强制操作</a>来强制执行。</p>
<h1 id="Immutable-X"><a class="header-anchor" href="#Immutable-X"> </a>Immutable X</h1>
<p><code>Immutable X</code>使用<code>Starkware</code>基于<code>StarkEx</code>提供的方案。具体架构与上文大同小异，不再赘述。</p>
<h2 id="以太坊上NFT接入"><a class="header-anchor" href="#以太坊上NFT接入"> </a>以太坊上NFT接入</h2>
<p><code>NFT</code>接入，本质上需要让以太坊上的<code>IMX</code>合约拥有<code>NFT</code>的铸造权。</p>
<h3 id="新的NFT接入"><a class="header-anchor" href="#新的NFT接入"> </a>新的NFT接入</h3>
<p>对于要新建的<code>NFT</code>只需要在自己的<code>ERC721</code>合约的基础上实现<code>IMX</code>给定的<a href="https://github.com/immutable/imx-contracts/blob/main/contracts/Mintable.sol">Mintable</a>接口。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">pragma solidity <span class="token operator">^</span><span class="token number">0.8</span><span class="token number">.4</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">"@openzeppelin/contracts/token/ERC721/ERC721.sol"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"./Mintable.sol"</span><span class="token punctuation">;</span>

contract Asset is <span class="token constant">ERC721</span><span class="token punctuation">,</span> Mintable <span class="token punctuation">&#123;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>
        address _owner<span class="token punctuation">,</span>
        string memory _name<span class="token punctuation">,</span>
        string memory _symbol<span class="token punctuation">,</span>
        address _IMX
    <span class="token punctuation">)</span> <span class="token constant">ERC721</span><span class="token punctuation">(</span>_name<span class="token punctuation">,</span> _symbol<span class="token punctuation">)</span> <span class="token function">Mintable</span><span class="token punctuation">(</span><span class="token parameter">_owner<span class="token punctuation">,</span> _IMX</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

    <span class="token keyword">function</span> <span class="token function">_mintFor</span><span class="token punctuation">(</span>
        <span class="token parameter">address user<span class="token punctuation">,</span>
        uint256 id<span class="token punctuation">,</span>
        bytes memory</span>
    <span class="token punctuation">)</span> internal override <span class="token punctuation">&#123;</span>
        <span class="token function">_safeMint</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="已部署的NFT接入"><a class="header-anchor" href="#已部署的NFT接入"> </a>已部署的NFT接入</h3>
<p>对于已部署过的合约，需要写一个新的合约包装进旧的合约。<br>
确保此合约可以铸造<code>NFT</code>，并且只有<code>IMX</code>可以调此合约的<code>mintFor</code>方法。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">"@imtbl/IMX-contracts/contracts/Mintable.sol"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"@openzeppelin/contracts/access/Ownable.sol"</span><span class="token punctuation">;</span>

contract YourContract is IMintable<span class="token punctuation">,</span> Ownable <span class="token punctuation">&#123;</span>

    <span class="token keyword">function</span> <span class="token function">mintFor</span><span class="token punctuation">(</span>
        <span class="token parameter">address to<span class="token punctuation">,</span>
        uint256 quantity<span class="token punctuation">,</span>
        bytes calldata mintingBlob</span>
    <span class="token punctuation">)</span> external override <span class="token punctuation">&#123;</span>
        <span class="token comment">// TODO: make sure only Immutable X can call this function</span>
        <span class="token comment">// TODO: mint the token!</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="创建项目-project-registration"><a class="header-anchor" href="#创建项目-project-registration"> </a>创建项目 (project registration)</h2>
<p>一个项目相当于一个超级管理员，并且和一个<code>owner</code>地址（拥有铸造权限）关联。用户可以在项目中发行多个合集（<code>collections</code>），<code>IMX</code>规定每个项目可以创建的<code>collection</code>数量有限制（一个月五个合集）。创建完项目后会生成对应的<code>projectId</code>。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"> <span class="token keyword">const</span> <span class="token literal-property property">params</span><span class="token operator">:</span> CreateProjectParams <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'项目名字'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">company_name</span><span class="token operator">:</span> <span class="token string">'公司名字'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">contact_email</span><span class="token operator">:</span> <span class="token string">'联系邮箱'</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> project<span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
  project <span class="token operator">=</span> <span class="token keyword">await</span> user<span class="token punctuation">.</span><span class="token function">createProject</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="合集注册-collection-registration"><a class="header-anchor" href="#合集注册-collection-registration"> </a>合集注册 (collection registration)</h2>
<p>合集（<code>collection</code>）代表一个已经在以太坊网络上部署好的<code>ERC721</code>合约。为了能在<code>IMX</code>网络上铸造资产，首先需要在<code>IMX</code>上注册这个合集。<br>
合集注册也是通过<code>IMX</code>提供的<code>sdk</code>或<code>api</code>完成，参考代码如下：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">  <span class="token keyword">const</span> <span class="token literal-property property">params</span><span class="token operator">:</span> CreateCollectionParams <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'合集的名字'</span><span class="token punctuation">,</span>
  <span class="token comment">// description: 'ENTER_COLLECTION_DESCRIPTION (OPTIONAL)',</span>
  <span class="token literal-property property">contract_address</span><span class="token operator">:</span> collectionContractAddress<span class="token punctuation">,</span>
  <span class="token literal-property property">owner_public_key</span><span class="token operator">:</span> ownerPublicKey<span class="token punctuation">,</span>
  <span class="token comment">// icon_url: '',</span>
  <span class="token comment">// metadata_api_url: '', //&lt;metadata_api_url>/&lt;token_id></span>
  <span class="token comment">// collection_image_url: '',</span>
  <span class="token literal-property property">project_id</span><span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>projectId<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> collection<span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
  collection <span class="token operator">=</span> <span class="token keyword">await</span> user<span class="token punctuation">.</span><span class="token function">createCollection</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在<code>IMX</code>上注册一个合集的例子可以<a href="https://docs.x.immutable.com/docs/asset-metadata#example-metadata-schema">参考这里</a>。</p>
<h2 id="元数据注册-metadata-schema-registration"><a class="header-anchor" href="#元数据注册-metadata-schema-registration"> </a>元数据注册 (metadata schema registration)</h2>
<p><code>IMX</code>允许项目为他们的资产指定元数据属性，这些元数据属性可以更好的帮助交易市场（<code>marketplace</code>）执行复杂的过滤查询，这样帮助用户更精准的发现他们想要的资产。更多资产元数据的例子可以<a href="https://docs.x.immutable.com/docs/asset-metadata#example-metadata-schema">参考这里</a>。<br>
元数据注册也是通过<code>IMX</code>提供的<code>sdk</code>完成，参考代码如下：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token literal-property property">params</span><span class="token operator">:</span> AddMetadataSchemaToCollectionParams <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">metadata</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'EXAMPLE_BOOLEAN'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> MetadataTypes<span class="token punctuation">.</span>Boolean<span class="token punctuation">,</span>
        <span class="token literal-property property">filterable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token comment">// ..add rest of schema here</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> collection <span class="token operator">=</span> <span class="token keyword">await</span> user<span class="token punctuation">.</span><span class="token function">addMetadataSchemaToCollection</span><span class="token punctuation">(</span>
    collectionContractAddress<span class="token punctuation">,</span>
    params<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>
    component<span class="token punctuation">,</span>
    <span class="token string">'Added metadata schema to collection'</span><span class="token punctuation">,</span>
    collectionContractAddress<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>collection<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在<code>IMX</code>上创建注册元数据的例子可以<a href="http://0x0e3a2a1f2146d86a604adc220b4967a898d7fe07">参考这里</a>。</p>
<h2 id="功能时序图"><a class="header-anchor" href="#功能时序图"> </a>功能时序图</h2>
<h3 id="铸造"><a class="header-anchor" href="#铸造"> </a>铸造</h3>
<p>管理员给<code>IMX Engine</code>发送铸币请求并附带签名，<code>IMX Engine</code>执行批次化后交由<code>Prover</code>进行生成有效性证明生成<code>Proof</code>提交到以太坊的验证合约进行验证。<br>
<img src="/posts/487c3c24/f-3.png" alt></p>
<h3 id="存款"><a class="header-anchor" href="#存款"> </a>存款</h3>
<p>用户发送代币转账到以太坊合约中，<code>IMX Engine</code>监听到存款事件后更改网络状态后交由<code>Prover</code>进行生成有效性证明生成<code>Proof</code>提交到以太坊的验证合约进行验证。<br>
<img src="/posts/487c3c24/f-4.png" alt></p>
<h3 id="取款"><a class="header-anchor" href="#取款"> </a>取款</h3>
<ul>
<li>一般情况：链下触发。用户发起提款请求。<code>IMX Engine</code>执行批次化后交由<code>Prover</code>进行生成有效性证明生成<code>Proof</code>提交到以太坊的验证合约进行验证。验证通过后用户在以太坊上调用取款取出资产。<br>
<img src="/posts/487c3c24/f-5.png" alt></li>
<li>特殊情况（例如：<code>IMX Engine</code> down掉）用户可以直接调用链上的紧急退出功能经过锁定时间窗口后取出所有资产。</li>
</ul>
<h3 id="交易"><a class="header-anchor" href="#交易"> </a>交易</h3>
<p><code>IMX Engine</code>内维护了一个中央订单簿。用户创建卖单将在<code>IMX Engine</code>中进行维护。当<code>IMX Engine</code>接收到对应买单会自动撮合，随后交由<code>Prover</code>进行生成有效性证明生成<code>Proof</code>提交到以太坊的验证合约进行验证。<br>
<img src="/posts/487c3c24/f-6.png" alt></p>
<h2 id="SDK-API"><a class="header-anchor" href="#SDK-API"> </a>SDK &amp;&amp; API</h2>
<p><code>Immutable X SDK</code> 是一个由<code>Immutable</code>创建的<code>Javascript</code>包，允许与<code>Immutable X</code>的<code>API</code>进行简单接口。主要使用的包是 <code>Link SDK</code>和<code>Immutable X Client</code>。<br>
<code>Immutable X Client</code>用于大多数后端操作，<code>Link SDK</code>用于前端、面向用户的交互。</p>
<p><a href="https://docs.x.immutable.com/docs/sdk-api">SDK</a><br>
<a href="https://docs.x.immutable.com/reference/get_v1-orders">API</a><br>
<a href="https://docs.x.immutable.com/docs/api-rate-limiting">API调用限制</a></p>
<h1 id="探索-StarkNet"><a class="header-anchor" href="#探索-StarkNet"> </a>探索 StarkNet</h1>
<h2 id="几个概念"><a class="header-anchor" href="#几个概念"> </a>几个概念</h2>
<h3 id="状态机"><a class="header-anchor" href="#状态机"> </a>状态机</h3>
<p><img src="/posts/487c3c24/f-7.png" alt></p>
<p><code>Y(S, T)= S'</code></p>
<p>给定一个旧的有效状态 <code>（S）</code>和一组新的有效交易 <code>（T）</code>，以太坊状态转换函数 <code>Y（S，T）</code> 产生新的有效输出状态<code>S'</code>。</p>
<h3 id="Re-Execution"><a class="header-anchor" href="#Re-Execution"> </a>Re-Execution</h3>
<p>是一种通过执行相同的计算来证明一个事实。</p>
<h3 id="零知识证明-2"><a class="header-anchor" href="#零知识证明-2"> </a>零知识证明</h3>
<p>零知识证明的目标是让验证者相信证明者拥有某个秘密(<code>withness</code>)，满足某种关系，而无需向验证者或其他任何人透露秘密本身。<br>
定义：</p>
<ul>
<li>完整性（<code>Completeness</code>）：如果证明者是诚实的，那么她最终会说服验证者。</li>
<li>可靠性（<code>Soundness</code>）：证明者只能说服验证者该陈述是否属实。</li>
<li>零知识性（<code>Zero-knowledgeness</code>）：除了知道陈述是真实的，验证者不知道任何额外的信息。</li>
</ul>
<h2 id="区块链解决了什么问题？"><a class="header-anchor" href="#区块链解决了什么问题？"> </a>区块链解决了什么问题？</h2>
<p>信任问题：系统A如何相信系统B陈述了一个事实。</p>
<h3 id="经典系统"><a class="header-anchor" href="#经典系统"> </a>经典系统</h3>
<ul>
<li>传统中心化账本系统：数据都存在一个大型计算机的账本系统中，用户使用时必须相信这个系统。</li>
<li>经典区块链系统：区块链具有包容性和问责制。每个操作员都有一个账本系统，操作员除经过自己验证数据可信之外，并不相信任何人的数据。每个操作员都需要验证所有交易的有效性。</li>
</ul>
<p><img src="/posts/487c3c24/f-8.png" alt><br>
区块链系统为了验证数据，所有交易都要公开在网络中，牺牲了数据的隐私性。</p>
<h3 id="解决方案"><a class="header-anchor" href="#解决方案"> </a>解决方案</h3>
<ul>
<li>增量扩容：通过扩大区块内交易数量或计算逻辑会导致操作节点需要更强的性能来处理更多的数据，越来越多的节点因为机器性能不足从而退出网络。导致节点数量减少，偏向于中心化。<br>
<img src="/posts/487c3c24/f-9.png" alt></li>
<li>有效性证明系统：有效性证明将操作员拆分为二：证明者（<code>Prover</code>）和验证者（<code>Verifier</code>）。证明者执行数据逻辑生成一个证明（<code>Proof</code>）交由给验证者网络，使验证者可以通过验证这个证明本身就可以相信证明者数据的有效性。有效性证明是个<code>NP</code>问题（证明困难，验证简单）。既保证了数据的隐私，又可以让验证者轻易的相信数据可靠。<br>
<img src="/posts/487c3c24/f-11.png" alt></li>
</ul>
<h2 id="ZK-STARK-Proofs"><a class="header-anchor" href="#ZK-STARK-Proofs"> </a>ZK-STARK Proofs</h2>
<p><code>zk-STARK</code>不需要可信设置（<code>non-setup</code>），是一种透明化的零知识证明系统。<br>
<img src="/posts/487c3c24/f-11.png" alt><br>
<img src="/posts/487c3c24/f-12.png" alt><br>
<img src="/posts/487c3c24/f-13.png" alt><br>
验证者只需验证<code>Proof</code>就可以相信证明者发送的最新状态，而不需要验证交易本身。</p>
<h3 id="Zkp常见系统比较"><a class="header-anchor" href="#Zkp常见系统比较"> </a>Zkp常见系统比较</h3>
<p><img src="/posts/487c3c24/f-14.png" alt></p>
<p>从上图可看出：<code>STARKs</code>的证明、验证和见证大小复杂度均高于其他系统（多项式对数复杂度随着规模扩大，系统效率越高，所以要进行批次化）。优点是不需要可信设置（<code>Trusted setup</code>），并且他的加密假设是基于哈希碰撞，具有良好的后量子安全的特点。</p>
<h2 id="Cairo-Language"><a class="header-anchor" href="#Cairo-Language"> </a>Cairo Language</h2>
<p><code>Cairo</code>是一种用于为一般计算创建<code>STARK</code>证明程序的图灵完备语言。<code>Cairo</code>为<code>StarkEx</code>提供支持，后者可扩展<code>Mainnet</code>上的应用程序（包括 <code>dYdX</code>、<code>Sorare</code>、<code>Immutable X</code>和 <code>DeversiFi</code>）。<code>Cairo</code>是<code>StarkNet</code>的原生智能合约语言。</p>
<h2 id="StarkNet-2"><a class="header-anchor" href="#StarkNet-2"> </a>StarkNet</h2>
<p><code>StarkNet</code>是无须许可的去中心化的<code>zk-Rollup</code>。它作为以太坊的<code>Layer2</code>网络运行。在<code>StarkNet</code>上使用<code>Cairo</code>开发的<code>dApp</code>，可以支持无限规模的计算。<br>
特点：</p>
<ul>
<li>可扩展性和完整性：<code>StarkNet</code>支持规模化，可以使用<code>Layer1</code>以太坊的安全性，通过在链下生成<code>STARK</code>证明，然后在链上进行验证。</li>
<li>通用性：在<code>StarkNet</code>上，开发人员可以使用<code>Cairo</code>编写智能合约轻松部署任何业务逻辑。</li>
<li>可组合性：<code>StarkNet</code>提供以太坊级别的可组合性，促进轻松开发和创新。</li>
</ul>
<h3 id="路线图"><a class="header-anchor" href="#路线图"> </a>路线图</h3>
<p><img src="/posts/487c3c24/f-15.png" alt></p>
<ul>
<li>阶段一 <code>Planets</code>: 单应用、单操作节点的<code>Rollups</code></li>
<li>阶段二 <code>Constellations</code>: 多应用、单操作节点的<code>Rollups</code></li>
<li>阶段三 <code>Universe</code>: 多应用、去中心化节点的<code>Rollups</code></li>
</ul>
<h3 id="当前进度-2"><a class="header-anchor" href="#当前进度-2"> </a>当前进度</h3>
<p><img src="/posts/487c3c24/f-16.png" alt></p>
<h3 id="架构图"><a class="header-anchor" href="#架构图"> </a>架构图</h3>
<p><img src="/posts/487c3c24/f-17.png" alt><br>
<code>StarkNet Full Node</code>：<code>StarkNet</code>网络中的一个节点，仅用于查询当前StarkNet状态。<br>
<code>StarkNet Sequencer Node</code>：<code>StarkNet</code>网络中用于定序和生成零知识证明的节点。相当于<code>StarkNet</code>的矿工。</p>
<h2 id="递归零知识证明"><a class="header-anchor" href="#递归零知识证明"> </a>递归零知识证明</h2>
<h3 id="定义-2"><a class="header-anchor" href="#定义-2"> </a>定义</h3>
<p>递归零知识证明：使用前一个状态的<code>Proof</code>以及当前交易作为输入，接下来<code>Prover</code>去尝试证明前一个状态的<code>Proof</code>以及当前交易是否有效，如果全部验证通过，程序会输出一个新的状态及一个<code>Proof</code>，过程如下图所示：</p>
<p><img src="/posts/487c3c24/f-18.png" alt><br>
递归零知识证明验证：只要验证前一个状态的<code>Proof</code>就可以验证整个链的状态，比如：当验证<code>Proof #5</code>状态是正确的，相当于递归验证了<code>Proof #4</code>，<code>Proof #3</code>。</p>
<p><code>Mina</code>（旧称<code>Coda</code>）项目，将整个区块链维持在22k，其中就使用了递归零知识证明。<br>
优点：递归零知识证明有非常好的聚合（压缩）、节省空间的优点。</p>
<h3 id="多层网络"><a class="header-anchor" href="#多层网络"> </a>多层网络</h3>
<p>某些<code>dApp</code>需要特殊的定制，这可能更好地在此层基础上，构建一个新的独立层提供服务。<br>
具体过程：</p>
<ul>
<li>每层网络都有一个<code>Cairo</code>程序，它可以作为该层网络的共识，或具体的业务。</li>
<li>下层网络提交<code>Proof</code>和<code>State Update</code>（在<code>zk-rollup</code>需要包含与之相关的<code>Merkle Tree</code>，在<code>Validium</code>下只需要<code>Merkle Tree Root</code>）到该层<code>Prover</code>进行定序和批次化。</li>
<li><code>Prover</code>使用<code>State Update</code>更新该层网络状态对应下层网络<code>Key</code>「保险库」的<code>State</code>。</li>
<li><code>Prover</code>调用该层<code>Cairo</code>程序并输入<code>Inputs</code>（更新前的网络状态）、<code>Outputs</code>（更新后的网络状态）、<code>txs</code>（下层网络提交的<code>Proofs</code>和<code>State Update</code>），生成该层的<code>Proof</code>和<code>State Update</code>，并将提交到上层网络的<code>Verifer</code>验证。</li>
</ul>
<p>注意：此处是一个递归化的过程。<br>
每层网络中都维护一个网络状态。<br>
利用零知识隐私化的特性，每层网络只需要关心当前层的网络状态合理化而无须关心下层网络本身。</p>
<p><img src="/posts/487c3c24/f-19.png" alt></p>
<h3 id="经典Layer2架构"><a class="header-anchor" href="#经典Layer2架构"> </a>经典Layer2架构</h3>
<ul>
<li><code>L2 Contract</code>：记录<code>Layer2 State/Root</code>的合约。</li>
<li><code>Verifier Contract</code>：用于验证<code>Layer2</code>状态转移有效性的<code>Verifier</code>的合约。</li>
<li>桥接<code>Layer1</code>、<code>Layer2</code>的资产出入管理合约。</li>
<li><code>ERC20/ERC721</code>账户模型对应网络的镜像。</li>
</ul>
<p><img src="/posts/487c3c24/f-20.png" alt></p>
<h3 id="应用在Layer3上"><a class="header-anchor" href="#应用在Layer3上"> </a>应用在Layer3上</h3>
<p>与<code>Layer2</code>在<code>Layer1</code>一样，<code>Layer3</code>也可以使用相同的结构并添加差异化的功能。<br>
<img src="/posts/487c3c24/f-21.png" alt></p>
<h1 id="参考资料-3"><a class="header-anchor" href="#参考资料-3"> </a>参考资料</h1>
<blockquote>
<p><a href="https://medium.com/starkware/fractal-scaling-from-l2-to-l3-7fe238ecfb4f">https://medium.com/starkware/fractal-scaling-from-l2-to-l3-7fe238ecfb4f</a><br>
<a href="https://medium.com/starkware/redefining-scalability-5aa11ffc5880">https://medium.com/starkware/redefining-scalability-5aa11ffc5880</a><br>
<a href="https://iosgvc.medium.com/scaling-summit-2021-keynote-recap-stark-validity-rollup-an-ultimate-scaling-technology-9cc62b307f69">https://iosgvc.medium.com/scaling-summit-2021-keynote-recap-stark-validity-rollup-an-ultimate-scaling-technology-9cc62b307f69</a></p>
</blockquote>
]]></content>
      <categories>
        <category>区块链</category>
      </categories>
      <tags>
        <tag>StarkNet</tag>
        <tag>Cairo</tag>
        <tag>STARK</tag>
      </tags>
  </entry>
  <entry>
    <title>VSCode设置FiraCode字体</title>
    <url>/posts/12238235/</url>
    <content><![CDATA[<h2 id="VSCode设置FiraCode字体"><a class="header-anchor" href="#VSCode设置FiraCode字体"> </a>VSCode设置FiraCode字体</h2>
<ol>
<li>进入FiraCode的<a href="https://github.com/tonsky/FiraCode?_pjax=%23js-repo-pjax-container">Github仓库</a>下载字体</li>
<li>安装<code>ttf</code>文件夹内所有字体</li>
<li>更改vscode的<code>settings.json</code>中关于字体的设置参数</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">&quot;editor.fontFamily&quot;: &quot;&#39;Fira Code&#39;, Consolas, Monaco, &#39;Courier New&#39;, monospace&quot;,
&quot;editor.fontLigatures&quot;: true,<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>fontLigatures</code> 为启用字体连字</p>
]]></content>
      <tags>
        <tag>工具</tag>
        <tag>vscode</tag>
      </tags>
  </entry>
  <entry>
    <title>filecoin的元数据证明和lurk</title>
    <url>/posts/a537129b/</url>
    <content><![CDATA[<h1 id="Lurk-2"><a class="header-anchor" href="#Lurk-2"> </a>Lurk</h1>
<p>Lurk 是一种用于图灵完备递归 SNARK 的开发中的编程语言：</p>
<ul>
<li><a href="https://github.com/lurk-lang/root">https://github.com/lurk-lang/root</a></li>
</ul>
<h1 id="资料"><a class="header-anchor" href="#资料"> </a>资料</h1>
<p><a href="https://www.youtube.com/watch?v=iQkedSqQH34">https://www.youtube.com/watch?v=iQkedSqQH34</a></p>
<h1 id="留坑待补充…"><a class="header-anchor" href="#留坑待补充…"> </a>留坑待补充…</h1>
]]></content>
      <categories>
        <category>区块链</category>
      </categories>
      <tags>
        <tag>filecoin</tag>
        <tag>Lurk</tag>
      </tags>
  </entry>
  <entry>
    <title>golang代码布局规范</title>
    <url>/posts/12dd2a6/</url>
    <content><![CDATA[<h2 id="golang标准的代码布局规范参见"><a class="header-anchor" href="#golang标准的代码布局规范参见"> </a>golang标准的代码布局规范参见</h2>
<p><a href="https://github.com/golang-standards/project-layout/blob/master/README_zh.md">Standard Go Project Layout</a></p>
]]></content>
      <tags>
        <tag>golang</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo 自动化部署到个人站点并设置chroot</title>
    <url>/posts/8c5b8b7f/</url>
    <content><![CDATA[<p>留坑<br>
<a href="https://blog.csdn.net/wmq880204/article/details/80671855">https://blog.csdn.net/wmq880204/article/details/80671855</a></p>
]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>chroot</tag>
      </tags>
  </entry>
  <entry>
    <title>polynomial commitments理解</title>
    <url>/posts/74fa8e83/</url>
    <content><![CDATA[<h1 id="留坑"><a class="header-anchor" href="#留坑"> </a>留坑</h1>
<p><a href="https://www.youtube.com/watch?v=7ggwLccuN5s&amp;t=101s">https://www.youtube.com/watch?v=7ggwLccuN5s&amp;t=101s</a></p>
]]></content>
      <categories>
        <category>区块链</category>
      </categories>
      <tags>
        <tag>多项式承诺</tag>
      </tags>
  </entry>
  <entry>
    <title>区块链上的随机数生成</title>
    <url>/posts/7946d7ef/</url>
    <content><![CDATA[<h1 id="区块链中的随机数"><a class="header-anchor" href="#区块链中的随机数"> </a>区块链中的随机数</h1>
<p>在权益证明（PoS）区块链中，随机性对于验证人职责的公平且不可预测分配很重要。</p>
<p>计算机并不擅长随机数，因为它们是确定性设备（相同的输入始终会产生相同的输出）。通常大家在计算机上（例如在游戏应用程序中）所说的 “随机数” 实际上是伪随机的。也就是说，它们依赖于用户或其他类型的 Oracle（预言机）提供的足够随机的种子，例如气象站的大气噪声、你的心律，甚至是熔岩灯，它都可以从中产生一系列看似随机的数字。但是给定相同的种子，将始终生成相同的序列。</p>
<p>然而，这些输入将根据时间和空间而变化，而且不可能将相同的结果输入到全球特定区块链的所有节点中。如果节点获得不同的输入并用它来出块，则会发生分叉。显然，现实世界的无序状态不适合用作区块链随机性的种子。</p>
<p>目前区块链生产环境中使用的随机数方案主要有2种：</p>
<ul>
<li>RANDAO</li>
<li>VRF</li>
</ul>
<p>polkadot、filecoin、Algonand 采用的是VRF方案。<br>
ETH2.0 采用RANDAO + VDF 方案。</p>
<h1 id="VRF"><a class="header-anchor" href="#VRF"> </a>VRF</h1>
<p>可验证随机数(Verifiable Random Function)</p>
<p>VRF具有：</p>
<ul>
<li>唯一性（对于同一消息，多次签名均为唯一相同结果的基于公钥签名机制）</li>
<li>抗碰撞性</li>
<li>伪随机性</li>
</ul>
<p>VRF的算法主要包含<code>VRFkeygen</code>, <code>VRFeval</code>, <code>VRFverify</code>.</p>
<h2 id="采用VRF生成随机数"><a class="header-anchor" href="#采用VRF生成随机数"> </a>采用VRF生成随机数</h2>
<p>可验证随机函数（VRF）是一种数学运算，需要一些输入并产生一个随机数以及该提交者生成该随机数的真实性证明。任何挑战者都可以验证该证明，以确保随机数生成有效。</p>
<p>Polkadot 中使用的 VRF 与 Ouroboros Praos 中使用的 VRF 大致相同。Ouroboros 的随机性对于出块来说是安全的，并且对于 BABE 也运行得很好。它们的不同之处在于，Polkadot 的 VRF 不依赖于中央时钟（问题变成了 “谁控制中央时钟？”），而是取决于它自己的过去结果来确定现在和将来的结果，并且它使用<code>slot</code>号（<code>slot number</code>）作为时钟仿真器来估计时间。</p>
<p>具体操作如下：</p>
<p><code>slot</code>为6秒时长内的离散时间单位，每个<code>slot</code>中可包含一个区块，也可不包含。多个<code>slot</code>可组成<code>epochs</code>，在波卡中，2400个<code>slot</code>组成1个<code>epoch</code>，也就是说每个<code>epoch</code>时长为4小时。</p>
<p>可验证的随机函数是一个函数，在伪代码中，可以这样表示：</p>
<blockquote>
<p>(RESULT, PROOF) = VRF(SECRET, INPUT)</p>
</blockquote>
<p>也就是说，对于一些<code>SECRET</code>，一些可以是公开的<code>INPUT</code>，结果是一个元组<code>RESULT</code>和<code>PROOF</code>，在这里<code>PROOF</code>可以通过外部观察来验证<code>RESULT</code>的合法性。</p>
<p>换句话说，进行<code>VRF Roll</code>会产生一个随机数和一个证明表示您获得了该随机数。并不仅仅是选中了你。</p>
<p>在每个<code>slot</code>，每个验证者会掷骰子，以下作为VRF函数的输入：</p>
<ul>
<li>SECRET：为掷骰子产生结果的指定特殊的key(验证者的私钥)。</li>
<li>INPUT：如果链中存在的<code>epoch</code>少于2个，则它是来自创世块的特定值。如果大于2个，则是过去2个<code>epoch</code>中所有 VRF RESULT 的<code>hash</code>。INPUT内还包含<code>slot</code>的编号。</li>
</ul>
<p>VRF的输出为：</p>
<ul>
<li>RESULT：产生的随机值。将该值与协议中设置的<code>THRESHOLD</code>比对，若该值低于<code>THRESHOLD</code>，则摇出该值的验证者为该<code>slot</code>的合格的区块生成候选人。该验证者创建并向网络提交区块，区块中需附带<code>RESULT</code>和<code>PROOF</code>值。</li>
<li>PROOF：为该随机值的证明，证明生成该随机值的过程是正确的。</li>
</ul>
<p>一旦验证者执行了 VRF，<code>RESULT</code>就会与协议中定义的<code>THRESHOLD</code>值进行比较。如果<code>RESULT</code>小于<code>THRESHOLD</code>，则验证器是该<code>slot</code>的有效块提议者候选者。否则，验证器将跳过该槽。</p>
<p>钓鱼人（fisherman）- 监视网络的收集人和验证人错误行为的节点，将验证中继链区块。由于非法投掷将产生非法区块，并且由于钓鱼人将在验证人产生的每个区块中访问 RESULT 和 PROOF，因此他们很容易自动报告作弊的验证人。</p>
<p>总结一下：在 VRF 下，每个验证人都会为自己掷出一个数字，并根据<code>THRESHOLD</code>对其进行检查，如果随机掷出的骰子低于该<code>THRESHOLD</code>，则会生成一个区块。观察网络并报告不良行为的钓鱼人事后会验证这些投掷的有效性，并向系统报告任何作弊行为（例如，有人尽管掷出的数量超过<code>THRESHOLD</code>，但仍然假装成出块者）。</p>
<p>精明的读者会注意到，由于这种工作方式，某些<code>slot</code>可能没有验证人作为出块候选者，因为所有验证人候选者的得分都太高而错过了<code>THRESHOLD</code>。我们阐明了如何解决此问题，并确保与 Wiki 页面的共识部分 的 Polkadot 出块时间保持几乎一致。</p>
<h1 id="RANDAO"><a class="header-anchor" href="#RANDAO"> </a>RANDAO</h1>
<p>RANDAO是利用经济模式（奖励跟处罚）的方式，促使在公共场域中能产生随机变量</p>
<p>原理很简单，想参加的人把拿钱来抵押，需要产生随机数的人要付钱。所以参加者就可以从中分润，当然不守规矩抵押的钱也就会被没收，利用奖励跟处罚的方式迫使大家都守规矩。详细步骤如下：</p>
<p>首先，会有个收集seed的时间，例如6个block的时间。接着，想参与的人，投入某个数量的ETH到RANDAO这个smart contract（作质押），然后附上secret（某个只有你知道的值s，然后作sha3）。</p>
<ol>
<li>
<p>等收集时间结束，就是验证时间。此阶段所有参与着需要把s传入smart contract做验证，smart contract会把s作sha3，去验证是不是跟第一阶段传进来的一致。最终会把验证过的s当作seed去产生随机数。</p>
</li>
<li>
<p>最后，就是产生随机数，然后把随机数传给之前有请求过的contract。然后归还质押的ETH跟利润分给参与者。</p>
</li>
</ol>
<p>此外有几个附加条件：</p>
<ol>
<li>
<p>第一阶段若收集到数笔一样的secret，只接受第一笔；</p>
</li>
<li>
<p>第一阶段会规定基本人数，若结束后未到达人数门坎，则此次的产生就失败；</p>
</li>
<li>
<p>若第二阶段需提供s；</p>
<ol>
<li>若未提供，则质押的ETH会被没收；</li>
<li>若此阶段有一个以上参与着未提供s，则此次产生失败，并且把没收的 ETH分给有提供s的参与者。且退还请求者所支付的ETH；</li>
</ol>
</li>
</ol>
<p>RANDAO会在内建在Beacon chain的逻辑中，而不是一个独立的smart contract，但RANDAO有个缺点，就是最后一位可以预测/操纵结果。如下图，因为最后一位可以知道前面的值，所以在最后可以决定要出值或是不出，因此可以操纵结果。(目前epoch是64个slot，而每个slot是6秒，所以epoch约是6.4 minutes)</p>
<p><img src="/posts/7946d7ef/figure1.png" alt></p>
<p>对于这一问题，以太坊 2.0 将通过 VDF （可验证延迟函数）来解决！</p>
<h1 id="RANDAO-VDF"><a class="header-anchor" href="#RANDAO-VDF"> </a>RANDAO + VDF</h1>
<p>VDF把RANDAO产生出来的随机数当种子去产生随机数，而且计算时间要够长</p>
<p>VDF 全称为 Verifiable Delay Function （可验证延迟函数)。</p>
<p>其言外之意就是此类行数需要花很长时间来进行计算。</p>
<p>比如，对数字 X 来说，一种 VDF 可以是 X 的连续 6 次平方：</p>
<p>((((((X^2)^2)^2)^2)^2)^2)^2<br>
假如 X=5，那么最终结果就是：</p>
<p>((((((5^2)^2)^2)^2)^2)^2)^2 =(((((25^2)^2)^2)^2)^2)^2 =((((625^2)^2)^2)^2)^2 =(((390625^2)^2)^2)^2 =((152587890625^2)^2)^2 =(23283064365386962890625^2)^2 =542101086242752217003726400434970855712890625^2 =293873587705571876992184134305561419454666389193021880377187926569604314863681793212890625<br>
随着计算的继续，计算的结果将越来越大。一个复杂的 VDF 将需要花费很长的时间才能计算出来，因为对于任何计算机来说，其计算过程都是非常复杂的。这个例子来源于一个真实的 VDF，直到现在它还是在 MIT 的一个时间胶囊密码学谜题的一部分，该 VDF 用了 80 万亿次平方。</p>
<p>那么这有什么意义呢？</p>
<p>首先，在计算最终数字时的延迟（delay）是可以 验证的，我们知道哪些计算机操作是达到结果所必需的，并且能够以合理的精确度确定机器达到结果所需要的时间。</p>
<p>其次，如果要计算出第三级结果，那计算机就 必须 先计算出第一级和第二级的结果 —— 我们无法在多台计算机上并行地进行此计算，因为每个新的输入都依赖于之前的输出，而且每个输出都需要预先确定的计算时间。</p>
<p>如果现在我们用 RANDAO 中的随机数来代替上方 VDF 例子中的数字 X，且如果函数的指数不是 6 而是好几千，并且函数不是使用平方（^2）而是更复杂的函数，那么我们将得到一个完全不同的函数，这个函数会将 RANDAO 的结果转变成另一个完全不一样的随机数，而且要计算出这个结果将需要花上一段时间，不管你拥有多少台电脑。</p>
<p>以太坊随机数生成机制：RANDAO 与 VDF 的完美结合</p>
<p>通过引入这种延迟，并使计算的时间要长于验证者可以通过影响某个随机数而获得利益的时间，我们就可以消除最后一级的随机性偏差 —— 即消除单个验证者可以对 RANDAO 结果产生的最后一点操控。</p>
<p>在以太坊 2.0 阶段，这个 VDF 被定义为 102 分钟时长 —— 超过了一个半小时。当前以太坊基金会正与 Filecoin 等区块链项目合作，资助开发一种针对此计算优化的开源 ASIC —— 这是一种专门用来进行这种计算的微型计算机。该机器将由爱好者、加密货币项目和其他区块链平台甚至验证者来运行，它具有一个小优势，可以第一时间响应 VDF 检查，而且不需要比一般的微型计算机全节点更高的电力成本。</p>
<p>这样一种高度专业化的机器确保了任何其他试图对 RANDAO 重获最后一点影响的人，都必须开发出比当前的 ASIC 效率高 100 倍的机器。开发这种设备将耗资巨大，除非真有某种一本万利的用途；而如果能开发出来的话，几乎可以完全摧毁以太坊。</p>
<p>在以太坊 2.0 阶段，每 6.4 分钟称为一个时间段（epoch)。每经过一个 epoch， RAODAO 就揭晓一次，同时这也意味着每过一个 epoch 我们就得运行一个新的 VDF。每个 VDF 的周期是 102.4 分钟，因此总会有 16 个 VDF 同时运行。VDF 得到的结果即作为随机性种子，用来选定下一组验证者，保证公平性。</p>
<p><strong>。。未完留坑</strong></p>
<h1 id="引用和参考文献-2"><a class="header-anchor" href="#引用和参考文献-2"> </a>引用和参考文献</h1>
<blockquote>
<p><a href="https://wiki.polkadot.network/docs/learn-randomness">PolkadotWiki</a><br>
<a href="https://www.panewslab.com/zh/articledetails/D50471778.html">波卡的随机性</a></p>
</blockquote>
]]></content>
      <categories>
        <category>区块链</category>
      </categories>
      <tags>
        <tag>区块链</tag>
        <tag>Randao</tag>
        <tag>VRF</tag>
      </tags>
  </entry>
  <entry>
    <title>在确定性系统实现随机数-Randao机制</title>
    <url>/posts/408d5eb7/</url>
    <content><![CDATA[<h1 id="问题"><a class="header-anchor" href="#问题"> </a>问题</h1>
<p><strong>如何在区块链系统中使用随机数</strong><br>
最简单的实现是使用当前状态信息处理后作为随机数的seed使用。例如:在solidity中使用blockhash、时间戳等信息处理后作为seed。<br>
但是矿工有能力操纵这些区块链数据，因此能够间接影响随机数。若随机数包含区块链数据，会使矿工有能力构建对其有利的随机数。</p>
<h1 id="规则"><a class="header-anchor" href="#规则"> </a>规则</h1>
<p>一枚任何人都能参与，大家一起生成随机数的DAO（去中心化自治组织）！首先，需要在区块链中创建一个RANDAO合约，定义参与规则。生成随机数的基本过程可以分为三个阶段：</p>
<h2 id="第一阶段：收集有效sha3-s"><a class="header-anchor" href="#第一阶段：收集有效sha3-s"> </a>第一阶段：收集有效sha3(s)</h2>
<p>想要参与生成随机数的人需要在指定时间段内（例如，6个区块期间，约72s）向合约C发送m个ETH做抵押并附上sha3（s）的结果，s为参与者自选的秘密数字。</p>
<h2 id="第二阶段：收集有效s"><a class="header-anchor" href="#第二阶段：收集有效s"> </a>第二阶段：收集有效s</h2>
<p>第一阶段后，成功提交sha3（s）的人要在第一阶段指定时间内向合约C发送一笔带有秘密数字s的交易。合约C会对s运行sha3运算并将结果与先前提交的数据进行比较，检查s是否有效。有效s将被保存到种子集合中，最终生成随机数。</p>
<h2 id="第三阶段：计算随机数、退还押金及奖金"><a class="header-anchor" href="#第三阶段：计算随机数、退还押金及奖金"> </a>第三阶段：计算随机数、退还押金及奖金</h2>
<ol>
<li>
<p>成功收集全部秘密数字后，合约C根据函数f（s1，s2，…，sn）计算出随机数，计算结果会被写入C的存储并发送到之前请求随机数的其他合约。</p>
</li>
<li>
<p>合约C在第一阶段将押金返还给参与者，并将利润分成相等份作为额外奖励发给全部参与者。收益指消耗随机数的其他合约所支付的费用。</p>
</li>
</ol>
<h2 id="附加规则"><a class="header-anchor" href="#附加规则"> </a>附加规则</h2>
<p>为确保RNG不受操纵，同时出于安全和效率考量，合约C有以下附加规则：</p>
<ol>
<li>
<p>第一阶段中，超过两个相同sha3（s）按顺序提交时，接受第一个。</p>
</li>
<li>
<p>第一阶段中，设参与人数最低门槛，该时间段内未能收集足够sha3时，该区块高度的RNG失败。</p>
</li>
<li>
<p>参与者提交sha3（s）被合约C接受时，须在第二阶段中披露该s。</p>
<ol>
<li>参与者未能在第二阶段披露s时，第一阶段发送的m个ETH被没收且不提供任何回报。</li>
<li>第二阶段有一个或多个s未披露时，此块高度的RNG失败。没收的ETH被均分成等份发予在第二阶段中披露s的其他参与者。其他合约支付的费用予以退还。</li>
</ol>
</li>
</ol>
<h1 id="drand-分布式随机信标守护进程"><a class="header-anchor" href="#drand-分布式随机信标守护进程"> </a>drand 分布式随机信标守护进程</h1>
<p><a href="https://github.com/drand/drand">https://github.com/drand/drand</a></p>
]]></content>
      <categories>
        <category>区块链</category>
      </categories>
      <tags>
        <tag>eth</tag>
        <tag>区块链</tag>
        <tag>randao</tag>
      </tags>
  </entry>
  <entry>
    <title>探索全同态加密</title>
    <url>/posts/a5f2eb4/</url>
    <content><![CDATA[<h1 id="全同态加密是什么"><a class="header-anchor" href="#全同态加密是什么"> </a>全同态加密是什么</h1>
<p>近几年对于个人隐私保护的话题越来越多，包括同态加密在内的一系列密码学应用技术也得到了很广泛的普及。在了解全同态加密（Fully Homomorphic Encryption/FHE）之前我们先了解下同态加密。</p>
<h1 id="发展史"><a class="header-anchor" href="#发展史"> </a>发展史</h1>
<p><a href="https://salt-security.com/nieuws/fully-homomorphic-encryption-de-geschiedenis/">https://salt-security.com/nieuws/fully-homomorphic-encryption-de-geschiedenis/</a></p>
<h1 id="同态加密-2"><a class="header-anchor" href="#同态加密-2"> </a>同态加密</h1>
<p>同态加密体系大致上被分为四类：部分同态、近似同态、有限级数全同态与完全同态。</p>
<h2 id="部分同态加密"><a class="header-anchor" href="#部分同态加密"> </a>部分同态加密</h2>
<p>部分同态加密（Homomorphic encryption）也叫半同态加密，是一种加密形式，它允许人们对密文进行特定形式的代数运算得到仍然是加密的结果，将其解密所得到的结果与对明文进行同样的运算结果一样。<br>
半同态加密模式：</p>
<ul>
<li>加法同态：满足<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo><mi>E</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo><mo>=</mo><mi>E</mi><mo stretchy="false">(</mo><mi>X</mi><mo>+</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">E(X)E(Y)=E(X+Y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span></span></span></span>。典型的例子为：椭圆曲线加密算法中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>g</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">E(x)=gx</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">gx</span></span></span></span>（其中g为椭圆曲线的generator），则<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mi>E</mi><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><mi>g</mi><mi>x</mi><mi>g</mi><mi>y</mi><mo>=</mo><mi>g</mi><mo stretchy="false">(</mo><mi>x</mi><mo>+</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><mi>E</mi><mo stretchy="false">(</mo><mi>x</mi><mo>+</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">E(x)E(y)=gxgy=g(x+y)=E(x+y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">gxg</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span>，具有加法同态性。 以及Pedersen Commit也具有加法同态性。</li>
<li>乘法同态：满足<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo><mi>E</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo><mo>=</mo><mi>E</mi><mo stretchy="false">(</mo><mi>X</mi><mi>Y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">E(X)E(Y)=E(XY)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span></span></span></span>。典型的例子为：RSA加密算法中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>x</mi><mi>e</mi></msup></mrow><annotation encoding="application/x-tex">E(x)=x^e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span></span></span></span>（其中e为公钥），则<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mi>E</mi><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>x</mi><mi>e</mi></msup><msup><mi>y</mi><mi>e</mi></msup><mo>=</mo><mo stretchy="false">(</mo><mi>x</mi><mi>y</mi><msup><mo stretchy="false">)</mo><mi>e</mi></msup><mo>=</mo><mi>E</mi><mo stretchy="false">(</mo><mi>x</mi><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">E(x)E(y)=x^ey^e=(xy)^e=E(xy)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8588em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span>，具有乘法同态性。</li>
</ul>
<p>在加密计算中，加法同态可以完成任何加法运算。乘法同态亦然。</p>
<h2 id="近似同态加密"><a class="header-anchor" href="#近似同态加密"> </a>近似同态加密</h2>
<p>如果我们又想让私密输入相乘，又想得到它们之间的线性组合的话，单纯的部分同态加密算法（RSA，ElGamal）是无法完成的。所以我们就需要来到下一阶段。</p>
<p>部分同态加密的下一阶段是近似同态加密，这一阶段距离我们想要实现的全同态更近了一步。如果我们有近似同态加密算法的话，那么我们就可以在密文上同时计算加法与乘法了。但是需要注意的是，正因为这一阶段是近似同态（Somewhat Homomorphic）的，所以可以做的加法和乘法次数非常有限，可以计算的函数也在一个有限的范围内。<strong>因为我们不能计算任意逻辑和深度的函数。</strong></p>
<h2 id="有限级数全同态加密"><a class="header-anchor" href="#有限级数全同态加密"> </a>有限级数全同态加密</h2>
<p>来到下一个阶段之后，我们距离全同态的目标更进一步了。</p>
<p>这一阶段被称之为有限级数全同态加密。在这一阶段的话，我们已经可以对密文进行任意的加法乘法组合了，没有任何对于次数的局限性。</p>
<p>但是之所以被称之为有限级数全同态的原因是，这个阶段的算法会引入一个新的复杂度上限<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span></span></span></span>的概念，这一复杂度上限约束了函数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span>的复杂度。如果我们可以把<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span>用二进制电路<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>来表示的话，<strong>那么<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>的深度和大小一定要在<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span></span></span></span>的范围之内。</strong></p>
<h2 id="全同态加密"><a class="header-anchor" href="#全同态加密"> </a>全同态加密</h2>
<p>全同态加密的系统<strong>没有任何计算方法的限制</strong>，我们可以允许第三方对加密数据执行计算，并获得加密结果，他们可以将其交还给拥有原始数据解密密钥的任何人，而第三方无法自行解密数据或结果。<br>
<img src="/posts/a5f2eb4/f1.png" alt></p>
<h1 id="应用例子"><a class="header-anchor" href="#应用例子"> </a>应用例子</h1>
<p>假设您有一些电子邮件，您想通过第三方垃圾邮件过滤器来检查其中的垃圾邮件，又不希望第三方获取邮件中的内容。所有您可以使用全同态加密做以下方案：<br>
<img src="/posts/a5f2eb4/f2.png" alt><br>
这样第三方获取的是加密后的数据，他只需要在加密后的数据上做计算，将结果返回给您进行解密，即可得到计算后的原文结果。</p>
<p>对于区块链技术，同态加密也是很好的互补。使用同态加密技术，运行在区块链上的智能合约可以处理密文，而无法获知真实数据，极大的提高了隐私安全性。</p>
<p>目前全同态的加密方案主要包括如下三种类型：</p>
<ul>
<li>基于理想格（ideal lattice）的方案：Gentry 和 Halevi 在 2011 年提出的基于理想格的方案可以实现 72 bit 的安全强度，对应的公钥大小约为 2.3 GB，同时刷新密文的处理时间需要几十分钟。</li>
<li>基于整数上近似 GCD 问题的方案：Dijk 等人在 2010 年提出的方案（及后续方案）采用了更简化的概念模型，可以降低公钥大小至几十 MB 量级。</li>
<li>基于带扰动学习（Learning With Errors，LWE）问题的方案：Brakerski 和 Vaikuntanathan 等在 2011 年左右提出了相关方案；Lopez-Alt A 等在 2012 年设计出多密钥全同态加密方案，接近实时多方安全计算的需求。</li>
</ul>
<h1 id="参考资料-4"><a class="header-anchor" href="#参考资料-4"> </a>参考资料</h1>
<blockquote>
<p><a href="https://yeasy.gitbook.io/blockchain_guide/05_crypto/homoencryption">https://yeasy.gitbook.io/blockchain_guide/05_crypto/homoencryption</a><br>
<a href="https://vitalik.ca/general/2020/07/20/homomorphic.html">https://vitalik.ca/general/2020/07/20/homomorphic.html</a></p>
</blockquote>
]]></content>
      <categories>
        <category>区块链</category>
      </categories>
      <tags>
        <tag>区块链</tag>
        <tag>零知识证明</tag>
      </tags>
  </entry>
  <entry>
    <title>敏捷开发</title>
    <url>/posts/ed2e9abb/</url>
    <content><![CDATA[<h1 id="瀑布式开发"><a class="header-anchor" href="#瀑布式开发"> </a>瀑布式开发</h1>
<p>瀑布式开发的基本流程是 需求 → 设计 → 开发 → 测试 ， 是一个更倾向于严格控制的管理模式 。 要求有明确的需求，大家按照需求一步步做好规划，每一阶段工作的完成是下一阶段工作开始的前提，每一阶段都要进行严格的评审，保证各阶段的工作做得足够好时才允许进入下一阶段。这种模式一般适用于需求比较明确、to B 端的项目。</p>
<p>不得不说瀑布项目失败率会比较高，因为它有一个很大的缺陷， 就是受各种条件的制约。当产品研发完成后， 到了产品测试阶段 万一发现问题 ，或者发现其无法满足市场需求， 那么就需要重新开发，甚至需要重新规划产品，这 间接导致了产品延期发布的高发性 与不确定性。</p>
<p>微软 的瀑布式开发模式就是个很好的例子。随着用户对软件的需求越来越苛刻，微软的软件产品曾经遭受了大家的不满，原因并非是产品的使用问题，而是其更新周期太过漫长 。</p>
<p>比如微软Office 、 Windows 等主打产品的更新周期长达 3 年左右，软件延期发布实属家常便饭，此时微软的瀑布式开发模式已经难以满足新型软件的开发要求，不得不改变产品的研发策略。</p>
<p>随着网络的逐渐兴起，软件交付模式发生了巨大变化，也正是在 那 个时候，“敏捷开发”模式被国外的软件先行者们探索出来了。</p>
<h1 id="敏捷式开发"><a class="header-anchor" href="#敏捷式开发"> </a>敏捷式开发</h1>
<p>简单的说，敏捷开发是一种以用户需求进化为核心、迭代、循序渐进的开发方法。首先把 用户（客户 ）最关注的软件原型做出来，交付或上线，在实际场景中去 快速 修改弥补需求中的不足，再次发布版本。通过一些敏捷实践方式，细化story ，提供更小的迭代。如此循环，直到用户（客户）满意。适用于需求不明确、创新性或者需要抢占市场的项目。</p>
<p>还是拿微软来说，微软的Visual Studio 2010是公司内部首个因敏捷开发模式而受益的Visual Studio版本，该软件发布于2010年4月，耗费了两年的时间完成开发，但随后研发团队发现软件中的许多模板对于敏捷开发者来说太过笼统，几乎没有太大的实际意义，微软的软件研发策略也就从此开始发生了巨大变化。以往的产品更新周期为两到三年，目前的版本更新速度已经缩短至一个季度左右，这在瀑布式开发模式下是难以想象的。</p>
<h1 id="Scrum"><a class="header-anchor" href="#Scrum"> </a>Scrum</h1>
<p>Scrum的英文意思是橄榄球运动的一个专业术语，表示“争球”的动作；把一个开发流程的名字取名为Scrum，我想你一定能想象出你的开发团队在开发一个项目时，大家像打橄榄球一样迅速、富有战斗激情、人人你争我抢地完成它，你一定会感到非常兴奋的。</p>
<p>而Scrum就是这样的一个开发流程，运用该流程，你就能看到你团队高效的工作。</p>
<h2 id="【Scrum开发流程中的三大角色】"><a class="header-anchor" href="#【Scrum开发流程中的三大角色】"> </a>【Scrum开发流程中的三大角色】</h2>
<h2 id="产品负责人（Product-Owner）"><a class="header-anchor" href="#产品负责人（Product-Owner）"> </a>产品负责人（Product Owner）</h2>
<p>主要负责确定产品的功能和达到要求的标准，指定软件的发布日期和交付的内容，同时有权力接受或拒绝开发团队的工作成果。</p>
<h2 id="流程管理员（Scrum-Master）"><a class="header-anchor" href="#流程管理员（Scrum-Master）"> </a>流程管理员（Scrum Master）</h2>
<p>主要负责整个Scrum流程在项目中的顺利实施和进行，以及清除挡在客户和开发工作之间的沟通障碍，使得客户可以直接驱动开发。</p>
<h2 id="开发团队（Scrum-Team）"><a class="header-anchor" href="#开发团队（Scrum-Team）"> </a>开发团队（Scrum Team）</h2>
<p>主要负责软件产品在Scrum规定流程下进行开发工作，人数控制在5~10人左右，每个成员可能负责不同的技术方面，但要求每成员必须要有很强的自我管理能力，同时具有一定的表达能力；成员可以采用任何工作方式，只要能达到Sprint的目标。</p>
<h1 id="如何进行Scrum开发？"><a class="header-anchor" href="#如何进行Scrum开发？"> </a>如何进行Scrum开发？</h1>
<p>1、我们首先需要确定一个Product Backlog（按优先顺序排列的一个产品需求列表），这个是由Product Owner 负责的；</p>
<p>2、Scrum Team根据Product Backlog列表，做工作量的预估和安排；</p>
<p>3、有了Product Backlog列表，我们需要通过 Sprint Planning Meeting（Sprint计划会议） 来从中挑选出一个Story作为本次迭代完成的目标，这个目标的时间周期是1~4个星期，然后把这个Story进行细化，形成一个Sprint Backlog；</p>
<p>4、Sprint Backlog是由Scrum Team去完成的，每个成员根据Sprint Backlog再细化成更小的任务（细到每个任务的工作量在2天内能完成）；</p>
<p>5、在Scrum Team完成计划会议上选出的Sprint Backlog过程中，需要进行 Daily Scrum Meeting（每日站立会议），每次会议控制在15分钟左右，每个人都必须发言，并且要向所有成员当面汇报你昨天完成了什么，并且向所有成员承诺你今天要完成什么，同时遇到不能解决的问题也可以提出，每个人回答完成后，要走到黑板前更新自己的 Sprint burn down（Sprint燃尽图）；</p>
<p>6、做到每日集成，也就是每天都要有一个可以成功编译、并且可以演示的版本；很多人可能还没有用过自动化的每日集成，其实TFS就有这个功能，它可以支持每次有成员进行签入操作的时候，在服务器上自动获取最新版本，然后在服务器中编译，如果通过则马上再执行单元测试代码，如果也全部通过，则将该版本发布，这时一次正式的签入操作才保存到TFS中，中间有任何失败，都会用邮件通知项目管理人员；</p>
<p>7、当一个Story完成，也就是Sprint Backlog被完成，也就表示一次Sprint完成，这时，我们要进行 Srpint Review Meeting（演示会议），也称为评审会议，产品负责人和客户都要参加（最好本公司老板也参加），每一个Scrum Team的成员都要向他们演示自己完成的软件产品（这个会议非常重要，一定不能取消）；</p>
<p>8、最后就是 Sprint Retrospective Meeting（回顾会议），也称为总结会议，以轮流发言方式进行，每个人都要发言，总结并讨论改进的地方，放入下一轮Sprint的产品需求中；</p>
<h1 id="TDD-测试驱动开发"><a class="header-anchor" href="#TDD-测试驱动开发"> </a>TDD 测试驱动开发</h1>
<p>TDD，所谓测试驱动开发，那么一定是测试现行。TDD的过程中，我们需要的是专注于一个需求的开发，直到测试通过。这里我说针对一个需求，我想强调的，这里的测试，应当是不依赖于实现的系统测试，而不是单元测试。否则，TDD将难以展开。</p>
<p>大多数情况下，开发者会先开发再测试，很可能出现的一种情况是，过程中一系列的单元测试都是通过的，但最终的功能依旧无法保证，这时再开展系统测试，可以说是比较耗费时间的，毕竟，原本你的目标可以变成：通过眼前这一项测试。</p>
<p>先这么多吧~期待后面会有更多不一样的感受。</p>
]]></content>
  </entry>
  <entry>
    <title>科学上网trojan-go和strongswan-ikev2搭建</title>
    <url>/posts/e1da7b5b/</url>
    <content><![CDATA[<h1 id="生成ssl证书"><a class="header-anchor" href="#生成ssl证书"> </a>生成ssl证书</h1>
<h2 id="首次安装"><a class="header-anchor" href="#首次安装"> </a>首次安装</h2>
<pre class="line-numbers language-none"><code class="language-none">sudo -iu root
apt-get install socat
curl https:&#x2F;&#x2F;get.acme.sh | sh -s email&#x3D;test1@test.com #安装完成
yourdomain&#x3D;xxx.xxx.xxx.xxx #你的域名<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="签名证书"><a class="header-anchor" href="#签名证书"> </a>签名证书</h2>
<p>因为mac、ios系统vpn不支持ec-256证书格式，在此申请RSA证书</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;root&#x2F;.acme.sh&#x2F;acme.sh --issue -d $&#123;yourdomain&#125; --debug --standalone<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="证书续期"><a class="header-anchor" href="#证书续期"> </a>证书续期</h2>
<p>写个<code>autoCa.sh</code>放入<code>.acme.sh</code>文件夹中</p>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;bin&#x2F;bash   
yourdomain&#x3D;&quot;xxx.xxx.xxx.xxx&quot;
systemctl stop trojan-web                                       #停掉web服务
&#x2F;root&#x2F;.acme.sh&#x2F;acme.sh --cron --home &#x2F;root&#x2F;.acme.sh             #续期
cert_file&#x3D;&quot;&#x2F;root&#x2F;.acme.sh&#x2F;$&#123;yourdomain&#125;&#x2F;$&#123;yourdomain&#125;.cer&quot;
key_file&#x3D;&quot;&#x2F;root&#x2F;.acme.sh&#x2F;$&#123;yourdomain&#125;&#x2F;$&#123;yourdomain&#125;.key&quot;
ca_file&#x3D;&quot;&#x2F;root&#x2F;.acme.sh&#x2F;$&#123;yourdomain&#125;&#x2F;ca.cer&quot;
cp -f $cert_file &#x2F;usr&#x2F;local&#x2F;etc&#x2F;ipsec.d&#x2F;certs&#x2F;server.cert.pem   #拷贝证书到ipsec目录下
cp -f $key_file &#x2F;usr&#x2F;local&#x2F;etc&#x2F;ipsec.d&#x2F;private&#x2F;server.pem
cp -f $ca_file &#x2F;usr&#x2F;local&#x2F;etc&#x2F;ipsec.d&#x2F;cacerts&#x2F;ca.cert.pem
systemctl start trojan-web                                      #启动trojan web 服务
&#x2F;usr&#x2F;local&#x2F;sbin&#x2F;ipsec restart                                   #重启  ipsec<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="定时任务更新证书"><a class="header-anchor" href="#定时任务更新证书"> </a>定时任务更新证书</h2>
<p>bash输入 <code>crontab -e</code> 修改定时任务</p>
<pre class="line-numbers language-none"><code class="language-none">#每个月2号执行
0 0 2 * * bash &#x2F;root&#x2F;.acme.sh&#x2F;autoCa.sh &gt; &#x2F;dev&#x2F;null<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h1 id="安装-strongswan"><a class="header-anchor" href="#安装-strongswan"> </a>安装 strongswan</h1>
<h2 id="复制生成好的证书到当前目录下"><a class="header-anchor" href="#复制生成好的证书到当前目录下"> </a>复制生成好的证书到当前目录下</h2>
<pre class="line-numbers language-none"><code class="language-none">yourdomain&#x3D;&quot;xxx.xxx.xxx.xxx&quot;
cert_file&#x3D;&quot;&#x2F;root&#x2F;.acme.sh&#x2F;$&#123;yourdomain&#125;_ecc&#x2F;$&#123;yourdomain&#125;.cer&quot;
key_file&#x3D;&quot;&#x2F;root&#x2F;.acme.sh&#x2F;$&#123;yourdomain&#125;_ecc&#x2F;$&#123;yourdomain&#125;.key&quot;
ca_file&#x3D;&quot;&#x2F;root&#x2F;.acme.sh&#x2F;$&#123;yourdomain&#125;_ecc&#x2F;ca.cer&quot;
cp -f $cert_file server.cert.pem
cp -f $key_file server.pem
cp -f $cert_file client.cert.pem
cp -f $key_file client.pem
cp -f $ca_file ca.cert.pem<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="安装-strongswan-2"><a class="header-anchor" href="#安装-strongswan-2"> </a>安装 strongswan</h2>
<pre class="line-numbers language-none"><code class="language-none">source &lt;(curl -sL https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;wanyvic&#x2F;one-key-ikev2-vpn&#x2F;master&#x2F;one-key-ikev2.sh)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>提示: Would you want to import existing cert? You NEED copy your cert file to the same directory of this script 选 <code>yes</code></p>
<h2 id="配置-ikev2密码"><a class="header-anchor" href="#配置-ikev2密码"> </a>配置 ikev2密码</h2>
<pre class="line-numbers language-none"><code class="language-none">vim &#x2F;usr&#x2F;local&#x2F;etc&#x2F;ipsec.secrets<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="trojan-go"><a class="header-anchor" href="#trojan-go"> </a>trojan-go</h1>
<h2 id="安装Jrohy的一键trojan面板脚本"><a class="header-anchor" href="#安装Jrohy的一键trojan面板脚本"> </a>安装Jrohy的一键trojan面板脚本</h2>
<pre class="line-numbers language-none"><code class="language-none">source &lt;(curl -sL https:&#x2F;&#x2F;git.io&#x2F;trojan-install)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="删除"><a class="header-anchor" href="#删除"> </a>删除</h2>
<pre class="line-numbers language-none"><code class="language-none">source &lt;(curl -sL https:&#x2F;&#x2F;git.io&#x2F;trojan-install) --remove<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="切换-trojan-go"><a class="header-anchor" href="#切换-trojan-go"> </a>切换 trojan-go</h2>
<pre class="line-numbers language-none"><code class="language-none">trojan
# 交互输入1 和 6
1
6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>或通过<code>&#123;https://yourdomain&#125;</code>打开网页手动切换内核</p>
<h2 id="更改trojan-go配置文件以支持websocket"><a class="header-anchor" href="#更改trojan-go配置文件以支持websocket"> </a>更改trojan-go配置文件以支持websocket</h2>
<pre class="line-numbers language-none"><code class="language-none">vim &#x2F;usr&#x2F;local&#x2F;etc&#x2F;trojan&#x2F;config.json<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">#在mysql后面追加
&quot;websocket&quot;: &#123;
        &quot;enabled&quot;: true,
        &quot;path&quot;: &quot;&#x2F;DFE4545DFDED&#x2F;&quot;, # ws路径
        &quot;host&quot;: &quot;你的域名&quot;
    &#125;,
    &quot;mux&quot;: &#123;
        &quot;enabled&quot;: true,
        &quot;concurrency&quot;: 8,
        &quot;idle_timeout&quot;: 60
    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">trojan restart #重启trojan<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="更改trojan-go配置的证书路径"><a class="header-anchor" href="#更改trojan-go配置的证书路径"> </a>更改trojan-go配置的证书路径</h2>
<p>安装脚本默认生成ec-256证书，在此不使用ec-256证书。使用之前生成的RSA证书代替</p>
<pre class="line-numbers language-none"><code class="language-none">#删除证书路径中的ec-256证书
rm -rf &#x2F;root&#x2F;.acme.sh&#x2F;$&#123;yourdomain&#125;_ecc
sed -i &quot;s&#x2F;$&#123;yourdomain&#125;_ecc&#x2F;$&#123;yourdomain&#125;&#x2F;g&quot; &#x2F;usr&#x2F;local&#x2F;etc&#x2F;trojan&#x2F;config.json<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h1 id="客户端"><a class="header-anchor" href="#客户端"> </a>客户端</h1>
<h2 id="ipsec"><a class="header-anchor" href="#ipsec"> </a>ipsec</h2>
<p>ipsec 直接使用系统ikev2 vpn连接即可。</p>
<h2 id="trojan-go-2"><a class="header-anchor" href="#trojan-go-2"> </a>trojan-go</h2>
<p>GUI使用<a href="https://qv2ray.net/">Qv2ray</a> + <a href="https://github.com/p4gefau1t/trojan-go/releases">trojan-go 内核程序</a> + <a href="https://github.com/Qv2ray/QvPlugin-Trojan-Go/releases">trojan-go qv2ray 插件</a></p>
<p><a href="http://qv2ray.net/lang/zh/plugins/usage.html">Qv2ray插件文档</a></p>
<h3 id="运作"><a class="header-anchor" href="#运作"> </a>运作</h3>
<ul>
<li>
<p>Qv2ray 设置<code>sock5/http</code>代理到本地</p>
</li>
<li>
<p>浏览器使用<code>SwitchyOmega</code>插件连接本地代理端口</p>
</li>
<li>
<p>终端使用<br>
设置环境变量</p>
</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">export http_proxy&#x3D;http:&#x2F;&#x2F;127.0.0.1:8082
export https_proxy&#x3D;http:&#x2F;&#x2F;127.0.0.1:8082
# 或者
# export http_proxy&#x3D;&quot;socks5:&#x2F;&#x2F;127.0.0.1:1080&quot;
# export https_proxy&#x3D;&quot;socks5:&#x2F;&#x2F;127.0.0.1:1080&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <tags>
        <tag>vpn</tag>
      </tags>
  </entry>
  <entry>
    <title>零知识证明 一</title>
    <url>/posts/11e4c139/</url>
    <content><![CDATA[<h1 id="介绍-5"><a class="header-anchor" href="#介绍-5"> </a>介绍</h1>
<p>零知识证明的目标是让验证者相信证明者拥有某个秘密(<code>withness</code>)，满足某种关系，而无需向验证者或其他任何人透露秘密本身。</p>
<p>我们可以更具体地认为这是一个程序，表示为<code>C</code>，接受两个输入：<code>C(x, w)</code>。输入<code>x</code>是公共输入，<code>w</code>是秘密见证输入(区块链内一般指交易本身)。该程序的输出是布尔值，即<code>true</code>或<code>false</code>。随后的目标是给出了具体的公共投入<code>x</code>，证明了证明方知道秘密输入<code>w</code>这样<code>C(x,w) == true</code>。</p>
<h1 id="示例程序"><a class="header-anchor" href="#示例程序"> </a>示例程序</h1>
<p>假设Bob知道一个散列值<code>H</code>，并且他希望有一个证明，证明Alice知道<code>s</code>的散列的值是<code>H</code>。通常 Alice会通过把<code>s</code>给Bob来证明这一点，之后Bob会重新计算哈希并检查它是否等于<code>H</code>。</p>
<p>但是，假设Alice不想把<code>s</code>透露给Bob，而只是想证明她知道该值。她可以为此使用<code>zk-SNARK</code>。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token constant">C</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> w</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
  <span class="token keyword">return</span> <span class="token punctuation">(</span> <span class="token function">sha256</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">==</span> x <span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>其中<code>w</code>就代表了秘密<code>s</code>，<code>x</code>代表公开值<code>H</code>，<code>C(x, w)</code>就代表了证明(proofs)。Bob只需要验证<code>C(x, w)</code>是否为<code>true</code>即可相信Alice，而无须知道<code>s</code>本身。</p>
<h1 id="zk-SNARK-的定义"><a class="header-anchor" href="#zk-SNARK-的定义"> </a>zk-SNARK 的定义</h1>
<p>一个zk-SNARK由三个算法组成，<code>G</code>, <code>P</code>, <code>V</code>定义如下：</p>
<p>密钥生成器<code>G</code>接受一个秘密参数<code>lambda</code>和一个程序电路<code>C</code>，并生成两个公开可用的密钥，一个证明密钥<code>pk</code>和一个验证密钥<code>vk</code>。这些密钥是公共参数，只需要为给定程序<code>C</code>生成一次。</p>
<p>证明者将<code>P</code>证明密钥<code>pk</code>、公共输入<code>x</code>和隐私见证作输入<code>w</code>。该算法生成证明<code>prf = P(pk, x, w)</code>。</p>
<p>验证者<code>V</code>计算证明<code>prf</code>，如果正确则<code>V(vk, x, prf)</code>返回<code>true</code>，否则返回<code>false</code>。因此，如果证明者知道<code>w</code>，则此函数<code>C(x,w) == true</code></p>
<p>请注意此处生成器中使用的秘密参数<code>lambda</code>。这个参数有时会让在实际应用中使<code>zk-SNARK</code>变得很棘手。这样做的原因是任何知道这个参数的人都可以生成假证明。具体来说，给定任何程序<code>C</code>和公共输入<code>x</code>，知道<code>lambda</code>的人可以生成一个证明<code>fake_prf</code>，以便在不知道秘密<code>w</code>的情况下使<code>V(vk, x, fake_prf)</code>等于<code>true</code>。</p>
<p>因此，实际运行生成器需要一个非常安全的过程，以确保没有人知道并将参数保存在任何地方。这就是Zcash团队为了生成证明密钥和验证密钥而进行了极其精心的仪式的原因，确保<code>lambda</code>在此过程中被销毁。</p>
<h1 id="给我们的示例使用zk-SNARK"><a class="header-anchor" href="#给我们的示例使用zk-SNARK"> </a>给我们的示例使用zk-SNARK</h1>
<p>Alice和Bob在实践中如何使用<code>zk-SNARK</code>来证明Alice知道上面例子中的秘密值？</p>
<p>首先，如上所述，我们将使用一个由以下函数定义的程序:</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token constant">C</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> w</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
  <span class="token keyword">return</span> <span class="token punctuation">(</span> <span class="token function">sha256</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">==</span> x <span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>Bob的第一步是运行生成器<code>g</code>，以创建验证密钥<code>pk</code>和验证密钥<code>vk</code>。首先随机生成 <code>lambda</code>并使用它作为输入:</p>
<pre class="line-numbers language-none"><code class="language-none">(pk, vk) &#x3D; G(C, lambda)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>正如上面所讨论的，必须小心处理<code>lambda</code>参数，因为如果Alice知道<code>lambda</code>的值，她将能够创建伪证明。Bob将与Alice分享<code>pk</code>和<code>vk</code>。</p>
<p>Alice现在将扮演证明者的角色。她需要证明她知道散列到已知hash <code>H</code>的值<code>s</code>。她运行证明算法 <code>P</code>，输入<code>pk</code>,<code>H</code>和<code>s</code>来生成证明<code>prf</code>:</p>
<pre class="line-numbers language-none"><code class="language-none">prf &#x3D; P(pk, H, s)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>接下来，Alice把证明文件交给Bob，Bob运行验证函数<code>v(vk,H,prf)</code> ，在这种情况下返回 <code>true</code>，因为Alice完全知道这个秘密。Bob可以确信Alice知道这个秘密，但Alice不需要向Bob透露这个秘密。</p>
<h1 id="可重用的证明和验证密钥"><a class="header-anchor" href="#可重用的证明和验证密钥"> </a>可重用的证明和验证密钥</h1>
<p>在我们上面的示例中，如果Bob想向Alice证明他知道一个<code>s'</code>，就不能使用上面的过程了。这是因为Alice不知道Bob有没有保存<code>lambda</code>参数。如果保存了，Bob有能力伪造证明。</p>
<p>如果一个程序对许多人有用(比如 Zcash 的例子) ，一个独立于Alice和Bob的可信任的第三方可以运行生成器并创建证明密钥<code>pk</code>和验证密钥<code>vk</code>，这样就没有人知道<code>lambda</code>了。</p>
<p>任何信任这个第三方的人都可以在未来的交互中使用这些密钥。</p>
<h1 id="Ethereum-中的-zk-snark"><a class="header-anchor" href="#Ethereum-中的-zk-snark"> </a>Ethereum 中的 zk-snark</h1>
<p>开发者已经开始将zk-snark集成到Ethereum中。这看起来像什么？具体而言，验证算法（<code>verify</code>）的构建模块以预编译合同的形式添加到Ethereum。用法如下: 生成器链下运行，生成验证密钥和验证密钥。然后，任何证明者都可以使用<code>proving key</code>来创建证明，也是链下运行的。通用验证算法可以在一个智能合约中运行，使用<code>pk</code>、<code>vk</code>和公共输入作为输入参数。验证算法的结果可以用于触发其他链上活动。</p>
<p>这里有一个简单的例子来说明zk-snark如何帮助保护Ethereum上的隐私。假设我们有一个简单Token合约。一般来说，常规的合同（ERC20）是从地址到余额的映射：</p>
<pre class="line-numbers language-none"><code class="language-none">mapping (address &#x3D;&gt; uint256) balances;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>我们将用余额的散列替换余额，<code>bytes32</code>代替<code>uint256</code>。</p>
<pre class="line-numbers language-none"><code class="language-none">mapping (address &#x3D;&gt; bytes32) balanceHashes;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>我们不会隐藏交易的发送者或接收者，但是我们可以隐藏余额和发送量。这种财产有时被称为机密交易。</p>
<p>两个zk-snark用于将令牌从一个帐户发送到另一个帐户，一个由发送者创建，一个由接收者创建。（发送者生成发送的proof，接收者生成接收的proof）</p>
<p>通常在一个Token合约中，如果一个交易金额是有效的，我们需要验证以下内容:</p>
<pre class="line-numbers language-none"><code class="language-none">balances[fromAddress] &gt;&#x3D; value<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>因此，我们也需要在zk-snark证明更新后的哈希值与更新后的余额相匹配。</p>
<p>其主要思想是，发送者将使用他们的<code>startBalance</code>和交易<code>value</code>作为隐私输入，将<code>startBalance</code>、<code>afterBalance</code>和<code>value</code>的哈希作为公共输入。类似地，接收者将<code>startBalance</code>和<code>value</code>作为秘密输入，将<code>startBalance</code>、<code>afterBalance</code>和<code>value</code>的哈希作为公共输入。</p>
<p>下面是我们将用于发送方zk-SNARK的程序，其中与前面一样，<code>x</code>表示公共输入，<code>w</code>表示私有输入。</p>
<pre class="line-numbers language-none"><code class="language-none">function senderFunction(x, w) &#123;
  return (
    w.senderBalanceBefore &gt; w.value &amp;&amp;
    sha256(w.value) &#x3D;&#x3D; x.hashValue &amp;&amp;
    sha256(w.senderBalanceBefore) &#x3D;&#x3D; x.hashSenderBalanceBefore &amp;&amp;
    sha256(w.senderBalanceBefore - w.value) &#x3D;&#x3D; x.hashSenderBalanceAfter
  )
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>接收方使用的程序如下:</p>
<pre class="line-numbers language-none"><code class="language-none">function receiverFunction(x, w) &#123;
  return (
    sha256(w.value) &#x3D;&#x3D; x.hashValue &amp;&amp;
    sha256(w.receiverBalanceBefore) &#x3D;&#x3D; x.hashReceiverBalanceBefore &amp;&amp;
    sha256(w.receiverBalanceBefore + w.value) &#x3D;&#x3D; x.hashReceiverBalanceAfter
  )
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>程序检查发送余额是否大于正在发送的值，并检查所有散列是否匹配。一组可信的人员将为我们的 zk-snark生成证明和验证密钥，我们称之为<code>confTxSenderPk</code>、<code>confTxSenderVk</code>、<code>conftxreceivpk</code>和<code>confTxReceiverPk</code>。</p>
<p>使用zk-snark的Token合约看起来像这样:</p>
<pre class="line-numbers language-none"><code class="language-none">function transfer(address _to, bytes32 hashValue, bytes32 hashSenderBalanceAfter, bytes32 hashReceiverBalanceAfter, bytes zkProofSender, bytes zkProofReceiver) &#123;
  bytes32 hashSenderBalanceBefore &#x3D; balanceHashes[msg.sender];
  bytes32 hashReceiverBalanceBefore &#x3D; balanceHashes[_to];
  
  bool senderProofIsCorrect &#x3D; zksnarkverify(confTxSenderVk, [hashSenderBalanceBefore, hashSenderBalanceAfter, hashValue], zkProofSender);

bool receiverProofIsCorrect &#x3D; zksnarkverify(confTxReceiverVk, [hashReceiverBalanceBefore, hashReceiverBalanceAfter, hashValue], zkProofReceiver);

  if(senderProofIsCorrect &amp;&amp; receiverProofIsCorrect) &#123;
    balanceHashes[msg.sender] &#x3D; hashSenderBalanceAfter;
    balanceHashes[_to] &#x3D; hashReceiverBalanceAfter;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>因此，区块链上唯一的更新是<code>balance</code>的hash，而不是<code>balance</code>本身。然而，我们可以知道所有的<code>balance</code>是正确的更新，因为我们可以检查自己的证明已经验证。</p>
<p>上述机密事务方案主要是给出了一个如何在 Ethereum 上使用 zk-snark 的实例。为了在此基础上创建一个健壮的机密事务方案，我们需要解决一些问题:</p>
<ul>
<li>用户将需要跟踪他们的余额客户端，如果您失去了余额，这些令牌是不可恢复的。也许可以使用从签名密钥派生的密钥对余额进行链式加密存储。<strong>注：</strong> 要用户记录自己的<code>w</code>，或存储在链上。</li>
<li>余额需要使用32字节的数据和编码熵的平衡的一部分，以防止能够扭转哈希算出余额。<strong>注：</strong> 对<code>balanceHash</code>加<code>salt</code>避免字典攻击。</li>
<li>需要处理发送到未使用地址的边缘情况。</li>
<li>为了发送，发送者需要与接收者互动。一个可能有一个系统，其中发送者使用他们的证据来启动交易，和接收者可以看到在块环链上，他们有一个“未决的传入交易”，并可以完成它。<strong>注：</strong> 必须要有个链下的撮合系统收集发送者和接收者的proof。</li>
</ul>
<h1 id="参考"><a class="header-anchor" href="#参考"> </a>参考</h1>
<blockquote>
<p><a href="https://media.consensys.net/introduction-to-zksnarks-with-examples-3283b554fc3b">https://media.consensys.net/introduction-to-zksnarks-with-examples-3283b554fc3b</a></p>
</blockquote>
]]></content>
      <categories>
        <category>区块链</category>
      </categories>
      <tags>
        <tag>区块链</tag>
        <tag>零知识证明</tag>
      </tags>
  </entry>
  <entry>
    <title>零知识证明 三 zkSNARK R1CS-&gt;QAP</title>
    <url>/posts/45c3b13b/</url>
    <content><![CDATA[<h1 id="开篇提示"><a class="header-anchor" href="#开篇提示"> </a>开篇提示</h1>
<p>本文是基于V神<a href="https://vitalik.ca/general/2016/12/10/qap.html">Quadratic Arithmetic Programs: from Zero to Hero</a>与网友分析基础之上总结而成。</p>
<p>zkSNARK过程：<br>
<img src="/posts/45c3b13b/f3.png" alt></p>
<p>本篇只讲前半部分。</p>
<h1 id="NP问题与NPC问题"><a class="header-anchor" href="#NP问题与NPC问题"> </a>NP问题与NPC问题</h1>
<ul>
<li>P问题：能在多项式时间内解决的问题。</li>
<li>NP问题：能在多项式时间验证答案正确与否的问题。</li>
<li>NP-hard问题：任意np问题都可以在多项式时间内归约为该问题。归约的意思是为了解决问题A，先将问题A归约为另一个问题B，解决问题B同时也间接解决了问题A。</li>
<li>NPC问题：既是NP问题，也是NP-hard问题。</li>
</ul>
<h1 id="QAP-问题"><a class="header-anchor" href="#QAP-问题"> </a>QAP 问题</h1>
<p>首先，zk-SNARK 不能直接用于解决任何计算问题，我们必须先把问题转换成正确的“形式”来处理，这种形式叫做 “quadratic arithmetic problem”(QAP)，在进行 QAP 转换的同时，如果你有代码的输入就可以创建一个对应的解（有时称之为 QAP 的 witness）。之后，还需要一个相当复杂的步骤来为 witness 创建实际的“零知识证明”，此外还有一个独立的过程来验证某人发送给你的证明。</p>
<p>我们来选择一个简单的例子来做说明：证明你知道一个立方方程的解：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><mi>x</mi><mo>+</mo><mn>5</mn><mo>=</mo><mn>35</mn></mrow><annotation encoding="application/x-tex">x^3 + x + 5 = 35</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">35</span></span></span></span> （提示：解是3，解用来构造 witness ）。这个例子既可以让你理解zkSNARK背后的技术原理，又不会产生出很大的 QAP。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">qeval</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    y <span class="token operator">=</span> x<span class="token operator">**</span><span class="token number">3</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y <span class="token operator">+</span> <span class="token number">5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>我们这里所使用的特殊的程序语言支持基本算术运算 (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>+</mo><mo separator="true">,</mo><mo>−</mo><mo separator="true">,</mo><mo>∗</mo><mo separator="true">,</mo><mi mathvariant="normal">/</mi></mrow><annotation encoding="application/x-tex">+,-,*,/</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">+</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">∗</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">/</span></span></span></span>)，常量阶指数运算(如：可以计算 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mn>7</mn></msup></mrow><annotation encoding="application/x-tex">x^7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span></span></span></span> 但是不能计算 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mi>y</mi></msup></mrow><annotation encoding="application/x-tex">x^y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span></span></span></span></span></span></span> )和变量赋值，理论上可以在这个语言中做任意计算（只要计算步骤的次数是受限制的，此外，不允许循环）。注意，这个语言不支持模运算 (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">%</mi></mrow><annotation encoding="application/x-tex">\%</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord">%</span></span></span></span>) 和比较运算 (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mo separator="true">,</mo><mo>&gt;</mo><mo separator="true">,</mo><mo>&lt;</mo><mo>=</mo><mo separator="true">,</mo><mo>&gt;</mo><mo>=</mo></mrow><annotation encoding="application/x-tex">&lt;, &gt;, &lt;=, &gt;=</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span></span><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;=</span></span><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;=</span></span></span></span>)，但是通过提供辅助输入可以扩展到支持这两种运算，此处我们不做展开。</p>
<h1 id="扁平化"><a class="header-anchor" href="#扁平化"> </a>扁平化</h1>
<p>然后，我们把代码拍平(Flattening)转换为代数线路(algebraic circuit)：</p>
<p>拍平后的代码一次只能做下面的一种简单运算，x=y（x可以是数字或变量）。x=y op z（其中op可以是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>+</mo><mo separator="true">,</mo><mo>−</mo><mo separator="true">,</mo><mo>∗</mo><mo separator="true">,</mo><mi mathvariant="normal">/</mi></mrow><annotation encoding="application/x-tex">+,-,*,/</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">+</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">∗</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">/</span></span></span></span>等运算）</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>y</mi><mi>m</mi><mi mathvariant="normal">_</mi><mn>1</mn><mo>=</mo><mi>x</mi><mo>∗</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">
sym\_1 = x * x
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9544em;vertical-align:-0.31em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">sy</span><span class="mord mathnormal">m</span><span class="mord">_1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mi>s</mi><mi>y</mi><mi>m</mi><mi mathvariant="normal">_</mi><mn>1</mn><mo>∗</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">
y = sym\_1 * x
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9544em;vertical-align:-0.31em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">sy</span><span class="mord mathnormal">m</span><span class="mord">_1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>y</mi><mi>m</mi><mi mathvariant="normal">_</mi><mn>2</mn><mo>=</mo><mi>y</mi><mo>+</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">
sym\_2 = y + x
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9544em;vertical-align:-0.31em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">sy</span><span class="mord mathnormal">m</span><span class="mord">_2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span><br>
~<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>o</mi><mi>u</mi><mi>t</mi><mo>=</mo><mi>s</mi><mi>y</mi><mi>m</mi><mi mathvariant="normal">_</mi><mn>2</mn><mo>+</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">
out = sym\_2 + 5
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9544em;vertical-align:-0.31em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">sy</span><span class="mord mathnormal">m</span><span class="mord">_2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">5</span></span></span></span></p>
<p>在上面的过程中，我们引入了一些中间变量，但是整体跟我们原来的的代码是等价的。</p>
<h1 id="通往-R1CS-的大门"><a class="header-anchor" href="#通往-R1CS-的大门"> </a>通往 R1CS 的大门</h1>
<p>接下来，我们需要把拍平的代码写成一个叫作R1CS（rank-1 constraint system）的约束系统。</p>
<p><strong>R1CS：</strong> 可将其理解为一个方程组。</p>
<p>Prover需要向Verifier证明其知道满足该方程组所有方程式的解，证明过程可转化为Prover知道3组向量<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>c</mi><mo>⃗</mo></mover><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\vec{a},\vec{b},\vec{c})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2274em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">c</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>以及1组对应于R1CS解的向量<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>s</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{s}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span></span></span></span>（np问题转化为np完全问题），使得<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>∗</mo><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>−</mo><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>c</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">&lt;\vec{s},\vec{a}&gt;*&lt;\vec{s},\vec{b}&gt;-&lt;\vec{s},\vec{c}&gt;=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9084em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord">∗</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1719em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9084em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">c</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>成立。</p>
<p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup></mrow><annotation encoding="application/x-tex">&lt;\vec{s},\vec{a}&gt;=\sum_{i=1}^{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9084em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.104em;vertical-align:-0.2997em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span></span></span></span>。</p>
<p>拍平后的方程组：</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>y</mi><mi>m</mi><mi mathvariant="normal">_</mi><mn>1</mn><mo>=</mo><mi>x</mi><mo>∗</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">
sym\_1 = x * x
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9544em;vertical-align:-0.31em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">sy</span><span class="mord mathnormal">m</span><span class="mord">_1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mi>s</mi><mi>y</mi><mi>m</mi><mi mathvariant="normal">_</mi><mn>1</mn><mo>∗</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">
y = sym\_1 * x
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9544em;vertical-align:-0.31em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">sy</span><span class="mord mathnormal">m</span><span class="mord">_1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>y</mi><mi>m</mi><mi mathvariant="normal">_</mi><mn>2</mn><mo>=</mo><mi>y</mi><mo>+</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">
sym\_2 = y + x
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9544em;vertical-align:-0.31em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">sy</span><span class="mord mathnormal">m</span><span class="mord">_2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span><br>
~<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>o</mi><mi>u</mi><mi>t</mi><mo>=</mo><mi>s</mi><mi>y</mi><mi>m</mi><mi mathvariant="normal">_</mi><mn>2</mn><mo>+</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">
out = sym\_2 + 5
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9544em;vertical-align:-0.31em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">sy</span><span class="mord mathnormal">m</span><span class="mord">_2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">5</span></span></span></span></p>
<p>由方程组可知，其中涉及6个变量和4个逻辑门。</p>
<p>左侧组成了变量组，在此基础上加上<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>，组成了6维向量<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">[</mo><mtext>~</mtext><mi>o</mi><mi>n</mi><mi>e</mi><mo separator="true">,</mo><mi>x</mi><mo separator="true">,</mo><mtext>~</mtext><mi>o</mi><mi>u</mi><mi>t</mi><mo separator="true">,</mo><mi>s</mi><mi>y</mi><mi>m</mi><mi mathvariant="normal">_</mi><mn>1</mn><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>s</mi><mi>y</mi><mi>m</mi><mi mathvariant="normal">_</mi><mn>2</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\vec{s}=[ \text{\textasciitilde}one,x,\text{\textasciitilde}out,sym\_1,y,sym\_2 ]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1em;vertical-align:-0.35em;"></span><span class="mopen">[</span><span class="mord text"><span class="mord">~</span></span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">~</span></span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">sy</span><span class="mord mathnormal">m</span><span class="mord">_1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">sy</span><span class="mord mathnormal">m</span><span class="mord">_2</span><span class="mclose">]</span></span></span></span></p>
<p>其中：</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>~</mtext><mi>o</mi><mi>n</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">\text{\textasciitilde}one</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7806em;vertical-align:-0.35em;"></span><span class="mord text"><span class="mord">~</span></span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span></span></span></span>：虚拟变量</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>：输入变量</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>~</mtext><mi>o</mi><mi>u</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">\text{\textasciitilde}out</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9651em;vertical-align:-0.35em;"></span><span class="mord text"><span class="mord">~</span></span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span></span></span></span>：输出变量</li>
</ul>
<p>Prover知道满足上述方程式组的解（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">x=3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span>），则<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">[</mo><mtext>~</mtext><mi>o</mi><mi>n</mi><mi>e</mi><mo separator="true">,</mo><mi>x</mi><mo separator="true">,</mo><mtext>~</mtext><mi>o</mi><mi>u</mi><mi>t</mi><mo separator="true">,</mo><mi>s</mi><mi>y</mi><mi>m</mi><mi mathvariant="normal">_</mi><mn>1</mn><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>s</mi><mi>y</mi><mi>m</mi><mi mathvariant="normal">_</mi><mn>2</mn><mo stretchy="false">]</mo><mo>=</mo><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mn>3</mn><mo separator="true">,</mo><mn>35</mn><mo separator="true">,</mo><mn>9</mn><mo separator="true">,</mo><mn>27</mn><mo separator="true">,</mo><mn>30</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\vec{s}=[ \text{\textasciitilde}one,x,\text{\textasciitilde}out,sym\_1,y,sym\_2 ] = [1,3,35,9,27,30]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1em;vertical-align:-0.35em;"></span><span class="mopen">[</span><span class="mord text"><span class="mord">~</span></span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">~</span></span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">sy</span><span class="mord mathnormal">m</span><span class="mord">_1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">sy</span><span class="mord mathnormal">m</span><span class="mord">_2</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">35</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">9</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">27</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">30</span><span class="mclose">]</span></span></span></span>。</p>
<h2 id="计算"><a class="header-anchor" href="#计算"> </a>计算</h2>
<h3 id="第一门逻辑电路"><a class="header-anchor" href="#第一门逻辑电路"> </a>第一门逻辑电路</h3>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mi>s</mi><mi>y</mi><msub><mi>m</mi><mn>1</mn></msub><mo>∗</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">y=sym_1*x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6597em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">sy</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>，满足<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>∗</mo><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>−</mo><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>c</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">&lt;\vec{s},\vec{a}&gt;*&lt;\vec{s},\vec{b}&gt;-&lt;\vec{s},\vec{c}&gt;=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9084em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord">∗</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1719em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9084em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">c</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>成立的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>c</mi><mo>⃗</mo></mover><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\vec{a},\vec{b},\vec{c})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2274em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">c</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>为：</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\vec{a} = [0,1,0,0,0,0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\vec{b} = [0,1,0,0,0,0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9774em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>c</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\vec{c} = [0,0,0,1,0,0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">c</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">]</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>∗</mo><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>−</mo><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>c</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>=</mo><mn>3</mn><mo>∗</mo><mn>3</mn><mo>−</mo><mn>9</mn><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">&lt;\vec{s},\vec{a}&gt;*&lt;\vec{s},\vec{b}&gt;-&lt;\vec{s},\vec{c}&gt;= 3*3-9=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9084em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord">∗</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1719em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9084em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">c</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">9</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span></p>
<h3 id="第二门逻辑电路"><a class="header-anchor" href="#第二门逻辑电路"> </a>第二门逻辑电路</h3>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mi>s</mi><mi>y</mi><mi>m</mi><mi mathvariant="normal">_</mi><mn>1</mn><mo>∗</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">y=sym\_1*x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9544em;vertical-align:-0.31em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">sy</span><span class="mord mathnormal">m</span><span class="mord">_1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>，满足<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>∗</mo><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>−</mo><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>c</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">&lt;\vec{s},\vec{a}&gt;*&lt;\vec{s},\vec{b}&gt;-&lt;\vec{s},\vec{c}&gt;=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9084em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord">∗</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1719em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9084em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">c</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>成立的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>c</mi><mo>⃗</mo></mover><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\vec{a},\vec{b},\vec{c})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2274em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">c</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>为：</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\vec{a} = [0,0,0,1,0,0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\vec{b} = [0,1,0,0,0,0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9774em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>c</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\vec{c} = [0,0,0,0,1,0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">c</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">]</span></span></span></span></p>
<h3 id="第三门逻辑电路"><a class="header-anchor" href="#第三门逻辑电路"> </a>第三门逻辑电路</h3>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>y</mi><mi>m</mi><mi mathvariant="normal">_</mi><mn>2</mn><mo>=</mo><mi>y</mi><mo>+</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">sym\_2=y+x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9544em;vertical-align:-0.31em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">sy</span><span class="mord mathnormal">m</span><span class="mord">_2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>，满足<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>∗</mo><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>−</mo><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>c</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">&lt;\vec{s},\vec{a}&gt;*&lt;\vec{s},\vec{b}&gt;-&lt;\vec{s},\vec{c}&gt;=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9084em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord">∗</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1719em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9084em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">c</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>成立的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>c</mi><mo>⃗</mo></mover><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\vec{a},\vec{b},\vec{c})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2274em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">c</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>为：</p>
<p>因为是加法所以这里做法有些不同（实际转化为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>y</mi><mi>m</mi><mi mathvariant="normal">_</mi><mn>2</mn><mo>=</mo><mo stretchy="false">(</mo><mi>y</mi><mo>+</mo><mi>x</mi><mo stretchy="false">)</mo><mo>∗</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">sym\_2=(y+x)*1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9544em;vertical-align:-0.31em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">sy</span><span class="mord mathnormal">m</span><span class="mord">_2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>）：<br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\vec{a} = [0,1,0,0,1,0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\vec{b} = [1,0,0,0,0,0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9774em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>c</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\vec{c} = [0,0,0,0,0,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">c</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>∗</mo><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>−</mo><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>c</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>=</mo><mo stretchy="false">(</mo><mn>3</mn><mo>+</mo><mn>27</mn><mo stretchy="false">)</mo><mo>∗</mo><mn>1</mn><mo>−</mo><mn>30</mn><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">&lt;\vec{s},\vec{a}&gt;*&lt;\vec{s},\vec{b}&gt;-&lt;\vec{s},\vec{c}&gt;= (3+27)*1-30=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9084em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord">∗</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1719em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9084em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">c</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">27</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">30</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span></p>
<h3 id="第四门逻辑电路"><a class="header-anchor" href="#第四门逻辑电路"> </a>第四门逻辑电路</h3>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>~</mtext><mi>o</mi><mi>u</mi><mi>t</mi><mo>=</mo><mi>s</mi><mi>y</mi><mi>m</mi><mi mathvariant="normal">_</mi><mn>2</mn><mo>+</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">\text{\textasciitilde}out=sym\_2+5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9651em;vertical-align:-0.35em;"></span><span class="mord text"><span class="mord">~</span></span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9544em;vertical-align:-0.31em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">sy</span><span class="mord mathnormal">m</span><span class="mord">_2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">5</span></span></span></span>，满足<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>∗</mo><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>−</mo><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>c</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">&lt;\vec{s},\vec{a}&gt;*&lt;\vec{s},\vec{b}&gt;-&lt;\vec{s},\vec{c}&gt;=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9084em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord">∗</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1719em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9084em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">c</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>成立的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>c</mi><mo>⃗</mo></mover><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\vec{a},\vec{b},\vec{c})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2274em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">c</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>为：</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">[</mo><mn>5</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\vec{a} = [5,0,0,0,0,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\vec{b} = [1,0,0,0,0,0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9774em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>c</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\vec{c} = [0,0,1,0,0,0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">c</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">]</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>∗</mo><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>−</mo><mo>&lt;</mo><mover accent="true"><mi>s</mi><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>c</mi><mo>⃗</mo></mover><mo>&gt;</mo><mo>=</mo><mo stretchy="false">(</mo><mn>5</mn><mo>+</mo><mn>30</mn><mo stretchy="false">)</mo><mo>∗</mo><mn>1</mn><mo>−</mo><mn>35</mn><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">&lt;\vec{s},\vec{a}&gt;*&lt;\vec{s},\vec{b}&gt;-&lt;\vec{s},\vec{c}&gt;= (5+30)*1-35=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9084em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord">∗</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1719em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9084em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">s</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">c</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">30</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">35</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span></p>
<p>最后得到完整的R1CS：</p>
<p>A:<br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0, 1, 0, 0, 0, 0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0, 0, 0, 1, 0, 0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0, 1, 0, 0, 1, 0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>5</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[5, 0, 0, 0, 0, 1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span></p>
<p>B:<br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0, 1, 0, 0, 0, 0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0, 1, 0, 0, 0, 0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[1, 0, 0, 0, 0, 0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[1, 0, 0, 0, 0, 0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">]</span></span></span></span></p>
<p>C:<br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0, 0, 0, 1, 0, 0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0, 0, 0, 0, 1, 0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0, 0, 0, 0, 0, 1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0, 0, 1, 0, 0, 0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">]</span></span></span></span></p>
<h1 id="R1CS-to-QAP"><a class="header-anchor" href="#R1CS-to-QAP"> </a>R1CS to QAP</h1>
<p>下一步是将这个 R1CS 转换成 QAP 形式。它实现了完全相同的逻辑，只是使用了多项式而不是点积。</p>
<p>通过使用<strong>拉格朗日插值</strong>或<strong>快速傅里叶逆变换</strong>来将4组长度为6的三个向量转换为3组6个3次多项式。</p>
<p>具体作法：<br>
从每个a向量中取出一个值，用拉格朗日插值来构造一个多项式(在 i 处的多项式得到 i 的第一个值)</p>
<p>从第一列得到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mn>2</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mn>3</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mn>4</mn><mo separator="true">,</mo><mn>5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1,0),(2,0),(3,0),(4,5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord">4</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">5</span><span class="mclose">)</span></span></span></span>使用这4个点用拉格朗日插值构造多项式，以此类推。</p>
<p>最后得到多项式</p>
<p>A polynomials<br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mo>−</mo><mn>5.0</mn><mo separator="true">,</mo><mn>9.166</mn><mo separator="true">,</mo><mo>−</mo><mn>5.0</mn><mo separator="true">,</mo><mn>0.833</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[-5.0, 9.166, -5.0, 0.833]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">−</span><span class="mord">5.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">9.166</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">5.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.833</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>8.0</mn><mo separator="true">,</mo><mo>−</mo><mn>11.333</mn><mo separator="true">,</mo><mn>5.0</mn><mo separator="true">,</mo><mo>−</mo><mn>0.666</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[8.0, -11.333, 5.0, -0.666]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">8.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">11.333</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">5.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">0.666</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0.0</mn><mo separator="true">,</mo><mn>0.0</mn><mo separator="true">,</mo><mn>0.0</mn><mo separator="true">,</mo><mn>0.0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0.0, 0.0, 0.0, 0.0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.0</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mo>−</mo><mn>6.0</mn><mo separator="true">,</mo><mn>9.5</mn><mo separator="true">,</mo><mo>−</mo><mn>4.0</mn><mo separator="true">,</mo><mn>0.5</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[-6.0, 9.5, -4.0, 0.5]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">−</span><span class="mord">6.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">9.5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">4.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.5</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>4.0</mn><mo separator="true">,</mo><mo>−</mo><mn>7.0</mn><mo separator="true">,</mo><mn>3.5</mn><mo separator="true">,</mo><mo>−</mo><mn>0.5</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[4.0, -7.0, 3.5, -0.5]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">4.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">7.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">3.5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">0.5</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mo>−</mo><mn>1.0</mn><mo separator="true">,</mo><mn>1.833</mn><mo separator="true">,</mo><mo>−</mo><mn>1.0</mn><mo separator="true">,</mo><mn>0.166</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[-1.0, 1.833, -1.0, 0.166]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">−</span><span class="mord">1.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1.833</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">1.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.166</span><span class="mclose">]</span></span></span></span></p>
<p>B polynomials<br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>3.0</mn><mo separator="true">,</mo><mo>−</mo><mn>5.166</mn><mo separator="true">,</mo><mn>2.5</mn><mo separator="true">,</mo><mo>−</mo><mn>0.333</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[3.0, -5.166, 2.5, -0.333]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">3.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">5.166</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2.5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">0.333</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mo>−</mo><mn>2.0</mn><mo separator="true">,</mo><mn>5.166</mn><mo separator="true">,</mo><mo>−</mo><mn>2.5</mn><mo separator="true">,</mo><mn>0.333</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[-2.0, 5.166, -2.5, 0.333]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">−</span><span class="mord">2.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">5.166</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">2.5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.333</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0.0</mn><mo separator="true">,</mo><mn>0.0</mn><mo separator="true">,</mo><mn>0.0</mn><mo separator="true">,</mo><mn>0.0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0.0, 0.0, 0.0, 0.0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.0</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0.0</mn><mo separator="true">,</mo><mn>0.0</mn><mo separator="true">,</mo><mn>0.0</mn><mo separator="true">,</mo><mn>0.0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0.0, 0.0, 0.0, 0.0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.0</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0.0</mn><mo separator="true">,</mo><mn>0.0</mn><mo separator="true">,</mo><mn>0.0</mn><mo separator="true">,</mo><mn>0.0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0.0, 0.0, 0.0, 0.0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.0</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0.0</mn><mo separator="true">,</mo><mn>0.0</mn><mo separator="true">,</mo><mn>0.0</mn><mo separator="true">,</mo><mn>0.0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0.0, 0.0, 0.0, 0.0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.0</span><span class="mclose">]</span></span></span></span></p>
<p>C polynomials<br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0.0</mn><mo separator="true">,</mo><mn>0.0</mn><mo separator="true">,</mo><mn>0.0</mn><mo separator="true">,</mo><mn>0.0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0.0, 0.0, 0.0, 0.0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.0</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0.0</mn><mo separator="true">,</mo><mn>0.0</mn><mo separator="true">,</mo><mn>0.0</mn><mo separator="true">,</mo><mn>0.0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0.0, 0.0, 0.0, 0.0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.0</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mo>−</mo><mn>1.0</mn><mo separator="true">,</mo><mn>1.833</mn><mo separator="true">,</mo><mo>−</mo><mn>1.0</mn><mo separator="true">,</mo><mn>0.166</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[-1.0, 1.833, -1.0, 0.166]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">−</span><span class="mord">1.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1.833</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">1.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.166</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>4.0</mn><mo separator="true">,</mo><mo>−</mo><mn>4.333</mn><mo separator="true">,</mo><mn>1.5</mn><mo separator="true">,</mo><mo>−</mo><mn>0.166</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[4.0, -4.333, 1.5, -0.166]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">4.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">4.333</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1.5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">0.166</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mo>−</mo><mn>6.0</mn><mo separator="true">,</mo><mn>9.5</mn><mo separator="true">,</mo><mo>−</mo><mn>4.0</mn><mo separator="true">,</mo><mn>0.5</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[-6.0, 9.5, -4.0, 0.5]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">−</span><span class="mord">6.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">9.5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">4.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.5</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>4.0</mn><mo separator="true">,</mo><mo>−</mo><mn>7.0</mn><mo separator="true">,</mo><mn>3.5</mn><mo separator="true">,</mo><mo>−</mo><mn>0.5</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[4.0, -7.0, 3.5, -0.5]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">4.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">7.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">3.5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">0.5</span><span class="mclose">]</span></span></span></span></p>
<p>系数按升序排列，所以上面的第一个多项式实际上是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.833</mn><msup><mi>x</mi><mn>3</mn></msup><mo>−</mo><mn>5</mn><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mn>9.166</mn><mi>x</mi><mo>−</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">0.833x^3-5x^2 + 9.166x-5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord">0.833</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord">5</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">9.166</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">5</span></span></span></span>。这组多项式(加上我稍后解释的 z 多项式)构成了这个特定 QAP 实例的参数。</p>
<h1 id="检查-QAP"><a class="header-anchor" href="#检查-QAP"> </a>检查 QAP</h1>
<p>我们可以将x带入多项式，例如<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></p>
<p>A results at x=1<br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mspace linebreak="newline"></mspace><mn>1</mn><mspace linebreak="newline"></mspace><mn>0</mn><mspace linebreak="newline"></mspace><mn>0</mn><mspace linebreak="newline"></mspace><mn>0</mn><mspace linebreak="newline"></mspace><mn>0</mn><mspace linebreak="newline"></mspace></mrow><annotation encoding="application/x-tex">
0\\
1\\
0\\
0\\
0\\
0\\
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span><span class="mspace newline"></span></span></span></p>
<p>B results at x=1<br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mspace linebreak="newline"></mspace><mn>1</mn><mspace linebreak="newline"></mspace><mn>0</mn><mspace linebreak="newline"></mspace><mn>0</mn><mspace linebreak="newline"></mspace><mn>0</mn><mspace linebreak="newline"></mspace><mn>0</mn><mspace linebreak="newline"></mspace></mrow><annotation encoding="application/x-tex">
0\\
1\\
0\\
0\\
0\\
0\\
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span><span class="mspace newline"></span></span></span></p>
<p>C results at x=1<br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mspace linebreak="newline"></mspace><mn>0</mn><mspace linebreak="newline"></mspace><mn>0</mn><mspace linebreak="newline"></mspace><mn>1</mn><mspace linebreak="newline"></mspace><mn>0</mn><mspace linebreak="newline"></mspace><mn>0</mn><mspace linebreak="newline"></mspace></mrow><annotation encoding="application/x-tex">
0\\
0\\
0\\
1\\
0\\
0\\
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span><span class="mspace newline"></span></span></span></p>
<p>这里有的，和我们上面创建的第一个逻辑门的，三个向量的集合完全一样。</p>
<p>与其单一检查R1CS的约束不如对多项式进行点积同时来检查所有的约束。</p>
<p><img src="/posts/45c3b13b/f2.png" alt></p>
<p>例如当<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>时：<br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn><mo>∗</mo><mo stretchy="false">(</mo><mo>−</mo><mn>5</mn><mo stretchy="false">)</mo><mo>+</mo><mn>3</mn><mo>∗</mo><mn>8</mn><mo>+</mo><mn>35</mn><mo>∗</mo><mn>0</mn><mo>+</mo><mn>9</mn><mo>∗</mo><mo stretchy="false">(</mo><mo>−</mo><mn>6</mn><mo stretchy="false">)</mo><mo>+</mo><mn>27</mn><mo>∗</mo><mn>4</mn><mo>+</mo><mn>30</mn><mo>∗</mo><mo stretchy="false">(</mo><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><mn>43</mn></mrow><annotation encoding="application/x-tex">A(1)=1*(-5)+3*8+35*0+9*(-6)+27*4+30*(-1)=43</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">5</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">35</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">9</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">6</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">27</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">30</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">43</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo stretchy="false">(</mo><mn>2</mn><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn><mo>∗</mo><mn>9.166</mn><mo>+</mo><mn>3</mn><mo>∗</mo><mo stretchy="false">(</mo><mo>−</mo><mn>11.333</mn><mo stretchy="false">)</mo><mo>+</mo><mn>35</mn><mo>∗</mo><mn>0</mn><mo>+</mo><mn>9</mn><mo>∗</mo><mn>9.5</mn><mo>+</mo><mn>27</mn><mo>∗</mo><mo stretchy="false">(</mo><mo>−</mo><mn>7</mn><mo stretchy="false">)</mo><mo>+</mo><mn>30</mn><mo>∗</mo><mn>1.833</mn><mo>=</mo><mo>−</mo><mn>73.333</mn></mrow><annotation encoding="application/x-tex">A(2)=1*9.166+3*(-11.333)+35*0+9*9.5+27*(-7)+30*1.833=-73.333</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">9.166</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">11.333</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">35</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">9</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">9.5</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">27</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">7</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">30</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1.833</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">−</span><span class="mord">73.333</span></span></span></span><br>
…</p>
<p>得出：<br>
<a href="https://www.symbolab.com/solver/vector-dot-product-calculator/%5Cbegin%7Bpmatrix%7D-5%269%2B%5Cfrac%7B1%7D%7B6%7D%26-5%26%5Cfrac%7B5%7D%7B6%7D%5C%5C%20%20%20%20%20%20%20%208%26-11-%5Cfrac%7B1%7D%7B3%7D%265%26-%5Cfrac%7B2%7D%7B3%7D%5C%5C%20%20%20%20%20%20%20%200%260%260%260%5C%5C%20%20%20%20%20%20%20%20-6%269.5%26-4%26.5%5C%5C%20%20%20%20%20%20%20%204%26-7%263.5%26-.5%5C%5C%20%20%20%20%20%20%20%20-1%26%5Cfrac%7B11%7D%7B6%7D%26-1%26%5Cfrac%7B1%7D%7B6%7D%5Cend%7Bpmatrix%7D%5E%7BT%7D%5Ccdot%5Cbegin%7Bpmatrix%7D1%263%2635%269%2627%2630%5Cend%7Bpmatrix%7D%5E%7BT%7D"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>⋅</mo><mi>s</mi><mo>=</mo><mo stretchy="false">[</mo><mn>43.0</mn><mo separator="true">,</mo><mo>−</mo><mn>73.333</mn><mo separator="true">,</mo><mn>38.5</mn><mo separator="true">,</mo><mo>−</mo><mn>5.166</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">A \cdot s = [43.0, -73.333, 38.5, -5.166]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">43.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">73.333</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">38.5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">5.166</span><span class="mclose">]</span></span></span></span></a><br>
<a href="https://www.symbolab.com/solver/vector-dot-product-calculator/%5Cbegin%7Bpmatrix%7D3%26-5-%5Cfrac%7B1%7D%7B6%7D%262.5%26-%5Cfrac%7B1%7D%7B3%7D%5C%5C%20%20-2%265%2B%5Cfrac%7B1%7D%7B6%7D%26-2.5%26%5Cfrac%7B1%7D%7B3%7D%5C%5C%20%20%20%20%20%20%20%20%200%260%260%260%5C%5C%20%20%20%20%20%20%20%20%200%260%260%260%5C%5C%20%20%20%20%20%20%20%20%200%260%260%260%5C%5C%20%20%20%20%20%20%20%20%200%260%260%260%5Cend%7Bpmatrix%7D%5E%7BT%7D%5Ccdot%5Cbegin%7Bpmatrix%7D1%263%2635%269%2627%2630%5Cend%7Bpmatrix%7D%5E%7BT%7D"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>⋅</mo><mi>s</mi><mo>=</mo><mo stretchy="false">[</mo><mo>−</mo><mn>3.0</mn><mo separator="true">,</mo><mn>10.333</mn><mo separator="true">,</mo><mo>−</mo><mn>5.0</mn><mo separator="true">,</mo><mn>0.666</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">B \cdot s = [-3.0, 10.333, -5.0, 0.666]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">−</span><span class="mord">3.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">10.333</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">5.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.666</span><span class="mclose">]</span></span></span></span></a><br>
<a href="https://www.symbolab.com/solver/vector-dot-product-calculator/%5Cbegin%7Bpmatrix%7D0%260%260%260%5C%5C%200%260%260%260%5C%5C%20-1%26%5Cfrac%7B11%7D%7B6%7D%26-1%26%5Cfrac%7B1%7D%7B6%7D%5C%5C%204%26-%5Cfrac%7B26%7D%7B6%7D%261.5%26-%5Cfrac%7B1%7D%7B6%7D%5C%5C%20-6%269.5%26-4%26%5Cfrac%7B1%7D%7B2%7D%5C%5C%204%26-7%263.5%26-0.5%5Cend%7Bpmatrix%7D%5E%7BT%7D%5Ccdot%5Cbegin%7Bpmatrix%7D1%263%2635%269%2627%2630%5Cend%7Bpmatrix%7D%5E%7BT%7D"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo>⋅</mo><mi>s</mi><mo>=</mo><mo stretchy="false">[</mo><mo>−</mo><mn>41.0</mn><mo separator="true">,</mo><mn>71.666</mn><mo separator="true">,</mo><mo>−</mo><mn>24.5</mn><mo separator="true">,</mo><mn>2.833</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">C \cdot s = [-41.0, 71.666, -24.5, 2.833]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">−</span><span class="mord">41.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">71.666</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">24.5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2.833</span><span class="mclose">]</span></span></span></span></a></p>
<p><a href="https://www.symbolab.com/solver/vector-dot-product-calculator/%5Cleft(-%5Cleft(5%2B%5Cfrac%7B1%7D%7B6%7D%5Cright)%20x%5E%7B3%7D%2B38.5x%5E%7B2%7D-%5Cleft(73%2B%5Cfrac%7B1%7D%7B3%7D%5Cright)x%2B43%5Cright)%5Cleft(%5Cfrac%7B2%7D%7B3%7Dx%5E%7B3%7D-5x%5E%7B2%7D%2B%5Cleft(10%2B%5Cfrac%7B1%7D%7B3%7D%5Cright)x-3%5Cright)-%5Cleft(%5Cleft(2%2B%5Cfrac%7B5%7D%7B6%7D%5Cright)x%5E%7B3%7D-24.5x%5E%7B2%7D%2B%5Cleft(71%2B%5Cfrac%7B2%7D%7B3%7D%5Cright)x-41%5Cright)"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>⋅</mo><mi>s</mi><mo>∗</mo><mi>B</mi><mo>⋅</mo><mi>s</mi><mo>−</mo><mi>C</mi><mo>⋅</mo><mi>s</mi></mrow><annotation encoding="application/x-tex">A \cdot s*B \cdot s -C\cdot s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span></a><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mo stretchy="false">(</mo><mo>−</mo><mn>5.166</mn><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><mn>38.5</mn><msup><mi>x</mi><mn>2</mn></msup><mo>−</mo><mn>73.333</mn><mi>x</mi><mo>+</mo><mn>43</mn><mo stretchy="false">)</mo><mo>∗</mo><mo stretchy="false">(</mo><mn>0.666</mn><msup><mi>x</mi><mn>3</mn></msup><mo>−</mo><mn>5</mn><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mn>10.333</mn><mi>x</mi><mo>−</mo><mn>3</mn><mo stretchy="false">)</mo><mo>−</mo><mo stretchy="false">(</mo><mn>2.833</mn><mo>∗</mo><msup><mi>x</mi><mn>3</mn></msup><mo>−</mo><mn>24.5</mn><mo>∗</mo><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mn>71.666</mn><mi>x</mi><mo>−</mo><mn>41</mn><mo stretchy="false">)</mo><mo>=</mo><mo>−</mo><mn>3.444</mn><msup><mi>x</mi><mn>6</mn></msup><mo>+</mo><mn>51.5</mn><msup><mi>x</mi><mn>5</mn></msup><mo>−</mo><mn>294.777</mn><msup><mi>x</mi><mn>4</mn></msup><mo>+</mo><mn>805.833</mn><msup><mi>x</mi><mn>3</mn></msup><mo>−</mo><mn>1063.777</mn><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mn>592.666</mn><mi>x</mi><mo>−</mo><mn>88</mn></mrow><annotation encoding="application/x-tex">=(-5.166x^3+38.5x^2-73.333x+43)*(0.666x^3-5x^2+10.333x-3)-(2.833*x^3-24.5*x^2+71.666x-41)=-3.444x^6+51.5x^5-294.777x^4+805.833x^3-1063.777x^2+592.666x-88</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">5.166</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord">38.5</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">73.333</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">43</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">0.666</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord">5</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">10.333</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2.833</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">24.5</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">71.666</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">41</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord">−</span><span class="mord">3.444</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord">51.5</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord">294.777</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord">805.833</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord">1063.777</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">592.666</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">88</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mo stretchy="false">[</mo><mo>−</mo><mn>88.0</mn><mo separator="true">,</mo><mn>592.666</mn><mo separator="true">,</mo><mo>−</mo><mn>1063.777</mn><mo separator="true">,</mo><mspace></mspace><mn>805.833</mn><mo separator="true">,</mo><mo>−</mo><mn>294.777</mn><mo separator="true">,</mo><mn>51.5</mn><mo separator="true">,</mo><mo>−</mo><mn>3.444</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">t=[-88.0, 592.666, -1063.777,\allowbreak 805.833, -294.777, 51.5, -3.444]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">−</span><span class="mord">88.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">592.666</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">1063.777</span><span class="mpunct">,</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.1667em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">805.833</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">294.777</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">51.5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">3.444</span><span class="mclose">]</span></span></span></span></p>
<p>Z定义为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>2</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>3</mn><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">(x-1)(x-2)(x-3)...</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mclose">)</span><span class="mord">...</span></span></span></span>在对应于逻辑门的所有点处为零的最简单多项式。代数的一个基本事实是，任何在所有这些点上都等于 0 的多项式必须是这个最小多项式的倍数。即Z应该为t的因式。</p>
<p>计算：</p>
<p><a href="https://www.symbolab.com/solver/vector-dot-product-calculator/%5Cleft(x%20-%201%5Cright)%20%5Ccdot%20%5Cleft(x%20-%202%5Cright)%20%5Ccdot%20%5Cleft(x%20-%203%5Cright)%20%5Ccdot%20%5Cleft(x%20-%204%5Cright)"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi><mo>=</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>2</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>3</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>4</mn><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">[</mo><mn>24</mn><mo separator="true">,</mo><mo>−</mo><mn>50</mn><mo separator="true">,</mo><mn>35</mn><mo separator="true">,</mo><mo>−</mo><mn>10</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">Z =(x-1)(x-2)(x-3)(x-4)=[24,-50,35,-10,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">4</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">24</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">50</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">35</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">10</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span></a></p>
<p><a href="https://www.wolframalpha.com/widget/widgetPopup.jsp?p=v&amp;id=330407de24ae45cf5e6ae7c814f1f459&amp;title=Dividing%20Polynomials%20Calculator&amp;theme=blue&amp;i0=-(3%2B4/9)*x%5E6%2B51.5*x%5E5-(294%2B7/9)*x%5E4%2B(805%2B5/6)*x%5E3-(1063%2B7/9)*x%5E2%2B(592%2B2/3)*x-88&amp;i1=x%5E4-10x%5E3%2B35x%5E2-50x%2B24&amp;podSelect=&amp;includepodid=Input&amp;includepodid=QuotientAndRemainder&amp;podstate=QuotientAndRemainder__Step-by-step%20solution&amp;showAssumptions=1&amp;showWarnings=1"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo>=</mo><mi>t</mi><mi mathvariant="normal">/</mi><mi>Z</mi><mo>=</mo><mo stretchy="false">[</mo><mo>−</mo><mn>3.666</mn><mo separator="true">,</mo><mn>17.055</mn><mo separator="true">,</mo><mo>−</mo><mn>3.444</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">H = t/Z = [-3.666,17.055,-3.444]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">t</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">−</span><span class="mord">3.666</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">17.055</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord">3.444</span><span class="mclose">]</span></span></span></span></a> (wolframalpha 计算有误差)</p>
<p>精确值：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo>=</mo><mi>t</mi><mi mathvariant="normal">/</mi><mi>z</mi><mo>=</mo><mo>−</mo><mfrac><mn>31</mn><mn>9</mn></mfrac><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mfrac><mn>307</mn><mn>18</mn></mfrac><mi>x</mi><mo>−</mo><mfrac><mn>66</mn><mn>18</mn></mfrac></mrow><annotation encoding="application/x-tex">H = t/z = -\frac{31}{9}x^2+\frac{307}{18}x-\frac{66}{18}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">t</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord">−</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">9</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">18</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">307</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">18</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">66</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p>
<p>即：t可被Z整除。即Z为t的因式。</p>
<p>如果我们试图伪造 R1CS 解决方案中的任何变量。则t不会是Z的倍数。</p>
<h1 id="参考资料-5"><a class="header-anchor" href="#参考资料-5"> </a>参考资料</h1>
<blockquote>
<p><a href="https://james-christopher-ray.medium.com/here-are-the-calculations-for-the-product-of-a-b-and-c-with-s-ae6a3f94647a">https://james-christopher-ray.medium.com/here-are-the-calculations-for-the-product-of-a-b-and-c-with-s-ae6a3f94647a</a><br>
<a href="https://medium.com/@VitalikButerin/quadratic-arithmetic-programs-from-zero-to-hero-f6d558cea649">https://medium.com/@VitalikButerin/quadratic-arithmetic-programs-from-zero-to-hero-f6d558cea649</a></p>
</blockquote>
]]></content>
      <categories>
        <category>区块链</category>
      </categories>
      <tags>
        <tag>区块链</tag>
        <tag>零知识证明</tag>
      </tags>
  </entry>
  <entry>
    <title>零知识证明 二 多项式</title>
    <url>/posts/24a9f174/</url>
    <content><![CDATA[<h1 id="多项式"><a class="header-anchor" href="#多项式"> </a>多项式</h1>
<p>零知识采用多项式充当证明的媒介。</p>
<p>其中涉及到代数基本定理：</p>
<ul>
<li>任何复系数一元<code>n</code>次多项式，方程在复数域上至少有一根(<code>n≥1</code>)，由此推出，<code>n</code>次复系数多项式方程在复数域内有且只有<code>n</code>个根。</li>
</ul>
<p>进而可推出，当两个次数相同的一元<code>n</code>次多项式有且只有<code>n</code>个交点。</p>
<h2 id="示例"><a class="header-anchor" href="#示例"> </a>示例</h2>
<p>假设验证者手中有一个一元<code>n</code>次多项式。</p>
<p>证明者声称他知道验证者的多项式。</p>
<p>他们可以使用以下的方式进行交互：</p>
<ul>
<li>验证者选出一个随机的值<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>，并求出多项式结果。</li>
<li>验证者把<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>给证明者，要求证明者对<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>进行求值。</li>
<li>证明者将结果给验证者。</li>
<li>验证者检验证明者给的值是否与自己计算的一致。如果一致那么这个语句将会有很大程度是真的。</li>
</ul>
<p>例如，如果我们考虑<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>的整数范围从1到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>77</mn></msup></mrow><annotation encoding="application/x-tex">10^{77}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">77</span></span></span></span></span></span></span></span></span></span></span></span>，不同多项式的非交点最少为是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>77</mn></msup><mo>−</mo><mi>d</mi></mrow><annotation encoding="application/x-tex">10^{77}-d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">77</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span> (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span>：次数)，因此<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>意外“命中”任何<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span>的交点的概率等于(微不足道的) :</p>
<p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mi>d</mi><mrow><mn>1</mn><msup><mn>0</mn><mn>77</mn></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{d}{10^{77}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">77</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>假设<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span>足够小于范围的上限，几乎是100%</p>
<h1 id="参考资料-6"><a class="header-anchor" href="#参考资料-6"> </a>参考资料</h1>
<blockquote>
<p><a href="https://medium.com/@imolfar/why-and-how-zk-snark-works-1-introduction-the-medium-of-a-proof-d946e931160">https://medium.com/@imolfar/why-and-how-zk-snark-works-1-introduction-the-medium-of-a-proof-d946e931160</a></p>
</blockquote>
]]></content>
      <categories>
        <category>区块链</category>
      </categories>
      <tags>
        <tag>区块链</tag>
        <tag>零知识证明</tag>
      </tags>
  </entry>
</search>
